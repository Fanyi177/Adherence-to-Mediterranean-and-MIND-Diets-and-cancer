#整理UKB膳食数据
memory.limit(999999999999)
library(data.table)
data<-fread("E:/deskbook/food.csv",header=T) # 502357 obs 1408 variables
colnames(data)
#查看每次膳食数据的数量 14%,20%,17%,21%,20%
colSums(is.na(data)[,1399:1403])/nrow(data)
#删除无膳食数据 剩余210957 obs 
library(tidyverse)
data2<-data%>%filter(!(is.na(`100002-0.0`)&is.na(`100002-1.0`)&is.na(`100002-2.0`)&is.na(`100002-3.0`)&is.na(`100002-4.0`)))# 排除291,400obs
#能量调整 使用*energy/2000进行调整 
options(max.print = 1000000)
colnames(data2)
data3<-subset(data2,select=c(1))
colnames(data3)
data4<-subset(data2,select=c(24:1378))
colnames(data4)
data_cov<-subset(data2,select=c(1,2:23,1379:1408))
n<-nrow(data4)
#提取105010####
data_105010<-subset(data,select=c(1,1399:1403))
#本来想直接完成能量转换，发现不行#####
colnames(data4)
n<-nrow(data4)
data5<-data.frame(matrix(0,n,ncol(data4)))
pb <- progress_bar$new(total = length(6:1355) * nrow(data4))
for (i in 6:1355) {
  for (j in 1:nrow(data4)) {
    data5[j, i] <- ifelse(
      which(colnames(data4) == colnames(data4)[i]) %% 5 == 1,
      data4[j, get(colnames(data4)[i])]* data4$`100002-0.0`/ 2000,ifelse(
        which(colnames(data4) == colnames(data4)[i]) %% 5 == 2, 
        data4[j, get(colnames(data4)[i])] * data4$`100002-1.0` / 2000,ifelse(
          which(colnames(data4) == colnames(data4)[i]) %% 5 == 3,
          data4[j, get(colnames(data4)[i])] * data4$`100002-2.0` / 2000,ifelse(
            which(colnames(data4) == colnames(data4)[i]) %% 5 == 4,
            data4[j, get(colnames(data4)[i])] * data4$`100002-3.0` / 2000,
            data4[j, get(colnames(data4)[i])] * data4$`100002-4.0` / 2000
          ))))
    pb$tick()}
}
#重新实践代码，将每次相应随访的数据放在一起#####
# 筛选出基线随访的列
selected_columns <- which(seq_len(ncol(data4)) %% 5 == 1)
# 按照条件对列进行排序
sorted_columns <- c(selected_columns, setdiff(seq_len(ncol(data4)), selected_columns))
# 根据排序后的列名生成新的数据框
new_data1<- data4[, ..sorted_columns]
colnames(new_data1)
new_data1_1<-subset(new_data1,select=c(1:24))
new_data1_2<-subset(new_data1,select=c(25:271))
colnames(new_data1_1)
# 筛选出第一次随访的列
selected_columns <- which(seq_len(ncol(data4)) %% 5 == 2)
# 按照条件对列进行排序
sorted_columns <- c(selected_columns, setdiff(seq_len(ncol(data4)), selected_columns))
# 根据排序后的列名生成新的数据框
new_data2 <- data4[, ..sorted_columns]
colnames(new_data2)
new_data2_1<-subset(new_data2,select=c(1:24))
new_data2_2<-subset(new_data2,select=c(25:271))
# 筛选出第二次随访的列
selected_columns <- which(seq_len(ncol(data4)) %% 5 == 3)
# 按照条件对列进行排序
sorted_columns <- c(selected_columns, setdiff(seq_len(ncol(data4)), selected_columns))
# 根据排序后的列名生成新的数据框
new_data3 <- data4[, ..sorted_columns]
new_data3_1<-subset(new_data3,select=c(1:24))
new_data3_2<-subset(new_data3,select=c(25:271))
# 筛选出第三次随访的列
selected_columns <- which(seq_len(ncol(data4)) %% 5 == 4)
# 按照条件对列进行排序
sorted_columns <- c(selected_columns, setdiff(seq_len(ncol(data4)), selected_columns))
# 根据排序后的列名生成新的数据框
new_data4 <- data4[, ..sorted_columns]
new_data4_1<-subset(new_data4,select=c(1:24))
new_data4_2<-subset(new_data4,select=c(25:271))
# 筛选出第四次随访的列
selected_columns <- which(seq_len(ncol(data4)) %% 5 == 0)
# 按照条件对列进行排序
sorted_columns <- c(selected_columns, setdiff(seq_len(ncol(data4)), selected_columns))
# 根据排序后的列名生成新的数据框
new_data5 <- data4[, ..sorted_columns]
new_data5_1<-subset(new_data5,select=c(1:24))
new_data5_2<-subset(new_data5,select=c(25:271))
#对各个数据进行能量调整使用*energy/2000进行调整 
#基线能量调整
new_data11<-data.frame(matrix(0,n,ncol(new_data1_1)))
for (i in 2:ncol(new_data1_1)){
  new_data11[,1]<-new_data1_1[,1]
  colnames(new_data11)[1]<-colnames(new_data1_1)[1]
  new_data11[,i]<-new_data1_1[, get(colnames(new_data1_1)[i])]* data4$`100002-0.0`/ 2000
  colnames(new_data11)[i]<-colnames(new_data1_1)[i]
}
#第一次随访能量调整
new_data21<-data.frame(matrix(0,n,ncol(new_data2_1)))
for (i in 2:ncol(new_data2_1)){
  new_data21[,1]<-new_data2_1[,1]
  colnames(new_data21)[1]<-colnames(new_data2_1)[1]
  new_data21[,i]<-new_data2_1[, get(colnames(new_data2_1)[i])]* data4$`100002-1.0`/ 2000
  colnames(new_data21)[i]<-colnames(new_data2_1)[i]
}
#第二次随访能量调整
new_data31<-data.frame(matrix(0,n,ncol(new_data3_1)))
for (i in 2:ncol(new_data3_1)){
  new_data31[,1]<-new_data3_1[,1]
  colnames(new_data31)[1]<-colnames(new_data3_1)[1]
  new_data31[,i]<-new_data3_1[, get(colnames(new_data3_1)[i])]* data4$`100002-2.0`/ 2000
  colnames(new_data31)[i]<-colnames(new_data3_1)[i]
}
#第三次随访能量调整
new_data41<-data.frame(matrix(0,n,ncol(new_data4_1)))
for (i in 2:ncol(new_data4_1)){
  new_data41[,1]<-new_data4_1[,1]
  colnames(new_data41)[1]<-colnames(new_data4_1)[1]
  new_data41[,i]<-new_data4_1[, get(colnames(new_data4_1)[i])]* data4$`100002-3.0`/ 2000
  colnames(new_data41)[i]<-colnames(new_data4_1)[i]
}
#第四次随访能量调整
new_data51<-data.frame(matrix(0,n,ncol(new_data5_1)))
for (i in 2:ncol(new_data5_1)){
  new_data51[,1]<-new_data5_1[,1]
  colnames(new_data51)[1]<-colnames(new_data5_1)[1]
  new_data51[,i]<-new_data5_1[, get(colnames(new_data5_1)[i])]* data4$`100002-4.0`/ 2000
  colnames(new_data51)[i]<-colnames(new_data5_1)[i]
}
#data5为营养素，data5_2为食物组
data5<-cbind(data3,new_data11,new_data21,new_data31,new_data41,new_data51)
colnames(data5)
write.csv(data5,"E:/deskbook/data5.csv")
data5_2<-cbind(data3,new_data1_2,new_data2_2,new_data3_2,new_data4_2,new_data5_2)
colnames(data5_2)
#合并在excel整理的ICD数据
ICD<-fread("E:/deskbook/ICD.csv",header=T)
ICD<-merge(ICD,data_105010,by='eid',all.x = T)
write_excel_csv(ICD,"E:/deskbook/ICD.csv")
#整理paichufood
ICD<-fread("E:/deskbook/ICD.csv",header=T)
colnames(ICD)
ICD<-subset(ICD,select=c(1:20,57,80:84))
data6<-merge(data5,ICD,by='eid',all.x = T)
data6_2<-merge(data5_2,ICD,by='eid',all.x = T)
#排除基线患有恶性肿瘤的
colnames(data6)
data6<-filter(data6,Exclusion_1==0) #剩余193424例
data6_2<-filter(data6_2,Exclusion_1==0)#剩余193424例
#排除收集的24hFFQ在癌症发生前
data7<-data6%>%filter(paichufood!=1) #剩余190097例
data7_2<-data6_2%>%filter(paichufood!=1)#剩余190097例
#拿出eid，发病时间，膳食完成时间获得相关膳食元素平均摄入量信息
colnames(data7)
data_zhengli<-subset(data7,select=c(1:121,133:137,142:146,130))
colnames(data_zhengli)
data_zhengli[is.na(data_zhengli$Endpoint1), "Endpoint1"] <- 0
data_zhengli$`105010-0.0`<-as.Date(data_zhengli$`105010-0.0`, format="%Y/%m/%d")
data_zhengli$`105010-0.0`<-format(data_zhengli$`105010-0.0`, "%Y/%m/%d")
data_zhengli$`105010-1.0`<-as.Date(data_zhengli$`105010-1.0`, format="%Y/%m/%d")
data_zhengli$`105010-1.0`<-format(data_zhengli$`105010-1.0`, "%Y/%m/%d")
data_zhengli$`105010-2.0`<-as.Date(data_zhengli$`105010-2.0`, format="%Y/%m/%d")
data_zhengli$`105010-2.0`<-format(data_zhengli$`105010-2.0`, "%Y/%m/%d")
data_zhengli$`105010-3.0`<-as.Date(data_zhengli$`105010-3.0`, format="%Y/%m/%d")
data_zhengli$`105010-3.0`<-format(data_zhengli$`105010-3.0`, "%Y/%m/%d")
data_zhengli$`105010-4.0`<-as.Date(data_zhengli$`105010-4.0`, format="%Y/%m/%d")
data_zhengli$`105010-4.0`<-format(data_zhengli$`105010-4.0`, "%Y/%m/%d")
#整理需要用几次FFQ的膳食元素平均值数据,用python
#每2w样本量分为一份，为了多线程跑
# 计算数据行数和分组数量
setwd("E:/deskbook/data_subset")
n_rows <- nrow(data_zhengli)
n_groups <- ceiling(n_rows/20000)
# 循环创建数据子集并保存为CSV文件
for (i in 1:n_groups) {
  # 计算子集范围
  start_row <- (i-1) * 20000 + 1
  end_row <- min(i * 20000, n_rows)
  # 提取数据子集
  data_subset1 <- data_zhengli[start_row:end_row, ]
  # 保存数据子集为CSV文件
  filename <- paste0("data1_subset_", i, ".csv")
  write_excel_csv(data_subset1, file = filename)
}
#拿出eid，发病时间，膳食完成时间获得相关膳食平均摄入量信息
rm(data1,data2,data3,data4,data5,data5_2,data6,data6_2,new_data1,new_data1_1)
rm(data,data_105010,data_cov,data_subset,data,subset1,new_data1_2,new_data11,new_data2)
rm(new_data2_1,new_data2_2,new_data21,new_data3,new_data3_1,new_data3_2)
rm(new_data31,new_data4,new_data4_1,new_data4_2,new_data41,new_data5,new_data5_1,new_data5_2,new_data51)
data_zhengli_2<-subset(data7_2,select=c(1,2:1236,1248:1252,1257:1261,1245))
data_zhengli_2[is.na(data_zhengli_2$Endpoint1), "Endpoint1"] <- 0
data_zhengli_2[, 2:1236][data_zhengli_2[, 2:1236] == 555] <- 0.5
data_zhengli_2[, 2:1236][data_zhengli_2[, 2:1236] == 444] <- 0.25
data_zhengli_2[, 2:1236][data_zhengli_2[, 2:1236] == 200] <- 2.5
data_zhengli_2[, 2:1236][data_zhengli_2[, 2:1236] == 300] <- 3.5
data_zhengli_2[, 2:1236][data_zhengli_2[, 2:1236] == 400] <- 4.5
data_zhengli_2[, 2:1236][data_zhengli_2[, 2:1236] == 500] <- 5.5
data_zhengli_2[, 2:1236][data_zhengli_2[, 2:1236] == 600] <- 6.5
colnames(data_zhengli_2)
data_zhengli_2$`105010-0.0`<-as.Date(data_zhengli_2$`105010-0.0`, format="%Y/%m/%d")
data_zhengli_2$`105010-0.0`<-format(data_zhengli_2$`105010-0.0`, "%Y/%m/%d")
data_zhengli_2$`105010-1.0`<-as.Date(data_zhengli_2$`105010-1.0`, format="%Y/%m/%d")
data_zhengli_2$`105010-1.0`<-format(data_zhengli_2$`105010-1.0`, "%Y/%m/%d")
data_zhengli_2$`105010-2.0`<-as.Date(data_zhengli_2$`105010-2.0`, format="%Y/%m/%d")
data_zhengli_2$`105010-2.0`<-format(data_zhengli_2$`105010-2.0`, "%Y/%m/%d")
data_zhengli_2$`105010-3.0`<-as.Date(data_zhengli_2$`105010-3.0`, format="%Y/%m/%d")
data_zhengli_2$`105010-3.0`<-format(data_zhengli_2$`105010-3.0`, "%Y/%m/%d")
data_zhengli_2$`105010-4.0`<-as.Date(data_zhengli_2$`105010-4.0`, format="%Y/%m/%d")
data_zhengli_2$`105010-4.0`<-format(data_zhengli_2$`105010-4.0`, "%Y/%m/%d")
write_excel_csv(data_zhengli_2,"E:/deskbook/data_zhengli_2.csv")
#整理需要用几次FFQ的平均值数据,用python
#每2w样本量分为一份，为了多线程跑
# 计算数据行数和分组数量
n_rows <- nrow(data_zhengli_2)
n_groups <- ceiling(n_rows/20000)
# 循环创建数据子集并保存为CSV文件
for (i in 1:n_groups) {
  # 计算子集范围
  start_row <- (i-1) * 20000 + 1
  end_row <- min(i * 20000, n_rows)
  # 提取数据子集
  data_subset <- data_zhengli_2[start_row:end_row, ]
  # 保存数据子集为CSV文件
  filename <- paste0("data_subset_", i, ".csv")
  write_excel_csv(data_subset, file = filename)
}
#合并其他变量信息####
colnames(data7)
data8<-subset(data7,select=c(1,122,124,129:132,141))
colnames(data8)
#合并家族史和教育程度
setwd("E:/deskbook")
cov<-fread("E:/deskbook/cov.csv",header=T)
cov3<-fread("E:/deskbook/UKB/cov.csv",header=T)
cov3<-subset(cov3,select=c(1,127))
cov<-merge(cov,cov3,all.x = T,by="eid")
write_excel_csv(cov,"E:/deskbook/cov.csv")
colnames(cov)
cov2<-subset(cov,select = c(1,11,3,7,13,20,24,28,32,36,40,350,354,48,532))
colnames(cov2)
education_family_history<-subset(cov,select=c(1,17:19,218:349))
write_excel_csv(education_family_history,"E:/deskbook/education_family_history.csv")
#在excel上面整理出来
education<-fread("E:/deskbook/education_family_history.csv",header=T)#3 variable
data9<-merge(data8,education,by='eid',all.x = T) #190097 obs 10 vars
data9$education[data9$education==3]<-NA
data9$famaliy_history[data9$famaliy_history==3]<-NA
data9<-merge(data9,cov2,by='eid',all.x = T)
colnames(data9)
#编码性别和指数
data9$sex<-data9$`31-0.0`
data9$Townsend_deprivation_index<-data9$`189-0.0`
#整理变量
data9$shifang<-data9$`190-0.0`
data9$whr<-data9$`48-0.0`/data9$`49-0.0`
data9$household_income<-ifelse(data9$`738-0.0`<=2,0,1)
data9$weekly_activity<-ifelse(data9$`884-0.0`>=0&data9$`904-0.0`>=0,
                              rowMeans((select(data9,c(`884-0.0`,`904-0.0`)))),
                              ifelse(data9$`884-0.0`<0&data9$`904-0.0`<0,NA,
                                     ifelse(data9$`884-0.0`<0,data9$`904-0.0`,
                                            ifelse(data9$`904-0.0`<0,data9$`884-0.0`,0))))
data9$`1160-0.0`[data9$`1160-0.0`<=0]<-NA
data9$sleep_duration<-data9$`1160-0.0`
data9$smoking_status<-ifelse(data9$`1239-0.0`==1|data9$`1239-0.0`==2,3,ifelse(
  data9$`1249-0.0`==1,2,ifelse(data9$`1249-0.0`==2,1,
                               ifelse(data9$`1249-0.0`==3,0,
                                      ifelse(data9$`1249-0.0`==4,0,ifelse(data9$`1239-0.0`==0,0,NA))))))
data9$smoking_status<-factor(data9$smoking_status,levels=c(0,1,2,3),labels = c("Never","Former occasional smoker","Former regular smoker","Current somker"))
data9$alochol_drinking<-ifelse(data9$`1558-0.0`<=3&data9$`1558-0.0`>=1,2,
                               ifelse(data9$`1558-0.0`>=4&data9$`1558-0.0`<=5,1,
                                      ifelse(data9$`1558-0.0`==6,0,NA)))
data9$alochol_drinking<-factor(data9$alochol_drinking,levels = c(0,1,2),labels = c("Never","Occasional drinker","Regular drinker"))
data9$SBP<-data9$`4080-0.0`
data9$BMI<-data9$`21001-0.0`
data9$recruitment_age<-data9$`21022-0.0`
#删除失访的人群
data11<-data9%>%filter(is.na(shifang))# 189571obs
colnames(data11)
data11 <- subset(data11, select = -c(3,11:24))
#删除协变量缺失值 剩余187495 obs
data12<-data11%>%filter(!(is.na(famaliy_history)|is.na(education)|
                            is.na(Townsend_deprivation_index)|is.na(whr)|
                            is.na(BMI)|is.na(smoking_status)|is.na(alochol_drinking)|
                            is.na(household_income)))
#插补法填补数据
library(mice)
colnames(data12)
summary(data12)
tianbu<-mice(data12[,c(3,7:11,13:21)],m=5)
#插入填补数据
tianbu2<-complete(tianbu,action=2)
tianbu2$Townsend_deprivation_index2<- cut(tianbu2$Townsend_deprivation_index, breaks = quantile(tianbu2$Townsend_deprivation_index, probs = c(0, 0.33, 0.66, 1)), include.lowest = TRUE, labels = FALSE)#三分位分组
data13<-subset(data12,select=-c(3,7:11,13:21))
colnames(tianbu2)
UKBdata<-cbind(data13,tianbu2)
colnames(UKBdata)
table(UKBdata$various_cancer)
UKBdata[, 8][UKBdata[, 8] == "#N/A"] <- 9
UKBdata[, 8][UKBdata[, 8] == ""] <- 0
#导出UKB数据#####
#每2w样本量分为一份
# 计算数据行数和分组数量
setwd("E:/deskbook")
n_rows <- nrow(UKBdata)
n_groups <- ceiling(n_rows/20000)
# 循环创建数据子集并保存为CSV文件
for (i in 1:n_groups) {
  # 计算子集范围
  start_row <- (i-1) * 20000 + 1
  end_row <- min(i * 20000, n_rows)
  # 提取数据子集
  UKBdata_subset <- UKBdata[start_row:end_row, ]
  # 保存数据子集为CSV文件
  filename <- paste0("UKBdata_subset_", i, ".csv")
  write_excel_csv(UKBdata_subset, file = filename)
}
#读取python完成平均24hFFQ信息
setwd("E:/deskbook/data_subset")
file_names <- list.files(pattern = "^pan_cancer")
all_data <- list()
# 循环读取所有文件
for (file_name in file_names) {
  data <- fread(file_name,header=T)
  all_data[[file_name]] <- data
}
all_data_df <- do.call(rbind, all_data)# 190095 obs
#扣除膳食收集在发病之前的
all_data_df<-subset(all_data_df,select=-c(1))
colnames(all_data_df)
na_vec <- apply(all_data_df[, 2:495], 1, function(x) all(is.na(x)))
ffqdata <- all_data_df[!na_vec, ] # 190087obs
ffqdata<-subset(ffqdata,select=-c(496))
#ffq信息储存
write_excel_csv(ffqdata,"E:/deskbook/ffqdata.csv")
#读取python完成平均24hFFQ信息####
ffqdata<-fread("D:/deskbook/ffqdata.csv",header=T)
colnames(ffqdata)
ffqdata_1<-subset(ffqdata,select=c(1))
ffqdata_2<-subset(ffqdata,select=-c(1))
colnames(ffqdata_2) <- paste0("a", gsub(" ", "_", colnames(ffqdata_2)))
ffqdata<-cbind(ffqdata_1,ffqdata_2)
ffq<-fread("E:/deskbook/FFQ.csv",header=T) 
ffqdata2<-merge(ffqdata,ffq,by="eid",all.x = T)
colnames(ffqdata2)
ffqdata3<-ffqdata2[,-c(736:750,771:825)]
names(ffqdata3) <- gsub("\\.x", "", names(ffqdata3))
colnames(ffqdata3)
table(ffqdata3$Canned_soup_vegetables)
#计算评分
#MIND_sum1:利用平均24hFFQ和摄入总和计算####
ffqdata3$a104090_1_0.5<-ifelse(is.na(ffqdata3[, a104090_1]), NA, 0.5*ffqdata3[, a104090_1])
ffqdata3$a104060_1_0.5<-ifelse(is.na(ffqdata3[, a104060_1]), NA, 0.5*ffqdata3[, a104060_1])
ffqdata3$a104070_1_0.5<-ifelse(is.na(ffqdata3[, a104070_1]), NA, 0.5*ffqdata3[, a104070_1])
ffqdata3[, Green_Leafy_Vegetables_sum1:= rowSums(.SD, na.rm = TRUE), .SDcols = c("a104160_1", "a104300_1", "a104240_1","a104370_1", "a104090_1_0.5",
                                                                                 "a104360_1", "a104180_1", "a104080_1", "a104060_1_0.5", "a104070_1_0.5")]
table(ffqdata3$Green_Leafy_Vegetables_sum1)
#other vegetables
ffqdata3$Canned_soup_vegetables<-ifelse(
  is.na(ffqdata3$`20108-0.0`)&is.na(ffqdata3$`20108-0.1`)&is.na(ffqdata3$`20108-0.2`), 0,ifelse(
    ffqdata3$`20108-0.0` == 5| ffqdata3$`20108-0.1` ==5|ffqdata3$`20108-0.2`==5,0.25, 
    0))
ffqdata3$homemade_soup_vegetables<-ifelse(
  is.na(ffqdata3$`20109-0.0`)&is.na(ffqdata3$`20109-0.1`)&is.na(ffqdata3$`20109-0.2`), 0,ifelse(
    ffqdata3$`20109-0.0`== 5| ffqdata3$`20109-0.1`==5|ffqdata3$`20109-0.2`==5,0.25, 
    0))
ffqdata3[, Other_Vegetables_sum1:= rowSums(.SD, na.rm = TRUE), .SDcols = c("a104190_1", "a104170_1", "a104140_1","a104340_1", "a104350_1","a104320_1","a104060_1_0.5", "a104070_1_0.5","a104090_1_0.5",
                                                                           "a104130_1", "a104150_1", "a104200_1","a104210_1","a104220_1","a104230_1", 
                                                                           "a104250_1","a104260_1","a104270_1","a104290_1","a104310_1","a104330_1","a104380_1",'Canned_soup_vegetables',"homemade_soup_vegetables")]
table(ffqdata3$Other_Vegetables_sum1)
#Berries
ffqdata3[, Berries_sum1:= rowSums(.SD, na.rm = TRUE), .SDcols = c("a104470_1")]
table(ffqdata3$Berries_sum1)
summary(ffqdata3$Berries_sum1)
#Nuts
ffqdata3[, Nuts_sum1:= rowSums(.SD, na.rm = TRUE), .SDcols = c("a102430_1","a102410_1","a102450_1","a102440_1",
                                                               "a102420_1")]
table(ffqdata3$Nuts_sum1)
#Butter/margarine
ffqdata3$Butter_sum1<-ifelse(ffqdata3$a104040_1==1|ffqdata3$a101300_1==1|ffqdata3$a104040_1==1,1,0)
ffqdata3$Butter_sum1[is.na(ffqdata3$Butter_sum1)]<-0
table(ffqdata3$Butter_sum1)
#Whole_grains
ffqdata3[, Whole_grains_sum1:= rowSums(.SD, na.rm = TRUE), .SDcols = c("a100770_1","a100800_1","a100840_1","a100850_1",
                                                                       "a102720_1","a102740_1")]
table(ffqdata3$Whole_grains_sum1)
#Cheese
ffqdata3[, cheese_sum1:= rowSums(.SD, na.rm = TRUE), .SDcols = c("a102820_1","a102830_1","a102840_1","a102860_1",
                                                                 "a102870_1","a102880_1","a102890_1","a102900_1","a102910_1")]
table(ffqdata3$cheese_sum1)
#fish
ffqdata3$Canned_soup_fish<-ifelse(ffqdata3$`20108-0.0`==1|ffqdata3$`20108-0.1`==1|ffqdata3$`20108-0.2`==1|ffqdata3$`20108-0.3`==1,0.25,0)
ffqdata3$homemade_soup_fish<-ifelse(ffqdata3$`20109-0.0`==1|ffqdata3$`20109-0.1`==1|ffqdata3$`20109-0.2`==1|ffqdata3$`20109-0.3`==1,0.25,0)
summary(ffqdata3$Canned_soup_fish)
ffqdata3[,fish_sum1:= rowSums(.SD, na.rm = TRUE), .SDcols = c("a103150_1", "a103160_1","a103190_1", "a103200_1","a103210_1",
                                                              "a103220_1","a103230_1",'Canned_soup_fish',"homemade_soup_fish")]
summary(ffqdata3$fish_sum1)
#Beans
ffqdata3$Canned_soup_bean<-ifelse(ffqdata3$`20108-0.0`==4|ffqdata3$`20108-0.1`==4|ffqdata3$`20108-0.2`==4|ffqdata3$`20108-0.3`==4,0.25,0)
ffqdata3$homemade_soup_bean<-ifelse(ffqdata3$`20109-0.0`==4|ffqdata3$`20109-0.1`==4|ffqdata3$`20109-0.2`==4|ffqdata3$`20109-0.3`==4,0.25,0)
ffqdata3[,bean_sum1:= rowSums(.SD, na.rm = TRUE), .SDcols = c("a104000_1", "a104010_1","a104110_1", "a104120_1","a104280_1",
                                                              'Canned_soup_bean',"homemade_soup_bean","a103270_1")]
table(ffqdata3$bean_sum1)
#poultry
ffqdata3$Canned_soup_meat<-ifelse(ffqdata3$`20108-0.0`==2|ffqdata3$`20108-0.1`==2|ffqdata3$`20108-0.2`==2|ffqdata3$`20108-0.3`==2,0.25,0)
ffqdata3$homemade_soup_meat<-ifelse(ffqdata3$`20109-0.0`==2|ffqdata3$`20109-0.1`==2|ffqdata3$`20109-0.2`==2|ffqdata3$`20109-0.3`==2,0.25,0)
ffqdata3[,poultry_sum1:= rowSums(.SD, na.rm = TRUE), .SDcols = c("a103060_1",
                                                                 'Canned_soup_meat',"homemade_soup_meat")]
table(ffqdata3$poultry_sum1)
#red meat
ffqdata3[,red_meat_sum1:= rowSums(.SD, na.rm = TRUE), .SDcols = c("a103010_1","a103020_1","a103030_1","a103040_1","a103070_1",
                                                                  "a103080_1",'Canned_soup_meat',"homemade_soup_meat")]
table(ffqdata3$red_meat_sum1)
#Fast/fried foods 
ffqdata3[,fastfried_food_sum1:= rowSums(.SD, na.rm = TRUE), .SDcols = c("a103050_1","a103170_1","a103180_1","a104020_1","a102460_1")]
table(ffqdata3$fastfried_food_sum1)
#Pastries and sweets 
ffqdata3[,Pastries_sweets_sum1:= rowSums(.SD, na.rm = TRUE), .SDcols = c("a101970_1","a101980_1","a101990_1","a102010_1","a102020_1",
                                                                         "a102030_1","a102050_1","a102060_1",'a102070_1',
                                                                         "a102120_1","a102140_1",'a102150_1','a102170_1','a102180_1',
                                                                         "a102190_1","a102200_1","a102210_1","a102220_1","a102230_1",
                                                                         "a102260_1","a102270_1","a102280_1","a102290_1","a102300_1","a102310_1",
                                                                         "a102320_1","a102320_1",'a102330_1','a102340_1','a102350_1',
                                                                         "a102360_1",'a102370_1',"a102380_1")]
table(ffqdata3$Pastries_sweets_sum1)
#Wine
ffqdata3[,wine_sum1:= rowSums(.SD, na.rm = TRUE), .SDcols = c("a100590_1","a100630_1","a100670_1","a100720_1")]
table(ffqdata3$wine_sum1)
#MIND评分 基于平均FFQ摄入的总和
colnames(ffqdata3)
#查看是否有NA
missing_vals <- colSums(is.na(ffqdata3[,769:790]))
print(missing_vals)
ffqdata3$Green_Leafy_Vegetables_sum1_score<-ifelse(ffqdata3$Green_Leafy_Vegetables_sum1<=0.285714,0,ifelse(
  ffqdata3$Green_Leafy_Vegetables_sum1<0.857143,0.5,1))
table(ffqdata3$Green_Leafy_Vegetables_sum1_score)
ffqdata3$Other_Vegetables_sum1_score<-ifelse(ffqdata3$Other_Vegetables_sum1<0.714285,0,ifelse(
  ffqdata3$Other_Vegetables_sum1<1,0.5,1))
ffqdata3$Berries_sum1_score<-ifelse(ffqdata3$Berries_sum1<0.142857,0,ifelse(
  ffqdata3$Berries_sum1<0.285714,0.5,1))
ffqdata3$Nuts_sum1_score<-ifelse(ffqdata3$Nuts_sum1<0.071429,0,ifelse(
  ffqdata3$Nuts_sum1<=0.7142864,0.5,1))
ffqdata3$Butter_sum1_score<-ifelse(ffqdata3$Butter_sum1==1,1,0)
ffqdata3$cheese_sum1_score<-ifelse(ffqdata3$cheese_sum1>=1,0,ifelse(
  ffqdata3$cheese_sum1>0.142857,0.5,1))
ffqdata3$Whole_grains_sum1_score<-ifelse(ffqdata3$Whole_grains_sum1<1,0,ifelse(
  ffqdata3$cheese_sum1<=2,0.5,1))
ffqdata3$fish_sum1_score<-ifelse(ffqdata3$fish_sum1<0.03333,0,ifelse(
  ffqdata3$fish_sum1<=0.142857,0.5,1))
ffqdata3$bean_sum1_score<-ifelse(ffqdata3$bean_sum1<0.142857,0,ifelse(
  ffqdata3$bean_sum1<=0.428571,0.5,1))
ffqdata3$poultry_sum1_score<-ifelse(ffqdata3$poultry_sum1<0.142857,0,ifelse(
  ffqdata3$poultry_sum1<=0.428571,0.5,1))
ffqdata3$red_meat_sum1_score<-ifelse(ffqdata3$red_meat_sum1>0.857143,0,ifelse(
  ffqdata3$red_meat_sum1>=0.571429,0.5,1))
ffqdata3$fastfried_food_sum1_score<-ifelse(ffqdata3$fastfried_food_sum1>0.428571,0,ifelse(
  ffqdata3$fastfried_food_sum1>=0.142857,0.5,1))
ffqdata3$Pastries_sweets_sum1_score<-ifelse(ffqdata3$Pastries_sweets_sum1>1,0,ifelse(
  ffqdata3$Pastries_sweets_sum1>0.714286,0.5,1))
ffqdata3$wine_sum1_score<-ifelse(ffqdata3$wine_sum1<0.033333,0,ifelse(
  ffqdata3$wine_sum1<0.285714,0.5,1))
ffqdata3[,MIND_sum1:= rowSums(.SD, na.rm = TRUE), .SDcols = c("Green_Leafy_Vegetables_sum1_score","Other_Vegetables_sum1_score",
                                                              "Berries_sum1_score","Nuts_sum1_score","Butter_sum1_score","cheese_sum1_score",
                                                              "Whole_grains_sum1_score","fish_sum1_score","bean_sum1_score","poultry_sum1_score",
                                                              "red_meat_sum1_score","fastfried_food_sum1_score","Pastries_sweets_sum1_score","wine_sum1_score")]
table(ffqdata3[,MIND_sum1])
#MIND_sum2:利用基线24hFFQ和摄入总和计算####
ffqdata3$a104090_2_0.5<-ifelse(is.na(ffqdata3[, a104090_2]), NA, 0.5*ffqdata3[, a104090_2])
ffqdata3$a104060_2_0.5<-ifelse(is.na(ffqdata3[, a104060_2]), NA, 0.5*ffqdata3[, a104060_2])
ffqdata3$a104070_2_0.5<-ifelse(is.na(ffqdata3[, a104070_2]), NA, 0.5*ffqdata3[, a104070_2])
colnames(ffqdata3)
ffqdata3[, Green_Leafy_Vegetables_sum2:= rowSums(.SD, na.rm = TRUE), .SDcols = c("a104160_2", "a104300_2", "a104240_2","a104370_2", "a104090_2_0.5",
                                                                                 "a104360_2", "a104180_2", "a104080_2", "a104060_2_0.5", "a104070_2_0.5")]
table(ffqdata3$Green_Leafy_Vegetables_sum2)
#other vegetables
ffqdata3[, Other_Vegetables_sum2:= rowSums(.SD, na.rm = TRUE), .SDcols = c("a104190_2", "a104170_2", "a104140_2","a104340_2", "a104350_2","a104320_2","a104060_2_0.5", "a104070_2_0.5","a104090_2_0.5",
                                                                           "a104130_2", "a104150_2", "a104200_2","a104210_2","a104220_2","a104230_2", 
                                                                           "a104250_2","a104260_2","a104270_2","a104290_2","a104310_2","a104330_2","a104380_2",'Canned_soup_vegetables',"homemade_soup_vegetables")]
table(ffqdata3$Other_Vegetables_sum2)
#Berries
ffqdata3[, Berries_sum2:= rowSums(.SD, na.rm = TRUE), .SDcols = c("a104470_2")]
table(ffqdata3$Berries_sum2)
#Nuts
ffqdata3[, Nuts_sum2:= rowSums(.SD, na.rm = TRUE), .SDcols = c("a102430_2","a102410_2","a102450_2","a102440_2",
                                                               "a102420_2")]
table(ffqdata3$Nuts_sum2)
#Butter/margarine
ffqdata3$Butter_sum2<-ifelse(ffqdata3$a104040_2==1|ffqdata3$a101300_2==1|ffqdata3$a104040_2==1,1,0)
ffqdata3$Butter_sum2[is.na(ffqdata3$Butter_sum2)]<-0
table(ffqdata3$Butter_sum2)
#Whole_grains
ffqdata3[, Whole_grains_sum2:= rowSums(.SD, na.rm = TRUE), .SDcols = c("a100770_2","a100800_2","a100840_2","a100850_2",
                                                                       "a102720_2","a102740_2")]
table(ffqdata3$Whole_grains_sum2)

#Cheese
ffqdata3[, cheese_sum2:= rowSums(.SD, na.rm = TRUE), .SDcols = c("a102820_2","a102830_2","a102840_2","a102860_2",
                                                                 "a102870_2","a102880_2","a102890_2","a102900_2","a102910_2")]
table(ffqdata3$cheese_sum2)
#fish
ffqdata3[,fish_sum2:= rowSums(.SD, na.rm = TRUE), .SDcols = c("a103150_2", "a103160_2","a103190_2", "a103200_2","a103210_2",
                                                              "a103220_2","a103230_2",'Canned_soup_fish',"homemade_soup_fish")]
table(ffqdata3$fish_sum2)
#Beans
ffqdata3[,bean_sum2:= rowSums(.SD, na.rm = TRUE), .SDcols = c("a104000_2", "a104010_2","a104110_2", "a104120_2","a104280_2",
                                                              'Canned_soup_bean',"homemade_soup_bean","a103270_2")]
table(ffqdata3$bean_sum2)
#poultry
ffqdata3[,poultry_sum2:= rowSums(.SD, na.rm = TRUE), .SDcols = c("a103060_2",
                                                                 'Canned_soup_meat',"homemade_soup_meat")]
table(ffqdata3$poultry_sum2)
#red meat
ffqdata3[,red_meat_sum2:= rowSums(.SD, na.rm = TRUE), .SDcols = c("a103010_2","a103020_2","a103030_2","a103040_2","a103070_2",
                                                                  "a103080_2",'Canned_soup_meat',"homemade_soup_meat")]
table(ffqdata3$red_meat_sum2)
#Fast/fried foods 
ffqdata3[,fastfried_food_sum2:= rowSums(.SD, na.rm = TRUE), .SDcols = c("a103050_2","a103170_2","a103180_2","a104020_2","a102460_2")]
table(ffqdata3$fastfried_food_sum2)
#Pastries and sweets 
ffqdata3[,Pastries_sweets_sum2:= rowSums(.SD, na.rm = TRUE), .SDcols = c("a101970_2","a101980_2","a101990_2","a102010_2","a102020_2",
                                                                         "a102030_2","a102050_2","a102060_2",'a102070_2',
                                                                         "a102120_2","a102140_2",'a102150_2','a102170_2','a102180_2',
                                                                         "a102190_2","a102200_2","a102210_2","a102220_2","a102230_2",
                                                                         "a102260_2","a102270_2","a102280_2","a102290_2","a102300_2","a102310_2",
                                                                         "a102320_2","a102320_2",'a102330_2','a102340_2','a102350_2',
                                                                         "a102360_2",'a102370_2',"a102380_2")]
table(ffqdata3$Pastries_sweets_sum2)
#Wine
ffqdata3[,wine_sum2:= rowSums(.SD, na.rm = TRUE), .SDcols = c("a100590_2","a100630_2","a100670_2","a100720_2")]
table(ffqdata3$wine_sum2)
#MIND评分 基于平均摄入的总和
colnames(ffqdata3)
#查看是否有NA
missing_vals <- colSums(is.na(ffqdata3[,809:814]))
print(missing_vals)
ffqdata3$Green_Leafy_Vegetables_sum2_score<-ifelse(ffqdata3$Green_Leafy_Vegetables_sum2<=0.285714,0,ifelse(
  ffqdata3$Green_Leafy_Vegetables_sum2<0.857143,0.5,1))
table(ffqdata3$Green_Leafy_Vegetables_sum2_score)
ffqdata3$Other_Vegetables_sum2_score<-ifelse(ffqdata3$Other_Vegetables_sum2<0.714285,0,ifelse(
  ffqdata3$Other_Vegetables_sum2<1,0.5,1))
ffqdata3$Berries_sum2_score<-ifelse(ffqdata3$Berries_sum2<0.142857,0,ifelse(
  ffqdata3$Berries_sum2<0.285714,0.5,1))
ffqdata3$Nuts_sum2_score<-ifelse(ffqdata3$Nuts_sum2<0.071429,0,ifelse(
  ffqdata3$Nuts_sum2<=0.7142864,0.5,1))
ffqdata3$Butter_sum2_score<-ifelse(ffqdata3$Butter_sum2==1,1,0)
ffqdata3$cheese_sum2_score<-ifelse(ffqdata3$cheese_sum2>=1,0,ifelse(
  ffqdata3$cheese_sum2>0.142857,0.5,1))
ffqdata3$Whole_grains_sum2_score<-ifelse(ffqdata3$Whole_grains_sum2<1,0,ifelse(
  ffqdata3$cheese_sum2<=2,0.5,1))
ffqdata3$fish_sum2_score<-ifelse(ffqdata3$fish_sum2<0.03333,0,ifelse(
  ffqdata3$fish_sum2<=0.142857,0.5,1))
ffqdata3$bean_sum2_score<-ifelse(ffqdata3$bean_sum2<0.142857,0,ifelse(
  ffqdata3$bean_sum2<=0.428571,0.5,1))
ffqdata3$poultry_sum2_score<-ifelse(ffqdata3$poultry_sum2<0.142857,0,ifelse(
  ffqdata3$poultry_sum2<=0.428571,0.5,1))
ffqdata3$red_meat_sum2_score<-ifelse(ffqdata3$red_meat_sum2>0.857143,0,ifelse(
  ffqdata3$red_meat_sum2>=0.571429,0.5,1))
ffqdata3$fastfried_food_sum2_score<-ifelse(ffqdata3$fastfried_food_sum2>0.428571,0,ifelse(
  ffqdata3$fastfried_food_sum2>=0.142857,0.5,1))
ffqdata3$Pastries_sweets_sum2_score<-ifelse(ffqdata3$Pastries_sweets_sum2>1,0,ifelse(
  ffqdata3$Pastries_sweets_sum2>0.714286,0.5,1))
ffqdata3$wine_sum2_score<-ifelse(ffqdata3$wine_sum2<0.033333,0,ifelse(
  ffqdata3$wine_sum2<0.285714,0.5,1))
ffqdata3[,MIND_sum2:= rowSums(.SD, na.rm = TRUE), .SDcols = c("Green_Leafy_Vegetables_sum2_score","Other_Vegetables_sum2_score",
                                                              "Berries_sum2_score","Nuts_sum2_score","Butter_sum2_score","cheese_sum2_score",
                                                              "Whole_grains_sum2_score","fish_sum2_score","bean_sum2_score","poultry_sum2_score",
                                                              "red_meat_sum2_score","fastfried_food_sum2_score","Pastries_sweets_sum2_score","wine_sum2_score")]
table(ffqdata3[,MIND_sum2])
#MIND_average1:利用平均24hFFQ和摄入平均计算####
ffqdata3[, Green_Leafy_Vegetables_average1:= rowMeans(.SD, na.rm = TRUE), .SDcols = c("a104160_1", "a104300_1", "a104240_1","a104370_1", "a104090_1_0.5",
                                                                                      "a104360_1", "a104180_1", "a104080_1", "a104060_1_0.5", "a104070_1_0.5")]
table(ffqdata3$Green_Leafy_Vegetables_average1)
ffqdata3$Green_Leafy_Vegetables_average1[is.na(ffqdata3$Green_Leafy_Vegetables_average1)]<-0
#other vegetables
ffqdata3[, Other_Vegetables_average1:= rowMeans(.SD, na.rm = TRUE), .SDcols = c("a104190_1", "a104170_1", "a104140_1","a104340_1", "a104350_1","a104320_1","a104060_1_0.5", "a104070_1_0.5","a104090_1_0.5",
                                                                                "a104130_1", "a104150_1", "a104200_1","a104210_1","a104220_1","a104230_1", 
                                                                                "a104250_1","a104260_1","a104270_1","a104290_1","a104310_1","a104330_1","a104380_1",'Canned_soup_vegetables',"homemade_soup_vegetables")]
table(ffqdata3$Other_Vegetables_average1)
ffqdata3$Other_Vegetables_average1[is.na(ffqdata3$Other_Vegetables_average1)]<-0
#Berries
ffqdata3[, Berries_average1:= rowMeans(.SD, na.rm = TRUE), .SDcols = c("a104470_1")]
table(ffqdata3$Berries_average1)
ffqdata3$Berries_average1[is.na(ffqdata3$Berries_average1)]<-0
#Nuts
ffqdata3[, Nuts_average1:= rowMeans(.SD, na.rm = TRUE), .SDcols = c("a102430_1","a102410_1","a102450_1","a102440_1",
                                                                    "a102420_1")]
table(ffqdata3$Nuts_average1)
ffqdata3$Nuts_average1[is.na(ffqdata3$Nuts_average1)]<-0
#Butter/margarine
ffqdata3$Butter_average1<-ifelse(ffqdata3$a104040_1==1|ffqdata3$a101300_1==1|ffqdata3$a104040_1==1,1,0)
ffqdata3$Butter_average1[is.na(ffqdata3$Butter_average1)]<-0
table(ffqdata3$Butter_average1)
#Whole_grains
ffqdata3[, Whole_grains_average1:= rowMeans(.SD, na.rm = TRUE), .SDcols = c("a100770_1","a100800_1","a100840_1","a100850_1",
                                                                            "a102720_1","a102740_1")]
table(ffqdata3$Whole_grains_average1)
ffqdata3$Whole_grains_average1[is.na(ffqdata3$Whole_grains_average1)]<-0
#Cheese
ffqdata3[, cheese_average1:= rowMeans(.SD, na.rm = TRUE), .SDcols = c("a102820_1","a102830_1","a102840_1","a102860_1",
                                                                      "a102870_1","a102880_1","a102890_1","a102900_1","a102910_1")]
table(ffqdata3$cheese_average1)
ffqdata3$cheese_average1[is.na(ffqdata3$cheese_average1)]<-0
#fish
ffqdata3[,fish_average1:= rowMeans(.SD, na.rm = TRUE), .SDcols = c("a103150_1", "a103160_1","a103190_1", "a103200_1","a103210_1",
                                                                   "a103220_1","a103230_1",'Canned_soup_fish',"homemade_soup_fish")]
table(ffqdata3$fish_average1)
ffqdata3$fish_average1[is.na(ffqdata3$fish_average1)]<-0
#Beans
ffqdata3[,bean_average1:= rowMeans(.SD, na.rm = TRUE), .SDcols = c("a104000_1", "a104010_1","a104110_1", "a104120_1","a104280_1",
                                                                   'Canned_soup_bean',"homemade_soup_bean","a103270_1")]
table(ffqdata3$bean_average1)
ffqdata3$bean_average1[is.na(ffqdata3$bean_average1)]<-0
#poultry
ffqdata3[,poultry_average1:= rowMeans(.SD, na.rm = TRUE), .SDcols = c("a103060_1",
                                                                      'Canned_soup_meat',"homemade_soup_meat")]
table(ffqdata3$poultry_average1)
ffqdata3$poultry_average1[is.na(ffqdata3$poultry_average1)]<-0
#red meat
ffqdata3[,red_meat_average1:= rowMeans(.SD, na.rm = TRUE), .SDcols = c("a103010_1","a103020_1","a103030_1","a103040_1","a103070_1",
                                                                       "a103080_1",'Canned_soup_meat',"homemade_soup_meat")]
table(ffqdata3$red_meat_average1)
ffqdata3$red_meat_average1[is.na(ffqdata3$red_meat_average1)]<-0
#Fast/fried foods 
ffqdata3[,fastfried_food_average1:= rowMeans(.SD, na.rm = TRUE), .SDcols = c("a103050_1","a103170_1","a103180_1","a104020_1","a102460_1")]
table(ffqdata3$fastfried_food_average1)
ffqdata3$fastfried_food_average1[is.na(ffqdata3$fastfried_food_average1)]<-0
#Pastries and sweets 
ffqdata3[,Pastries_sweets_average1:= rowMeans(.SD, na.rm = TRUE), .SDcols = c("a101970_1","a101980_1","a101990_1","a102010_1","a102020_1",
                                                                              "a102030_1","a102050_1","a102060_1",'a102070_1',
                                                                              "a102120_1","a102140_1",'a102150_1','a102170_1','a102180_1',
                                                                              "a102190_1","a102200_1","a102210_1","a102220_1","a102230_1",
                                                                              "a102260_1","a102270_1","a102280_1","a102290_1","a102300_1","a102310_1",
                                                                              "a102320_1","a102320_1",'a102330_1','a102340_1','a102350_1',
                                                                              "a102360_1",'a102370_1',"a102380_1")]
table(ffqdata3$Pastries_sweets_average1)
ffqdata3$Pastries_sweets_average1[is.na(ffqdata3$Pastries_sweets_average1)]<-0
#Wine
ffqdata3[,wine_average1:= rowMeans(.SD, na.rm = TRUE), .SDcols = c("a100590_1","a100630_1","a100670_1","a100720_1")]
table(ffqdata3$wine_average1)
ffqdata3$wine_average1[is.na(ffqdata3$wine_average1)]<-0
#MIND评分 基于平均FFQ摄入的总和
colnames(ffqdata3)
#查看是否有NA
missing_vals <- colSums(is.na(ffqdata3[,838:851]))
print(missing_vals)
ffqdata3$Green_Leafy_Vegetables_average1_score<-ifelse(ffqdata3$Green_Leafy_Vegetables_average1<=0.285714,0,ifelse(
  ffqdata3$Green_Leafy_Vegetables_average1<0.857143,0.5,1))
table(ffqdata3$Green_Leafy_Vegetables_average1_score)
ffqdata3$Other_Vegetables_average1_score<-ifelse(ffqdata3$Other_Vegetables_average1<0.714285,0,ifelse(
  ffqdata3$Other_Vegetables_average1<1,0.5,1))
ffqdata3$Berries_average1_score<-ifelse(ffqdata3$Berries_average1<0.142857,0,ifelse(
  ffqdata3$Berries_average1<0.285714,0.5,1))
ffqdata3$Nuts_average1_score<-ifelse(ffqdata3$Nuts_average1<0.071429,0,ifelse(
  ffqdata3$Nuts_average1<=0.7142864,0.5,1))
ffqdata3$Butter_average1_score<-ifelse(ffqdata3$Butter_average1==1,1,0)
ffqdata3$cheese_average1_score<-ifelse(ffqdata3$cheese_average1>=1,0,ifelse(
  ffqdata3$cheese_average1>0.142857,0.5,1))
ffqdata3$Whole_grains_average1_score<-ifelse(ffqdata3$Whole_grains_average1<1,0,ifelse(
  ffqdata3$cheese_average1<=2,0.5,1))
ffqdata3$fish_average1_score<-ifelse(ffqdata3$fish_average1<0.03333,0,ifelse(
  ffqdata3$fish_average1<=0.142857,0.5,1))
ffqdata3$bean_average1_score<-ifelse(ffqdata3$bean_average1<0.142857,0,ifelse(
  ffqdata3$bean_average1<=0.428571,0.5,1))
ffqdata3$poultry_average1_score<-ifelse(ffqdata3$poultry_average1<0.142857,0,ifelse(
  ffqdata3$poultry_average1<=0.428571,0.5,1))
ffqdata3$red_meat_average1_score<-ifelse(ffqdata3$red_meat_average1>0.857143,0,ifelse(
  ffqdata3$red_meat_average1>=0.571429,0.5,1))
ffqdata3$fastfried_food_average1_score<-ifelse(ffqdata3$fastfried_food_average1>0.428571,0,ifelse(
  ffqdata3$fastfried_food_average1>=0.142857,0.5,1))
ffqdata3$Pastries_sweets_average1_score<-ifelse(ffqdata3$Pastries_sweets_average1>1,0,ifelse(
  ffqdata3$Pastries_sweets_average1>0.714286,0.5,1))
ffqdata3$wine_average1_score<-ifelse(ffqdata3$wine_average1<0.033333,0,ifelse(
  ffqdata3$wine_average1<0.285714,0.5,1))
ffqdata3[,MIND_average1:= rowSums(.SD, na.rm = TRUE), .SDcols = c("Green_Leafy_Vegetables_average1_score","Other_Vegetables_average1_score",
                                                                  "Berries_average1_score","Nuts_average1_score","Butter_average1_score","cheese_average1_score",
                                                                  "Whole_grains_average1_score","fish_average1_score","bean_average1_score","poultry_average1_score",
                                                                  "red_meat_average1_score","fastfried_food_average1_score","Pastries_sweets_average1_score","wine_average1_score")]
table(ffqdata3[,MIND_average1])
#MIND_average2:利用基线24hFFQ和摄入平均计算####
ffqdata3[, Green_Leafy_Vegetables_average2:= rowMeans(.SD, na.rm = TRUE), .SDcols = c("a104160_2", "a104300_2", "a104240_2","a104370_2", "a104090_2_0.5",
                                                                                      "a104360_2", "a104180_2", "a104080_2", "a104060_2_0.5", "a104070_2_0.5")]
table(ffqdata3$Green_Leafy_Vegetables_average2)
ffqdata3$Green_Leafy_Vegetables_average2[is.na(ffqdata3$Green_Leafy_Vegetables_average2)]<-0
#other vegetables
ffqdata3[, Other_Vegetables_average2:= rowMeans(.SD, na.rm = TRUE), .SDcols = c("a104190_2", "a104170_2", "a104140_2","a104340_2", "a104350_2","a104320_2","a104060_2_0.5", "a104070_2_0.5","a104090_2_0.5",
                                                                                "a104130_2", "a104150_2", "a104200_2","a104210_2","a104220_2","a104230_2", 
                                                                                "a104250_2","a104260_2","a104270_2","a104290_2","a104310_2","a104330_2","a104380_2",'Canned_soup_vegetables',"homemade_soup_vegetables")]
table(ffqdata3$Other_Vegetables_average2)
ffqdata3$Other_Vegetables_average2[is.na(ffqdata3$Other_Vegetables_average2)]<-0
#Berries
ffqdata3[, Berries_average2:= rowMeans(.SD, na.rm = TRUE), .SDcols = c("a104470_2")]
table(ffqdata3$Berries_average2)
ffqdata3$Berries_average2[is.na(ffqdata3$Berries_average2)]<-0
#Nuts
ffqdata3[, Nuts_average2:= rowMeans(.SD, na.rm = TRUE), .SDcols = c("a102430_2","a102410_2","a102450_2","a102440_2",
                                                                    "a102420_2")]
table(ffqdata3$Nuts_average2)
ffqdata3$Nuts_average2[is.na(ffqdata3$Nuts_average2)]<-0
#Butter/margarine
ffqdata3$Butter_average2<-ifelse(ffqdata3$a104040_2==1|ffqdata3$a101300_2==1|ffqdata3$a104040_2==1,1,0)
ffqdata3$Butter_average2[is.na(ffqdata3$Butter_average2)]<-0
table(ffqdata3$Butter_average2)
#Whole_grains
ffqdata3[, Whole_grains_average2:= rowMeans(.SD, na.rm = TRUE), .SDcols = c("a100770_2","a100800_2","a100840_2","a100850_2",
                                                                            "a102720_2","a102740_2")]
table(ffqdata3$Whole_grains_average2)
ffqdata3$Whole_grains_average2[is.na(ffqdata3$Whole_grains_average2)]<-0
#Cheese
ffqdata3[, cheese_average2:= rowMeans(.SD, na.rm = TRUE), .SDcols = c("a102820_2","a102830_2","a102840_2","a102860_2",
                                                                      "a102870_2","a102880_2","a102890_2","a102900_2","a102910_2")]
table(ffqdata3$cheese_average2)
ffqdata3$cheese_average2[is.na(ffqdata3$cheese_average2)]<-0
#fish
ffqdata3[,fish_average2:= rowMeans(.SD, na.rm = TRUE), .SDcols = c("a103150_2", "a103160_2","a103190_2", "a103200_2","a103210_2",
                                                                   "a103220_2","a103230_2",'Canned_soup_fish',"homemade_soup_fish")]
table(ffqdata3$fish_average2)
ffqdata3$fish_average2[is.na(ffqdata3$fish_average2)]<-0
#Beans
ffqdata3[,bean_average2:= rowMeans(.SD, na.rm = TRUE), .SDcols = c("a104000_2", "a104010_2","a104110_2", "a104120_2","a104280_2",
                                                                   'Canned_soup_bean',"homemade_soup_bean","a103270_2")]
table(ffqdata3$bean_average2)
ffqdata3$bean_average2[is.na(ffqdata3$bean_average2)]<-0
#poultry
ffqdata3[,poultry_average2:= rowMeans(.SD, na.rm = TRUE), .SDcols = c("a103060_2",
                                                                      'Canned_soup_meat',"homemade_soup_meat")]
table(ffqdata3$poultry_average2)
ffqdata3$poultry_average2[is.na(ffqdata3$poultry_average2)]<-0
#red meat
ffqdata3[,red_meat_average2:= rowMeans(.SD, na.rm = TRUE), .SDcols = c("a103010_2","a103020_2","a103030_2","a103040_2","a103070_2",
                                                                       "a103080_2",'Canned_soup_meat',"homemade_soup_meat")]
table(ffqdata3$red_meat_average2)
ffqdata3$red_meat_average2[is.na(ffqdata3$red_meat_average2)]<-0
#Fast/fried foods 
ffqdata3[,fastfried_food_average2:= rowMeans(.SD, na.rm = TRUE), .SDcols = c("a103050_2","a103170_2","a103180_2","a104020_2","a102460_2")]
table(ffqdata3$fastfried_food_average2)
ffqdata3$fastfried_food_average2[is.na(ffqdata3$fastfried_food_average2)]<-0
#Pastries and sweets 
ffqdata3[,Pastries_sweets_average2:= rowMeans(.SD, na.rm = TRUE), .SDcols = c("a101970_2","a101980_2","a101990_2","a102010_2","a102020_2",
                                                                              "a102030_2","a102050_2","a102060_2",'a102070_2',
                                                                              "a102120_2","a102140_2",'a102150_2','a102170_2','a102180_2',
                                                                              "a102190_2","a102200_2","a102210_2","a102220_2","a102230_2",
                                                                              "a102260_2","a102270_2","a102280_2","a102290_2","a102300_2","a102310_2",
                                                                              "a102320_2","a102320_2",'a102330_2','a102340_2','a102350_2',
                                                                              "a102360_2",'a102370_2',"a102380_2")]
table(ffqdata3$Pastries_sweets_average2)
ffqdata3$Pastries_sweets_average2[is.na(ffqdata3$Pastries_sweets_average2)]<-0
#Wine
ffqdata3[,wine_average2:= rowMeans(.SD, na.rm = TRUE), .SDcols = c("a100590_2","a100630_2","a100670_2","a100720_2")]
table(ffqdata3$wine_average2)
ffqdata3$wine_average2[is.na(ffqdata3$wine_average2)]<-0
#MIND评分 基于平均FFQ摄入的总和
colnames(ffqdata3)
#查看是否有NA
missing_vals <- colSums(is.na(ffqdata3[,867:879]))
print(missing_vals)
ffqdata3$Green_Leafy_Vegetables_average2_score<-ifelse(ffqdata3$Green_Leafy_Vegetables_average2<=0.285714,0,ifelse(
  ffqdata3$Green_Leafy_Vegetables_average2<0.857143,0.5,1))
table(ffqdata3$Green_Leafy_Vegetables_average2_score)
ffqdata3$Other_Vegetables_average2_score<-ifelse(ffqdata3$Other_Vegetables_average2<0.714285,0,ifelse(
  ffqdata3$Other_Vegetables_average2<1,0.5,1))
ffqdata3$Berries_average2_score<-ifelse(ffqdata3$Berries_average2<0.142857,0,ifelse(
  ffqdata3$Berries_average2<0.285714,0.5,1))
ffqdata3$Nuts_average2_score<-ifelse(ffqdata3$Nuts_average2<0.071429,0,ifelse(
  ffqdata3$Nuts_average2<=0.7142864,0.5,1))
ffqdata3$Butter_average2_score<-ifelse(ffqdata3$Butter_average2==1,1,0)
ffqdata3$cheese_average2_score<-ifelse(ffqdata3$cheese_average2>=1,0,ifelse(
  ffqdata3$cheese_average2>0.142857,0.5,1))
ffqdata3$Whole_grains_average2_score<-ifelse(ffqdata3$Whole_grains_average2<1,0,ifelse(
  ffqdata3$cheese_average2<=2,0.5,1))
ffqdata3$fish_average2_score<-ifelse(ffqdata3$fish_average2<0.03333,0,ifelse(
  ffqdata3$fish_average2<=0.142857,0.5,1))
ffqdata3$bean_average2_score<-ifelse(ffqdata3$bean_average2<0.142857,0,ifelse(
  ffqdata3$bean_average2<=0.428571,0.5,1))
ffqdata3$poultry_average2_score<-ifelse(ffqdata3$poultry_average2<0.142857,0,ifelse(
  ffqdata3$poultry_average2<=0.428571,0.5,1))
ffqdata3$red_meat_average2_score<-ifelse(ffqdata3$red_meat_average2>0.857143,0,ifelse(
  ffqdata3$red_meat_average2>=0.571429,0.5,1))
ffqdata3$fastfried_food_average2_score<-ifelse(ffqdata3$fastfried_food_average2>0.428571,0,ifelse(
  ffqdata3$fastfried_food_average2>=0.142857,0.5,1))
ffqdata3$Pastries_sweets_average2_score<-ifelse(ffqdata3$Pastries_sweets_average2>1,0,ifelse(
  ffqdata3$Pastries_sweets_average2>0.714286,0.5,1))
ffqdata3$wine_average2_score<-ifelse(ffqdata3$wine_average2<0.033333,0,ifelse(
  ffqdata3$wine_average2<0.285714,0.5,1))
ffqdata3[,MIND_average2:= rowSums(.SD, na.rm = TRUE), .SDcols = c("Green_Leafy_Vegetables_average2_score","Other_Vegetables_average2_score",
                                                                  "Berries_average2_score","Nuts_average2_score","Butter_average2_score","cheese_average2_score",
                                                                  "Whole_grains_average2_score","fish_average2_score","bean_average2_score","poultry_average2_score",
                                                                  "red_meat_average2_score","fastfried_food_average2_score","Pastries_sweets_average2_score","wine_average2_score")]
table(ffqdata3[,MIND_average2])
#MEDAS_sum1:利用平均24hFFQ和摄入总和计算####
#Vegetables_sum1
ffqdata3[, Vegetables_sum1:= rowSums(.SD, na.rm = TRUE), .SDcols = c("a104160_1", "a104300_1", "a104240_1","a104370_1", "a104360_1",
                                                                     "a104180_1", "a104080_1", "a104190_1", "a104170_1","a104140_1","a104340_1",
                                                                     "a104350_1","a104320_1","a104060_1","a104070_1","a104130_1","a104150_1",
                                                                     "a104200_1","a104210_1","a104220_1","a104230_1","a104250_1","a104260_1",
                                                                     "a104270_1","a104290_1","a104310_1","a104330_1","a104380_1")]
table(ffqdata3$Green_Leafy_Vegetables_sum1)
#fruit_sum1
ffqdata3$a100190_1_0.25<-ifelse(is.na(ffqdata3[, a100190_1]), NA, 0.25*ffqdata3[, a100190_1])
ffqdata3$a100200_1_0.25<-ifelse(is.na(ffqdata3[, a100200_1]), NA, 0.25*ffqdata3[, a100200_1])
ffqdata3$a100210_1_0.5<-ifelse(is.na(ffqdata3[, a100210_1]), NA, 0.5*ffqdata3[, a100210_1])
ffqdata3$a100220_1_0.25<-ifelse(is.na(ffqdata3[, a100220_1]), NA, 0.25*ffqdata3[, a100220_1])
ffqdata3[, fruit_sum1:= rowSums(.SD, na.rm = TRUE), .SDcols = c("a104410_1", "a104420_1", "a104430_1","a104440_1", "a104450_1",
                                                                "a104460_1", "a104470_1", "a104480_1", "a104490_1","a104500_1","a104510_1",
                                                                "a104520_1","a104530_1","a104540_1","a104550_1","a104560_1","a104570_1",
                                                                "a104580_1","a104590_1","a100190_1_0.25","a100200_1_0.25",
                                                                "a100210_1_0.5","a100220_1_0.25")]
table(ffqdata3$fruit_sum1)
#Red meat 等同于red_meat_sum1
#Butter,margarine or cream 等同于ffqdata3$Butter_sum1
#Sweetened or carbonated drinks
ffqdata3[, Sweetened_sum1:= rowSums(.SD, na.rm = TRUE), .SDcols = c("a100160_1", "a100170_1", "a100180_1")]
table(ffqdata3[, Sweetened_sum1])
#Wine 等同于wine_sum1
#Legumes 等同于bean_sum1
#Seafood 等同于fish_sum1
#Sweets or pastries 等同于Pastries_sweets_sum1
#Nuts 等同于Nuts_sum1
#white meat 等同于poultry_sum1
#MEDAS评分 基于平均FFQ摄入的总和
colnames(ffqdata3)
#查看是否有NA
missing_vals <- colSums(is.na(ffqdata3[,896:902]))
print(missing_vals)
colnames(ffqdata3)
ffqdata3$Vegetables_sum1_score<-ifelse(ffqdata3$Vegetables_sum1>=2,1,ifelse(ffqdata3$a104090_1>=1,1,0))#大于2份蔬菜或者大于一份沙拉
ffqdata3$Vegetables_sum1_score[is.na(ffqdata3$Vegetables_sum1_score)]<-0
ffqdata3$fruit_sum1_score<-ifelse(ffqdata3$fruit_sum1>=3,1,0)
ffqdata3$Mred_meat_sum1_score<-ifelse(ffqdata3$red_meat_sum1>=1,0,1)
ffqdata3$MButter_sum1_score<-ifelse(ffqdata3$Butter_sum1>=1,0,1)
ffqdata3$MSweetened_sum1_score<-ifelse(ffqdata3$Sweetened_sum1>=1,0,1)
ffqdata3$Mwine_sum1_score<-ifelse(ffqdata3$wine_sum1>=1,1,0)
ffqdata3$Mbean_sum1_score<-ifelse(ffqdata3$bean_sum1>=0.428571,1,0)
ffqdata3$Mfish_sum1_score<-ifelse(ffqdata3$fish_sum1>=0.428571,1,0)
ffqdata3$MPastries_sweets_sum1_score<-ifelse(ffqdata3$Pastries_sweets_sum1>=0.285714,0,1)
ffqdata3$MNuts_sum1_score<-ifelse(ffqdata3$Nuts_sum1>=0.428571,1,0)
ffqdata3$Mpoultry_sum1_score<-ifelse(ffqdata3$poultry_sum1>ffqdata3$red_meat_sum1,1,0)
ffqdata3[,MEDAS_sum1:= rowSums(.SD, na.rm = TRUE), .SDcols = c("Vegetables_sum1_score","fruit_sum1_score",
                                                               "Mred_meat_sum1_score","MButter_sum1_score","MSweetened_sum1_score",
                                                               "Mwine_sum1_score","Mbean_sum1_score","Mfish_sum1_score","MPastries_sweets_sum1_score",
                                                               "MNuts_sum1_score","Mpoultry_sum1_score")]
table(ffqdata3[,MEDAS_sum1])
##MEDAS_sum2:利用基线24hFFQ和摄入总和计算####
#Vegetables_sum2
ffqdata3[, Vegetables_sum2:= rowSums(.SD, na.rm = TRUE), .SDcols = c("a104160_2", "a104300_2", "a104240_2","a104370_2", "a104360_2",
                                                                     "a104180_2", "a104080_2", "a104190_2", "a104170_2","a104140_2","a104340_2",
                                                                     "a104350_2","a104320_2","a104060_2","a104070_2","a104130_2","a104150_2",
                                                                     "a104200_2","a104210_2","a104220_2","a104230_2","a104250_2","a104260_2",
                                                                     "a104270_2","a104290_2","a104310_2","a104330_2","a104380_2")]
table(ffqdata3$Green_Leafy_Vegetables_sum2)
#fruit_sum2
ffqdata3$a100190_2_0.25<-ifelse(is.na(ffqdata3[, a100190_2]), NA, 0.25*ffqdata3[, a100190_2])
ffqdata3$a100200_2_0.25<-ifelse(is.na(ffqdata3[, a100200_2]), NA, 0.25*ffqdata3[, a100200_2])
ffqdata3$a100210_2_0.5<-ifelse(is.na(ffqdata3[, a100210_2]), NA, 0.5*ffqdata3[, a100210_2])
ffqdata3$a100220_2_0.25<-ifelse(is.na(ffqdata3[, a100220_2]), NA, 0.25*ffqdata3[, a100220_2])
ffqdata3[, fruit_sum2:= rowSums(.SD, na.rm = TRUE), .SDcols = c("a104410_2", "a104420_2", "a104430_2","a104440_2", "a104450_2",
                                                                "a104460_2", "a104470_2", "a104480_2", "a104490_2","a104500_2","a104510_2",
                                                                "a104520_2","a104530_2","a104540_2","a104550_2","a104560_2","a104570_2",
                                                                "a104580_2","a104590_2","a100190_2_0.25","a100200_2_0.25",
                                                                "a100210_2_0.5","a100220_2_0.25")]
table(ffqdata3$fruit_sum2)
#Red meat 等同于red_meat_sum2
#Butter,margarine or cream 等同于ffqdata3$Butter_sum2
#Sweetened or carbonated drinks
ffqdata3[, Sweetened_sum2:= rowSums(.SD, na.rm = TRUE), .SDcols = c("a100160_2", "a100170_2", "a100180_2")]
table(ffqdata3[, Sweetened_sum2])
#Wine 等同于wine_sum2
#Legumes 等同于bean_sum2
#Seafood 等同于fish_sum2
#Sweets or pastries 等同于Pastries_sweets_sum2
#Nuts 等同于Nuts_sum2
#white meat 等同于poultry_sum2
#MEDAS评分 基于平均FFQ摄入的总和
colnames(ffqdata3)
#查看是否有NA
missing_vals <- colSums(is.na(ffqdata3[,916:921]))
print(missing_vals)
colnames(ffqdata3)
ffqdata3$Vegetables_sum2_score<-ifelse(ffqdata3$Vegetables_sum2>=2,1,ifelse(ffqdata3$a104090_2>=1,1,0))#大于2份蔬菜或者大于一份沙拉
ffqdata3$Vegetables_sum2_score[is.na(ffqdata3$Vegetables_sum2_score)]<-0
ffqdata3$fruit_sum2_score<-ifelse(ffqdata3$fruit_sum2>=3,1,0)
ffqdata3$Mred_meat_sum2_score<-ifelse(ffqdata3$red_meat_sum2>=1,0,1)
ffqdata3$MButter_sum2_score<-ifelse(ffqdata3$Butter_sum2>=1,0,1)
ffqdata3$MSweetened_sum2_score<-ifelse(ffqdata3$Sweetened_sum2>=1,0,1)
ffqdata3$Mwine_sum2_score<-ifelse(ffqdata3$wine_sum2>=1,1,0)
ffqdata3$Mbean_sum2_score<-ifelse(ffqdata3$bean_sum2>=0.428571,1,0)
ffqdata3$Mfish_sum2_score<-ifelse(ffqdata3$fish_sum2>=0.428571,1,0)
ffqdata3$MPastries_sweets_sum2_score<-ifelse(ffqdata3$Pastries_sweets_sum2>=0.285714,0,1)
ffqdata3$MNuts_sum2_score<-ifelse(ffqdata3$Nuts_sum2>=0.428571,1,0)
ffqdata3$Mpoultry_sum2_score<-ifelse(ffqdata3$poultry_sum2>ffqdata3$red_meat_sum2,1,0)
ffqdata3[,MEDAS_sum2:= rowSums(.SD, na.rm = TRUE), .SDcols = c("Vegetables_sum2_score","fruit_sum2_score",
                                                               "Mred_meat_sum2_score","MButter_sum2_score","MSweetened_sum2_score",
                                                               "Mwine_sum2_score","Mbean_sum2_score","Mfish_sum2_score","MPastries_sweets_sum2_score",
                                                               "MNuts_sum2_score","Mpoultry_sum2_score")]
table(ffqdata3[,MEDAS_sum2])
#MEDAS_average1:利用平均24hFFQ和摄入平均计算####
#Vegetables_average1
ffqdata3[, Vegetables_average1:= rowMeans(.SD, na.rm = TRUE), .SDcols = c("a104160_1", "a104300_1", "a104240_1","a104370_1", "a104360_1",
                                                                          "a104180_1", "a104080_1", "a104190_1", "a104170_1","a104140_1","a104340_1",
                                                                          "a104350_1","a104320_1","a104060_1","a104070_1","a104130_1","a104150_1",
                                                                          "a104200_1","a104210_1","a104220_1","a104230_1","a104250_1","a104260_1",
                                                                          "a104270_1","a104290_1","a104310_1","a104330_1","a104380_1")]
table(ffqdata3$Green_Leafy_Vegetables_average1)
#fruit_average1
ffqdata3[, fruit_average1:= rowMeans(.SD, na.rm = TRUE), .SDcols = c("a104410_1", "a104420_1", "a104430_1","a104440_1", "a104450_1",
                                                                     "a104460_1", "a104470_1", "a104480_1", "a104490_1","a104500_1","a104510_1",
                                                                     "a104520_1","a104530_1","a104540_1","a104550_1","a104560_1","a104570_1",
                                                                     "a104580_1","a104590_1","a100190_1_0.25","a100200_1_0.25",
                                                                     "a100210_1_0.5","a100220_1_0.25")]
table(ffqdata3$fruit_average1)
#Red meat 等同于red_meat_average1
#Butter,margarine or cream 等同于ffqdata3$Butter_average1
#Sweetened or carbonated drinks
ffqdata3[, Sweetened_average1:= rowMeans(.SD, na.rm = TRUE), .SDcols = c("a100160_1", "a100170_1", "a100180_1")]
table(ffqdata3[, Sweetened_average1])
#Wine 等同于wine_average1
#Legumes 等同于bean_average1
#Seafood 等同于fish_average1
#Sweets or pastries 等同于Pastries_sweets_average1
#Nuts 等同于Nuts_average1
#white meat 等同于poultry_average1
#MEDAS评分 基于平均FFQ摄入的总和
ffqdata3$Vegetables_average1_score<-ifelse(ffqdata3$Vegetables_average1>=2,1,ifelse(ffqdata3$a104090_1>=1,1,0))#大于2份蔬菜或者大于一份沙拉
ffqdata3$Vegetables_average1_score[is.na(ffqdata3$Vegetables_average1_score)]<-0
ffqdata3$fruit_average1_score<-ifelse(ffqdata3$fruit_average1>=3,1,0)
ffqdata3$Mred_meat_average1_score<-ifelse(ffqdata3$red_meat_average1>=1,0,1)
ffqdata3$MButter_average1_score<-ifelse(ffqdata3$Butter_average1>=1,0,1)
ffqdata3$MSweetened_average1_score<-ifelse(ffqdata3$Sweetened_average1>=1,0,1)
ffqdata3$Mwine_average1_score<-ifelse(ffqdata3$wine_average1>=1,1,0)
ffqdata3$Mbean_average1_score<-ifelse(ffqdata3$bean_average1>=0.428571,1,0)
ffqdata3$Mfish_average1_score<-ifelse(ffqdata3$fish_average1>=0.428571,1,0)
ffqdata3$MPastries_sweets_average1_score<-ifelse(ffqdata3$Pastries_sweets_average1>=0.285714,0,1)
ffqdata3$MNuts_average1_score<-ifelse(ffqdata3$Nuts_average1>=0.428571,1,0)
ffqdata3$Mpoultry_average1_score<-ifelse(ffqdata3$poultry_average1>ffqdata3$red_meat_average1,1,0)
ffqdata3[,MEDAS_average1:= rowSums(.SD, na.rm = TRUE), .SDcols = c("Vegetables_average1_score","fruit_average1_score",
                                                                   "Mred_meat_average1_score","MButter_average1_score","MSweetened_average1_score",
                                                                   "Mwine_average1_score","Mbean_average1_score","Mfish_average1_score","MPastries_sweets_average1_score",
                                                                   "MNuts_average1_score","Mpoultry_average1_score")]
table(ffqdata3[,MEDAS_average1])
#MEDAS_average2:利用基线24hFFQ和摄入平均计算####
#Vegetables_average2
ffqdata3[, Vegetables_average2:= rowMeans(.SD, na.rm = TRUE), .SDcols = c("a104160_2", "a104300_2", "a104240_2","a104370_2", "a104360_2",
                                                                          "a104180_2", "a104080_2", "a104190_2", "a104170_2","a104140_2","a104340_2",
                                                                          "a104350_2","a104320_2","a104060_2","a104070_2","a104130_2","a104150_2",
                                                                          "a104200_2","a104210_2","a104220_2","a104230_2","a104250_2","a104260_2",
                                                                          "a104270_2","a104290_2","a104310_2","a104330_2","a104380_2")]
table(ffqdata3$Green_Leafy_Vegetables_average2)
#fruit_average2
ffqdata3[, fruit_average2:= rowMeans(.SD, na.rm = TRUE), .SDcols = c("a104410_2", "a104420_2", "a104430_2","a104440_2", "a104450_2",
                                                                     "a104460_2", "a104470_2", "a104480_2", "a104490_2","a104500_2","a104510_2",
                                                                     "a104520_2","a104530_2","a104540_2","a104550_2","a104560_2","a104570_2",
                                                                     "a104580_2","a104590_2","a100190_2_0.25","a100200_2_0.25",
                                                                     "a100210_2_0.5","a100220_2_0.25")]
table(ffqdata3$fruit_average2)
#Red meat 等同于red_meat_average2
#Butter,margarine or cream 等同于ffqdata3$Butter_average2
#Sweetened or carbonated drinks
ffqdata3[, Sweetened_average2:= rowMeans(.SD, na.rm = TRUE), .SDcols = c("a100160_2", "a100170_2", "a100180_2")]
table(ffqdata3[, Sweetened_average2])
#Wine 等同于wine_average2
#Legumes 等同于bean_average2
#Seafood 等同于fish_average2
#Sweets or pastries 等同于Pastries_sweets_average2
#Nuts 等同于Nuts_average2
#white meat 等同于poultry_average2
#MEDAS评分 基于平均FFQ摄入的总和
ffqdata3$Vegetables_average2_score<-ifelse(ffqdata3$Vegetables_average2>=2,1,ifelse(ffqdata3$a104090_2>=1,1,0))#大于2份蔬菜或者大于一份沙拉
ffqdata3$Vegetables_average2_score[is.na(ffqdata3$Vegetables_average2_score)]<-0
ffqdata3$fruit_average2_score<-ifelse(ffqdata3$fruit_average2>=3,1,0)
ffqdata3$Mred_meat_average2_score<-ifelse(ffqdata3$red_meat_average2>=1,0,1)
ffqdata3$MButter_average2_score<-ifelse(ffqdata3$Butter_average2>=1,0,1)
ffqdata3$MSweetened_average2_score<-ifelse(ffqdata3$Sweetened_average2>=1,0,1)
ffqdata3$Mwine_average2_score<-ifelse(ffqdata3$wine_average2>=1,1,0)
ffqdata3$Mbean_average2_score<-ifelse(ffqdata3$bean_average2>=0.428571,1,0)
ffqdata3$Mfish_average2_score<-ifelse(ffqdata3$fish_average2>=0.428571,1,0)
ffqdata3$MPastries_sweets_average2_score<-ifelse(ffqdata3$Pastries_sweets_average2>=0.285714,0,1)
ffqdata3$MNuts_average2_score<-ifelse(ffqdata3$Nuts_average2>=0.428571,1,0)
ffqdata3$Mpoultry_average2_score<-ifelse(ffqdata3$poultry_average2>ffqdata3$red_meat_average2,1,0)
ffqdata3[,MEDAS_average2:= rowSums(.SD, na.rm = TRUE), .SDcols = c("Vegetables_average2_score","fruit_average2_score",
                                                                   "Mred_meat_average2_score","MButter_average2_score","MSweetened_average2_score",
                                                                   "Mwine_average2_score","Mbean_average2_score","Mfish_average2_score","MPastries_sweets_average2_score",
                                                                   "MNuts_average2_score","Mpoultry_average2_score")]
table(ffqdata3[,MEDAS_average2])
summary(ffqdata3[,MEDAS_average2])
#导入能量和膳食元素数据####
setwd("E:/deskbook/data_subset")
file_names <- list.files(pattern = "^1pan_cancer")
ffqenergy <- list()
# 循环读取所有文件
for (file_name in file_names) {
  data <- fread(file_name,header=T,select=c(2:51))
  ffqenergy[[file_name]] <- data
}
ffqenergy_df <- do.call(rbind, ffqenergy)# 190095 obs
colnames(ffqenergy_df)
#合并
ffqdata4<-merge(ffqdata3,ffqenergy_df,by="eid",all.x = T)
#导出ffqdata4####
write_excel_csv(ffqdata4,"E:/deskbook/ffqdata4.csv")
#合并基本人口统计学资料####
colnames(ffqdata4)
ffq<-subset(ffqdata4,select=c(1,769:1011))
#读基线特征资料
setwd("E:/deskbook/data_subset")
file_names <- list.files(pattern = "^UKBdata")
all_data <- list()
# 循环读取所有文件
for (file_name in file_names) {
  data <- fread(file_name,header=T)
  all_data[[file_name]] <- data
}
UKBdata <- do.call(rbind, all_data)# 187495 obs
#寻找共同的eid
# 找到两个数据集中都存在的eid值
common_eids <- intersect(UKBdata$eid, ffq$eid)
# 根据共有的eid值筛选每个数据集中的记录
matched_data1 <- UKBdata[UKBdata$eid %in% common_eids,]
matched_data2 <- ffq[ffq$eid %in% common_eids,]
#分析的数据####
UKBdata2<-merge(matched_data1,matched_data2,by="eid",all.x = T)
UKBdata2$status<-ifelse(UKBdata2$pan_cancer==0,0,1)
colnames(UKBdata2)
#查看是否有NA
missing_vals <- colSums(is.na(UKBdata2[,218:265]))
table(UKBdata2$status)
print(missing_vals)
#插补法填补数据
library(mice)
names<-colnames(UKBdata2[,218:265])
new_col_names <- paste("x", 1:48, sep = "")
names(UKBdata2)[218:265] <- new_col_names
tianbu<-mice(UKBdata2[,218:265],m=3)
#插入填补数据
tianbu2<-complete(tianbu,action=2)
colnames(UKBdata2)
UKBdata2_2<-subset(UKBdata2,select=-c(218:265))
names(tianbu2)<- names
UKBdata2<-cbind(UKBdata2_2,tianbu2)# 187485 obs
#导出数据
write_excel_csv(UKBdata2,"E:/deskbook/UKBdata2.csv")
#读取数据####
rm(list=ls())
UKBdata2<-fread("E:/deskbook/UKBdata2.csv",header=T)
#查看随访日期
ICD<-fread("E:/deskbook/ICD.csv",header=T)
ICD_suifang<-subset(ICD,select=c(1,35:41))
UKBdata_suifang<-merge(UKBdata2,ICD,all.x = T,by="eid")
table(UKBdata_suifang$`40005-0.0`)
#Supplement Table 1
table(UKBdata2$pan_cancer)
table(UKBdata2$various_cancer)
UKBdata2$various_cancer[UKBdata2$various_cancer == "non-Hodgkin_lymphoma"] <- "non_Hodgkin_lymphoma"
UKBdata2$various_cancer[UKBdata2$various_cancer == "throid"] <- "thyroid"
UKBdata2$various_cancer[UKBdata2$various_cancer == "cervix"|UKBdata2$various_cancer == "uterine"] <- "uterus_cervix"
#算比例
table(UKBdata2$pan_cancer)/sum(table(UKBdata2$pan_cancer))*100
table(UKBdata2$various_cancer)/sum(table(UKBdata2$various_cancer))*100
#表1####
colnames(UKBdata2)
UKBdata2$energy<-UKBdata2$`100002_1`/4.184
vars<-colnames(UKBdata2[,c(9:22,59,168,267)])
catvars<-colnames(UKBdata2[,c(9:11,14,17:18,22)])
vars2<-colnames(UKBdata2[,c(13,15:16,19:21,59,168,267)])
library(tableone)
table1<-CreateTableOne(vars=vars,strata="status",data=UKBdata2,
                       factorVars =catvars,addOverall = T)
table1_1<-print(table1, quote = FALSE, noSpaces = TRUE, printToggle = FALSE,showAllLevels = T,
                nonnormal=vars2)
write.csv(table1_1,"E:/deskbook/table1.csv")
UKB1<-subset(UKBdata2,status==0)
UKB2<-subset(UKBdata2,status==1)
#初步尝试
library(survival)
colnames(UKBdata2)
result<-c()
for (i in UKBdata2[,c(59,91,120,149,168,187,202,217)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+famaliy_history+
                smoking_status+alochol_drinking+Townsend_deprivation_index2,data=UKBdata2)
  result<-rbind(result,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)],summary(fiti)$coef[1,5]))
}
#使用平均24hffq的总和sum1，接着尝试用几分组好
UKBdata2$MIND_sum1_3group <- cut(UKBdata2$MIND_sum1, 
                                 breaks = quantile(UKBdata2$MIND_sum1, probs = c(0, 0.33, 0.66, 1)), include.lowest = TRUE, labels = FALSE)#三分位分组
UKBdata2$MIND_sum1_5group <- cut(UKBdata2$MIND_sum1, 
                                 breaks = quantile(UKBdata2$MIND_sum1, probs = c(0, 0.20,0.40,0.60, 0.80, 1)), include.lowest = TRUE, labels = FALSE)#五分位分组
UKBdata2$MIND_sum1_3group<-factor(UKBdata2$MIND_sum1_3group)
UKBdata2$MIND_sum1_5group<-factor(UKBdata2$MIND_sum1_5group)
fit1<-coxph(Surv(recruitment_age,status)~UKBdata2$MIND_sum1_3group+energy+sex+education+famaliy_history+
              smoking_status+alochol_drinking+Townsend_deprivation_index2,data=UKBdata2)
summary(fit1)
fit2<-coxph(Surv(recruitment_age,status)~UKBdata2$MIND_sum1_5group+energy+sex+education+famaliy_history+
              smoking_status+alochol_drinking+Townsend_deprivation_index2,data=UKBdata2)
summary(fit2)
#Supplement Table 5
vars<-colnames(UKBdata2[,c(9:22,59,168,267)])
catvars<-colnames(UKBdata2[,c(9:11,14,17:18,22)])
vars2<-colnames(UKBdata2[,c(13,15:16,19:21,59,168,267)])
Supplement_table5<-CreateTableOne(vars=vars,strata="MIND_sum1_3group",data=UKBdata2,
                                  factorVars =catvars,addOverall = T)
Supplement_table5_1<-print(Supplement_table5, quote = FALSE, noSpaces = TRUE, printToggle = FALSE,showAllLevels = T,
                           nonnormal=vars2)
write.csv(Supplement_table5_1,"E:/deskbook/Supplement_table5_1.csv")
#Supplement Table 6####
UKBdata2$MEDAS_sum1_3group <- cut(UKBdata2$MEDAS_sum1, 
                                  breaks = quantile(UKBdata2$MEDAS_sum1, probs = c(0, 0.33, 0.66, 1)), include.lowest = TRUE, labels = FALSE)#三分位分组
Supplement_table6<-CreateTableOne(vars=vars,strata="MEDAS_sum1_3group",data=UKBdata2,
                                  factorVars =catvars,addOverall = T)
Supplement_table6_1<-print(Supplement_table6, quote = FALSE, noSpaces = TRUE, printToggle = FALSE,showAllLevels = T,
                           nonnormal=vars2)
write.csv(Supplement_table6_1,"E:/deskbook/Supplement_table6_1.csv")
#Figure 环形条图####
x1<-UKBdata2$MIND_sum1
summary(x1)#6.265377
mean(x1)#1.895334
sd(x1)
h1<-hist(x1,
         breaks=25,freq=T,xlab="MIND_sum1",ylab="Frequency",
         density = 12,col="red",angle=45)
x2<-UKBdata2$MEDAS_sum1
mean(x2)#4.884331
sd(x2)#1.640144
h2<-hist(x2,
         breaks=15,freq=T,xlab="MEDAS_sum1",ylab="Frequency",
         density = 12,col="red",angle=45)
library(tidyverse)
figure_data<- data.frame(
  individual=paste( "Mister ", seq(1,38), sep=""),
  group=c( rep('MIND score', 27), rep('MEDAS score', 11)) ,
  value=c(70,377,496,1913,2394,5453,6100,10382,10902,15264,15551,18495,
          17076,17744,14993,12690,9863,6840,4649,2619,1542,665,353,8,
          44,12,1,2525,9951,23052,36978,42160,33695,18508,7177,2130,364,33))
figure_data$propotion<-figure_data$value/176573*100
figure_data$group <- as.factor(figure_data$group)
## 在每个分组数据的后面插入几行缺失值
empty_bar <- 3
to_add <- data.frame(matrix(NA, empty_bar*nlevels(figure_data$group), ncol(figure_data)))
colnames(to_add) <- colnames(figure_data) # 设置数据表的名称
to_add$group <- rep(levels(figure_data$group), each=empty_bar)#为数据表添加分组变量
figure_data<- rbind(figure_data, to_add) # 合并两个数据
figure_data <- figure_data %>% arrange(group) # 将数据根据分组进行排序
figure_data$id <- seq(1, nrow(figure_data))
# 获取每个样本的名称在y轴的位置和倾斜角度
label_data <- figure_data
number_of_bar <- nrow(label_data) # 计算条的数量
## 每个条上标签的轴坐标的倾斜角度
angle <- 90 - 360* (label_data$id-0.5) /number_of_bar 
label_data$hjust <- ifelse( angle < -90, 1, 0) # 调整标签的对其方式
label_data$angle <- ifelse(angle < -90, angle+180, angle) ## 标签倾斜角度
## 为数据准备基础弧线的数据
base_data <- figure_data %>% group_by(group) %>% 
  summarize(start=min(id), end=max(id) - empty_bar) %>% 
  rowwise() %>% mutate(title=mean(c(start, end)))
# 为网格标尺准备数据
grid_data <- base_data
grid_data$end <- grid_data$end[c(nrow(grid_data), 1:nrow(grid_data)-1)] + 1
grid_data$start <- grid_data$start - 1
grid_data <- grid_data[-1,]
## 可视化分组圆环条形图
ggplot(figure_data)+
  ## 添加条形图
  geom_bar(aes(x=as.factor(id), y=propotion, fill=group),stat="identity",
           alpha=1) +
  ylim(-20,30) + ## 设置y轴坐标表的取值范围,可流出更大的圆心空白
  theme_minimal()+coord_polar()+
  theme(legend.position = "none", # 不要图例
        axis.text = element_blank(),# 不要x轴的标签
        axis.title = element_blank(), # 不要坐标系的名称
        panel.grid = element_blank(), # 不要网格线
        plot.margin = unit(rep(-1,4), "cm"))+## 整个图与周围的边距
  geom_segment(data=base_data, aes(x = start, y = -2, xend = end, yend = -2),
               colour = "black", alpha=0.8, size=0.6 , inherit.aes = FALSE )+## 添加分组文本信息
  geom_text(data=base_data, aes(x = title, y = -15, label=group),alpha=0.8,
            colour = "black", size=4,fontface="bold", inherit.aes = FALSE)
library(ggsci)
p2<-p1+scale_color_npg()+scale_fill_npg()
#表2 关联分析####
table(UKBdata2$MIND_sum1_3group,UKBdata2$MIND_sum1)
table(UKBdata2$MEDAS_sum1_3group,UKBdata2$MEDAS_sum1)
table(UKBdata2$MIND_sum1_3group)
table(UKBdata2$MEDAS_sum1_3group)
table(UKBdata2$MIND_sum1_3group,UKBdata2$status)
table(UKBdata2$MEDAS_sum1_3group,UKBdata2$status)
library(survival)
#Model 1仅进行能量调整
result<-c()
colnames(UKBdata2)
for (i in UKBdata2[,c(59,168)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy,data=UKBdata2)
  result<-rbind(result,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)],summary(fiti)$coef[1,5]))
}
write.csv(result,"E:/deskbook/table2_1.csv",row.names = F)
result<-c()
for (i in UKBdata2[,c(268,270)]){
  UKBdata2$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy,data=UKBdata2)
  result<-rbind(result,c(exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
write.csv(result,"E:/deskbook/table2_2.csv",row.names = F)
summary(fit1)
#Model 2进一步调整sex,education,income, index, family history
result<-c()
for (i in UKBdata2[,c(59,168)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income,data=UKBdata2)
  result<-rbind(result,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)],summary(fiti)$coef[1,5]))
}
fit1<-coxph(Surv(recruitment_age,status)~MIND_sum1+energy+sex+education+
              famaliy_history+Townsend_deprivation_index2+household_income,data=UKBdata2)
summary(fit1)
fit1<-coxph(Surv(recruitment_age,status)~MEDAS_sum1+energy+sex+education+
              famaliy_history+Townsend_deprivation_index2+household_income,data=UKBdata2)
summary(fit1)
write.csv(result,"E:/deskbook/table2_3.csv",row.names = F)
result<-c()
for (i in UKBdata2[,c(268,270)]){
  UKBdata2$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income,data=UKBdata2)
  result<-rbind(result,c(exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
write.csv(result,"E:/deskbook/table2_4.csv",row.names = F)
#Model 3进一步调整Smoking, alcohol, physical activity, BMI, WHR, SBP
result<-c()
for (i in UKBdata2[,c(59,168)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=UKBdata2)
  result<-rbind(result,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)],summary(fiti)$coef[1,5]))
}
fit1<-coxph(Surv(recruitment_age,status)~MIND_sum1+energy+sex+education+
              famaliy_history+Townsend_deprivation_index2+household_income+
              smoking_status+alochol_drinking+weekly_activity+
              BMI+whr+SBP,data=UKBdata2)
summary(fit1)
fit1<-coxph(Surv(recruitment_age,status)~MEDAS_sum1+energy+sex+education+
              famaliy_history+Townsend_deprivation_index2+household_income+
              smoking_status+alochol_drinking+weekly_activity+
              BMI+whr+SBP,data=UKBdata2)
summary(fit1)
write.csv(result,"E:/deskbook/table2_3.csv",row.names = F)
result<-c()
for (i in UKBdata2[,c(268,270)]){
  UKBdata2$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=UKBdata2)
  result<-rbind(result,c(exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
write.csv(result,"E:/deskbook/table2_4.csv",row.names = F)
#Model 4进一步调整Total_Cholesterol,HDL,tri,CRP,monocyte_count,Albumin
result<-c()
for (i in UKBdata2[,c(62,172)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+Total_Cholesterol+HDL_cholesterol+Triglycerides+CRP+monocyte_count+Albumin,data=UKBdata2)
  result<-rbind(result,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)],summary(fiti)$coef[1,5]))
}
write.csv(result,"D:/deskbook/table2_3.csv",row.names = F)
result<-c()
for (i in UKBdata2[,c(271,273)]){
  UKBdata2$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+Total_Cholesterol+HDL_cholesterol+Triglycerides+CRP+monocyte_count+Albumin,data=UKBdata2)
  result<-rbind(result,c(exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
write.csv(result,"D:/deskbook/table2_4.csv",row.names = F)
#趋势性检验
tapply(UKBdata2$MIND_sum1,UKBdata2$MIND_sum1_3group,function(x) 
{return(quantile(x,probs=c(0.5)))})

UKBdata2$MIND_sum1_3group_p<-ifelse(UKBdata2$MIND_sum1_3group==1,4.5,ifelse(
  UKBdata2$MIND_sum1_3group==2,6.5,8))

tapply(UKBdata2$MEDAS_sum1,UKBdata2$MEDAS_sum1_3group,function(x) 
{return(quantile(x,probs=c(0.5)))})
UKBdata2$MEDAS_sum1_3group_p<-ifelse(UKBdata2$MEDAS_sum1_3group==1,4,ifelse(
  UKBdata2$MEDAS_sum1_3group==2,5,7))
#model 1
colnames(UKBdata2)
result<-c()
for (i in UKBdata2[,c(276:277)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy,data=UKBdata2)
  result<-rbind(result,c(summary(fiti)$coef[1,5]))
}
#model 2
result<-c()
for (i in UKBdata2[,c(276:277)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income,data=UKBdata2)
  result<-rbind(result,c(summary(fiti)$coef[1,5]))
}
#model 3
result<-c()
for (i in UKBdata2[,c(276:277)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=UKBdata2)
  result<-rbind(result,c(summary(fiti)$coef[1,5]))
}
#model 4
result<-c()
for (i in UKBdata2[,c(276:277)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+Total_Cholesterol+HDL_cholesterol+Triglycerides+CRP+monocyte_count+Albumin,data=UKBdata2)
  result<-rbind(result,c(summary(fiti)$coef[1,5]))
}
#Figure1####
library(grid)
library("forestploter")
figure1<-read.csv("E:/deskbook/Figure1.csv",sep=",",header=T)
#整理表格
colnames(figure1)
figure1$Diet.Adherence<-ifelse(is.na(figure1$N),
                               figure1$Diet.Adherence,
                               paste0("  ",figure1$Diet.Adherence))
figure1$N<-ifelse(is.na(figure1$N),"",figure1$N)
figure1$Inicidence<-ifelse(is.na(figure1$Inicidence),"",figure1$Inicidence)
#生成一个绘图区间，等下用来绘图
figure1$`Model 1 (HR [95%CI])`<-paste(rep(' ',20),collapse = ' ')
figure1$` `<-paste(rep(' ',3),collapse = ' ')
figure1$`Model 2 (HR [95%CI])`<-paste(rep(' ',20),collapse = ' ')
figure1$`  `<-paste(rep(' ',3),collapse = ' ')
figure1$`Model 3 (HR [95%CI])`<-paste(rep(' ',20),collapse = ' ')
#绘图
#设置forest_theme函数可以对森林图图片的细节进行调整
colnames(figure1)
p<-forest(figure1[,c(1:3,13:17)],
          est=list(figure1$HR1,figure1$HR2,figure1$HR3),
          lower=list(figure1$LCL1,figure1$LCL2,figure1$LCL3),
          upper = list(figure1$UCL1,figure1$UCL2,figure1$UCL3),
          ci_column=c(4,6,8),
          ref_line = 1,xlim=c(0.75,1.04),
          ticks_at = c(0.75,0.8,0.85,0.9,0.95,1.0))
#将文本加粗
g<-edit_plot(p,row=c(1,6),
             gp=gpar(fontface="bold"))
#做各个食物组与得分与泛癌之间的关联####
#MIND
colnames(UKBdata2)
library(survival)
var_list <- colnames(UKBdata2[,c(45:58)])
result<-c()
for (var in var_list) {
  fit<-coxph(Surv(recruitment_age,status)~eval(parse(text = var))+energy+sex+education+
               famaliy_history+Townsend_deprivation_index2+household_income+
               smoking_status+alochol_drinking+weekly_activity+
               BMI+whr+SBP,data=UKBdata2)
  HR <- exp(fit$coefficients[1])
  CI_lower <- summary(fit)$conf.int[1, 3]
  CI_upper <- summary(fit)$conf.int[1, 4]
  p_value <- summary(fit)$coef[1, 5]
  result <- rbind(result, c(HR, CI_lower, CI_upper, p_value))
}
write.csv(result,"E:/deskbook/Supplement_figure4.csv",row.names = F)
#MEDAS
var_list <- colnames(UKBdata2[,c(157,158,166,160,164,163,167,159,165,162,161)])
result<-c()
for (var in var_list) {
  fit<-coxph(Surv(recruitment_age,status)~eval(parse(text = var))+energy+sex+education+
               famaliy_history+Townsend_deprivation_index2+household_income+
               smoking_status+alochol_drinking+weekly_activity+
               BMI+whr+SBP,data=UKBdata2)
  HR <- exp(fit$coefficients[1])
  CI_lower <- summary(fit)$conf.int[1, 3]
  CI_upper <- summary(fit)$conf.int[1, 4]
  p_value <- summary(fit)$coef[1, 5]
  result <- rbind(result, c(HR, CI_lower, CI_upper, p_value))
}
write.csv(result,"E:/deskbook/Supplement_figure4.csv",row.names = F)
#做成森林图Supplement Figure4a
library(grid)
library("forestploter")
Supplemet_figure4a<-read.csv("E:/deskbook/Supplemet_figure4a.csv",sep=",",header=T)
#生成一个绘图区间，等下用来绘图
Supplemet_figure4a$` `<-paste(rep(' ',20),collapse = ' ')
#生成HR和可信区间
Supplemet_figure4a$`HR (95%CI)`<-paste0(round(Supplemet_figure4a$HR,2)," (",round(Supplemet_figure4a$LCL,2),"-",
                                        round(Supplemet_figure4a$UCL,2),")")
#绘图
#设置forest_theme函数可以对森林图图片的细节进行调整
p<-forest(Supplemet_figure4a[,c(1,6:7,5)],
          est=Supplemet_figure4a$HR,
          lower=Supplemet_figure4a$LCL,
          upper = Supplemet_figure4a$UCL,
          ci_column=2,
          ref_line = 1,xlim=c(0.8,1.13),
          ticks_at = c(0.80, 0.90,1.0,1.10))
#做成森林图Supplement Figure4b
library(grid)
library("forestploter")
Supplemet_figure4b<-read.csv("E:/deskbook/Supplemet_figure4b.csv",sep=",",header=T)
#生成一个绘图区间，等下用来绘图
Supplemet_figure4b$` `<-paste(rep(' ',20),collapse = ' ')
#生成HR和可信区间
Supplemet_figure4b$`HR (95%CI)`<-paste0(round(Supplemet_figure4b$HR,2)," (",round(Supplemet_figure4b$LCL,2),"-",
                                        round(Supplemet_figure4b$UCL,2),")")
#绘图
#设置forest_theme函数可以对森林图图片的细节进行调整
p<-forest(Supplemet_figure4b[,c(1,6:7,5)],
          est=Supplemet_figure4b$HR,
          lower=Supplemet_figure4b$LCL,
          upper = Supplemet_figure4b$UCL,
          ci_column=2,
          ref_line = 1,xlim=c(0.8,1.13),
          ticks_at = c(0.80, 0.90,1.0,1.10))
#RCS
#RCS####
#1.加载包
library(ggplot2)
library(rms) 
#datadist需减少NA
colnames(UKBdata2)
UKBdata2_2<-subset(UKBdata2,select=c(1,4:6,8:20,22,24,25,62,172,222,271,273,274))
#拟合方程并比较ACI
#寻找节点数
for (i in 3:7){
  fit<-coxph(Surv(recruitment_age,status)~rcs(MIND_sum1,nk=i)+energy+sex+education+
               famaliy_history+Townsend_deprivation_index2+household_income+
               smoking_status+alochol_drinking+weekly_activity+
               BMI+whr+SBP,data=UKBdata2_2)
  tmp<-extractAIC(fit)
  if(i==3){AIC=tmp[2];nk=3}
  if(tmp[2]<AIC){AIC=tmp[2];nk=i}
}
#supplement Figure2a
#3个节点
fit31<- cph(Surv(recruitment_age,status)~ rcs(MIND_sum1,3)+energy+sex+education+
              famaliy_history+Townsend_deprivation_index2+household_income+
              smoking_status+alochol_drinking+weekly_activity+
              BMI+whr+SBP,data=UKBdata2_2)
#提取非线性p值
p<-round(anova(fit31)[2,3],3)
#设置参考值
##refvalue<-0
#拟合方程，5代表几个节点，n>100最好选用5个节点
#若是cox回归模型，fit<- cph(Surv(time,death)~ rcs(FAC1_1,5),data=data) 
#打包数据并指定参考值
dd<-datadist(UKBdata2_2)
##dd$limits$f1[2]<-refvalue
options(datadist="dd")
#4.得到图形并美化图形
print(fit31)
orr=Predict(fit31,MIND_sum1,fun = exp,ref.zero = T)
result<-data.frame(orr$MIND_sum1,orr$yhat,orr$lower,orr$upper)
#绘制图形
#绘制左右双标轴
par(mar=c(4,4,3,3)+0.3)#距离外框线的距离
par(xpd=NA)
ylim.bot<-min(orr[,"lower"])
ylim.top<-max(orr[,"upper"])
#密度曲线
plot(orr[,1],orr[,"yhat"],
     xlab="MIND adherence score",ylab="HR",
     type="l",ylim=c(ylim.bot,ylim.top),
     col="red",lwd=3,cex.axis=1.2,cex.lab=1.2)#cex.axis控制刻度大小
lines(orr[,1],orr[,"lower"],lty=2,lwd=2)
lines(orr[,1],orr[,"upper"],lty=2,lwd=2)
lines(x=range(orr[,1]),y=c(1,1),lty=3,col="grey40",lwd=2)
points(6.5,1,pch=16,cex=1.5)      
#附上refvalue的值
text(6.5+1.1,1.08,paste0("Refvalue=",6.5),lwd=4)
#添加图例
legend("topright",
       paste0("P-non-linear=",ifelse(round(p,3)<0.001,"<0.001",round(p,3))),
       bty="n",cex=1.3)
legend(x=0.03,y=1.0,lty=c(1,2),col=c("red","black"),
       c("Estimation","95%CI"),
       bty="n",cex=1.2)
#supplement Figure 2b
#3个节点
fit31<- cph(Surv(recruitment_age,status)~ rcs(MEDAS_sum1,3)+energy+sex+education+
              famaliy_history+Townsend_deprivation_index2+household_income+
              smoking_status+alochol_drinking+weekly_activity+
              BMI+whr+SBP,data=UKBdata2_2)
#提取非线性p值
p<-round(anova(fit31)[2,3],3)
#设置参考值
##refvalue<-0
#拟合方程，5代表几个节点，n>100最好选用5个节点
#若是cox回归模型，fit<- cph(Surv(time,death)~ rcs(FAC1_1,5),data=data) 
#打包数据并指定参考值
dd<-datadist(UKBdata2_2)
##dd$limits$f1[2]<-refvalue
options(datadist="dd")
#4.得到图形并美化图形
print(fit31)
orr=Predict(fit31,MEDAS_sum1,fun = exp,ref.zero = T)
result<-data.frame(orr$MEDAS_sum1,orr$yhat,orr$lower,orr$upper)
#绘制图形
#设置密度曲线的背景色
#绘制左右双标轴
par(mar=c(4,4,3,3)+0.3)#距离外框线的距离
par(xpd=NA)
ylim.bot<-min(orr[,"lower"])
ylim.top<-max(orr[,"upper"])
#密度曲线
plot(orr[,1],orr[,"yhat"],
     xlab="MEDAS adherence score",ylab="HR",
     type="l",ylim=c(ylim.bot,ylim.top),
     col="red",lwd=3,cex.axis=1.2,cex.lab=1.2)#cex.axis控制刻度大小
lines(orr[,1],orr[,"lower"],lty=2,lwd=2)
lines(orr[,1],orr[,"upper"],lty=2,lwd=2)
lines(x=range(orr[,1]),y=c(1,1),lty=3,col="grey40",lwd=2)
points(5.0,1,pch=16,cex=1.5)      
#附上refvalue的值
text(5.0+1.1,1.08,paste0("Refvalue=",5.0),lwd=4)
#添加图例
legend("topright",
       paste0("P-non-linear",ifelse(round(p,3)<0.001,"<0.001",round(p,3))),
       bty="n",cex=1.3)
legend(x=0.03,y=1.0,lty=c(1,2),col=c("red","black"),
       c("Estimation","95%CI"),
       bty="n",cex=1.2)
#分层森林图####
####总癌####
#得到分组分析的结果
#需要先转换为非因子变量
#可以重新读取数据####
library(survival)
UKBdata2<-fread("E:/deskbook/UKBdata2.csv",header=T)
colnames(UKBdata2)
UKBdata2$various_cancer[UKBdata2$various_cancer == "non-Hodgkin_lymphoma"] <- "non_Hodgkin_lymphoma"
UKBdata2$various_cancer[UKBdata2$various_cancer == "throid"] <- "thyroid"
UKBdata2$various_cancer[UKBdata2$various_cancer == "cervix"|UKBdata2$various_cancer == "uterine"] <- "uterus_cervix"
UKBdata2$MIND_sum1_3group <- cut(UKBdata2$MIND_sum1, 
                                 breaks = quantile(UKBdata2$MIND_sum1, probs = c(0, 0.33, 0.66, 1)), include.lowest = TRUE, labels = FALSE)#三分位分组
UKBdata2$MEDAS_sum1_3group <- cut(UKBdata2$MEDAS_sum1, 
                                 breaks = quantile(UKBdata2$MEDAS_sum1, probs = c(0, 0.33, 0.66, 1)), include.lowest = TRUE, labels = FALSE)#三分位分组
UKBdata2$energy<-UKBdata2$`100002_1`/4.184
UKBdata2$smoking_status<-ifelse(UKBdata2$smoking_status=="Never",0,
                                ifelse(UKBdata2$smoking_status=="Former occasional smoker",1,
                                       ifelse(UKBdata2$smoking_status=="Former regular smoker",2,3)))
UKBdata2$alochol_drinking<-ifelse(UKBdata2$alochol_drinking=="Never",0,
                                ifelse(UKBdata2$alochol_drinking=="Occasional drinker",1,2))
#female
colnames(UKBdata2)
var_list<-colnames(UKBdata2[,c(268,267)])
result1_1<-c()
for (var in var_list) {
  fit<-coxph(Surv(recruitment_age,status)~eval(parse(text = var))+energy+sex+education+
               famaliy_history+Townsend_deprivation_index2+household_income+
               smoking_status+alochol_drinking+weekly_activity+
               BMI+whr+SBP,data=UKBdata2,subset = (sex=="0"))
  HR <- exp(fit$coefficients[1])
  CI_lower <- summary(fit)$conf.int[1, 3]
  CI_upper <- summary(fit)$conf.int[1, 4]
  p_value <- summary(fit)$coef[1, 5]
  result1_1<-rbind(result1_1, c(HR, CI_lower, CI_upper, p_value))
}
rownames(result1_1)<-c("MEDAS score","MIND score")
colnames(result1_1)<-c("OR","LCL","UCL","P")
#性别为male
result1_2<-c()
for (var in var_list) {
  fit<-coxph(Surv(recruitment_age,status)~eval(parse(text = var))+energy+sex+education+
               famaliy_history+Townsend_deprivation_index2+household_income+
               smoking_status+alochol_drinking+weekly_activity+
               BMI+whr+SBP,data=UKBdata2,subset = (sex=="1"))
  HR <- exp(fit$coefficients[1])
  CI_lower <- summary(fit)$conf.int[1, 3]
  CI_upper <- summary(fit)$conf.int[1, 4]
  p_value <- summary(fit)$coef[1, 5]
  result1_2<-rbind(result1_2, c(HR, CI_lower, CI_upper, p_value))
}
rownames(result1_2)<-c("MEDAS score","MIND score")
result1<-rbind(result1_1,result1_2)
#无完成全职教育
result2_1<-c()
for (var in var_list) {
  fit<-coxph(Surv(recruitment_age,status)~eval(parse(text = var))+energy+sex+education+
               famaliy_history+Townsend_deprivation_index2+household_income+
               smoking_status+alochol_drinking+weekly_activity+
               BMI+whr+SBP,data=UKBdata2,subset = (education=="0"))
  HR <- exp(fit$coefficients[1])
  CI_lower <- summary(fit)$conf.int[1, 3]
  CI_upper <- summary(fit)$conf.int[1, 4]
  p_value <- summary(fit)$coef[1, 5]
  result2_1<-rbind(result2_1, c(HR, CI_lower, CI_upper, p_value))
}
rownames(result2_1)<-c("MEDAS score","MIND score")
colnames(result2_1)<-c("OR","LCL","UCL","P")
#有完成全职教育
result2_2<-c()
for (var in var_list) {
  fit<-coxph(Surv(recruitment_age,status)~eval(parse(text = var))+energy+sex+education+
               famaliy_history+Townsend_deprivation_index2+household_income+
               smoking_status+alochol_drinking+weekly_activity+
               BMI+whr+SBP,data=UKBdata2,subset = (education=="1"))
  HR <- exp(fit$coefficients[1])
  CI_lower <- summary(fit)$conf.int[1, 3]
  CI_upper <- summary(fit)$conf.int[1, 4]
  p_value <- summary(fit)$coef[1, 5]
  result2_2<-rbind(result2_2,c(HR, CI_lower,CI_upper,p_value))
}
rownames(result2_2)<-c("MEDAS score","MIND score")
colnames(result2_2)<-c("OR","LCL","UCL","P")
result2<-rbind(result2_1,result2_2)
#家族史为0
result4_1<-c()
for (var in var_list) {
  fit<-coxph(Surv(recruitment_age,status)~eval(parse(text = var))+energy+sex+education+
               famaliy_history+Townsend_deprivation_index2+household_income+
               smoking_status+alochol_drinking+weekly_activity+
               BMI+whr+SBP,data=UKBdata2,subset=(famaliy_history=="0"))
  HR <- exp(fit$coefficients[1])
  CI_lower <- summary(fit)$conf.int[1, 3]
  CI_upper <- summary(fit)$conf.int[1, 4]
  p_value <- summary(fit)$coef[1, 5]
  result4_1<-rbind(result4_1, c(HR, CI_lower, CI_upper, p_value))
}
rownames(result4_1)<-c("MEDAS score","MIND score")
colnames(result4_1)<-c("OR","LCL","UCL","P")
#家族史为1
result4_2<-c()
for (var in var_list) {
  fit<-coxph(Surv(recruitment_age,status)~eval(parse(text = var))+energy+sex+education+
               famaliy_history+Townsend_deprivation_index2+household_income+
               smoking_status+alochol_drinking+weekly_activity+
               BMI+whr+SBP,data=UKBdata2,subset=(famaliy_history=="1"))
  HR <- exp(fit$coefficients[1])
  CI_lower <- summary(fit)$conf.int[1, 3]
  CI_upper <- summary(fit)$conf.int[1, 4]
  p_value <- summary(fit)$coef[1, 5]
  result4_2<-rbind(result4_2, c(HR, CI_lower, CI_upper, p_value))
}
rownames(result4_2)<-c("MEDAS score","MIND score")
colnames(result4_2)<-c("OR","LCL","UCL","P")
result4<-rbind(result4_1,result4_2)
#吸烟史0
UKBdata2$smoking_status2<-ifelse(UKBdata2$smoking_status=="Never",0,1)
result5_1<-c()
for (var in var_list) {
  fit<-coxph(Surv(recruitment_age,status)~eval(parse(text = var))+energy+sex+education+
               famaliy_history+Townsend_deprivation_index2+household_income+
               smoking_status2+alochol_drinking+weekly_activity+
               BMI+whr+SBP,data=UKBdata2,subset=(smoking_status2=="0"))
  HR <- exp(fit$coefficients[1])
  CI_lower <- summary(fit)$conf.int[1, 3]
  CI_upper <- summary(fit)$conf.int[1, 4]
  p_value <- summary(fit)$coef[1, 5]
  result5_1<-rbind(result5_1, c(HR, CI_lower, CI_upper, p_value))
}
rownames(result5_1)<-c("MEDAS score","MIND score")
colnames(result5_1)<-c("OR","LCL","UCL","P")
#吸烟史为1
result5_2<-c()
for (var in var_list) {
  fit<-coxph(Surv(recruitment_age,status)~eval(parse(text = var))+energy+sex+education+
               famaliy_history+Townsend_deprivation_index2+household_income+
               smoking_status2+alochol_drinking+weekly_activity+
               BMI+whr+SBP,data=UKBdata2,subset=(smoking_status2=="1"))
  HR <- exp(fit$coefficients[1])
  CI_lower <- summary(fit)$conf.int[1, 3]
  CI_upper <- summary(fit)$conf.int[1, 4]
  p_value <- summary(fit)$coef[1, 5]
  result5_2<-rbind(result5_2, c(HR, CI_lower, CI_upper, p_value))
}
rownames(result5_2)<-c("MEDAS score","MIND score")
colnames(result5_2)<-c("OR","LCL","UCL","P")
result5<-rbind(result5_1,result5_2)
#饮酒史为0
UKBdata2$alochol_drinking2<-ifelse(UKBdata2$alochol_drinking=="Never",0,1)
result6_1<-c()
for (var in var_list) {
  fit<-coxph(Surv(recruitment_age,status)~eval(parse(text = var))+energy+sex+education+
               famaliy_history+Townsend_deprivation_index2+household_income+
               smoking_status+alochol_drinking2+weekly_activity+
               BMI+whr+SBP,data=UKBdata2,subset=(alochol_drinking2=="0"))
  HR <- exp(fit$coefficients[1])
  CI_lower <- summary(fit)$conf.int[1, 3]
  CI_upper <- summary(fit)$conf.int[1, 4]
  p_value <- summary(fit)$coef[1, 5]
  result6_1<-rbind(result6_1, c(HR, CI_lower, CI_upper, p_value))
}
rownames(result6_1)<-c("MEDAS score","MIND score")
colnames(result6_1)<-c("OR","LCL","UCL","P")
#饮酒史为1
result6_2<-c()
for (var in var_list) {
  fit<-coxph(Surv(recruitment_age,status)~eval(parse(text = var))+energy+sex+education+
               famaliy_history+Townsend_deprivation_index2+household_income+
               smoking_status+alochol_drinking2+weekly_activity+
               BMI+whr+SBP,data=UKBdata2,subset=(alochol_drinking2=="1"))
  HR <- exp(fit$coefficients[1])
  CI_lower <- summary(fit)$conf.int[1, 3]
  CI_upper <- summary(fit)$conf.int[1, 4]
  p_value <- summary(fit)$coef[1, 5]
  result6_2<-rbind(result6_2, c(HR, CI_lower, CI_upper, p_value))
}
rownames(result6_2)<-c("MEDAS score","MIND score")
colnames(result6_2)<-c("OR","LCL","UCL","P")
result6<-rbind(result6_1,result6_2)
#BMI为非肥胖
UKBdata2$BMIgroup<-ifelse(UKBdata2$BMI<=25,0,1)
result7_1<-c()
for (var in var_list) {
  fit<-coxph(Surv(recruitment_age,status)~eval(parse(text = var))+energy+sex+education+
               famaliy_history+Townsend_deprivation_index2+household_income+
               smoking_status+alochol_drinking+weekly_activity+
               BMIgroup+whr+SBP,data=UKBdata2,subset=(BMIgroup=="0"))
  HR <- exp(fit$coefficients[1])
  CI_lower <- summary(fit)$conf.int[1, 3]
  CI_upper <- summary(fit)$conf.int[1, 4]
  p_value <- summary(fit)$coef[1, 5]
  result7_1<-rbind(result7_1, c(HR, CI_lower, CI_upper, p_value))
}
rownames(result7_1)<-c("MEDAS score","MIND score")
colnames(result7_1)<-c("OR","LCL","UCL","P")
#肥胖
result7_2<-c()
for (var in var_list) {
  fit<-coxph(Surv(recruitment_age,status)~eval(parse(text = var))+energy+sex+education+
               famaliy_history+Townsend_deprivation_index2+household_income+
               smoking_status+alochol_drinking+weekly_activity+
               BMIgroup+whr+SBP,data=UKBdata2,subset=(BMIgroup=="1"))
  HR <- exp(fit$coefficients[1])
  CI_lower <- summary(fit)$conf.int[1, 3]
  CI_upper <- summary(fit)$conf.int[1, 4]
  p_value <- summary(fit)$coef[1, 5]
  result7_2<-rbind(result7_2, c(HR, CI_lower, CI_upper, p_value))
}
rownames(result7_2)<-c("MEDAS score","MIND score")
colnames(result7_2)<-c("OR","LCL","UCL","P")
result7<-rbind(result7_1,result7_2)
#导出
write.csv(result1,"E:/deskbook/result1.csv")
write.csv(result2,"E:/deskbook/result2.csv")
write.csv(result4,"E:/deskbook/result4.csv")
write.csv(result5,"E:/deskbook/result5.csv")
write.csv(result6,"E:/deskbook/result6.csv")
write.csv(result7,"E:/deskbook/result7.csv")
#得到交互作用P
#性别
result1 <- data.frame() 
 for (var in var_list) {
    formula <- as.formula(paste("Surv(recruitment_age, status) ~", var, "+ energy + sex + education + famaliy_history + 
                              Townsend_deprivation_index2 + household_income + smoking_status + 
                               alochol_drinking + weekly_activity + BMI + whr + SBP +", var, "*sex", sep = " "))
    fit <- coxph(formula, data = UKBdata2)
    interaction_term <- paste(var, "sex", sep = ":")
    p_value <- ifelse(interaction_term %in% names(coef(fit)), summary(fit)$coefficients[interaction_term, "Pr(>|z|)"], NA)
    result1 <- rbind(result1, data.frame(Variable = var, P_Value = p_value))
         }
print(result1)
#教育
result1 <- data.frame() 
for (var in var_list) {
  formula <- as.formula(paste("Surv(recruitment_age, status) ~", var, "+ energy + sex + education + famaliy_history + 
                              Townsend_deprivation_index2 + household_income + smoking_status + 
                               alochol_drinking + weekly_activity + BMI + whr + SBP +", var, "*education", sep = " "))
  fit <- coxph(formula, data = UKBdata2)
  interaction_term <- paste(var, "education", sep = ":")
  p_value <- ifelse(interaction_term %in% names(coef(fit)), summary(fit)$coefficients[interaction_term, "Pr(>|z|)"], NA)
  result1 <- rbind(result1, data.frame(Variable = var, P_Value = p_value))
}
print(result1)
#家族史
result1 <- data.frame() 
for (var in var_list) {
  formula <- as.formula(paste("Surv(recruitment_age, status) ~", var, "+ energy + sex + education + famaliy_history + 
                              Townsend_deprivation_index2 + household_income + smoking_status + 
                               alochol_drinking + weekly_activity + BMI + whr + SBP +", var, "*famaliy_history", sep = " "))
  fit <- coxph(formula, data = UKBdata2)
  interaction_term <- paste(var, "famaliy_history", sep = ":")
  p_value <- ifelse(interaction_term %in% names(coef(fit)), summary(fit)$coefficients[interaction_term, "Pr(>|z|)"], NA)
  result1 <- rbind(result1, data.frame(Variable = var, P_Value = p_value))
}
print(result1)
#吸烟
result1 <- data.frame() 
for (var in var_list) {
  formula <- as.formula(paste("Surv(recruitment_age, status) ~", var, "+ energy + sex + education + famaliy_history + 
                              Townsend_deprivation_index2 + household_income + smoking_status2 + 
                               alochol_drinking + weekly_activity + BMI + whr + SBP +", var, "*smoking_status2", sep = " "))
  fit <- coxph(formula, data = UKBdata2)
  interaction_term <- paste(var, "smoking_status2", sep = ":")
  p_value <- ifelse(interaction_term %in% names(coef(fit)), summary(fit)$coefficients[interaction_term, "Pr(>|z|)"], NA)
  result1 <- rbind(result1, data.frame(Variable = var, P_Value = p_value))
}
print(result1)
#饮酒
colnames(UKBdata2)
result1 <- data.frame() 
for (var in var_list) {
  formula <- as.formula(paste("Surv(recruitment_age, status) ~", var, "+ energy + sex + education + famaliy_history + 
                              Townsend_deprivation_index2 + household_income + smoking_status+ 
                               alochol_drinking2+ weekly_activity + BMI + whr + SBP +", var, "*alochol_drinking2", sep = " "))
  fit <- coxph(formula, data = UKBdata2)
  interaction_term <- paste(var, "alochol_drinking", sep = ":")
  p_value <- ifelse(interaction_term %in% names(coef(fit)), summary(fit)$coefficients[interaction_term, "Pr(>|z|)"], NA)
  result1 <- rbind(result1, data.frame(Variable = var, P_Value = p_value))
}
#BMI
result1 <- data.frame() 
for (var in var_list) {
  formula <- as.formula(paste("Surv(recruitment_age, status) ~", var, "+ energy + sex + education + famaliy_history + 
                              Townsend_deprivation_index2 + household_income + smoking_status+ 
                               alochol_drinking+ weekly_activity + BMIgroup + whr + SBP +", var, "*BMIgroup", sep = " "))
  fit <- coxph(formula, data = UKBdata2)
  interaction_term <- paste(var, "BMIgroup", sep = ":")
  p_value <- ifelse(interaction_term %in% names(coef(fit)), summary(fit)$coefficients[interaction_term, "Pr(>|z|)"], NA)
  result1 <- rbind(result1, data.frame(Variable = var, P_Value = p_value))
}
print(result1)
#获得相应癌症发生数
colnames(UKBdata2)
table(UKBdata2$sex,UKBdata2$status)
table(UKBdata2$education,UKBdata2$status)
table(UKBdata2$famaliy_history,UKBdata2$status)
table(UKBdata2$smoking_status2)
table(UKBdata2$smoking_status2,UKBdata2$status)
table(UKBdata2$alochol_drinking2)
table(UKBdata2$alochol_drinking2,UKBdata2$status)
table(UKBdata2$BMIgroup)
table(UKBdata2$BMIgroup,UKBdata2$status)
#Figure 2####
library(grid)
library("forestploter")
figure2<-read.csv("E:/deskbook/Figure2.csv",sep=",",header=T)
#整理表格
figure2$Subgroup<-ifelse(is.na(figure2$N),
                         figure2$Subgroup,
                         paste0("  ",figure2$Subgroup))
figure2$N<-ifelse(is.na(figure2$N),"",figure2$N)
figure2$Incidence<-ifelse(is.na(figure2$Incidence),"",figure2$Incidence)
figure2$P.for.interaction<-ifelse(is.na(figure2$P.for.interaction),"",figure2$P.for.interaction)
#生成一个变量se，它在绘图的时候表示正方形的大小
figure2$se<-(log(figure2$UCL)-log(figure2$HR))/1.96
#生成一个绘图区间，等下用来绘图
figure2$` `<-paste(rep(' ',20),collapse = ' ')
#生成HR和可信区间
figure2$`HR (95%CI)`<-ifelse(is.na(figure2$se),"",
                             paste0(round(figure2$HR,2)," (",round(figure2$LCL,2),"-",round(figure2$UCL,2),")"))
#绘图
#设置forest_theme函数可以对森林图图片的细节进行调整
ggsci::pal_aaas()
tm<-forest_theme(base_size=10,ci_pch = 15,
                 ci_col="black",ci_lty = 1,ci_lwd=2.0,ci_fill="blue")
colnames(figure2)
p<-forest(figure2[,c(1:5,10:11)],
          est=figure2$HR1,
          lower=figure2$LCL1,
          upper = figure2$UCL1,
          ci_column=6,
          ref_line = 1,xlim=c(0.8,1.05),
          ticks_at = c(0.8,0.85,0.9,0.95,1.0),theme = tm)
#将文本加粗
g<-edit_plot(p,row=c(1,6,11,16,21,26),
             gp=gpar(fontface="bold"))
####分癌Supplement Figure6####
colnames(UKBdata2)
library(data.table)
library(survival)
library(tidyverse)
UKBdata2<-fread("E:/deskbook/UKBdata2.csv",header=T)
colnames(UKBdata2)
####head and neck####
data_head<-subset(UKBdata2,various_cancer=="head_and_neck"|various_cancer==0)
#female
result1_1<-c()
for (i in data_head[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_head,subset = (sex=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#性别为male
result1_2<-c()
for (i in data_head[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_head,subset = (sex=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_head[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*sex,data=data_head)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_sex<-cbind(result1,new_result1_3)
result_sex<-result_sex%>% mutate(strate=c("female_MED","male_MED","Female_MIND","male_MIND"),.before=OR)
result_sex<-result_sex%>% mutate(cancer=c("head"),.before=strate)
#无完成全职教育
result1_1<-c()
for (i in data_head[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_head,subset = (education=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#有完成全职教育
result1_2<-c()
for (i in data_head[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_head,subset = (education=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_head[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*education,data=data_head)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_education<-cbind(result1,new_result1_3)
result_education<-result_education%>% mutate(strate=c("noeducaiton_MED","educaiton_MED","noeducaiton_MIND","educaiton_MIND"),.before=OR)
result_education<-result_education%>% mutate(cancer=c("head"),.before=strate)
#家族史为0
result1_1<-c()
for (i in data_head[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_head,subset = (famaliy_history=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#家族史为1
result1_2<-c()
for (i in data_head[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_head,subset = (famaliy_history=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_head[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*famaliy_history,data=data_head)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_family<-cbind(result1,new_result1_3)
result_family<-result_family%>% mutate(strate=c("nofamily_MED","family_MED","nofamily_MIND","family_MIND"),.before=OR)
result_family<-result_family%>% mutate(cancer=c("head"),.before=strate)
#吸烟史0
data_head$smoking_status2<-ifelse(data_head$smoking_status=="0",0,1)
result1_1<-c()
for (i in data_head[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_head,subset = (smoking_status2=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#吸烟史为1
result1_2<-c()
for (i in data_head[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_head,subset = (smoking_status2=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_head[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*smoking_status2,data=data_head)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_smoking<-cbind(result1,new_result1_3)
result_smoking<-result_smoking%>% mutate(strate=c("nosmoking_MED","yes_MED","nosmoking_MIND","yes_MIND"),.before=OR)
result_smoking<-result_smoking%>% mutate(cancer=c("head"),.before=strate)
#饮酒史为0
data_head$alochol_drinking2<-ifelse(data_head$alochol_drinking=="0",0,1)
result1_1<-c()
for (i in data_head[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP,data=data_head,subset = (alochol_drinking2=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#饮酒史为1
result1_2<-c()
for (i in data_head[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP,data=data_head,subset = (alochol_drinking2=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_head[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP+i*alochol_drinking2,data=data_head)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_alcohol<-cbind(result1,new_result1_3)
result_alcohol<-result_alcohol%>% mutate(strate=c("noalcohol_MED","yes_MED","noalcohol_MIND","yes_MIND"),.before=OR)
result_alcohol<-result_alcohol%>% mutate(cancer=c("head"),.before=strate)
#BMI为非肥胖
data_head$BMIgroup<-ifelse(data_head$BMI<=25,0,1)
result1_1<-c()
for (i in data_head[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP,data=data_head,subset = (BMIgroup=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#肥胖
result1_2<-c()
for (i in data_head[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP,data=data_head,subset = (BMIgroup=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_head[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP+i*BMIgroup,data=data_head)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_BMI<-cbind(result1,new_result1_3)
result_BMI<-result_BMI%>% mutate(strate=c("nofat_MED","yes_MED","nofat_MIND","yes_MIND"),.before=OR)
result_BMI<-result_BMI%>% mutate(cancer=c("head"),.before=strate)
#合并
result_head<-rbind(result_sex,result_education,result_family,result_smoking,result_alcohol,result_BMI)


####esophagus####
data_esophagus<-subset(UKBdata2,various_cancer=="esophagus"|various_cancer==0)
#female
result1_1<-c()
for (i in data_esophagus[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_esophagus,subset = (sex=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#性别为male
result1_2<-c()
for (i in data_esophagus[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_esophagus,subset = (sex=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_esophagus[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*sex,data=data_esophagus)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_sex<-cbind(result1,new_result1_3)
result_sex<-result_sex%>% mutate(strate=c("female_MED","male_MED","Female_MIND","male_MIND"),.before=OR)
result_sex<-result_sex%>% mutate(cancer=c("esophagus"),.before=strate)
#无完成全职教育
result1_1<-c()
for (i in data_esophagus[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_esophagus,subset = (education=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#有完成全职教育
result1_2<-c()
for (i in data_esophagus[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_esophagus,subset = (education=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_esophagus[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*education,data=data_esophagus)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_education<-cbind(result1,new_result1_3)
result_education<-result_education%>% mutate(strate=c("noeducaiton_MED","educaiton_MED","noeducaiton_MIND","educaiton_MIND"),.before=OR)
result_education<-result_education%>% mutate(cancer=c("esophagus"),.before=strate)
#家族史为0
result1_1<-c()
for (i in data_esophagus[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_esophagus,subset = (famaliy_history=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#家族史为1
result1_2<-c()
for (i in data_esophagus[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_esophagus,subset = (famaliy_history=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_esophagus[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*famaliy_history,data=data_esophagus)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_family<-cbind(result1,new_result1_3)
result_family<-result_family%>% mutate(strate=c("nofamily_MED","family_MED","nofamily_MIND","family_MIND"),.before=OR)
result_family<-result_family%>% mutate(cancer=c("esophagus"),.before=strate)
#吸烟史0
data_esophagus$smoking_status2<-ifelse(data_esophagus$smoking_status=="0",0,1)
result1_1<-c()
for (i in data_esophagus[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_esophagus,subset = (smoking_status2=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#吸烟史为1
result1_2<-c()
for (i in data_esophagus[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_esophagus,subset = (smoking_status2=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_esophagus[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*smoking_status2,data=data_esophagus)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_smoking<-cbind(result1,new_result1_3)
result_smoking<-result_smoking%>% mutate(strate=c("nosmoking_MED","yes_MED","nosmoking_MIND","yes_MIND"),.before=OR)
result_smoking<-result_smoking%>% mutate(cancer=c("esophagus"),.before=strate)
#饮酒史为0
data_esophagus$alochol_drinking2<-ifelse(data_esophagus$alochol_drinking=="0",0,1)
result1_1<-c()
for (i in data_esophagus[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP,data=data_esophagus,subset = (alochol_drinking2=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#饮酒史为1
result1_2<-c()
for (i in data_esophagus[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP,data=data_esophagus,subset = (alochol_drinking2=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_esophagus[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP+i*alochol_drinking2,data=data_esophagus)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_alcohol<-cbind(result1,new_result1_3)
result_alcohol<-result_alcohol%>% mutate(strate=c("noalcohol_MED","yes_MED","noalcohol_MIND","yes_MIND"),.before=OR)
result_alcohol<-result_alcohol%>% mutate(cancer=c("esophagus"),.before=strate)
#BMI为非肥胖
data_esophagus$BMIgroup<-ifelse(data_esophagus$BMI<=25,0,1)
result1_1<-c()
for (i in data_esophagus[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP,data=data_esophagus,subset = (BMIgroup=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#肥胖
result1_2<-c()
for (i in data_esophagus[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP,data=data_esophagus,subset = (BMIgroup=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_esophagus[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP+i*BMIgroup,data=data_esophagus)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_BMI<-cbind(result1,new_result1_3)
result_BMI<-result_BMI%>% mutate(strate=c("nofat_MED","yes_MED","nofat_MIND","yes_MIND"),.before=OR)
result_BMI<-result_BMI%>% mutate(cancer=c("esophagus"),.before=strate)
#合并
result_esophagus<-rbind(result_sex,result_education,result_family,result_smoking,result_alcohol,result_BMI)


####stomach####
data_stomach<-subset(UKBdata2,various_cancer=="stomach"|various_cancer==0)
#female
result1_1<-c()
for (i in data_stomach[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_stomach,subset = (sex=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#性别为male
result1_2<-c()
for (i in data_stomach[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_stomach,subset = (sex=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_stomach[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*sex,data=data_stomach)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_sex<-cbind(result1,new_result1_3)
result_sex<-result_sex%>% mutate(strate=c("female_MED","male_MED","Female_MIND","male_MIND"),.before=OR)
result_sex<-result_sex%>% mutate(cancer=c("stomach"),.before=strate)
#无完成全职教育
result1_1<-c()
for (i in data_stomach[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_stomach,subset = (education=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#有完成全职教育
result1_2<-c()
for (i in data_stomach[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_stomach,subset = (education=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_stomach[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*education,data=data_stomach)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_education<-cbind(result1,new_result1_3)
result_education<-result_education%>% mutate(strate=c("noeducaiton_MED","educaiton_MED","noeducaiton_MIND","educaiton_MIND"),.before=OR)
result_education<-result_education%>% mutate(cancer=c("stomach"),.before=strate)
#家族史为0
result1_1<-c()
for (i in data_stomach[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_stomach,subset = (famaliy_history=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#家族史为1
result1_2<-c()
for (i in data_stomach[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_stomach,subset = (famaliy_history=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_stomach[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*famaliy_history,data=data_stomach)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_family<-cbind(result1,new_result1_3)
result_family<-result_family%>% mutate(strate=c("nofamily_MED","family_MED","nofamily_MIND","family_MIND"),.before=OR)
result_family<-result_family%>% mutate(cancer=c("stomach"),.before=strate)
#吸烟史0
data_stomach$smoking_status2<-ifelse(data_stomach$smoking_status=="0",0,1)
result1_1<-c()
for (i in data_stomach[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_stomach,subset = (smoking_status2=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#吸烟史为1
result1_2<-c()
for (i in data_stomach[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_stomach,subset = (smoking_status2=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_stomach[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*smoking_status2,data=data_stomach)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_smoking<-cbind(result1,new_result1_3)
result_smoking<-result_smoking%>% mutate(strate=c("nosmoking_MED","yes_MED","nosmoking_MIND","yes_MIND"),.before=OR)
result_smoking<-result_smoking%>% mutate(cancer=c("stomach"),.before=strate)
#饮酒史为0
data_stomach$alochol_drinking2<-ifelse(data_stomach$alochol_drinking=="0",0,1)
result1_1<-c()
for (i in data_stomach[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP,data=data_stomach,subset = (alochol_drinking2=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#饮酒史为1
result1_2<-c()
for (i in data_stomach[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP,data=data_stomach,subset = (alochol_drinking2=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_stomach[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP+i*alochol_drinking2,data=data_stomach)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_alcohol<-cbind(result1,new_result1_3)
result_alcohol<-result_alcohol%>% mutate(strate=c("noalcohol_MED","yes_MED","noalcohol_MIND","yes_MIND"),.before=OR)
result_alcohol<-result_alcohol%>% mutate(cancer=c("stomach"),.before=strate)
#BMI为非肥胖
data_stomach$BMIgroup<-ifelse(data_stomach$BMI<=25,0,1)
result1_1<-c()
for (i in data_stomach[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP,data=data_stomach,subset = (BMIgroup=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#肥胖
result1_2<-c()
for (i in data_stomach[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP,data=data_stomach,subset = (BMIgroup=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_stomach[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP+i*BMIgroup,data=data_stomach)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_BMI<-cbind(result1,new_result1_3)
result_BMI<-result_BMI%>% mutate(strate=c("nofat_MED","yes_MED","nofat_MIND","yes_MIND"),.before=OR)
result_BMI<-result_BMI%>% mutate(cancer=c("stomach"),.before=strate)
#合并
result_stomach<-rbind(result_sex,result_education,result_family,result_smoking,result_alcohol,result_BMI)

####colorectal####
data_colorectal<-subset(UKBdata2,various_cancer=="colorectal"|various_cancer==0)
#female
result1_1<-c()
for (i in data_colorectal[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_colorectal,subset = (sex=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#性别为male
result1_2<-c()
for (i in data_colorectal[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_colorectal,subset = (sex=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_colorectal[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*sex,data=data_colorectal)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_sex<-cbind(result1,new_result1_3)
result_sex<-result_sex%>% mutate(strate=c("female_MED","male_MED","Female_MIND","male_MIND"),.before=OR)
result_sex<-result_sex%>% mutate(cancer=c("colorectal"),.before=strate)
#无完成全职教育
result1_1<-c()
for (i in data_colorectal[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_colorectal,subset = (education=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#有完成全职教育
result1_2<-c()
for (i in data_colorectal[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_colorectal,subset = (education=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_colorectal[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*education,data=data_colorectal)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_education<-cbind(result1,new_result1_3)
result_education<-result_education%>% mutate(strate=c("noeducaiton_MED","educaiton_MED","noeducaiton_MIND","educaiton_MIND"),.before=OR)
result_education<-result_education%>% mutate(cancer=c("colorectal"),.before=strate)
#家族史为0
result1_1<-c()
for (i in data_colorectal[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_colorectal,subset = (famaliy_history=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#家族史为1
result1_2<-c()
for (i in data_colorectal[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_colorectal,subset = (famaliy_history=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_colorectal[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*famaliy_history,data=data_colorectal)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_family<-cbind(result1,new_result1_3)
result_family<-result_family%>% mutate(strate=c("nofamily_MED","family_MED","nofamily_MIND","family_MIND"),.before=OR)
result_family<-result_family%>% mutate(cancer=c("colorectal"),.before=strate)
#吸烟史0
data_colorectal$smoking_status2<-ifelse(data_colorectal$smoking_status=="0",0,1)
result1_1<-c()
for (i in data_colorectal[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_colorectal,subset = (smoking_status2=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#吸烟史为1
result1_2<-c()
for (i in data_colorectal[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_colorectal,subset = (smoking_status2=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_colorectal[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*smoking_status2,data=data_colorectal)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_smoking<-cbind(result1,new_result1_3)
result_smoking<-result_smoking%>% mutate(strate=c("nosmoking_MED","yes_MED","nosmoking_MIND","yes_MIND"),.before=OR)
result_smoking<-result_smoking%>% mutate(cancer=c("colorectal"),.before=strate)
#饮酒史为0
data_colorectal$alochol_drinking2<-ifelse(data_colorectal$alochol_drinking=="0",0,1)
result1_1<-c()
for (i in data_colorectal[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP,data=data_colorectal,subset = (alochol_drinking2=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#饮酒史为1
result1_2<-c()
for (i in data_colorectal[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP,data=data_colorectal,subset = (alochol_drinking2=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_colorectal[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP+i*alochol_drinking2,data=data_colorectal)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_alcohol<-cbind(result1,new_result1_3)
result_alcohol<-result_alcohol%>% mutate(strate=c("noalcohol_MED","yes_MED","noalcohol_MIND","yes_MIND"),.before=OR)
result_alcohol<-result_alcohol%>% mutate(cancer=c("colorectal"),.before=strate)
#BMI为非肥胖
data_colorectal$BMIgroup<-ifelse(data_colorectal$BMI<=25,0,1)
result1_1<-c()
for (i in data_colorectal[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP,data=data_colorectal,subset = (BMIgroup=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#肥胖
result1_2<-c()
for (i in data_colorectal[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP,data=data_colorectal,subset = (BMIgroup=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_colorectal[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP+i*BMIgroup,data=data_colorectal)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_BMI<-cbind(result1,new_result1_3)
result_BMI<-result_BMI%>% mutate(strate=c("nofat_MED","yes_MED","nofat_MIND","yes_MIND"),.before=OR)
result_BMI<-result_BMI%>% mutate(cancer=c("colorectal"),.before=strate)
#合并
result_colorectal<-rbind(result_sex,result_education,result_family,result_smoking,result_alcohol,result_BMI)


####liver####
data_liver<-subset(UKBdata2,various_cancer=="liver"|various_cancer==0)
#female
result1_1<-c()
for (i in data_liver[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_liver,subset = (sex=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#性别为male
result1_2<-c()
for (i in data_liver[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_liver,subset = (sex=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_liver[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*sex,data=data_liver)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_sex<-cbind(result1,new_result1_3)
result_sex<-result_sex%>% mutate(strate=c("female_MED","male_MED","Female_MIND","male_MIND"),.before=OR)
result_sex<-result_sex%>% mutate(cancer=c("liver"),.before=strate)
#无完成全职教育
result1_1<-c()
for (i in data_liver[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_liver,subset = (education=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#有完成全职教育
result1_2<-c()
for (i in data_liver[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_liver,subset = (education=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_liver[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*education,data=data_liver)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_education<-cbind(result1,new_result1_3)
result_education<-result_education%>% mutate(strate=c("noeducaiton_MED","educaiton_MED","noeducaiton_MIND","educaiton_MIND"),.before=OR)
result_education<-result_education%>% mutate(cancer=c("liver"),.before=strate)
#家族史为0
result1_1<-c()
for (i in data_liver[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_liver,subset = (famaliy_history=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#家族史为1
result1_2<-c()
for (i in data_liver[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_liver,subset = (famaliy_history=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_liver[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*famaliy_history,data=data_liver)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_family<-cbind(result1,new_result1_3)
result_family<-result_family%>% mutate(strate=c("nofamily_MED","family_MED","nofamily_MIND","family_MIND"),.before=OR)
result_family<-result_family%>% mutate(cancer=c("liver"),.before=strate)
#吸烟史0
data_liver$smoking_status2<-ifelse(data_liver$smoking_status=="0",0,1)
result1_1<-c()
for (i in data_liver[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_liver,subset = (smoking_status2=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#吸烟史为1
result1_2<-c()
for (i in data_liver[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_liver,subset = (smoking_status2=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_liver[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*smoking_status2,data=data_liver)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_smoking<-cbind(result1,new_result1_3)
result_smoking<-result_smoking%>% mutate(strate=c("nosmoking_MED","yes_MED","nosmoking_MIND","yes_MIND"),.before=OR)
result_smoking<-result_smoking%>% mutate(cancer=c("liver"),.before=strate)
#饮酒史为0
data_liver$alochol_drinking2<-ifelse(data_liver$alochol_drinking=="0",0,1)
result1_1<-c()
for (i in data_liver[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP,data=data_liver,subset = (alochol_drinking2=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#饮酒史为1
result1_2<-c()
for (i in data_liver[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP,data=data_liver,subset = (alochol_drinking2=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_liver[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP+i*alochol_drinking2,data=data_liver)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_alcohol<-cbind(result1,new_result1_3)
result_alcohol<-result_alcohol%>% mutate(strate=c("noalcohol_MED","yes_MED","noalcohol_MIND","yes_MIND"),.before=OR)
result_alcohol<-result_alcohol%>% mutate(cancer=c("liver"),.before=strate)
#BMI为非肥胖
data_liver$BMIgroup<-ifelse(data_liver$BMI<=25,0,1)
result1_1<-c()
for (i in data_liver[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP,data=data_liver,subset = (BMIgroup=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#肥胖
result1_2<-c()
for (i in data_liver[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP,data=data_liver,subset = (BMIgroup=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_liver[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP+i*BMIgroup,data=data_liver)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_BMI<-cbind(result1,new_result1_3)
result_BMI<-result_BMI%>% mutate(strate=c("nofat_MED","yes_MED","nofat_MIND","yes_MIND"),.before=OR)
result_BMI<-result_BMI%>% mutate(cancer=c("liver"),.before=strate)
#合并
result_liver<-rbind(result_sex,result_education,result_family,result_smoking,result_alcohol,result_BMI)

####gallbladder####
data_gallbladder<-subset(UKBdata2,various_cancer=="gallbladder"|various_cancer==0)
#female
result1_1<-c()
for (i in data_gallbladder[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_gallbladder,subset = (sex=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#性别为male
result1_2<-c()
for (i in data_gallbladder[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_gallbladder,subset = (sex=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_gallbladder[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*sex,data=data_gallbladder)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_sex<-cbind(result1,new_result1_3)
result_sex<-result_sex%>% mutate(strate=c("female_MED","male_MED","Female_MIND","male_MIND"),.before=OR)
result_sex<-result_sex%>% mutate(cancer=c("gallbladder"),.before=strate)
#无完成全职教育
result1_1<-c()
for (i in data_gallbladder[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_gallbladder,subset = (education=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#有完成全职教育
result1_2<-c()
for (i in data_gallbladder[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_gallbladder,subset = (education=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_gallbladder[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*education,data=data_gallbladder)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_education<-cbind(result1,new_result1_3)
result_education<-result_education%>% mutate(strate=c("noeducaiton_MED","educaiton_MED","noeducaiton_MIND","educaiton_MIND"),.before=OR)
result_education<-result_education%>% mutate(cancer=c("gallbladder"),.before=strate)
#家族史为0
result1_1<-c()
for (i in data_gallbladder[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_gallbladder,subset = (famaliy_history=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#家族史为1
result1_2<-c()
for (i in data_gallbladder[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_gallbladder,subset = (famaliy_history=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_gallbladder[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*famaliy_history,data=data_gallbladder)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_family<-cbind(result1,new_result1_3)
result_family<-result_family%>% mutate(strate=c("nofamily_MED","family_MED","nofamily_MIND","family_MIND"),.before=OR)
result_family<-result_family%>% mutate(cancer=c("gallbladder"),.before=strate)
#吸烟史0
data_gallbladder$smoking_status2<-ifelse(data_gallbladder$smoking_status=="0",0,1)
result1_1<-c()
for (i in data_gallbladder[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_gallbladder,subset = (smoking_status2=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#吸烟史为1
result1_2<-c()
for (i in data_gallbladder[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_gallbladder,subset = (smoking_status2=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_gallbladder[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*smoking_status2,data=data_gallbladder)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_smoking<-cbind(result1,new_result1_3)
result_smoking<-result_smoking%>% mutate(strate=c("nosmoking_MED","yes_MED","nosmoking_MIND","yes_MIND"),.before=OR)
result_smoking<-result_smoking%>% mutate(cancer=c("gallbladder"),.before=strate)
#饮酒史为0
data_gallbladder$alochol_drinking2<-ifelse(data_gallbladder$alochol_drinking=="0",0,1)
result1_1<-c()
for (i in data_gallbladder[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP,data=data_gallbladder,subset = (alochol_drinking2=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#饮酒史为1
result1_2<-c()
for (i in data_gallbladder[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP,data=data_gallbladder,subset = (alochol_drinking2=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_gallbladder[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP+i*alochol_drinking2,data=data_gallbladder)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_alcohol<-cbind(result1,new_result1_3)
result_alcohol<-result_alcohol%>% mutate(strate=c("noalcohol_MED","yes_MED","noalcohol_MIND","yes_MIND"),.before=OR)
result_alcohol<-result_alcohol%>% mutate(cancer=c("gallbladder"),.before=strate)
#BMI为非肥胖
data_gallbladder$BMIgroup<-ifelse(data_gallbladder$BMI<=25,0,1)
result1_1<-c()
for (i in data_gallbladder[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP,data=data_gallbladder,subset = (BMIgroup=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#肥胖
result1_2<-c()
for (i in data_gallbladder[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP,data=data_gallbladder,subset = (BMIgroup=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_gallbladder[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP+i*BMIgroup,data=data_gallbladder)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_BMI<-cbind(result1,new_result1_3)
result_BMI<-result_BMI%>% mutate(strate=c("nofat_MED","yes_MED","nofat_MIND","yes_MIND"),.before=OR)
result_BMI<-result_BMI%>% mutate(cancer=c("gallbladder"),.before=strate)
#合并
result_gallbladder<-rbind(result_sex,result_education,result_family,result_smoking,result_alcohol,result_BMI)


####pancreas####
data_pancreas<-subset(UKBdata2,various_cancer=="pancreas"|various_cancer==0)
#female
result1_1<-c()
for (i in data_pancreas[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_pancreas,subset = (sex=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#性别为male
result1_2<-c()
for (i in data_pancreas[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_pancreas,subset = (sex=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_pancreas[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*sex,data=data_pancreas)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_sex<-cbind(result1,new_result1_3)
result_sex<-result_sex%>% mutate(strate=c("female_MED","male_MED","Female_MIND","male_MIND"),.before=OR)
result_sex<-result_sex%>% mutate(cancer=c("pancreas"),.before=strate)
#无完成全职教育
result1_1<-c()
for (i in data_pancreas[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_pancreas,subset = (education=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#有完成全职教育
result1_2<-c()
for (i in data_pancreas[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_pancreas,subset = (education=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_pancreas[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*education,data=data_pancreas)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_education<-cbind(result1,new_result1_3)
result_education<-result_education%>% mutate(strate=c("noeducaiton_MED","educaiton_MED","noeducaiton_MIND","educaiton_MIND"),.before=OR)
result_education<-result_education%>% mutate(cancer=c("pancreas"),.before=strate)
#家族史为0
result1_1<-c()
for (i in data_pancreas[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_pancreas,subset = (famaliy_history=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#家族史为1
result1_2<-c()
for (i in data_pancreas[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_pancreas,subset = (famaliy_history=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_pancreas[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*famaliy_history,data=data_pancreas)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_family<-cbind(result1,new_result1_3)
result_family<-result_family%>% mutate(strate=c("nofamily_MED","family_MED","nofamily_MIND","family_MIND"),.before=OR)
result_family<-result_family%>% mutate(cancer=c("pancreas"),.before=strate)
#吸烟史0
data_pancreas$smoking_status2<-ifelse(data_pancreas$smoking_status=="0",0,1)
result1_1<-c()
for (i in data_pancreas[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_pancreas,subset = (smoking_status2=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#吸烟史为1
result1_2<-c()
for (i in data_pancreas[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_pancreas,subset = (smoking_status2=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_pancreas[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*smoking_status2,data=data_pancreas)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_smoking<-cbind(result1,new_result1_3)
result_smoking<-result_smoking%>% mutate(strate=c("nosmoking_MED","yes_MED","nosmoking_MIND","yes_MIND"),.before=OR)
result_smoking<-result_smoking%>% mutate(cancer=c("pancreas"),.before=strate)
#饮酒史为0
data_pancreas$alochol_drinking2<-ifelse(data_pancreas$alochol_drinking=="0",0,1)
result1_1<-c()
for (i in data_pancreas[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP,data=data_pancreas,subset = (alochol_drinking2=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#饮酒史为1
result1_2<-c()
for (i in data_pancreas[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP,data=data_pancreas,subset = (alochol_drinking2=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_pancreas[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP+i*alochol_drinking2,data=data_pancreas)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_alcohol<-cbind(result1,new_result1_3)
result_alcohol<-result_alcohol%>% mutate(strate=c("noalcohol_MED","yes_MED","noalcohol_MIND","yes_MIND"),.before=OR)
result_alcohol<-result_alcohol%>% mutate(cancer=c("pancreas"),.before=strate)
#BMI为非肥胖
data_pancreas$BMIgroup<-ifelse(data_pancreas$BMI<=25,0,1)
result1_1<-c()
for (i in data_pancreas[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP,data=data_pancreas,subset = (BMIgroup=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#肥胖
result1_2<-c()
for (i in data_pancreas[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP,data=data_pancreas,subset = (BMIgroup=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_pancreas[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP+i*BMIgroup,data=data_pancreas)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_BMI<-cbind(result1,new_result1_3)
result_BMI<-result_BMI%>% mutate(strate=c("nofat_MED","yes_MED","nofat_MIND","yes_MIND"),.before=OR)
result_BMI<-result_BMI%>% mutate(cancer=c("pancreas"),.before=strate)
#合并
result_pancreas<-rbind(result_sex,result_education,result_family,result_smoking,result_alcohol,result_BMI)


####lung####
data_lung<-subset(UKBdata2,various_cancer=="lung"|various_cancer==0)
#female
result1_1<-c()
for (i in data_lung[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_lung,subset = (sex=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#性别为male
result1_2<-c()
for (i in data_lung[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_lung,subset = (sex=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_lung[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*sex,data=data_lung)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_sex<-cbind(result1,new_result1_3)
result_sex<-result_sex%>% mutate(strate=c("female_MED","male_MED","Female_MIND","male_MIND"),.before=OR)
result_sex<-result_sex%>% mutate(cancer=c("lung"),.before=strate)
#无完成全职教育
result1_1<-c()
for (i in data_lung[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_lung,subset = (education=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#有完成全职教育
result1_2<-c()
for (i in data_lung[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_lung,subset = (education=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_lung[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*education,data=data_lung)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_education<-cbind(result1,new_result1_3)
result_education<-result_education%>% mutate(strate=c("noeducaiton_MED","educaiton_MED","noeducaiton_MIND","educaiton_MIND"),.before=OR)
result_education<-result_education%>% mutate(cancer=c("lung"),.before=strate)
#家族史为0
result1_1<-c()
for (i in data_lung[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_lung,subset = (famaliy_history=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#家族史为1
result1_2<-c()
for (i in data_lung[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_lung,subset = (famaliy_history=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_lung[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*famaliy_history,data=data_lung)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_family<-cbind(result1,new_result1_3)
result_family<-result_family%>% mutate(strate=c("nofamily_MED","family_MED","nofamily_MIND","family_MIND"),.before=OR)
result_family<-result_family%>% mutate(cancer=c("lung"),.before=strate)
#吸烟史0
data_lung$smoking_status2<-ifelse(data_lung$smoking_status=="0",0,1)
result1_1<-c()
for (i in data_lung[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_lung,subset = (smoking_status2=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#吸烟史为1
result1_2<-c()
for (i in data_lung[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_lung,subset = (smoking_status2=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_lung[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*smoking_status2,data=data_lung)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_smoking<-cbind(result1,new_result1_3)
result_smoking<-result_smoking%>% mutate(strate=c("nosmoking_MED","yes_MED","nosmoking_MIND","yes_MIND"),.before=OR)
result_smoking<-result_smoking%>% mutate(cancer=c("lung"),.before=strate)
#饮酒史为0
data_lung$alochol_drinking2<-ifelse(data_lung$alochol_drinking=="0",0,1)
result1_1<-c()
for (i in data_lung[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP,data=data_lung,subset = (alochol_drinking2=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#饮酒史为1
result1_2<-c()
for (i in data_lung[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP,data=data_lung,subset = (alochol_drinking2=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_lung[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP+i*alochol_drinking2,data=data_lung)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_alcohol<-cbind(result1,new_result1_3)
result_alcohol<-result_alcohol%>% mutate(strate=c("noalcohol_MED","yes_MED","noalcohol_MIND","yes_MIND"),.before=OR)
result_alcohol<-result_alcohol%>% mutate(cancer=c("lung"),.before=strate)
#BMI为非肥胖
data_lung$BMIgroup<-ifelse(data_lung$BMI<=25,0,1)
result1_1<-c()
for (i in data_lung[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP,data=data_lung,subset = (BMIgroup=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#肥胖
result1_2<-c()
for (i in data_lung[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP,data=data_lung,subset = (BMIgroup=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_lung[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP+i*BMIgroup,data=data_lung)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_BMI<-cbind(result1,new_result1_3)
result_BMI<-result_BMI%>% mutate(strate=c("nofat_MED","yes_MED","nofat_MIND","yes_MIND"),.before=OR)
result_BMI<-result_BMI%>% mutate(cancer=c("lung"),.before=strate)
#合并
result_lung<-rbind(result_sex,result_education,result_family,result_smoking,result_alcohol,result_BMI)

####malignant_melanoma####
data_malignant_melanoma<-subset(UKBdata2,various_cancer=="malignant_melanoma"|various_cancer==0)
#female
result1_1<-c()
for (i in data_malignant_melanoma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_malignant_melanoma,subset = (sex=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#性别为male
result1_2<-c()
for (i in data_malignant_melanoma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_malignant_melanoma,subset = (sex=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_malignant_melanoma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*sex,data=data_malignant_melanoma)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_sex<-cbind(result1,new_result1_3)
result_sex<-result_sex%>% mutate(strate=c("female_MED","male_MED","Female_MIND","male_MIND"),.before=OR)
result_sex<-result_sex%>% mutate(cancer=c("malignant_melanoma"),.before=strate)
#无完成全职教育
result1_1<-c()
for (i in data_malignant_melanoma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_malignant_melanoma,subset = (education=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#有完成全职教育
result1_2<-c()
for (i in data_malignant_melanoma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_malignant_melanoma,subset = (education=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_malignant_melanoma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*education,data=data_malignant_melanoma)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_education<-cbind(result1,new_result1_3)
result_education<-result_education%>% mutate(strate=c("noeducaiton_MED","educaiton_MED","noeducaiton_MIND","educaiton_MIND"),.before=OR)
result_education<-result_education%>% mutate(cancer=c("malignant_melanoma"),.before=strate)
#家族史为0
result1_1<-c()
for (i in data_malignant_melanoma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_malignant_melanoma,subset = (famaliy_history=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#家族史为1
result1_2<-c()
for (i in data_malignant_melanoma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_malignant_melanoma,subset = (famaliy_history=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_malignant_melanoma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*famaliy_history,data=data_malignant_melanoma)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_family<-cbind(result1,new_result1_3)
result_family<-result_family%>% mutate(strate=c("nofamily_MED","family_MED","nofamily_MIND","family_MIND"),.before=OR)
result_family<-result_family%>% mutate(cancer=c("malignant_melanoma"),.before=strate)
#吸烟史0
data_malignant_melanoma$smoking_status2<-ifelse(data_malignant_melanoma$smoking_status=="0",0,1)
result1_1<-c()
for (i in data_malignant_melanoma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_malignant_melanoma,subset = (smoking_status2=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#吸烟史为1
result1_2<-c()
for (i in data_malignant_melanoma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_malignant_melanoma,subset = (smoking_status2=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_malignant_melanoma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*smoking_status2,data=data_malignant_melanoma)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_smoking<-cbind(result1,new_result1_3)
result_smoking<-result_smoking%>% mutate(strate=c("nosmoking_MED","yes_MED","nosmoking_MIND","yes_MIND"),.before=OR)
result_smoking<-result_smoking%>% mutate(cancer=c("malignant_melanoma"),.before=strate)
#饮酒史为0
data_malignant_melanoma$alochol_drinking2<-ifelse(data_malignant_melanoma$alochol_drinking=="0",0,1)
result1_1<-c()
for (i in data_malignant_melanoma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP,data=data_malignant_melanoma,subset = (alochol_drinking2=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#饮酒史为1
result1_2<-c()
for (i in data_malignant_melanoma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP,data=data_malignant_melanoma,subset = (alochol_drinking2=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_malignant_melanoma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP+i*alochol_drinking2,data=data_malignant_melanoma)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_alcohol<-cbind(result1,new_result1_3)
result_alcohol<-result_alcohol%>% mutate(strate=c("noalcohol_MED","yes_MED","noalcohol_MIND","yes_MIND"),.before=OR)
result_alcohol<-result_alcohol%>% mutate(cancer=c("malignant_melanoma"),.before=strate)
#BMI为非肥胖
data_malignant_melanoma$BMIgroup<-ifelse(data_malignant_melanoma$BMI<=25,0,1)
result1_1<-c()
for (i in data_malignant_melanoma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP,data=data_malignant_melanoma,subset = (BMIgroup=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#肥胖
result1_2<-c()
for (i in data_malignant_melanoma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP,data=data_malignant_melanoma,subset = (BMIgroup=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_malignant_melanoma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP+i*BMIgroup,data=data_malignant_melanoma)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_BMI<-cbind(result1,new_result1_3)
result_BMI<-result_BMI%>% mutate(strate=c("nofat_MED","yes_MED","nofat_MIND","yes_MIND"),.before=OR)
result_BMI<-result_BMI%>% mutate(cancer=c("malignant_melanoma"),.before=strate)
#合并
result_malignant_melanoma<-rbind(result_sex,result_education,result_family,result_smoking,result_alcohol,result_BMI)

####breast####
data_breast<-subset(UKBdata2,various_cancer=="breast"|various_cancer==0)
#female
result1_1<-c()
for (i in data_breast[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_breast,subset = (sex=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#性别为male
result1_2<-c()
for (i in data_breast[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_breast,subset = (sex=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_breast[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*sex,data=data_breast)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_sex<-cbind(result1,new_result1_3)
result_sex<-result_sex%>% mutate(strate=c("female_MED","male_MED","Female_MIND","male_MIND"),.before=OR)
result_sex<-result_sex%>% mutate(cancer=c("breast"),.before=strate)
#无完成全职教育
result1_1<-c()
for (i in data_breast[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_breast,subset = (education=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#有完成全职教育
result1_2<-c()
for (i in data_breast[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_breast,subset = (education=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_breast[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*education,data=data_breast)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_education<-cbind(result1,new_result1_3)
result_education<-result_education%>% mutate(strate=c("noeducaiton_MED","educaiton_MED","noeducaiton_MIND","educaiton_MIND"),.before=OR)
result_education<-result_education%>% mutate(cancer=c("breast"),.before=strate)
#家族史为0
result1_1<-c()
for (i in data_breast[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_breast,subset = (famaliy_history=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#家族史为1
result1_2<-c()
for (i in data_breast[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_breast,subset = (famaliy_history=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_breast[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*famaliy_history,data=data_breast)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_family<-cbind(result1,new_result1_3)
result_family<-result_family%>% mutate(strate=c("nofamily_MED","family_MED","nofamily_MIND","family_MIND"),.before=OR)
result_family<-result_family%>% mutate(cancer=c("breast"),.before=strate)
#吸烟史0
data_breast$smoking_status2<-ifelse(data_breast$smoking_status=="0",0,1)
result1_1<-c()
for (i in data_breast[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_breast,subset = (smoking_status2=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#吸烟史为1
result1_2<-c()
for (i in data_breast[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_breast,subset = (smoking_status2=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_breast[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*smoking_status2,data=data_breast)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_smoking<-cbind(result1,new_result1_3)
result_smoking<-result_smoking%>% mutate(strate=c("nosmoking_MED","yes_MED","nosmoking_MIND","yes_MIND"),.before=OR)
result_smoking<-result_smoking%>% mutate(cancer=c("breast"),.before=strate)
#饮酒史为0
data_breast$alochol_drinking2<-ifelse(data_breast$alochol_drinking=="0",0,1)
result1_1<-c()
for (i in data_breast[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP,data=data_breast,subset = (alochol_drinking2=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#饮酒史为1
result1_2<-c()
for (i in data_breast[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP,data=data_breast,subset = (alochol_drinking2=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_breast[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP+i*alochol_drinking2,data=data_breast)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_alcohol<-cbind(result1,new_result1_3)
result_alcohol<-result_alcohol%>% mutate(strate=c("noalcohol_MED","yes_MED","noalcohol_MIND","yes_MIND"),.before=OR)
result_alcohol<-result_alcohol%>% mutate(cancer=c("breast"),.before=strate)
#BMI为非肥胖
data_breast$BMIgroup<-ifelse(data_breast$BMI<=25,0,1)
result1_1<-c()
for (i in data_breast[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP,data=data_breast,subset = (BMIgroup=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#肥胖
result1_2<-c()
for (i in data_breast[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP,data=data_breast,subset = (BMIgroup=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_breast[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP+i*BMIgroup,data=data_breast)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_BMI<-cbind(result1,new_result1_3)
result_BMI<-result_BMI%>% mutate(strate=c("nofat_MED","yes_MED","nofat_MIND","yes_MIND"),.before=OR)
result_BMI<-result_BMI%>% mutate(cancer=c("breast"),.before=strate)
#合并
result_breast<-rbind(result_sex,result_education,result_family,result_smoking,result_alcohol,result_BMI)


####uterus_cervix####
data_uterus_cervix<-subset(UKBdata2,various_cancer=="uterus_cervix"|various_cancer==0)
#female
result1_1<-c()
for (i in data_uterus_cervix[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_uterus_cervix,subset = (sex=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#性别为male
result1_2<-c()
for (i in data_uterus_cervix[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_uterus_cervix,subset = (sex=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_uterus_cervix[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*sex,data=data_uterus_cervix)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_sex<-cbind(result1,new_result1_3)
result_sex<-result_sex%>% mutate(strate=c("female_MED","male_MED","Female_MIND","male_MIND"),.before=OR)
result_sex<-result_sex%>% mutate(cancer=c("uterus_cervix"),.before=strate)
#无完成全职教育
result1_1<-c()
for (i in data_uterus_cervix[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_uterus_cervix,subset = (education=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#有完成全职教育
result1_2<-c()
for (i in data_uterus_cervix[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_uterus_cervix,subset = (education=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_uterus_cervix[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*education,data=data_uterus_cervix)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_education<-cbind(result1,new_result1_3)
result_education<-result_education%>% mutate(strate=c("noeducaiton_MED","educaiton_MED","noeducaiton_MIND","educaiton_MIND"),.before=OR)
result_education<-result_education%>% mutate(cancer=c("uterus_cervix"),.before=strate)
#家族史为0
result1_1<-c()
for (i in data_uterus_cervix[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_uterus_cervix,subset = (famaliy_history=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#家族史为1
result1_2<-c()
for (i in data_uterus_cervix[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_uterus_cervix,subset = (famaliy_history=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_uterus_cervix[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*famaliy_history,data=data_uterus_cervix)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_family<-cbind(result1,new_result1_3)
result_family<-result_family%>% mutate(strate=c("nofamily_MED","family_MED","nofamily_MIND","family_MIND"),.before=OR)
result_family<-result_family%>% mutate(cancer=c("uterus_cervix"),.before=strate)
#吸烟史0
data_uterus_cervix$smoking_status2<-ifelse(data_uterus_cervix$smoking_status=="0",0,1)
result1_1<-c()
for (i in data_uterus_cervix[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_uterus_cervix,subset = (smoking_status2=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#吸烟史为1
result1_2<-c()
for (i in data_uterus_cervix[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_uterus_cervix,subset = (smoking_status2=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_uterus_cervix[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*smoking_status2,data=data_uterus_cervix)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_smoking<-cbind(result1,new_result1_3)
result_smoking<-result_smoking%>% mutate(strate=c("nosmoking_MED","yes_MED","nosmoking_MIND","yes_MIND"),.before=OR)
result_smoking<-result_smoking%>% mutate(cancer=c("uterus_cervix"),.before=strate)
#饮酒史为0
data_uterus_cervix$alochol_drinking2<-ifelse(data_uterus_cervix$alochol_drinking=="0",0,1)
result1_1<-c()
for (i in data_uterus_cervix[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP,data=data_uterus_cervix,subset = (alochol_drinking2=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#饮酒史为1
result1_2<-c()
for (i in data_uterus_cervix[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP,data=data_uterus_cervix,subset = (alochol_drinking2=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_uterus_cervix[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP+i*alochol_drinking2,data=data_uterus_cervix)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_alcohol<-cbind(result1,new_result1_3)
result_alcohol<-result_alcohol%>% mutate(strate=c("noalcohol_MED","yes_MED","noalcohol_MIND","yes_MIND"),.before=OR)
result_alcohol<-result_alcohol%>% mutate(cancer=c("uterus_cervix"),.before=strate)
#BMI为非肥胖
data_uterus_cervix$BMIgroup<-ifelse(data_uterus_cervix$BMI<=25,0,1)
result1_1<-c()
for (i in data_uterus_cervix[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP,data=data_uterus_cervix,subset = (BMIgroup=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#肥胖
result1_2<-c()
for (i in data_uterus_cervix[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP,data=data_uterus_cervix,subset = (BMIgroup=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_uterus_cervix[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP+i*BMIgroup,data=data_uterus_cervix)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_BMI<-cbind(result1,new_result1_3)
result_BMI<-result_BMI%>% mutate(strate=c("nofat_MED","yes_MED","nofat_MIND","yes_MIND"),.before=OR)
result_BMI<-result_BMI%>% mutate(cancer=c("uterus_cervix"),.before=strate)
#合并
result_uterus_cervix<-rbind(result_sex,result_education,result_family,result_smoking,result_alcohol,result_BMI)

####ovary####
data_ovary<-subset(UKBdata2,various_cancer=="ovary"|various_cancer==0)
#female
result1_1<-c()
for (i in data_ovary[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_ovary,subset = (sex=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#性别为male
result1_2<-c()
for (i in data_ovary[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_ovary,subset = (sex=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_ovary[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*sex,data=data_ovary)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_sex<-cbind(result1,new_result1_3)
result_sex<-result_sex%>% mutate(strate=c("female_MED","male_MED","Female_MIND","male_MIND"),.before=OR)
result_sex<-result_sex%>% mutate(cancer=c("ovary"),.before=strate)
#无完成全职教育
result1_1<-c()
for (i in data_ovary[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_ovary,subset = (education=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#有完成全职教育
result1_2<-c()
for (i in data_ovary[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_ovary,subset = (education=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_ovary[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*education,data=data_ovary)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_education<-cbind(result1,new_result1_3)
result_education<-result_education%>% mutate(strate=c("noeducaiton_MED","educaiton_MED","noeducaiton_MIND","educaiton_MIND"),.before=OR)
result_education<-result_education%>% mutate(cancer=c("ovary"),.before=strate)
#家族史为0
result1_1<-c()
for (i in data_ovary[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_ovary,subset = (famaliy_history=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#家族史为1
result1_2<-c()
for (i in data_ovary[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_ovary,subset = (famaliy_history=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_ovary[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*famaliy_history,data=data_ovary)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_family<-cbind(result1,new_result1_3)
result_family<-result_family%>% mutate(strate=c("nofamily_MED","family_MED","nofamily_MIND","family_MIND"),.before=OR)
result_family<-result_family%>% mutate(cancer=c("ovary"),.before=strate)
#吸烟史0
data_ovary$smoking_status2<-ifelse(data_ovary$smoking_status=="0",0,1)
result1_1<-c()
for (i in data_ovary[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_ovary,subset = (smoking_status2=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#吸烟史为1
result1_2<-c()
for (i in data_ovary[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_ovary,subset = (smoking_status2=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_ovary[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*smoking_status2,data=data_ovary)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_smoking<-cbind(result1,new_result1_3)
result_smoking<-result_smoking%>% mutate(strate=c("nosmoking_MED","yes_MED","nosmoking_MIND","yes_MIND"),.before=OR)
result_smoking<-result_smoking%>% mutate(cancer=c("ovary"),.before=strate)
#饮酒史为0
data_ovary$alochol_drinking2<-ifelse(data_ovary$alochol_drinking=="0",0,1)
result1_1<-c()
for (i in data_ovary[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP,data=data_ovary,subset = (alochol_drinking2=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#饮酒史为1
result1_2<-c()
for (i in data_ovary[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP,data=data_ovary,subset = (alochol_drinking2=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_ovary[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP+i*alochol_drinking2,data=data_ovary)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_alcohol<-cbind(result1,new_result1_3)
result_alcohol<-result_alcohol%>% mutate(strate=c("noalcohol_MED","yes_MED","noalcohol_MIND","yes_MIND"),.before=OR)
result_alcohol<-result_alcohol%>% mutate(cancer=c("ovary"),.before=strate)
#BMI为非肥胖
data_ovary$BMIgroup<-ifelse(data_ovary$BMI<=25,0,1)
result1_1<-c()
for (i in data_ovary[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP,data=data_ovary,subset = (BMIgroup=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#肥胖
result1_2<-c()
for (i in data_ovary[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP,data=data_ovary,subset = (BMIgroup=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_ovary[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP+i*BMIgroup,data=data_ovary)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_BMI<-cbind(result1,new_result1_3)
result_BMI<-result_BMI%>% mutate(strate=c("nofat_MED","yes_MED","nofat_MIND","yes_MIND"),.before=OR)
result_BMI<-result_BMI%>% mutate(cancer=c("ovary"),.before=strate)
#合并
result_ovary<-rbind(result_sex,result_education,result_family,result_smoking,result_alcohol,result_BMI)


####prostate####
data_prostate<-subset(UKBdata2,various_cancer=="prostate"|various_cancer==0)
#female
result1_1<-c()
for (i in data_prostate[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_prostate,subset = (sex=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#性别为male
result1_2<-c()
for (i in data_prostate[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_prostate,subset = (sex=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_prostate[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*sex,data=data_prostate)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_sex<-cbind(result1,new_result1_3)
result_sex<-result_sex%>% mutate(strate=c("female_MED","male_MED","Female_MIND","male_MIND"),.before=OR)
result_sex<-result_sex%>% mutate(cancer=c("prostate"),.before=strate)
#无完成全职教育
result1_1<-c()
for (i in data_prostate[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_prostate,subset = (education=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#有完成全职教育
result1_2<-c()
for (i in data_prostate[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_prostate,subset = (education=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_prostate[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*education,data=data_prostate)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_education<-cbind(result1,new_result1_3)
result_education<-result_education%>% mutate(strate=c("noeducaiton_MED","educaiton_MED","noeducaiton_MIND","educaiton_MIND"),.before=OR)
result_education<-result_education%>% mutate(cancer=c("prostate"),.before=strate)
#家族史为0
result1_1<-c()
for (i in data_prostate[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_prostate,subset = (famaliy_history=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#家族史为1
result1_2<-c()
for (i in data_prostate[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_prostate,subset = (famaliy_history=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_prostate[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*famaliy_history,data=data_prostate)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_family<-cbind(result1,new_result1_3)
result_family<-result_family%>% mutate(strate=c("nofamily_MED","family_MED","nofamily_MIND","family_MIND"),.before=OR)
result_family<-result_family%>% mutate(cancer=c("prostate"),.before=strate)
#吸烟史0
data_prostate$smoking_status2<-ifelse(data_prostate$smoking_status=="0",0,1)
result1_1<-c()
for (i in data_prostate[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_prostate,subset = (smoking_status2=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#吸烟史为1
result1_2<-c()
for (i in data_prostate[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_prostate,subset = (smoking_status2=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_prostate[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*smoking_status2,data=data_prostate)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_smoking<-cbind(result1,new_result1_3)
result_smoking<-result_smoking%>% mutate(strate=c("nosmoking_MED","yes_MED","nosmoking_MIND","yes_MIND"),.before=OR)
result_smoking<-result_smoking%>% mutate(cancer=c("prostate"),.before=strate)
#饮酒史为0
data_prostate$alochol_drinking2<-ifelse(data_prostate$alochol_drinking=="0",0,1)
result1_1<-c()
for (i in data_prostate[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP,data=data_prostate,subset = (alochol_drinking2=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#饮酒史为1
result1_2<-c()
for (i in data_prostate[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP,data=data_prostate,subset = (alochol_drinking2=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_prostate[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP+i*alochol_drinking2,data=data_prostate)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_alcohol<-cbind(result1,new_result1_3)
result_alcohol<-result_alcohol%>% mutate(strate=c("noalcohol_MED","yes_MED","noalcohol_MIND","yes_MIND"),.before=OR)
result_alcohol<-result_alcohol%>% mutate(cancer=c("prostate"),.before=strate)
#BMI为非肥胖
data_prostate$BMIgroup<-ifelse(data_prostate$BMI<=25,0,1)
result1_1<-c()
for (i in data_prostate[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP,data=data_prostate,subset = (BMIgroup=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#肥胖
result1_2<-c()
for (i in data_prostate[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP,data=data_prostate,subset = (BMIgroup=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_prostate[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP+i*BMIgroup,data=data_prostate)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_BMI<-cbind(result1,new_result1_3)
result_BMI<-result_BMI%>% mutate(strate=c("nofat_MED","yes_MED","nofat_MIND","yes_MIND"),.before=OR)
result_BMI<-result_BMI%>% mutate(cancer=c("prostate"),.before=strate)
#合并
result_prostate<-rbind(result_sex,result_education,result_family,result_smoking,result_alcohol,result_BMI)

####testic####
data_testic<-subset(UKBdata2,various_cancer=="testic"|various_cancer==0)
#female
result1_1<-c()
for (i in data_testic[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_testic,subset = (sex=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#性别为male
result1_2<-c()
for (i in data_testic[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_testic,subset = (sex=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_testic[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*sex,data=data_testic)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_sex<-cbind(result1,new_result1_3)
result_sex<-result_sex%>% mutate(strate=c("female_MED","male_MED","Female_MIND","male_MIND"),.before=OR)
result_sex<-result_sex%>% mutate(cancer=c("testic"),.before=strate)
#无完成全职教育
result1_1<-c()
for (i in data_testic[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_testic,subset = (education=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#有完成全职教育
result1_2<-c()
for (i in data_testic[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_testic,subset = (education=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_testic[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*education,data=data_testic)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_education<-cbind(result1,new_result1_3)
result_education<-result_education%>% mutate(strate=c("noeducaiton_MED","educaiton_MED","noeducaiton_MIND","educaiton_MIND"),.before=OR)
result_education<-result_education%>% mutate(cancer=c("testic"),.before=strate)
#家族史为0
result1_1<-c()
for (i in data_testic[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_testic,subset = (famaliy_history=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#家族史为1
result1_2<-c()
for (i in data_testic[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_testic,subset = (famaliy_history=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_testic[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*famaliy_history,data=data_testic)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_family<-cbind(result1,new_result1_3)
result_family<-result_family%>% mutate(strate=c("nofamily_MED","family_MED","nofamily_MIND","family_MIND"),.before=OR)
result_family<-result_family%>% mutate(cancer=c("testic"),.before=strate)
#吸烟史0
data_testic$smoking_status2<-ifelse(data_testic$smoking_status=="0",0,1)
result1_1<-c()
for (i in data_testic[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_testic,subset = (smoking_status2=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#吸烟史为1
result1_2<-c()
for (i in data_testic[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_testic,subset = (smoking_status2=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_testic[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*smoking_status2,data=data_testic)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_smoking<-cbind(result1,new_result1_3)
result_smoking<-result_smoking%>% mutate(strate=c("nosmoking_MED","yes_MED","nosmoking_MIND","yes_MIND"),.before=OR)
result_smoking<-result_smoking%>% mutate(cancer=c("testic"),.before=strate)
#饮酒史为0
data_testic$alochol_drinking2<-ifelse(data_testic$alochol_drinking=="0",0,1)
result1_1<-c()
for (i in data_testic[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP,data=data_testic,subset = (alochol_drinking2=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#饮酒史为1
result1_2<-c()
for (i in data_testic[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP,data=data_testic,subset = (alochol_drinking2=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_testic[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP+i*alochol_drinking2,data=data_testic)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_alcohol<-cbind(result1,new_result1_3)
result_alcohol<-result_alcohol%>% mutate(strate=c("noalcohol_MED","yes_MED","noalcohol_MIND","yes_MIND"),.before=OR)
result_alcohol<-result_alcohol%>% mutate(cancer=c("testic"),.before=strate)
#BMI为非肥胖
data_testic$BMIgroup<-ifelse(data_testic$BMI<=25,0,1)
result1_1<-c()
for (i in data_testic[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP,data=data_testic,subset = (BMIgroup=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#肥胖
result1_2<-c()
for (i in data_testic[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP,data=data_testic,subset = (BMIgroup=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_testic[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP+i*BMIgroup,data=data_testic)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_BMI<-cbind(result1,new_result1_3)
result_BMI<-result_BMI%>% mutate(strate=c("nofat_MED","yes_MED","nofat_MIND","yes_MIND"),.before=OR)
result_BMI<-result_BMI%>% mutate(cancer=c("testic"),.before=strate)
#合并
result_testic<-rbind(result_sex,result_education,result_family,result_smoking,result_alcohol,result_BMI)


####kidney####
data_kidney<-subset(UKBdata2,various_cancer=="kidney"|various_cancer==0)
#female
result1_1<-c()
for (i in data_kidney[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_kidney,subset = (sex=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#性别为male
result1_2<-c()
for (i in data_kidney[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_kidney,subset = (sex=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_kidney[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*sex,data=data_kidney)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_sex<-cbind(result1,new_result1_3)
result_sex<-result_sex%>% mutate(strate=c("female_MED","male_MED","Female_MIND","male_MIND"),.before=OR)
result_sex<-result_sex%>% mutate(cancer=c("kidney"),.before=strate)
#无完成全职教育
result1_1<-c()
for (i in data_kidney[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_kidney,subset = (education=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#有完成全职教育
result1_2<-c()
for (i in data_kidney[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_kidney,subset = (education=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_kidney[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*education,data=data_kidney)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_education<-cbind(result1,new_result1_3)
result_education<-result_education%>% mutate(strate=c("noeducaiton_MED","educaiton_MED","noeducaiton_MIND","educaiton_MIND"),.before=OR)
result_education<-result_education%>% mutate(cancer=c("kidney"),.before=strate)
#家族史为0
result1_1<-c()
for (i in data_kidney[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_kidney,subset = (famaliy_history=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#家族史为1
result1_2<-c()
for (i in data_kidney[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_kidney,subset = (famaliy_history=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_kidney[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*famaliy_history,data=data_kidney)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_family<-cbind(result1,new_result1_3)
result_family<-result_family%>% mutate(strate=c("nofamily_MED","family_MED","nofamily_MIND","family_MIND"),.before=OR)
result_family<-result_family%>% mutate(cancer=c("kidney"),.before=strate)
#吸烟史0
data_kidney$smoking_status2<-ifelse(data_kidney$smoking_status=="0",0,1)
result1_1<-c()
for (i in data_kidney[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_kidney,subset = (smoking_status2=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#吸烟史为1
result1_2<-c()
for (i in data_kidney[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_kidney,subset = (smoking_status2=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_kidney[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*smoking_status2,data=data_kidney)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_smoking<-cbind(result1,new_result1_3)
result_smoking<-result_smoking%>% mutate(strate=c("nosmoking_MED","yes_MED","nosmoking_MIND","yes_MIND"),.before=OR)
result_smoking<-result_smoking%>% mutate(cancer=c("kidney"),.before=strate)
#饮酒史为0
data_kidney$alochol_drinking2<-ifelse(data_kidney$alochol_drinking=="0",0,1)
result1_1<-c()
for (i in data_kidney[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP,data=data_kidney,subset = (alochol_drinking2=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#饮酒史为1
result1_2<-c()
for (i in data_kidney[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP,data=data_kidney,subset = (alochol_drinking2=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_kidney[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP+i*alochol_drinking2,data=data_kidney)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_alcohol<-cbind(result1,new_result1_3)
result_alcohol<-result_alcohol%>% mutate(strate=c("noalcohol_MED","yes_MED","noalcohol_MIND","yes_MIND"),.before=OR)
result_alcohol<-result_alcohol%>% mutate(cancer=c("kidney"),.before=strate)
#BMI为非肥胖
data_kidney$BMIgroup<-ifelse(data_kidney$BMI<=25,0,1)
result1_1<-c()
for (i in data_kidney[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP,data=data_kidney,subset = (BMIgroup=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#肥胖
result1_2<-c()
for (i in data_kidney[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP,data=data_kidney,subset = (BMIgroup=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_kidney[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP+i*BMIgroup,data=data_kidney)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_BMI<-cbind(result1,new_result1_3)
result_BMI<-result_BMI%>% mutate(strate=c("nofat_MED","yes_MED","nofat_MIND","yes_MIND"),.before=OR)
result_BMI<-result_BMI%>% mutate(cancer=c("kidney"),.before=strate)
#合并
result_kidney<-rbind(result_sex,result_education,result_family,result_smoking,result_alcohol,result_BMI)


####bladder####
data_bladder<-subset(UKBdata2,various_cancer=="bladder"|various_cancer==0)
#female
result1_1<-c()
for (i in data_bladder[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_bladder,subset = (sex=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#性别为male
result1_2<-c()
for (i in data_bladder[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_bladder,subset = (sex=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_bladder[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*sex,data=data_bladder)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_sex<-cbind(result1,new_result1_3)
result_sex<-result_sex%>% mutate(strate=c("female_MED","male_MED","Female_MIND","male_MIND"),.before=OR)
result_sex<-result_sex%>% mutate(cancer=c("bladder"),.before=strate)
#无完成全职教育
result1_1<-c()
for (i in data_bladder[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_bladder,subset = (education=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#有完成全职教育
result1_2<-c()
for (i in data_bladder[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_bladder,subset = (education=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_bladder[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*education,data=data_bladder)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_education<-cbind(result1,new_result1_3)
result_education<-result_education%>% mutate(strate=c("noeducaiton_MED","educaiton_MED","noeducaiton_MIND","educaiton_MIND"),.before=OR)
result_education<-result_education%>% mutate(cancer=c("bladder"),.before=strate)
#家族史为0
result1_1<-c()
for (i in data_bladder[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_bladder,subset = (famaliy_history=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#家族史为1
result1_2<-c()
for (i in data_bladder[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_bladder,subset = (famaliy_history=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_bladder[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*famaliy_history,data=data_bladder)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_family<-cbind(result1,new_result1_3)
result_family<-result_family%>% mutate(strate=c("nofamily_MED","family_MED","nofamily_MIND","family_MIND"),.before=OR)
result_family<-result_family%>% mutate(cancer=c("bladder"),.before=strate)
#吸烟史0
data_bladder$smoking_status2<-ifelse(data_bladder$smoking_status=="0",0,1)
result1_1<-c()
for (i in data_bladder[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_bladder,subset = (smoking_status2=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#吸烟史为1
result1_2<-c()
for (i in data_bladder[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_bladder,subset = (smoking_status2=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_bladder[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*smoking_status2,data=data_bladder)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_smoking<-cbind(result1,new_result1_3)
result_smoking<-result_smoking%>% mutate(strate=c("nosmoking_MED","yes_MED","nosmoking_MIND","yes_MIND"),.before=OR)
result_smoking<-result_smoking%>% mutate(cancer=c("bladder"),.before=strate)
#饮酒史为0
data_bladder$alochol_drinking2<-ifelse(data_bladder$alochol_drinking=="0",0,1)
result1_1<-c()
for (i in data_bladder[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP,data=data_bladder,subset = (alochol_drinking2=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#饮酒史为1
result1_2<-c()
for (i in data_bladder[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP,data=data_bladder,subset = (alochol_drinking2=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_bladder[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP+i*alochol_drinking2,data=data_bladder)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_alcohol<-cbind(result1,new_result1_3)
result_alcohol<-result_alcohol%>% mutate(strate=c("noalcohol_MED","yes_MED","noalcohol_MIND","yes_MIND"),.before=OR)
result_alcohol<-result_alcohol%>% mutate(cancer=c("bladder"),.before=strate)
#BMI为非肥胖
data_bladder$BMIgroup<-ifelse(data_bladder$BMI<=25,0,1)
result1_1<-c()
for (i in data_bladder[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP,data=data_bladder,subset = (BMIgroup=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#肥胖
result1_2<-c()
for (i in data_bladder[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP,data=data_bladder,subset = (BMIgroup=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_bladder[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP+i*BMIgroup,data=data_bladder)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_BMI<-cbind(result1,new_result1_3)
result_BMI<-result_BMI%>% mutate(strate=c("nofat_MED","yes_MED","nofat_MIND","yes_MIND"),.before=OR)
result_BMI<-result_BMI%>% mutate(cancer=c("bladder"),.before=strate)
#合并
result_bladder<-rbind(result_sex,result_education,result_family,result_smoking,result_alcohol,result_BMI)

####brain####
data_brain<-subset(UKBdata2,various_cancer=="brain"|various_cancer==0)
#female
result1_1<-c()
for (i in data_brain[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_brain,subset = (sex=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#性别为male
result1_2<-c()
for (i in data_brain[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_brain,subset = (sex=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_brain[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*sex,data=data_brain)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_sex<-cbind(result1,new_result1_3)
result_sex<-result_sex%>% mutate(strate=c("female_MED","male_MED","Female_MIND","male_MIND"),.before=OR)
result_sex<-result_sex%>% mutate(cancer=c("brain"),.before=strate)
#无完成全职教育
result1_1<-c()
for (i in data_brain[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_brain,subset = (education=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#有完成全职教育
result1_2<-c()
for (i in data_brain[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_brain,subset = (education=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_brain[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*education,data=data_brain)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_education<-cbind(result1,new_result1_3)
result_education<-result_education%>% mutate(strate=c("noeducaiton_MED","educaiton_MED","noeducaiton_MIND","educaiton_MIND"),.before=OR)
result_education<-result_education%>% mutate(cancer=c("brain"),.before=strate)
#家族史为0
result1_1<-c()
for (i in data_brain[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_brain,subset = (famaliy_history=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#家族史为1
result1_2<-c()
for (i in data_brain[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_brain,subset = (famaliy_history=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_brain[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*famaliy_history,data=data_brain)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_family<-cbind(result1,new_result1_3)
result_family<-result_family%>% mutate(strate=c("nofamily_MED","family_MED","nofamily_MIND","family_MIND"),.before=OR)
result_family<-result_family%>% mutate(cancer=c("brain"),.before=strate)
#吸烟史0
data_brain$smoking_status2<-ifelse(data_brain$smoking_status=="0",0,1)
result1_1<-c()
for (i in data_brain[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_brain,subset = (smoking_status2=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#吸烟史为1
result1_2<-c()
for (i in data_brain[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_brain,subset = (smoking_status2=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_brain[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*smoking_status2,data=data_brain)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_smoking<-cbind(result1,new_result1_3)
result_smoking<-result_smoking%>% mutate(strate=c("nosmoking_MED","yes_MED","nosmoking_MIND","yes_MIND"),.before=OR)
result_smoking<-result_smoking%>% mutate(cancer=c("brain"),.before=strate)
#饮酒史为0
data_brain$alochol_drinking2<-ifelse(data_brain$alochol_drinking=="0",0,1)
result1_1<-c()
for (i in data_brain[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP,data=data_brain,subset = (alochol_drinking2=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#饮酒史为1
result1_2<-c()
for (i in data_brain[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP,data=data_brain,subset = (alochol_drinking2=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_brain[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP+i*alochol_drinking2,data=data_brain)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_alcohol<-cbind(result1,new_result1_3)
result_alcohol<-result_alcohol%>% mutate(strate=c("noalcohol_MED","yes_MED","noalcohol_MIND","yes_MIND"),.before=OR)
result_alcohol<-result_alcohol%>% mutate(cancer=c("brain"),.before=strate)
#BMI为非肥胖
data_brain$BMIgroup<-ifelse(data_brain$BMI<=25,0,1)
result1_1<-c()
for (i in data_brain[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP,data=data_brain,subset = (BMIgroup=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#肥胖
result1_2<-c()
for (i in data_brain[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP,data=data_brain,subset = (BMIgroup=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_brain[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP+i*BMIgroup,data=data_brain)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_BMI<-cbind(result1,new_result1_3)
result_BMI<-result_BMI%>% mutate(strate=c("nofat_MED","yes_MED","nofat_MIND","yes_MIND"),.before=OR)
result_BMI<-result_BMI%>% mutate(cancer=c("brain"),.before=strate)
#合并
result_brain<-rbind(result_sex,result_education,result_family,result_smoking,result_alcohol,result_BMI)

####thyroid####
data_thyroid<-subset(UKBdata2,various_cancer=="thyroid"|various_cancer==0)
#female
result1_1<-c()
for (i in data_thyroid[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_thyroid,subset = (sex=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#性别为male
result1_2<-c()
for (i in data_thyroid[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_thyroid,subset = (sex=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_thyroid[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*sex,data=data_thyroid)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_sex<-cbind(result1,new_result1_3)
result_sex<-result_sex%>% mutate(strate=c("female_MED","male_MED","Female_MIND","male_MIND"),.before=OR)
result_sex<-result_sex%>% mutate(cancer=c("thyroid"),.before=strate)
#无完成全职教育
result1_1<-c()
for (i in data_thyroid[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_thyroid,subset = (education=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#有完成全职教育
result1_2<-c()
for (i in data_thyroid[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_thyroid,subset = (education=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_thyroid[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*education,data=data_thyroid)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_education<-cbind(result1,new_result1_3)
result_education<-result_education%>% mutate(strate=c("noeducaiton_MED","educaiton_MED","noeducaiton_MIND","educaiton_MIND"),.before=OR)
result_education<-result_education%>% mutate(cancer=c("thyroid"),.before=strate)
#家族史为0
result1_1<-c()
for (i in data_thyroid[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_thyroid,subset = (famaliy_history=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#家族史为1
result1_2<-c()
for (i in data_thyroid[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_thyroid,subset = (famaliy_history=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_thyroid[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*famaliy_history,data=data_thyroid)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_family<-cbind(result1,new_result1_3)
result_family<-result_family%>% mutate(strate=c("nofamily_MED","family_MED","nofamily_MIND","family_MIND"),.before=OR)
result_family<-result_family%>% mutate(cancer=c("thyroid"),.before=strate)
#吸烟史0
data_thyroid$smoking_status2<-ifelse(data_thyroid$smoking_status=="0",0,1)
result1_1<-c()
for (i in data_thyroid[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_thyroid,subset = (smoking_status2=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#吸烟史为1
result1_2<-c()
for (i in data_thyroid[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_thyroid,subset = (smoking_status2=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_thyroid[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*smoking_status2,data=data_thyroid)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_smoking<-cbind(result1,new_result1_3)
result_smoking<-result_smoking%>% mutate(strate=c("nosmoking_MED","yes_MED","nosmoking_MIND","yes_MIND"),.before=OR)
result_smoking<-result_smoking%>% mutate(cancer=c("thyroid"),.before=strate)
#饮酒史为0
data_thyroid$alochol_drinking2<-ifelse(data_thyroid$alochol_drinking=="0",0,1)
result1_1<-c()
for (i in data_thyroid[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP,data=data_thyroid,subset = (alochol_drinking2=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#饮酒史为1
result1_2<-c()
for (i in data_thyroid[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP,data=data_thyroid,subset = (alochol_drinking2=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_thyroid[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP+i*alochol_drinking2,data=data_thyroid)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_alcohol<-cbind(result1,new_result1_3)
result_alcohol<-result_alcohol%>% mutate(strate=c("noalcohol_MED","yes_MED","noalcohol_MIND","yes_MIND"),.before=OR)
result_alcohol<-result_alcohol%>% mutate(cancer=c("thyroid"),.before=strate)
#BMI为非肥胖
data_thyroid$BMIgroup<-ifelse(data_thyroid$BMI<=25,0,1)
result1_1<-c()
for (i in data_thyroid[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP,data=data_thyroid,subset = (BMIgroup=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#肥胖
result1_2<-c()
for (i in data_thyroid[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP,data=data_thyroid,subset = (BMIgroup=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_thyroid[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP+i*BMIgroup,data=data_thyroid)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_BMI<-cbind(result1,new_result1_3)
result_BMI<-result_BMI%>% mutate(strate=c("nofat_MED","yes_MED","nofat_MIND","yes_MIND"),.before=OR)
result_BMI<-result_BMI%>% mutate(cancer=c("thyroid"),.before=strate)
#合并
result_thyroid<-rbind(result_sex,result_education,result_family,result_smoking,result_alcohol,result_BMI)


####Hodgkin_lymphoma####
data_Hodgkin_lymphoma<-subset(UKBdata2,various_cancer=="Hodgkin_lymphoma"|various_cancer==0)
#female
result1_1<-c()
for (i in data_Hodgkin_lymphoma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_Hodgkin_lymphoma,subset = (sex=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#性别为male
result1_2<-c()
for (i in data_Hodgkin_lymphoma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_Hodgkin_lymphoma,subset = (sex=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_Hodgkin_lymphoma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*sex,data=data_Hodgkin_lymphoma)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_sex<-cbind(result1,new_result1_3)
result_sex<-result_sex%>% mutate(strate=c("female_MED","male_MED","Female_MIND","male_MIND"),.before=OR)
result_sex<-result_sex%>% mutate(cancer=c("Hodgkin_lymphoma"),.before=strate)
#无完成全职教育
result1_1<-c()
for (i in data_Hodgkin_lymphoma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_Hodgkin_lymphoma,subset = (education=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#有完成全职教育
result1_2<-c()
for (i in data_Hodgkin_lymphoma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_Hodgkin_lymphoma,subset = (education=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_Hodgkin_lymphoma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*education,data=data_Hodgkin_lymphoma)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_education<-cbind(result1,new_result1_3)
result_education<-result_education%>% mutate(strate=c("noeducaiton_MED","educaiton_MED","noeducaiton_MIND","educaiton_MIND"),.before=OR)
result_education<-result_education%>% mutate(cancer=c("Hodgkin_lymphoma"),.before=strate)
#家族史为0
result1_1<-c()
for (i in data_Hodgkin_lymphoma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_Hodgkin_lymphoma,subset = (famaliy_history=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#家族史为1
result1_2<-c()
for (i in data_Hodgkin_lymphoma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_Hodgkin_lymphoma,subset = (famaliy_history=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_Hodgkin_lymphoma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*famaliy_history,data=data_Hodgkin_lymphoma)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_family<-cbind(result1,new_result1_3)
result_family<-result_family%>% mutate(strate=c("nofamily_MED","family_MED","nofamily_MIND","family_MIND"),.before=OR)
result_family<-result_family%>% mutate(cancer=c("Hodgkin_lymphoma"),.before=strate)
#吸烟史0
data_Hodgkin_lymphoma$smoking_status2<-ifelse(data_Hodgkin_lymphoma$smoking_status=="0",0,1)
result1_1<-c()
for (i in data_Hodgkin_lymphoma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_Hodgkin_lymphoma,subset = (smoking_status2=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#吸烟史为1
result1_2<-c()
for (i in data_Hodgkin_lymphoma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_Hodgkin_lymphoma,subset = (smoking_status2=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_Hodgkin_lymphoma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*smoking_status2,data=data_Hodgkin_lymphoma)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_smoking<-cbind(result1,new_result1_3)
result_smoking<-result_smoking%>% mutate(strate=c("nosmoking_MED","yes_MED","nosmoking_MIND","yes_MIND"),.before=OR)
result_smoking<-result_smoking%>% mutate(cancer=c("Hodgkin_lymphoma"),.before=strate)
#饮酒史为0
data_Hodgkin_lymphoma$alochol_drinking2<-ifelse(data_Hodgkin_lymphoma$alochol_drinking=="0",0,1)
result1_1<-c()
for (i in data_Hodgkin_lymphoma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP,data=data_Hodgkin_lymphoma,subset = (alochol_drinking2=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#饮酒史为1
result1_2<-c()
for (i in data_Hodgkin_lymphoma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP,data=data_Hodgkin_lymphoma,subset = (alochol_drinking2=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_Hodgkin_lymphoma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP+i*alochol_drinking2,data=data_Hodgkin_lymphoma)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_alcohol<-cbind(result1,new_result1_3)
result_alcohol<-result_alcohol%>% mutate(strate=c("noalcohol_MED","yes_MED","noalcohol_MIND","yes_MIND"),.before=OR)
result_alcohol<-result_alcohol%>% mutate(cancer=c("Hodgkin_lymphoma"),.before=strate)
#BMI为非肥胖
data_Hodgkin_lymphoma$BMIgroup<-ifelse(data_Hodgkin_lymphoma$BMI<=25,0,1)
result1_1<-c()
for (i in data_Hodgkin_lymphoma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP,data=data_Hodgkin_lymphoma,subset = (BMIgroup=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#肥胖
result1_2<-c()
for (i in data_Hodgkin_lymphoma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP,data=data_Hodgkin_lymphoma,subset = (BMIgroup=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_Hodgkin_lymphoma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP+i*BMIgroup,data=data_Hodgkin_lymphoma)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_BMI<-cbind(result1,new_result1_3)
result_BMI<-result_BMI%>% mutate(strate=c("nofat_MED","yes_MED","nofat_MIND","yes_MIND"),.before=OR)
result_BMI<-result_BMI%>% mutate(cancer=c("Hodgkin_lymphoma"),.before=strate)
#合并
result_Hodgkin_lymphoma<-rbind(result_sex,result_education,result_family,result_smoking,result_alcohol,result_BMI)

####non_Hodgkin_lymphoma####
data_non_Hodgkin_lymphoma<-subset(UKBdata2,various_cancer=="non_Hodgkin_lymphoma"|various_cancer==0)
#female
result1_1<-c()
for (i in data_non_Hodgkin_lymphoma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_non_Hodgkin_lymphoma,subset = (sex=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#性别为male
result1_2<-c()
for (i in data_non_Hodgkin_lymphoma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_non_Hodgkin_lymphoma,subset = (sex=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_non_Hodgkin_lymphoma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*sex,data=data_non_Hodgkin_lymphoma)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_sex<-cbind(result1,new_result1_3)
result_sex<-result_sex%>% mutate(strate=c("female_MED","male_MED","Female_MIND","male_MIND"),.before=OR)
result_sex<-result_sex%>% mutate(cancer=c("non_Hodgkin_lymphoma"),.before=strate)
#无完成全职教育
result1_1<-c()
for (i in data_non_Hodgkin_lymphoma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_non_Hodgkin_lymphoma,subset = (education=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#有完成全职教育
result1_2<-c()
for (i in data_non_Hodgkin_lymphoma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_non_Hodgkin_lymphoma,subset = (education=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_non_Hodgkin_lymphoma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*education,data=data_non_Hodgkin_lymphoma)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_education<-cbind(result1,new_result1_3)
result_education<-result_education%>% mutate(strate=c("noeducaiton_MED","educaiton_MED","noeducaiton_MIND","educaiton_MIND"),.before=OR)
result_education<-result_education%>% mutate(cancer=c("non_Hodgkin_lymphoma"),.before=strate)
#家族史为0
result1_1<-c()
for (i in data_non_Hodgkin_lymphoma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_non_Hodgkin_lymphoma,subset = (famaliy_history=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#家族史为1
result1_2<-c()
for (i in data_non_Hodgkin_lymphoma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_non_Hodgkin_lymphoma,subset = (famaliy_history=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_non_Hodgkin_lymphoma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*famaliy_history,data=data_non_Hodgkin_lymphoma)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_family<-cbind(result1,new_result1_3)
result_family<-result_family%>% mutate(strate=c("nofamily_MED","family_MED","nofamily_MIND","family_MIND"),.before=OR)
result_family<-result_family%>% mutate(cancer=c("non_Hodgkin_lymphoma"),.before=strate)
#吸烟史0
data_non_Hodgkin_lymphoma$smoking_status2<-ifelse(data_non_Hodgkin_lymphoma$smoking_status=="0",0,1)
result1_1<-c()
for (i in data_non_Hodgkin_lymphoma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_non_Hodgkin_lymphoma,subset = (smoking_status2=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#吸烟史为1
result1_2<-c()
for (i in data_non_Hodgkin_lymphoma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_non_Hodgkin_lymphoma,subset = (smoking_status2=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_non_Hodgkin_lymphoma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*smoking_status2,data=data_non_Hodgkin_lymphoma)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_smoking<-cbind(result1,new_result1_3)
result_smoking<-result_smoking%>% mutate(strate=c("nosmoking_MED","yes_MED","nosmoking_MIND","yes_MIND"),.before=OR)
result_smoking<-result_smoking%>% mutate(cancer=c("non_Hodgkin_lymphoma"),.before=strate)
#饮酒史为0
data_non_Hodgkin_lymphoma$alochol_drinking2<-ifelse(data_non_Hodgkin_lymphoma$alochol_drinking=="0",0,1)
result1_1<-c()
for (i in data_non_Hodgkin_lymphoma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP,data=data_non_Hodgkin_lymphoma,subset = (alochol_drinking2=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#饮酒史为1
result1_2<-c()
for (i in data_non_Hodgkin_lymphoma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP,data=data_non_Hodgkin_lymphoma,subset = (alochol_drinking2=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_non_Hodgkin_lymphoma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP+i*alochol_drinking2,data=data_non_Hodgkin_lymphoma)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_alcohol<-cbind(result1,new_result1_3)
result_alcohol<-result_alcohol%>% mutate(strate=c("noalcohol_MED","yes_MED","noalcohol_MIND","yes_MIND"),.before=OR)
result_alcohol<-result_alcohol%>% mutate(cancer=c("non_Hodgkin_lymphoma"),.before=strate)
#BMI为非肥胖
data_non_Hodgkin_lymphoma$BMIgroup<-ifelse(data_non_Hodgkin_lymphoma$BMI<=25,0,1)
result1_1<-c()
for (i in data_non_Hodgkin_lymphoma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP,data=data_non_Hodgkin_lymphoma,subset = (BMIgroup=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#肥胖
result1_2<-c()
for (i in data_non_Hodgkin_lymphoma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP,data=data_non_Hodgkin_lymphoma,subset = (BMIgroup=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_non_Hodgkin_lymphoma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP+i*BMIgroup,data=data_non_Hodgkin_lymphoma)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_BMI<-cbind(result1,new_result1_3)
result_BMI<-result_BMI%>% mutate(strate=c("nofat_MED","yes_MED","nofat_MIND","yes_MIND"),.before=OR)
result_BMI<-result_BMI%>% mutate(cancer=c("non_Hodgkin_lymphoma"),.before=strate)
#合并
result_non_Hodgkin_lymphoma<-rbind(result_sex,result_education,result_family,result_smoking,result_alcohol,result_BMI)


####multiple_myeloma####
data_multiple_myeloma<-subset(UKBdata2,various_cancer=="multiple_myeloma"|various_cancer==0)
#female
result1_1<-c()
for (i in data_multiple_myeloma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_multiple_myeloma,subset = (sex=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#性别为male
result1_2<-c()
for (i in data_multiple_myeloma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_multiple_myeloma,subset = (sex=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_multiple_myeloma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*sex,data=data_multiple_myeloma)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_sex<-cbind(result1,new_result1_3)
result_sex<-result_sex%>% mutate(strate=c("female_MED","male_MED","Female_MIND","male_MIND"),.before=OR)
result_sex<-result_sex%>% mutate(cancer=c("multiple_myeloma"),.before=strate)
#无完成全职教育
result1_1<-c()
for (i in data_multiple_myeloma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_multiple_myeloma,subset = (education=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#有完成全职教育
result1_2<-c()
for (i in data_multiple_myeloma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_multiple_myeloma,subset = (education=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_multiple_myeloma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*education,data=data_multiple_myeloma)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_education<-cbind(result1,new_result1_3)
result_education<-result_education%>% mutate(strate=c("noeducaiton_MED","educaiton_MED","noeducaiton_MIND","educaiton_MIND"),.before=OR)
result_education<-result_education%>% mutate(cancer=c("multiple_myeloma"),.before=strate)
#家族史为0
result1_1<-c()
for (i in data_multiple_myeloma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_multiple_myeloma,subset = (famaliy_history=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#家族史为1
result1_2<-c()
for (i in data_multiple_myeloma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_multiple_myeloma,subset = (famaliy_history=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_multiple_myeloma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*famaliy_history,data=data_multiple_myeloma)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_family<-cbind(result1,new_result1_3)
result_family<-result_family%>% mutate(strate=c("nofamily_MED","family_MED","nofamily_MIND","family_MIND"),.before=OR)
result_family<-result_family%>% mutate(cancer=c("multiple_myeloma"),.before=strate)
#吸烟史0
data_multiple_myeloma$smoking_status2<-ifelse(data_multiple_myeloma$smoking_status=="0",0,1)
result1_1<-c()
for (i in data_multiple_myeloma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_multiple_myeloma,subset = (smoking_status2=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#吸烟史为1
result1_2<-c()
for (i in data_multiple_myeloma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_multiple_myeloma,subset = (smoking_status2=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_multiple_myeloma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*smoking_status2,data=data_multiple_myeloma)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_smoking<-cbind(result1,new_result1_3)
result_smoking<-result_smoking%>% mutate(strate=c("nosmoking_MED","yes_MED","nosmoking_MIND","yes_MIND"),.before=OR)
result_smoking<-result_smoking%>% mutate(cancer=c("multiple_myeloma"),.before=strate)
#饮酒史为0
data_multiple_myeloma$alochol_drinking2<-ifelse(data_multiple_myeloma$alochol_drinking=="0",0,1)
result1_1<-c()
for (i in data_multiple_myeloma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP,data=data_multiple_myeloma,subset = (alochol_drinking2=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#饮酒史为1
result1_2<-c()
for (i in data_multiple_myeloma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP,data=data_multiple_myeloma,subset = (alochol_drinking2=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_multiple_myeloma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP+i*alochol_drinking2,data=data_multiple_myeloma)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_alcohol<-cbind(result1,new_result1_3)
result_alcohol<-result_alcohol%>% mutate(strate=c("noalcohol_MED","yes_MED","noalcohol_MIND","yes_MIND"),.before=OR)
result_alcohol<-result_alcohol%>% mutate(cancer=c("multiple_myeloma"),.before=strate)
#BMI为非肥胖
data_multiple_myeloma$BMIgroup<-ifelse(data_multiple_myeloma$BMI<=25,0,1)
result1_1<-c()
for (i in data_multiple_myeloma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP,data=data_multiple_myeloma,subset = (BMIgroup=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#肥胖
result1_2<-c()
for (i in data_multiple_myeloma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP,data=data_multiple_myeloma,subset = (BMIgroup=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_multiple_myeloma[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP+i*BMIgroup,data=data_multiple_myeloma)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_BMI<-cbind(result1,new_result1_3)
result_BMI<-result_BMI%>% mutate(strate=c("nofat_MED","yes_MED","nofat_MIND","yes_MIND"),.before=OR)
result_BMI<-result_BMI%>% mutate(cancer=c("multiple_myeloma"),.before=strate)
#合并
result_multiple_myeloma<-rbind(result_sex,result_education,result_family,result_smoking,result_alcohol,result_BMI)


####leukemia####
data_leukemia<-subset(UKBdata2,various_cancer=="leukemia"|various_cancer==0)
#female
result1_1<-c()
for (i in data_leukemia[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_leukemia,subset = (sex=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#性别为male
result1_2<-c()
for (i in data_leukemia[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_leukemia,subset = (sex=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_leukemia[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*sex,data=data_leukemia)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_sex<-cbind(result1,new_result1_3)
result_sex<-result_sex%>% mutate(strate=c("female_MED","male_MED","Female_MIND","male_MIND"),.before=OR)
result_sex<-result_sex%>% mutate(cancer=c("leukemia"),.before=strate)
#无完成全职教育
result1_1<-c()
for (i in data_leukemia[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_leukemia,subset = (education=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#有完成全职教育
result1_2<-c()
for (i in data_leukemia[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_leukemia,subset = (education=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_leukemia[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*education,data=data_leukemia)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_education<-cbind(result1,new_result1_3)
result_education<-result_education%>% mutate(strate=c("noeducaiton_MED","educaiton_MED","noeducaiton_MIND","educaiton_MIND"),.before=OR)
result_education<-result_education%>% mutate(cancer=c("leukemia"),.before=strate)
#家族史为0
result1_1<-c()
for (i in data_leukemia[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_leukemia,subset = (famaliy_history=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#家族史为1
result1_2<-c()
for (i in data_leukemia[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_leukemia,subset = (famaliy_history=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_leukemia[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*famaliy_history,data=data_leukemia)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_family<-cbind(result1,new_result1_3)
result_family<-result_family%>% mutate(strate=c("nofamily_MED","family_MED","nofamily_MIND","family_MIND"),.before=OR)
result_family<-result_family%>% mutate(cancer=c("leukemia"),.before=strate)
#吸烟史0
data_leukemia$smoking_status2<-ifelse(data_leukemia$smoking_status=="0",0,1)
result1_1<-c()
for (i in data_leukemia[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_leukemia,subset = (smoking_status2=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#吸烟史为1
result1_2<-c()
for (i in data_leukemia[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_leukemia,subset = (smoking_status2=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_leukemia[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status2+alochol_drinking+weekly_activity+
                BMI+whr+SBP+i*smoking_status2,data=data_leukemia)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_smoking<-cbind(result1,new_result1_3)
result_smoking<-result_smoking%>% mutate(strate=c("nosmoking_MED","yes_MED","nosmoking_MIND","yes_MIND"),.before=OR)
result_smoking<-result_smoking%>% mutate(cancer=c("leukemia"),.before=strate)
#饮酒史为0
data_leukemia$alochol_drinking2<-ifelse(data_leukemia$alochol_drinking=="0",0,1)
result1_1<-c()
for (i in data_leukemia[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP,data=data_leukemia,subset = (alochol_drinking2=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#饮酒史为1
result1_2<-c()
for (i in data_leukemia[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP,data=data_leukemia,subset = (alochol_drinking2=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_leukemia[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking2+weekly_activity+
                BMI+whr+SBP+i*alochol_drinking2,data=data_leukemia)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_alcohol<-cbind(result1,new_result1_3)
result_alcohol<-result_alcohol%>% mutate(strate=c("noalcohol_MED","yes_MED","noalcohol_MIND","yes_MIND"),.before=OR)
result_alcohol<-result_alcohol%>% mutate(cancer=c("leukemia"),.before=strate)
#BMI为非肥胖
data_leukemia$BMIgroup<-ifelse(data_leukemia$BMI<=25,0,1)
result1_1<-c()
for (i in data_leukemia[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP,data=data_leukemia,subset = (BMIgroup=="0"))
  result1_1<-rbind(result1_1,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#肥胖
result1_2<-c()
for (i in data_leukemia[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP,data=data_leukemia,subset = (BMIgroup=="1"))
  result1_2<-rbind(result1_2,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)]))
}
#交互作用
result1_3<-c()
for (i in data_leukemia[,c(268,267)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMIgroup+whr+SBP+i*BMIgroup,data=data_leukemia)
  result1_3<-rbind(result1_3,c(summary(fiti)$coefficients[14,5]))
}
result1_1 <- as.data.frame(result1_1)
result1_2 <- as.data.frame(result1_2)
result1 <- rbind(result1_1[1, ],result1_2[1, ],result1_1[2, ],result1_2[2, ])
colnames(result1)<-c("OR","LCL","UCL")
result1_3 <- as.data.frame(result1_3)
new_result1_3<-data.frame(Pinteraction = rep(NA, 4))
new_result1_3[c(1, 3), "Pinteraction"] <- result1_3[, 1]
result_BMI<-cbind(result1,new_result1_3)
result_BMI<-result_BMI%>% mutate(strate=c("nofat_MED","yes_MED","nofat_MIND","yes_MIND"),.before=OR)
result_BMI<-result_BMI%>% mutate(cancer=c("leukemia"),.before=strate)
#合并
result_leukemia<-rbind(result_sex,result_education,result_family,result_smoking,result_alcohol,result_BMI)


####合并
result_various_cancer<-rbind(result_head,result_esophagus,result_stomach,result_colorectal,
                             result_liver,result_gallbladder,result_pancreas,result_lung,result_malignant_melanoma,
                             result_breast,result_uterus_cervix,result_ovary,result_prostate,result_testic,
                             result_kidney,result_bladder,result_brain,result_thyroid,result_Hodgkin_lymphoma,
                             result_non_Hodgkin_lymphoma,result_multiple_myeloma,result_leukemia)
write.csv(result_various_cancer,"E:/deskbook/FigureS6.csv",row.names = F)




#画图####
rm(list=ls())
library(grid)
library("forestploter")
Supplement_figure6<-read.csv("E:/deskbook/Supplement_figure6_1.csv",sep=",",header=T)
#整理表格
Supplement_figure6$Subgroup<-ifelse(is.na(Supplement_figure6$HR1_head),
                                    Supplement_figure6$Subgroup,
                                    paste0("  ",Supplement_figure6$Subgroup))
Supplement_figure6$`Head and neck cancer`<-paste(rep(' ',30),collapse = ' ')
Supplement_figure6$` `<-paste(rep(' ',10),collapse = ' ')
Supplement_figure6$`Esophagus cancer`<-paste(rep(' ',30),collapse = ' ')
Supplement_figure6$`  `<-paste(rep(' ',10),collapse = ' ')
Supplement_figure6$`Stomach cacner`<-paste(rep(' ',30),collapse = ' ')
Supplement_figure6$`   `<-paste(rep(' ',10),collapse = ' ')
Supplement_figure6$`Colorectal cacner`<-paste(rep(' ',30),collapse = ' ')
Supplement_figure6$`    `<-paste(rep(' ',10),collapse = ' ')
Supplement_figure6$`Liver cacner`<-paste(rep(' ',30),collapse = ' ')
#设置forest_theme函数可以对森林图图片的细节进行调整
tm<-forest_theme(base_size=10,refline_lty="solid",
                 ci_pch = c(15,18),
                 ci_col=c("#377eb8","#4daf4a"),
                 ci_lty = 1,ci_lwd=1.4,legend_name="Dietary adherence",
                 legend_value = c("MEDAS score","MIND score"),
                 vertline_lty = c("dashed","dotted"),vertline_col = c("#d6604d","#bababa"))
colnames(Supplement_figure6)
p<-forest(Supplement_figure6[,c(1:2,18:26)],
          est=list(Supplement_figure6$HR1_head,Supplement_figure6$HR2_eophagus,Supplement_figure6$HR3_stomach,
                   Supplement_figure6$HR4_colorectal,Supplement_figure6$HR5_liver),
          lower=list(Supplement_figure6$LCL1,Supplement_figure6$LCL2,Supplement_figure6$LCL3,
                     Supplement_figure6$LCL4,Supplement_figure6$LCL5),
          upper = list(Supplement_figure6$UCL1,Supplement_figure6$UCL2,Supplement_figure6$UCL3,
                       Supplement_figure6$UCL4,Supplement_figure6$UCL5),
          ci_column=c(3,5,7,9,11),xlim=c(0.5,1.3),ticks_at = c(0.5,0.6,0.7,0.8,0.9,1.0,1.1,1.2,1.3),
          ref_line = 1,theme = tm)
#将文本加粗
g<-edit_plot(p,row=c(1,6,11,16,21,26),
             gp=gpar(fontface="bold"))
###画图####
rm(list=ls())
library(grid)
library("forestploter")
Supplement_figure6<-read.csv("E:/deskbook/Supplement_figure6.csv",sep=",",header=T)
Supplement_figure6$`Sex:Female`<-paste(rep(' ',5),collapse = ' ')
Supplement_figure6$` `<-paste(rep(' ',20),collapse = ' ')
Supplement_figure6$`Sex:Male`<-paste(rep(' ',5),collapse = ' ')
Supplement_figure6$`  `<-paste(rep(' ',20),collapse = ' ')
Supplement_figure6$`Completed full time education:No`<-paste(rep(' ',5),collapse = ' ')
Supplement_figure6$`   `<-paste(rep(' ',20),collapse = ' ')
Supplement_figure6$`Completed full time education:Yes`<-paste(rep(' ',5),collapse = ' ')
Supplement_figure6$`    `<-paste(rep(' ',20),collapse = ' ')
Supplement_figure6$`Family history of cancer:No`<-paste(rep(' ',5),collapse = ' ')
Supplement_figure6$`     `<-paste(rep(' ',20),collapse = ' ')
Supplement_figure6$`Family history of cancer:Yes`<-paste(rep(' ',5),collapse = ' ')
Supplement_figure6$`      `<-paste(rep(' ',20),collapse = ' ')
Supplement_figure6$`Smoking status:No`<-paste(rep(' ',5),collapse = ' ')
Supplement_figure6$`1     `<-paste(rep(' ',20),collapse = ' ')
Supplement_figure6$`Smoking status:Yes`<-paste(rep(' ',5),collapse = ' ')
Supplement_figure6$`1 `<-paste(rep(' ',20),collapse = ' ')
Supplement_figure6$`Alcohol drinking:No`<-paste(rep(' ',5),collapse = ' ')
Supplement_figure6$`1  `<-paste(rep(' ',20),collapse = ' ')
Supplement_figure6$`Alcohol drinking:Yes`<-paste(rep(' ',5),collapse = ' ')
Supplement_figure6$`2 `<-paste(rep(' ',20),collapse = ' ')
Supplement_figure6$`BMI:<25`<-paste(rep(' ',5),collapse = ' ')
Supplement_figure6$`2   `<-paste(rep(' ',20),collapse = ' ')
Supplement_figure6$`BMI:>25`<-paste(rep(' ',5),collapse = ' ')
tm<-forest_theme(base_size=10,ci_pch = 15,
                 ci_col="black",ci_lty = 1,ci_lwd=1.4)
colnames(Supplement_figure6)
p<-forest(Supplement_figure6[,c(1,38:60)],
          est=list(Supplement_figure6$HR1_female,Supplement_figure6$HR2_male,Supplement_figure6$HR3_education_no,
                   Supplement_figure6$HR4_education_yes,Supplement_figure6$HR5_familyhistory_no,Supplement_figure6$HR6_familyhistory_yes,
                   Supplement_figure6$HR7_smoking_no,Supplement_figure6$HR8_smoking_yes,Supplement_figure6$HR9_alcohol_no,
                   Supplement_figure6$HR10_alcohol_yes,Supplement_figure6$HR11_bmi.25,Supplement_figure6$HR12_bmi.25),
          lower=list(Supplement_figure6$LCL1,Supplement_figure6$LCL2,Supplement_figure6$LCL3,
                     Supplement_figure6$LCL4,Supplement_figure6$LCL5,Supplement_figure6$LCL6,
                     Supplement_figure6$LCL7,Supplement_figure6$LCL8,Supplement_figure6$LCL9,
                     Supplement_figure6$LCL10,Supplement_figure6$LCL11,Supplement_figure6$LCL12),
          upper = list(Supplement_figure6$UCL1,Supplement_figure6$UCL2,Supplement_figure6$UCL3,
                       Supplement_figure6$UCL4,Supplement_figure6$UCL5,Supplement_figure6$UCL6,
                       Supplement_figure6$UCL7,Supplement_figure6$UCL8,Supplement_figure6$UCL9,
                       Supplement_figure6$UCL10,Supplement_figure6$UCL11,Supplement_figure6$UCL12),
          ci_column=c(2,4,6,8,10,12,14,16,18,20,22,24),xlim=c(0.7,1.03),ticks_at = c(0.6,0.8,1.0),
          ref_line = 1,theme = tm)
g<-edit_plot(p,row=c(2,5,8,11,14,17,20,23,26,29,32,35,38,41,44,47,50,53,56,59,62,65),
             col=c(2,4,6,8,10,12,14,16,18,20,22,24),which="ci",gp=gpar(col="#037255"))
g<-edit_plot(g,row=c(3,6,9,12,15,18,21,24,27,30,33,36,39,42,45,48,51,54,57,60,63,66),
             col=c(2,4,6,8,10,12,14,16,18,20,22,24),which="ci",gp=gpar(col="#f39800"))
g
#做与各个癌症的关联####
library(survival)
colnames(UKBdata2)
table(UKBdata2$various_cancer)
data_headcancer<-subset(UKBdata2,various_cancer=="head_and_neck"|various_cancer==0)
table(data_headcancer$MIND_sum1_3group)
table(data_headcancer$MIND_sum1_3group,data_headcancer$status)
table(data_headcancer$MEDAS_sum1_3group)
table(data_headcancer$MEDAS_sum1_3group,data_headcancer$status)
UKBdata2$MIND_sum1_3group<-factor(UKBdata2$MIND_sum1_3group)
UKBdata2$MEDAS_sum1_3group<-factor(UKBdata2$MEDAS_sum1_3group)
result_head<-c()
for (i in data_headcancer[,c(268,267)]){
  data_headcancer$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_headcancer)
  result_head<-rbind(result_head,c(exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_head)<-c("OR_1","OR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_head<-data.frame(result_head)
result_head<-result_head%>% mutate(cancer=c("head"),.before=OR_1)
#Esophagus
data_Esophagus<-subset(UKBdata2,various_cancer=="esophagus"|various_cancer==0)
table(data_Esophagus$MIND_sum1_3group)
table(data_Esophagus$MIND_sum1_3group,data_Esophagus$status)
table(data_Esophagus$MEDAS_sum1_3group)
table(data_Esophagus$MEDAS_sum1_3group,data_Esophagus$status)
result_Esophagus<-c()
for (i in data_Esophagus[,c(268,267)]){
  data_Esophagus$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_Esophagus)
  result_Esophagus<-rbind(result_Esophagus,c(exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_Esophagus)<-c("OR_1","OR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_Esophagus<-data.frame(result_Esophagus)
result_Esophagus<-result_Esophagus%>% mutate(cancer=c("Esophagus"),.before=OR_1)
#stomach
data_stomach<-subset(UKBdata2,various_cancer=="stomach"|various_cancer==0)
table(data_stomach$MIND_sum1_3group)
table(data_stomach$MIND_sum1_3group,data_stomach$status)
table(data_stomach$MEDAS_sum1_3group)
table(data_stomach$MEDAS_sum1_3group,data_stomach$status)
result_stomach<-c()
for (i in data_stomach[,c(268,267)]){
  data_stomach$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_stomach)
  result_stomach<-rbind(result_stomach,c(exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_stomach)<-c("OR_1","OR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_stomach<-data.frame(result_stomach)
result_stomach<-result_stomach%>% mutate(cancer=c("stomach"),.before=OR_1)
#colorectal
data_colorectal<-subset(UKBdata2,various_cancer=="colorectal"|various_cancer==0)
table(data_colorectal$MIND_sum1_3group)
table(data_colorectal$MIND_sum1_3group,data_colorectal$status)
table(data_colorectal$MEDAS_sum1_3group)
table(data_colorectal$MEDAS_sum1_3group,data_colorectal$status)
result_colorectal<-c()
for (i in data_colorectal[,c(268,267)]){
  data_colorectal$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_colorectal)
  result_colorectal<-rbind(result_colorectal,c(exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_colorectal)<-c("OR_1","OR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_colorectal<-data.frame(result_colorectal)
result_colorectal<-result_colorectal%>% mutate(cancer=c("colorectal"),.before=OR_1)
#liver
data_liver<-subset(UKBdata2,various_cancer=="liver"|various_cancer==0)
table(data_liver$MIND_sum1_3group)
table(data_liver$MIND_sum1_3group,data_liver$status)
table(data_liver$MEDAS_sum1_3group)
table(data_liver$MEDAS_sum1_3group,data_liver$status)
result_liver<-c()
for (i in data_liver[,c(268,267)]){
  data_liver$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_liver)
  result_liver<-rbind(result_liver,c(exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_liver)<-c("OR_1","OR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_liver<-data.frame(result_liver)
result_liver<-result_liver%>% mutate(cancer=c("liver"),.before=OR_1)
#gallbladder
data_gallbladder<-subset(UKBdata2,various_cancer=="gallbladder"|various_cancer==0)
table(data_gallbladder$MIND_sum1_3group)
table(data_gallbladder$MIND_sum1_3group,data_gallbladder$status)
table(data_gallbladder$MEDAS_sum1_3group)
table(data_gallbladder$MEDAS_sum1_3group,data_gallbladder$status)
result_gallbladder<-c()
for (i in data_gallbladder[,c(268,267)]){
  data_gallbladder$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_gallbladder)
  result_gallbladder<-rbind(result_gallbladder,c(exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_gallbladder)<-c("OR_1","OR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_gallbladder<-data.frame(result_gallbladder)
result_gallbladder<-result_gallbladder%>% mutate(cancer=c("gallbladder"),.before=OR_1)
#pancreas
table(UKBdata2$various_cancer)
data_pancreas<-subset(UKBdata2,various_cancer=="pancreas"|various_cancer==0)
table(data_pancreas$MIND_sum1_3group)
table(data_pancreas$MIND_sum1_3group,data_pancreas$status)
table(data_pancreas$MEDAS_sum1_3group)
table(data_pancreas$MEDAS_sum1_3group,data_pancreas$status)
result_pancreas<-c()
for (i in data_pancreas[,c(268,267)]){
  data_pancreas$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_pancreas)
  result_pancreas<-rbind(result_pancreas,c(exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_pancreas)<-c("OR_1","OR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_pancreas<-data.frame(result_pancreas)
result_pancreas<-result_pancreas%>% mutate(cancer=c("pancreas"),.before=OR_1)
#lung
data_lung<-subset(UKBdata2,various_cancer=="lung"|various_cancer==0)
table(data_lung$MIND_sum1_3group)
table(data_lung$MIND_sum1_3group,data_lung$status)
table(data_lung$MEDAS_sum1_3group)
table(data_lung$MEDAS_sum1_3group,data_lung$status)
result_lung<-c()
for (i in data_lung[,c(268,267)]){
  data_lung$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_lung)
  result_lung<-rbind(result_lung,c(exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_lung)<-c("OR_1","OR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_lung<-data.frame(result_lung)
result_lung<-result_lung%>% mutate(cancer=c("lung"),.before=OR_1)
#malignant_melanoma
data_malignant_melanoma<-subset(UKBdata2,various_cancer=="malignant_melanoma"|various_cancer==0)
table(data_malignant_melanoma$MIND_sum1_3group)
table(data_malignant_melanoma$MIND_sum1_3group,data_malignant_melanoma$status)
table(data_malignant_melanoma$MEDAS_sum1_3group)
table(data_malignant_melanoma$MEDAS_sum1_3group,data_malignant_melanoma$status)
result_malignant_melanoma<-c()
for (i in data_malignant_melanoma[,c(268,267)]){
  data_malignant_melanoma$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_malignant_melanoma)
  result_malignant_melanoma<-rbind(result_malignant_melanoma,c(exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_malignant_melanoma)<-c("OR_1","OR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_malignant_melanoma<-data.frame(result_malignant_melanoma)
result_malignant_melanoma<-result_malignant_melanoma%>% mutate(cancer=c("malignant_melanoma"),.before=OR_1)
#breast
data_breast<-subset(UKBdata2,various_cancer=="breast"|various_cancer==0)
table(data_breast$MIND_sum1_3group)
table(data_breast$MIND_sum1_3group,data_breast$status)
table(data_breast$MEDAS_sum1_3group)
table(data_breast$MEDAS_sum1_3group,data_breast$status)
result_breast<-c()
for (i in data_breast[,c(268,267)]){
  data_breast$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_breast)
  result_breast<-rbind(result_breast,c(exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_breast)<-c("OR_1","OR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_breast<-data.frame(result_breast)
result_breast<-result_breast%>% mutate(cancer=c("breast"),.before=OR_1)
#Uterus and cervix cancer
table(UKBdata2$various_cancer)
data_uterine<-subset(UKBdata2,various_cancer=="uterus_cervix"|various_cancer==0)
table(data_uterine$MIND_sum1_3group)
table(data_uterine$MIND_sum1_3group,data_uterine$status)
table(data_uterine$MEDAS_sum1_3group)
table(data_uterine$MEDAS_sum1_3group,data_uterine$status)
result_uterine<-c()
for (i in data_uterine[,c(268,267)]){
  data_uterine$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_uterine)
  result_uterine<-rbind(result_uterine,c(exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_uterine)<-c("OR_1","OR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_uterine<-data.frame(result_uterine)
result_uterine<-result_uterine%>% mutate(cancer=c("uterine"),.before=OR_1)
#ovary
data_ovary<-subset(UKBdata2,various_cancer=="ovary"|various_cancer==0)
table(data_ovary$MIND_sum1_3group)
table(data_ovary$MIND_sum1_3group,data_ovary$status)
table(data_ovary$MEDAS_sum1_3group)
table(data_ovary$MEDAS_sum1_3group,data_ovary$status)
result_ovary<-c()
for (i in data_ovary[,c(268,267)]){
  data_ovary$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_ovary)
  result_ovary<-rbind(result_ovary,c(exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_ovary)<-c("OR_1","OR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_ovary<-data.frame(result_ovary)
result_ovary<-result_ovary%>% mutate(cancer=c("ovary"),.before=OR_1)
#prostate
data_prostate<-subset(UKBdata2,various_cancer=="prostate"|various_cancer==0)
table(data_prostate$MIND_sum1_3group)
table(data_prostate$MIND_sum1_3group,data_prostate$status)
table(data_prostate$MEDAS_sum1_3group)
table(data_prostate$MEDAS_sum1_3group,data_prostate$status)
result_prostate<-c()
for (i in data_prostate[,c(268,267)]){
  data_prostate$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_prostate)
  result_prostate<-rbind(result_prostate,c(exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_prostate)<-c("OR_1","OR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_prostate<-data.frame(result_prostate)
result_prostate<-result_prostate%>% mutate(cancer=c("prostate"),.before=OR_1)
#testic
table(UKBdata2$various_cancer)
data_testic<-subset(UKBdata2,various_cancer=="testic"|various_cancer==0)
table(data_testic$MIND_sum1_3group)
table(data_testic$MIND_sum1_3group,data_testic$status)
table(data_testic$MEDAS_sum1_3group)
table(data_testic$MEDAS_sum1_3group,data_testic$status)
result_testic<-c()
for (i in data_testic[,c(268,267)]){
  data_testic$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_testic)
  result_testic<-rbind(result_testic,c(exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_testic)<-c("OR_1","OR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_testic<-data.frame(result_testic)
result_testic<-result_testic%>% mutate(cancer=c("testic"),.before=OR_1)
#kidney
data_kidney<-subset(UKBdata2,various_cancer=="kidney"|various_cancer==0)
table(data_kidney$MIND_sum1_3group)
table(data_kidney$MIND_sum1_3group,data_kidney$status)
table(data_kidney$MEDAS_sum1_3group)
table(data_kidney$MEDAS_sum1_3group,data_kidney$status)
result_kidney<-c()
for (i in data_kidney[,c(268,267)]){
  data_kidney$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_kidney)
  result_kidney<-rbind(result_kidney,c(exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_kidney)<-c("OR_1","OR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_kidney<-data.frame(result_kidney)
result_kidney<-result_kidney%>% mutate(cancer=c("kidney"),.before=OR_1)
#bladder
data_bladder<-subset(UKBdata2,various_cancer=="bladder"|various_cancer==0)
table(data_bladder$MIND_sum1_3group)
table(data_bladder$MIND_sum1_3group,data_bladder$status)
table(data_bladder$MEDAS_sum1_3group)
table(data_bladder$MEDAS_sum1_3group,data_bladder$status)
result_bladder<-c()
for (i in data_bladder[,c(268,267)]){
  data_bladder$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_bladder)
  result_bladder<-rbind(result_bladder,c(exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_bladder)<-c("OR_1","OR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_bladder<-data.frame(result_bladder)
result_bladder<-result_bladder%>% mutate(cancer=c("bladder"),.before=OR_1)
#brain
data_brain<-subset(UKBdata2,various_cancer=="brain"|various_cancer==0)
table(data_brain$MIND_sum1_3group)
table(data_brain$MIND_sum1_3group,data_brain$status)
table(data_brain$MEDAS_sum1_3group)
table(data_brain$MEDAS_sum1_3group,data_brain$status)
result_brain<-c()
for (i in data_brain[,c(268,267)]){
  data_brain$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_brain)
  result_brain<-rbind(result_brain,c(exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_brain)<-c("OR_1","OR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_brain<-data.frame(result_brain)
result_brain<-result_brain%>% mutate(cancer=c("brain"),.before=OR_1)
#thyroid
table(UKBdata2$various_cancer)
data_thyroid<-subset(UKBdata2,various_cancer=="thyroid"|various_cancer==0)
table(data_thyroid$MIND_sum1_3group)
table(data_thyroid$MIND_sum1_3group,data_thyroid$status)
table(data_thyroid$MEDAS_sum1_3group)
table(data_thyroid$MEDAS_sum1_3group,data_thyroid$status)
table(data_thyroid$various_cancer)
result_thyroid<-c()
for (i in data_thyroid[,c(268,267)]){
  data_thyroid$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_thyroid)
  result_thyroid<-rbind(result_thyroid,c(exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_thyroid)<-c("OR_1","OR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_thyroid<-data.frame(result_thyroid)
result_thyroid<-result_thyroid%>% mutate(cancer=c("thyroid"),.before=OR_1)
#Hodgkin_lymphoma
data_Hodgkin_lymphoma<-subset(UKBdata2,various_cancer=="Hodgkin_lymphoma"|various_cancer==0)
table(data_Hodgkin_lymphoma$MIND_sum1_3group)
table(data_Hodgkin_lymphoma$MIND_sum1_3group,data_Hodgkin_lymphoma$status)
table(data_Hodgkin_lymphoma$MEDAS_sum1_3group)
table(data_Hodgkin_lymphoma$MEDAS_sum1_3group,data_Hodgkin_lymphoma$status)
result_Hodgkin_lymphoma<-c()
for (i in data_Hodgkin_lymphoma[,c(268,267)]){
  data_Hodgkin_lymphoma$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_Hodgkin_lymphoma)
  result_Hodgkin_lymphoma<-rbind(result_Hodgkin_lymphoma,c(exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_Hodgkin_lymphoma)<-c("OR_1","OR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_Hodgkin_lymphoma<-data.frame(result_Hodgkin_lymphoma)
result_Hodgkin_lymphoma<-result_Hodgkin_lymphoma%>% mutate(cancer=c("Hodgkin_lymphoma"),.before=OR_1)
#non_Hodgkin_lymphoma 
data_non_Hodgkin_lymphoma<-subset(UKBdata2,various_cancer=="non_Hodgkin_lymphoma"|various_cancer==0)
table(data_non_Hodgkin_lymphoma$MIND_sum1_3group)
table(data_non_Hodgkin_lymphoma$MIND_sum1_3group,data_non_Hodgkin_lymphoma$status)
table(data_non_Hodgkin_lymphoma$MEDAS_sum1_3group)
table(data_non_Hodgkin_lymphoma$MEDAS_sum1_3group,data_non_Hodgkin_lymphoma$status)
result_non_Hodgkin_lymphoma<-c()
for (i in data_non_Hodgkin_lymphoma[,c(268,267)]){
  data_non_Hodgkin_lymphoma$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_non_Hodgkin_lymphoma)
  result_non_Hodgkin_lymphoma<-rbind(result_non_Hodgkin_lymphoma,c(exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_non_Hodgkin_lymphoma)<-c("OR_1","OR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_non_Hodgkin_lymphoma<-data.frame(result_non_Hodgkin_lymphoma)
result_non_Hodgkin_lymphoma<-result_non_Hodgkin_lymphoma%>% mutate(cancer=c("non_Hodgkin_lymphoma"),.before=OR_1)
#multiple_myeloma
rm(data_headcancer,data_Esophagus,data_testic,data_colorectal)
data_multiple_myeloma<-subset(UKBdata2,various_cancer=="multiple_myeloma"|various_cancer==0)
table(data_multiple_myeloma$MIND_sum1_3group)
table(data_multiple_myeloma$MIND_sum1_3group,data_multiple_myeloma$status)
table(data_multiple_myeloma$MEDAS_sum1_3group)
table(data_multiple_myeloma$MEDAS_sum1_3group,data_multiple_myeloma$status)
result_multiple_myeloma<-c()
for (i in data_multiple_myeloma[,c(268,267)]){
  data_multiple_myeloma$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_multiple_myeloma)
  result_multiple_myeloma<-rbind(result_multiple_myeloma,c(exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_multiple_myeloma)<-c("OR_1","OR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_multiple_myeloma<-data.frame(result_multiple_myeloma)
result_multiple_myeloma<-result_multiple_myeloma%>% mutate(cancer=c("multiple_myeloma"),.before=OR_1)
#leukemia
data_leukemia<-subset(UKBdata2,various_cancer=="leukemia"|various_cancer==0)
table(data_leukemia$MIND_sum1_3group)
table(data_leukemia$MIND_sum1_3group,data_leukemia$status)
table(data_leukemia$MEDAS_sum1_3group)
table(data_leukemia$MEDAS_sum1_3group,data_leukemia$status)
rm(data_testic,data_thyroid,data_uterine)
result_leukemia<-c()
for (i in data_leukemia[,c(268,267)]){
  data_leukemia$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_leukemia)
  result_leukemia<-rbind(result_leukemia,c(exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_leukemia)<-c("OR_1","OR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_leukemia<-data.frame(result_leukemia)
result_leukemia<-result_leukemia%>% mutate(cancer=c("leukemia"),.before=OR_1)
#合并
result_various_cancer<-rbind(result_head,result_Esophagus,result_stomach,result_colorectal,
                             result_liver,result_gallbladder,result_pancreas,result_lung,result_malignant_melanoma,
                             result_breast,result_uterine,result_ovary,result_prostate,result_testic,
                             result_kidney,result_bladder,result_brain,result_thyroid,result_Hodgkin_lymphoma,
                             result_non_Hodgkin_lymphoma,result_multiple_myeloma,result_leukemia)
write.csv(result_various_cancer,"E:/deskbook/various_cancer.csv",row.names = F)
colnames(UKBdata2)
#Figure3####
#head#
rm(list=ls())
library(readr)
figure3_head<-read_csv("E:/deskbook/figure3_head.csv")
colnames(figure3_head)
library(ggplot2)
figure3_head$X<-factor(figure3_head$X,levels = c("MEDAS_tertile2","MEDAS_tertile3","MIND_tertile2","MIND_tertile3"))
p1<-ggplot(figure3_head,aes(x=X,y=Y))+
  geom_line(size=0.75)+
  geom_point(size=4)+
  geom_errorbar(aes(ymin=LCL,ymax=UCL),width=0.06,size=0.75)+
  xlab("Diet Adherence")+ylab("HR (95%CI)")+theme_classic()+geom_hline(aes(yintercept=1),linetype="dashed")+#加一条虚线
  scale_y_continuous(breaks = seq(0.3,1.6,0.2),limits = c(0.3,1.6))+
  theme(axis.text.x = element_text(size = 16, face = "bold"))+theme(axis.text.y = element_text(size = 16, face = "bold",color="black"))+#加粗刻度
  theme(axis.title.x = element_text(size = 16, face = "bold"))+theme(axis.title.y = element_text(size = 16, face = "bold"))+#加粗文字
  ggtitle("Head and neck cancer")+theme(plot.title = element_text(hjust = 0.5))+
  theme(plot.title=element_text(size=20,face="bold"),
        axis.title.y = element_blank(),
        axis.title.x = element_blank(),
        axis.text.x =element_blank())
#Esophagus cancer
figure3_esophagus<-read_csv("E:/deskbook/figure3_esophagus.csv")
figure3_esophagus$X<-factor(figure3_esophagus$X,levels = c("MEDAS_tertile2","MEDAS_tertile3","MIND_tertile2","MIND_tertile3"))
p2<-ggplot(figure3_esophagus,aes(x=X,y=Y))+
  geom_line(size=0.75)+
  geom_point(size=4)+
  geom_errorbar(aes(ymin=LCL,ymax=UCL),colour="black",width=0.06,size=0.75)+
  xlab("Diet Adherence")+ylab("HR(95%CI)")+theme_classic()+geom_hline(aes(yintercept=1),linetype="dashed")+#加一条虚线
  scale_y_continuous(breaks = seq(0.3,1.6,0.2),limits = c(0.3,1.6))+
  theme(axis.text.x = element_text(size = 16, face = "bold"))+theme(axis.text.y = element_text(size = 16, face = "bold",color="black"))+#加粗刻度
  theme(axis.title.x = element_text(size = 16, face = "bold"))+theme(axis.title.y = element_text(size = 16, face = "bold"))+#加粗文字
  ggtitle("Esophagus cancer")+theme(plot.title = element_text(hjust = 0.5))+
  theme(plot.title=element_text(size=20,face="bold"),
        axis.title.y = element_blank(),
        axis.title.x = element_blank(),
        axis.text.x =element_blank())
#Colorectal cancer
figure3_esophagus<-read_csv("E:/deskbook/figure3_esophagus.csv")
figure3_esophagus$X<-factor(figure3_esophagus$X,levels = c("MEDAS_tertile2","MEDAS_tertile3","MIND_tertile2","MIND_tertile3"))
p4<-ggplot(figure3_esophagus,aes(x=X,y=Y))+
  geom_line(size=0.75)+
  geom_point(size=4)+
  geom_errorbar(aes(ymin=LCL,ymax=UCL),colour="black",width=0.06,size=0.75)+
  xlab("Diet Adherence")+ylab("HR(95%CI)")+theme_classic()+geom_hline(aes(yintercept=1),linetype="dashed")+#加一条虚线
  scale_y_continuous(breaks = seq(0.3,1.6,0.2),limits = c(0.3,1.6))+
  theme(axis.text.x = element_text(size = 16, face = "bold"))+theme(axis.text.y = element_text(size = 16, face = "bold",color = "black"))+#加粗刻度
  theme(axis.title.x = element_text(size = 16, face = "bold"))+theme(axis.title.y = element_text(size = 16, face = "bold"))+#加粗文字
  ggtitle("Colorectal cancer")+theme(plot.title = element_text(hjust = 0.5))+
  theme(plot.title=element_text(size=20,face="bold"),
        axis.title.y = element_blank(),
        axis.title.x = element_blank(),
        axis.text.x =element_blank())
#Lung cancer
figure3_esophagus<-read_csv("E:/deskbook/figure3_esophagus.csv")
figure3_esophagus$X<-factor(figure3_esophagus$X,levels = c("MEDAS_tertile2","MEDAS_tertile3","MIND_tertile2","MIND_tertile3"))
p8<-ggplot(figure3_esophagus,aes(x=X,y=Y))+
  geom_line(size=0.75)+
  geom_point(size=4)+
  geom_errorbar(aes(ymin=LCL,ymax=UCL),colour="black",width=0.06,size=0.75)+
  xlab("Diet Adherence")+ylab("HR(95%CI)")+theme_classic()+geom_hline(aes(yintercept=1),linetype="dashed")+#加一条虚线
  scale_y_continuous(breaks = seq(0.3,1.6,0.2),limits = c(0.3,1.6))+
  theme(axis.text.x = element_text(size = 16, face = "bold"))+theme(axis.text.y = element_text(size = 16, face = "bold",color = "black"))+#加粗刻度
  theme(axis.title.x = element_text(size = 16, face = "bold"))+theme(axis.title.y = element_text(size = 16, face = "bold"))+#加粗文字
  ggtitle("Lung cancer")+theme(plot.title = element_text(hjust = 0.5))+
  theme(plot.title=element_text(size=20,face="bold"),
        axis.title.y = element_blank(),
        axis.title.x = element_blank(),
        axis.text.x =element_blank())
#Malignant melanoma
figure3_esophagus<-read_csv("E:/deskbook/figure3_esophagus.csv")
figure3_esophagus$X<-factor(figure3_esophagus$X,levels = c("MEDAS_tertile2","MEDAS_tertile3","MIND_tertile2","MIND_tertile3"))
p9<-ggplot(figure3_esophagus,aes(x=X,y=Y))+
  geom_line(size=0.75)+
  geom_point(size=4)+
  geom_errorbar(aes(ymin=LCL,ymax=UCL),colour="black",width=0.06,size=0.75)+
  xlab("Diet Adherence")+ylab("HR(95%CI)")+theme_classic()+geom_hline(aes(yintercept=1),linetype="dashed")+#加一条虚线
  scale_y_continuous(breaks = seq(0.3,1.6,0.2),limits = c(0.3,1.6))+
  theme(axis.text.x = element_text(size = 16, face = "bold"))+theme(axis.text.y = element_text(size = 16, face = "bold",color="black"))+#加粗刻度
  theme(axis.title.x = element_text(size = 16, face = "bold"))+theme(axis.title.y = element_text(size = 16, face = "bold"))+#加粗文字
  ggtitle("Malignant melanoma")+theme(plot.title = element_text(hjust = 0.5))+
  theme(plot.title=element_text(size=20,face="bold"),
        axis.title.y = element_blank(),
        axis.title.x = element_blank(),
        axis.text.x =element_blank())
#Breast cancer
figure3_esophagus<-read_csv("E:/deskbook/figure3_esophagus.csv")
figure3_esophagus$X<-factor(figure3_esophagus$X,levels = c("MEDAS_tertile2","MEDAS_tertile3","MIND_tertile2","MIND_tertile3"))
p10<-ggplot(figure3_esophagus,aes(x=X,y=Y))+
  geom_line(size=0.75)+
  geom_point(size=4)+
  geom_errorbar(aes(ymin=LCL,ymax=UCL),colour="black",width=0.06,size=0.75)+
  xlab("Diet Adherence")+ylab("HR(95%CI)")+theme_classic()+geom_hline(aes(yintercept=1),linetype="dashed")+#加一条虚线
  scale_y_continuous(breaks = seq(0.3,1.6,0.2),limits = c(0.3,1.6))+
  theme(axis.text.x = element_text(size = 16, face = "bold"))+theme(axis.text.y = element_text(size = 16, face = "bold",color="black"))+#加粗刻度
  theme(axis.title.x = element_text(size = 16, face = "bold"))+theme(axis.title.y = element_text(size = 16, face = "bold"))+#加粗文字
  ggtitle("Breast cancer")+theme(plot.title = element_text(hjust = 0.5))+
  theme(plot.title=element_text(size=20,face="bold"),
        axis.title.y = element_blank(),
        axis.title.x = element_blank(),
        axis.text.x =element_blank())
#Uterus and cervix cancer
figure3_esophagus<-read_csv("E:/deskbook/figure3_esophagus.csv")
figure3_esophagus$X<-factor(figure3_esophagus$X,levels = c("MEDAS_tertile2","MEDAS_tertile3","MIND_tertile2","MIND_tertile3"))
p11<-ggplot(figure3_esophagus,aes(x=X,y=Y))+
  geom_line(size=0.75)+
  geom_point(size=4)+
  geom_errorbar(aes(ymin=LCL,ymax=UCL),colour="black",width=0.06,size=0.75)+
  xlab("Diet Adherence")+ylab("HR(95%CI)")+theme_classic()+geom_hline(aes(yintercept=1),linetype="dashed")+#加一条虚线
  scale_y_continuous(breaks = seq(0.3,1.6,0.2),limits = c(0.3,1.6))+
  theme(axis.text.x = element_text(size = 16, face = "bold"))+theme(axis.text.y = element_text(size = 16, face = "bold",color="black"))+#加粗刻度
  theme(axis.title.x = element_text(size = 16, face = "bold"))+theme(axis.title.y = element_text(size = 16, face = "bold"))+#加粗文字
  ggtitle("Uterus and cervix cancer")+theme(plot.title = element_text(hjust = 0.5))+
  theme(plot.title=element_text(size=20,face="bold"),
        axis.title.y = element_blank(),
        axis.title.x = element_blank(),
        axis.text.x =element_blank())
#Prostate cancer
figure3_esophagus<-read_csv("E:/deskbook/figure3_esophagus.csv")
figure3_esophagus$X<-factor(figure3_esophagus$X,levels = c("MEDAS_tertile2","MEDAS_tertile3","MIND_tertile2","MIND_tertile3"))
p13<-ggplot(figure3_esophagus,aes(x=X,y=Y))+
  geom_line(size=0.75)+
  geom_point(size=4)+
  geom_errorbar(aes(ymin=LCL,ymax=UCL),colour="black",width=0.06,size=0.75)+
  xlab("Diet Adherence")+ylab("HR(95%CI)")+theme_classic()+geom_hline(aes(yintercept=1),linetype="dashed")+#加一条虚线
  scale_y_continuous(breaks = seq(0.3,1.6,0.2),limits = c(0.3,1.6))+
  theme(axis.text.x = element_text(size = 16, face = "bold"))+theme(axis.text.y = element_text(size = 16, face = "bold",color="black"))+#加粗刻度
  theme(axis.title.x = element_text(size = 16, face = "bold"))+theme(axis.title.y = element_text(size = 16, face = "bold"))+#加粗文字
  ggtitle("Prostate cancer")+theme(plot.title = element_text(hjust = 0.5))+
  theme(plot.title=element_text(size=20,face="bold"),
        axis.title.y = element_blank(),
        axis.title.x = element_blank(),
        axis.text.x =element_blank())
#Testis cancer
figure3_esophagus<-read_csv("E:/deskbook/figure3_esophagus.csv")
figure3_esophagus$X<-factor(figure3_esophagus$X,levels = c("MEDAS_tertile2","MEDAS_tertile3","MIND_tertile2","MIND_tertile3"))
p14<-ggplot(figure3_esophagus,aes(x=X,y=Y))+
  geom_line(size=0.75)+
  geom_point(size=4)+
  geom_errorbar(aes(ymin=LCL,ymax=UCL),colour="black",width=0.06,size=0.75)+
  xlab("Diet Adherence")+ylab("HR(95%CI)")+theme_classic()+geom_hline(aes(yintercept=1),linetype="dashed")+#加一条虚线
  scale_y_continuous(breaks = seq(0.2,1.7,0.3),limits = c(0.2,1.7))+
  theme(axis.text.x = element_text(size = 16, face = "bold"))+theme(axis.text.y = element_text(size = 16, face = "bold",color="black"))+#加粗刻度
  theme(axis.title.x = element_text(size = 16, face = "bold"))+theme(axis.title.y = element_text(size = 16, face = "bold"))+#加粗文字
  ggtitle("Testis cancer")+theme(plot.title = element_text(hjust = 0.5))+
  theme(plot.title=element_text(size=20,face="bold"),
        axis.title.y = element_blank(),
        axis.title.x = element_blank(),
        axis.text.x =element_blank())
#Kidney cancer
figure3_esophagus<-read_csv("E:/deskbook/figure3_esophagus.csv")
figure3_esophagus$X<-factor(figure3_esophagus$X,levels = c("MEDAS_tertile2","MEDAS_tertile3","MIND_tertile2","MIND_tertile3"))
p15<-ggplot(figure3_esophagus,aes(x=X,y=Y))+
  geom_line(size=0.75)+
  geom_point(size=4)+
  geom_errorbar(aes(ymin=LCL,ymax=UCL),colour="black",width=0.06,size=0.75)+
  xlab("Diet Adherence")+ylab("HR(95%CI)")+theme_classic()+geom_hline(aes(yintercept=1),linetype="dashed")+#加一条虚线
  scale_y_continuous(breaks = seq(0.3,1.6,0.2),limits = c(0.29,1.6))+
  theme(axis.text.x = element_text(size = 16, face = "bold"))+theme(axis.text.y = element_text(size = 16, face = "bold",color="black"))+#加粗刻度
  theme(axis.title.x = element_text(size = 16, face = "bold"))+theme(axis.title.y = element_text(size = 16, face = "bold"))+#加粗文字
  ggtitle("Kidney cancer")+theme(plot.title = element_text(hjust = 0.5))+
  theme(plot.title=element_text(size=20,face="bold"),
        axis.title.y = element_blank(),
        axis.title.x = element_blank(),
        axis.text.x =element_blank())
#Bladder cancer
figure3_esophagus<-read_csv("E:/deskbook/figure3_esophagus.csv")
figure3_esophagus$X<-factor(figure3_esophagus$X,levels = c("MEDAS_tertile2","MEDAS_tertile3","MIND_tertile2","MIND_tertile3"))
p16<-ggplot(figure3_esophagus,aes(x=X,y=Y))+
  geom_line(size=0.75)+
  geom_point(size=4)+
  geom_errorbar(aes(ymin=LCL,ymax=UCL),colour="black",width=0.06,size=0.75)+
  xlab("Diet Adherence")+ylab("HR(95%CI)")+theme_classic()+geom_hline(aes(yintercept=1),linetype="dashed")+#加一条虚线
  scale_y_continuous(breaks = seq(0.3,1.6,0.2),limits = c(0.3,1.6))+
  theme(axis.text.x = element_text(size = 16, face = "bold"))+theme(axis.text.y = element_text(size = 16, face = "bold",color="black"))+#加粗刻度
  theme(axis.title.x = element_text(size = 16, face = "bold"))+theme(axis.title.y = element_text(size = 16, face = "bold"))+#加粗文字
  ggtitle("Bladder cancer")+theme(plot.title = element_text(hjust = 0.5))+
  theme(plot.title=element_text(size=20,face="bold"),
        axis.title.y = element_blank(),
        axis.title.x = element_blank(),
        axis.text.x =element_blank())
#Brain cancer
figure3_esophagus<-read_csv("E:/deskbook/figure3_esophagus.csv")
figure3_esophagus$X<-factor(figure3_esophagus$X,levels = c("MEDAS_tertile2","MEDAS_tertile3","MIND_tertile2","MIND_tertile3"))
p17<-ggplot(figure3_esophagus,aes(x=X,y=Y))+
  geom_line(size=0.75)+
  geom_point(size=4)+
  geom_errorbar(aes(ymin=LCL,ymax=UCL),colour="black",width=0.06,size=0.75)+
  xlab("Diet Adherence")+ylab("HR(95%CI)")+theme_classic()+geom_hline(aes(yintercept=1),linetype="dashed")+#加一条虚线
  scale_y_continuous(breaks = seq(0.3,1.6,0.2),limits = c(0.29,1.6))+
  theme(axis.text.x = element_text(size = 16, face = "bold"))+theme(axis.text.y = element_text(size = 16, face = "bold",color="black"))+#加粗刻度
  theme(axis.title.x = element_text(size = 16, face = "bold"))+theme(axis.title.y = element_text(size = 16, face = "bold"))+#加粗文字
  ggtitle("Brain cancer")+theme(plot.title = element_text(hjust = 0.5))+
  theme(plot.title=element_text(size=20,face="bold"),
        axis.title.y = element_blank(),
        axis.title.x = element_blank(),
        axis.text.x =element_blank())
#Thyroid cancer
figure3_esophagus<-read_csv("E:/deskbook/figure3_esophagus.csv")
figure3_esophagus$X<-factor(figure3_esophagus$X,levels = c("MEDAS_tertile2","MEDAS_tertile3","MIND_tertile2","MIND_tertile3"))
p18<-ggplot(figure3_esophagus,aes(x=X,y=Y))+
  geom_line(size=0.75)+
  geom_point(size=4)+
  geom_errorbar(aes(ymin=LCL,ymax=UCL),colour="black",width=0.06,size=0.75)+
  xlab("Diet Adherence")+ylab("HR(95%CI)")+theme_classic()+geom_hline(aes(yintercept=1),linetype="dashed")+#加一条虚线
  scale_y_continuous(breaks = seq(0.2,1.6,0.2),limits = c(0.2,1.6))+
  theme(axis.text.x = element_text(size = 16, face = "bold"))+theme(axis.text.y = element_text(size = 16, face = "bold",color="black"))+#加粗刻度
  theme(axis.title.x = element_text(size = 16, face = "bold"))+theme(axis.title.y = element_text(size = 16, face = "bold"))+#加粗文字
  ggtitle("Thyroid cancer")+theme(plot.title = element_text(hjust = 0.5))+
  theme(plot.title=element_text(size=20,face="bold"),
        axis.title.y = element_blank(),
        axis.title.x = element_blank(),
        axis.text.x =element_blank())
#Non–Hodgkin lymphoma
figure3_esophagus<-read_csv("E:/deskbook/figure3_esophagus.csv")
figure3_esophagus$X<-factor(figure3_esophagus$X,levels = c("MEDAS_tertile2","MEDAS_tertile3","MIND_tertile2","MIND_tertile3"))
p20<-ggplot(figure3_esophagus,aes(x=X,y=Y))+
  geom_line(size=0.75)+
  geom_point(size=4)+
  geom_errorbar(aes(ymin=LCL,ymax=UCL),colour="black",width=0.06,size=0.75)+
  xlab("Diet Adherence")+ylab("HR(95%CI)")+theme_classic()+geom_hline(aes(yintercept=1),linetype="dashed")+#加一条虚线
  scale_y_continuous(breaks = seq(0.3,1.6,0.2),limits = c(0.3,1.6))+
  theme(axis.text.x = element_text(size = 16, face = "bold"))+theme(axis.text.y = element_text(size = 16, face = "bold",color="black"))+#加粗刻度
  theme(axis.title.x = element_text(size = 16, face = "bold"))+theme(axis.title.y = element_text(size = 16, face = "bold"))+#加粗文字
  ggtitle("Non–Hodgkin lymphoma")+theme(plot.title = element_text(hjust = 0.5))+
  theme(plot.title=element_text(size=20,face="bold"),
        axis.title.y = element_blank(),
        axis.title.x = element_blank(),
        axis.text.x =element_blank())
#Multiple myeloma
figure3_esophagus<-read_csv("E:/deskbook/figure3_esophagus.csv")
figure3_esophagus$X<-factor(figure3_esophagus$X,levels = c("MEDAS_tertile2","MEDAS_tertile3","MIND_tertile2","MIND_tertile3"))
p21<-ggplot(figure3_esophagus,aes(x=X,y=Y))+
  geom_line(size=0.75)+
  geom_point(size=4)+
  geom_errorbar(aes(ymin=LCL,ymax=UCL),colour="black",width=0.06,size=0.75)+
  xlab("Diet Adherence")+ylab("HR(95%CI)")+theme_classic()+geom_hline(aes(yintercept=1),linetype="dashed")+#加一条虚线
  scale_y_continuous(breaks = seq(0.3,1.6,0.2),limits = c(0.3,1.6))+
  theme(axis.text.x = element_text(size = 16, face = "bold"))+theme(axis.text.y = element_text(size = 16, face = "bold",color="black"))+#加粗刻度
  theme(axis.title.x = element_text(size = 16, face = "bold"))+theme(axis.title.y = element_text(size = 16, face = "bold"))+#加粗文字
  ggtitle("Multiple myeloma")+theme(plot.title = element_text(hjust = 0.5))+
  theme(plot.title=element_text(size=20,face="bold"),
        axis.title.y = element_blank(),
        axis.title.x = element_blank(),
        axis.text.x =element_blank())
#Leukemia
figure3_esophagus<-read_csv("E:/deskbook/figure3_esophagus.csv")
figure3_esophagus$X<-factor(figure3_esophagus$X,levels = c("MEDAS_tertile2","MEDAS_tertile3","MIND_tertile2","MIND_tertile3"),
                            labels = c("T21","T31","T22","T32"))
p22<-ggplot(figure3_esophagus,aes(x=X,y=Y))+
  geom_line(size=0.75)+
  geom_point(size=4)+
  geom_errorbar(aes(ymin=LCL,ymax=UCL),colour="black",width=0.06,size=0.75)+
  xlab("Diet Adherence")+ylab("HR(95%CI)")+theme_classic()+geom_hline(aes(yintercept=1),linetype="dashed")+#加一条虚线
  scale_y_continuous(breaks = seq(0.3,1.6,0.2),limits = c(0.3,1.6))+
  theme(axis.text.x = element_text(size = 16, face = "bold"))+theme(axis.text.y = element_text(size = 16, face = "bold",color="black"))+#加粗刻度
  theme(axis.title.x = element_text(size = 16, face = "bold"))+theme(axis.title.y = element_text(size = 16, face = "bold"))+#加粗文字
  ggtitle("Leukemia")+theme(plot.title = element_text(hjust = 0.5))+
  theme(plot.title=element_text(size=20,face="bold"),
        axis.title.y = element_blank(),
        axis.title.x = element_blank(),
        axis.text.x =element_blank())
p23<-ggplot(figure3_esophagus,aes(x=X,y=Y))+
  geom_line(size=0.75)+
  geom_point(size=4)+
  geom_errorbar(aes(ymin=LCL,ymax=UCL),colour="black",width=0.06,size=0.75)+
  xlab("Diet Adherence")+ylab("HR(95%CI)")+theme_classic()+geom_hline(aes(yintercept=1),linetype="dashed")+#加一条虚线
  scale_y_continuous(breaks = seq(0.3,1.6,0.2),limits = c(0.3,1.6))+
  theme(axis.text.x = element_text(size = 16, face = "bold",angle=0,color="black"))+theme(axis.text.y = element_text(size = 16, face = "bold",color="black"))+#加粗刻度
  theme(axis.title.x = element_text(size = 16, face = "bold"))+theme(axis.title.y = element_text(size = 20, face = "bold"))+#加粗文字
  ggtitle("Leukemia")+theme(plot.title = element_text(hjust = 0.5))+
  theme(plot.title=element_text(size=20,face="bold"),
        axis.title.x = element_blank())
#合并图片大小20*4
library(gridExtra)
grid.arrange(p1, p2, p4, p8,nrow = 1)
grid.arrange(p9, p10, p11, p13,nrow = 1)
grid.arrange(p14, p15, p16, p17,nrow = 1)
grid.arrange(p18, p20, p21, p22,nrow = 1)
#导入NMR的数据####
rm(list=ls())
NMR<-fread("E:/deskbook/NMR.csv",header=T)
colnames(NMR)
NMR_subset1<-subset(NMR,select=c(2:337))
NMR_subset2<-subset(NMR,select=c(1))
colnames(NMR)
# 筛选出基线随访的列
selected_columns <- which(seq_len(ncol(NMR_subset1)) %% 2 == 1)
# 按照条件对列进行排序
sorted_columns <- c(selected_columns, setdiff(seq_len(ncol(NMR_subset1)), selected_columns))
# 根据排序后的列名生成新的数据框
new_data1 <- NMR_subset1[, ..sorted_columns]
colnames(new_data1)
NMR_subset1<-subset(new_data1 ,select=c(1:168))
NMR<-cbind(NMR_subset2,NMR_subset1)
colnames(NMR)
#删除缺失NMR的数据，剩余274351
library(tidyverse)
NMR2<-NMR%>%filter(!(is.na(`23409-0.0`)&is.na(`23410-0.0`)&
                       is.na(`23578-0.0`)&is.na(`23552-0.0`)&
                       is.na(`23467-0.0`)&is.na(`23575-0.0`)))
#合并在excel整理的ICD数据
ICD<-fread("E:/deskbook/ICD.csv",header=T)
colnames(ICD)
ICD<-subset(ICD,select=c(1,9,11,10,57))
NMR3<-merge(NMR2,ICD,by='eid',all.x = T)
#排除基线患有恶性肿瘤的,剩余250976例
NMR4<-filter(NMR3,Exclusion_1==0) #剩余250976例
#删除基线使用降脂药,剩余206904
medication<-fread("E:/deskbook/medication.csv",header=T)
colnames(medication)
table(medication$medication)
NMR5<-merge(NMR4,medication,by='eid',all.x = T)
NMR6<-filter(NMR5,medication==0)#剩余206904
#合并家族史和教育程度
education<-fread("E:/deskbook/education_family_history.csv",header=T)#3 variable
NMR7<-merge(NMR6,education,by='eid',all.x = T) #206904 obs 176 vars
NMR7$education[NMR7$education==3]<-NA
NMR7$famaliy_history[NMR7$famaliy_history==3]<-NA
#导入cov
cov<-fread("E:/deskbook/cov.csv",header=T)
#整理变量
cov$shifang<-cov$`190-0.0`
cov$whr<-cov$`48-0.0`/cov$`49-0.0`
cov$household_income<-ifelse(cov$`738-0.0`<=2,0,1)
cov$weekly_activity<-ifelse(cov$`884-0.0`>=0&cov$`904-0.0`>=0,
                            rowMeans((select(cov,c(`884-0.0`,`904-0.0`)))),
                            ifelse(cov$`884-0.0`<0&cov$`904-0.0`<0,NA,
                                   ifelse(cov$`884-0.0`<0,cov$`904-0.0`,
                                          ifelse(cov$`904-0.0`<0,cov$`884-0.0`,0))))
cov$`1160-0.0`[cov$`1160-0.0`<=0]<-NA
cov$sleep_duration<-cov$`1160-0.0`
cov$smoking_status<-ifelse(cov$`1239-0.0`==1|cov$`1239-0.0`==2,3,ifelse(
  cov$`1249-0.0`==1,2,ifelse(cov$`1249-0.0`==2,1,
                             ifelse(cov$`1249-0.0`==3,0,
                                    ifelse(cov$`1249-0.0`==4,0,ifelse(cov$`1239-0.0`==0,0,NA))))))
cov$smoking_status<-factor(cov$smoking_status,levels=c(0,1,2,3),labels = c("Never","Former occasional smoker","Former regular smoker","Current somker"))
cov$alochol_drinking<-ifelse(cov$`1558-0.0`<=3&cov$`1558-0.0`>=1,2,
                             ifelse(cov$`1558-0.0`>=4&cov$`1558-0.0`<=5,1,
                                    ifelse(cov$`1558-0.0`==6,0,NA)))
cov$alochol_drinking<-factor(cov$alochol_drinking,levels = c(0,1,2),labels = c("Never","Occasional drinker","Regular drinker"))
cov$SBP<-cov$`4080-0.0`
cov$BMI<-cov$`21001-0.0`
cov$recruitment_age<-cov$`21022-0.0`
cov$sex<-cov$`31-0.0`
cov$Townsend_deprivation_index<-cov$`189-0.0`
colnames(cov)
cov2<-subset(cov,select=c(1,533:544))
NMR8<-merge(NMR7,cov2,by="eid",all.x = T)
colnames(NMR8)
#删除失访的人群
NMR8<-NMR8%>%filter(is.na(shifang))# 原来有206904，剩余206361
#删除协变量缺失值 剩余202303 obs
NMR9<-NMR8%>%filter(!(is.na(famaliy_history)|is.na(education)|
                        is.na(Townsend_deprivation_index)|is.na(whr)|
                        is.na(BMI)|is.na(smoking_status)|is.na(alochol_drinking)|
                        is.na(household_income)))
colnames(NMR9)
missing_vals<-colSums(is.na(NMR9))
print(missing_vals)
#将NMR的缺失值替换成最小值的二分之一
NMR9_1<-subset(NMR9,select=c(2:169))
NMR9_2<-subset(NMR9,select=c(1,170,173,175:176,178:188))
for (i in 1:ncol(NMR9_1)) {
  col_min <- min(NMR9_1[[i]], na.rm = TRUE) # get the minimum value of the column
  NMR9_1[is.na(NMR9_1[[i]]), i] <- col_min / 2 # replace missing values with half of the minimum
}
summary(NMR9_1)
missing_vals<-colSums(is.na(NMR9_1))
print(missing_vals)
#使用插补法填补基本特征
library(mice)
colnames(NMR9_2)
tianbu<-mice(NMR9_2[,2:16],m=5)
#插入填补数据
tianbu2<-complete(tianbu,action=2)
tianbu2$Townsend_deprivation_index2 <- cut(tianbu2$Townsend_deprivation_index, breaks = quantile(tianbu2$Townsend_deprivation_index, probs = c(0, 0.33, 0.66, 1)), include.lowest = TRUE, labels = FALSE)#三分位分组
NMR9_2_2<-subset(NMR9_2,select=c(1))
NMR9_2<-cbind(NMR9_2_2,tianbu2)
#对代谢物进行log(x+1)转化和归一化####
n<-nrow(NMR9_1)
log_NMR9_1<-data.frame(matrix(0,n,ncol(NMR9_1)))
for (i in 1:ncol(NMR9_1)){
  log_NMR9_1[[i]]<-log(NMR9_1[[i]]+1)
}
names(log_NMR9_1)<-names(NMR9_1)
log_NMR9_1<-scale(log_NMR9_1)
#合并数据得到NMR9
NMR9<-cbind(NMR9_2,log_NMR9_1)
colnames(NMR9)
write_excel_csv(NMR9,"E:/deskbook/NMR9.csv")
#读取NMR9的数据####
NMR9<-fread("E:/deskbook/NMR9.csv",header=T)
#基线特征比较Table S7####
table(NMR9$various_cancer)
NMR9$status<-ifelse(NMR9$pan_cancer==0,0,1)
NMR9$various_cancer[NMR9$various_cancer == ""] <- "0"
NMR9$various_cancer[NMR9$various_cancer == "#N/A"] <- "9"
NMR9$various_cancer[NMR9$various_cancer == "non-Hodgkin_lymphoma"] <- "non_Hodgkin_lymphoma"
NMR9$various_cancer[NMR9$various_cancer == "throid"] <- "thyroid"
NMR9$various_cancer[NMR9$various_cancer == "cervix"|NMR9$various_cancer == "uterine"] <- "uterus_cervix"
colnames(NMR9)
vars<-colnames(NMR9[,c(4:17)])
catvars<-colnames(NMR9[,c(4:5,7,10:11,17,15)])
vars2<-colnames(NMR9[,c(6,8:9,12:14)])
library(tableone)
tableS7<-CreateTableOne(vars=vars,strata="status",data=NMR9,
                        factorVars =catvars,addOverall = T)
tableS7_1<-print(tableS7, quote = FALSE, noSpaces = TRUE, printToggle = FALSE,showAllLevels = T,
                 nonnormal=vars2)
write.csv(tableS7_1,"E:/deskbook/tableS7_1.csv")
#读取NMR9的数据####
library(data.table)
library(tidyverse)
library(survival)
NMR9<-fread("E:/deskbook/NMR9.csv",header=T)
NMR9$status<-ifelse(NMR9$pan_cancer==0,0,1)
NMR9$various_cancer[NMR9$various_cancer == ""] <- 0
NMR9$various_cancer[NMR9$various_cancer == "#N/A"] <- "9"
NMR9$various_cancer[NMR9$various_cancer == "non-Hodgkin_lymphoma"] <- "non_Hodgkin_lymphoma"
NMR9$various_cancer[NMR9$various_cancer == "throid"] <- "thyroid"
NMR9$various_cancer[NMR9$various_cancer == "cervix"|NMR9$various_cancer == "uterine"] <- "uterus_cervix"
table(NMR9$status)
table(NMR9$various_cancer)
#划分为训练集，测试集####
library(glmnet)
library(caret)
colnames(NMR9)
set.seed(777)
training.samples <- NMR9$status %>%
  createDataPartition(p = 0.6, list = FALSE)
train_data<- NMR9[training.samples, ]
test_data<- NMR9[-training.samples, ]
table(train_data$status)#103106 control 18276cases
table(test_data$status)#68586 control 12335cases
table(test_data$various_cancer)
#算比例
table(test_data$pan_cancer)/sum(table(test_data$pan_cancer))*100
table(test_data$various_cancer)/sum(table(test_data$various_cancer))*100
#筛选训练集中与结局有关的代谢物####
#使用Model 4去筛选与结局有关的代谢物(排除energy)
library(survival)
colnames(train_data)
result<-c()
for (i in train_data[,18:185]){
  fiti<-coxph(Surv(recruitment_age,status)~i+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=train_data)
  result<-rbind(result,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)],summary(fiti)$coef[1,5]))
}
colnames(result)<-c("HR","LCL","UCL","P")
write.csv(result,"E:/deskbook/supplement_table_8.csv",row.names = F)
#得到FDR
library(dplyr)#排序整理数据
supplement_table_8<-read.csv("E:/deskbook/supplement_table_8.csv")
#整体计算FDR
supplement_table_8<-supplement_table_8[order(supplement_table_8$P),]#需对P值先排序
supplement_table_8$BH<-p.adjust(supplement_table_8$P,method="bonferroni")
#shuchu
write.csv(supplement_table_8,"E:/deskbook/supplement_table_8.csv")
#使用net筛选需要的代谢物####
#先筛选出FDR<0.05的代谢物 115种
colnames(train_data)
metabolites<-subset(train_data,select=-c(1:17,24:26,48:50,67:68:75,78:79,82,87:108,115,122,157,
                                         172:176,178:186))
# Build the model using the training set
#生存状态和生存时间需转化为double类型
library(survival)
colnames(train_data)
train_data$recruitment_age<-as.double(train_data$recruitment_age)
train_data$status<-as.double(train_data$status)
y<-as.matrix(Surv(time=train_data$recruitment_age,event=train_data$status))
x<-as.matrix(metabolites)
rownames(x)<-paste0("S",c(1:nrow(x)))#这步变成numeric
#构建模型用deviance
set.seed(1000)
net.fit1<-cv.glmnet(x,y,family="cox",type.measure = "deviance",alpha=0.5,nfolds = 10)
net.fit2<-cv.glmnet(x,y,family="cox",type.measure = "deviance",alpha=0.75,nfolds = 10)
net.fit3<-cv.glmnet(x,y,family="cox",type.measure = "deviance",alpha=1,nfolds = 10)
net.fit5<-cv.glmnet(x,y,family="cox",type.measure = "deviance",alpha=0.25,nfolds = 10)
#合并几个比较#之前的尝试
install.packages("viridis")
library(viridis)
viridis_pal()(5)
par(mfrow = c(2,2))
plot(net.fit1); plot(net.fit2); plot(net.fit3);plot(net.fit4)
plot(net.fit5)
plot(log(net.fit1$lambda), net.fit1$cvm , pch = 19, col = "#ffd401",
     xlab = "log(λ)", ylab = net.fit1$name)

points(log(net.fit2$lambda), net.fit2$cvm, pch = 19, col = "#00b0eb")
points(log(net.fit3$lambda) , net.fit3$cvm , pch = 19, col = "#e20612")
legend("topleft", legend = c("alpha=0.50", "alpha=0.75", "alpha=1.00"),
       pch = 19, col = c("#ffd401","#00b0eb","#e20612"),x.intersp=0.6, y.intersp=0.8)
#
plot(net.fit5)
legend("topleft", legend ="alpha=0.25", 
       pch = 19, col = "#ffd401",x.intersp=0.6, y.intersp=0.8)
plot(net.fit1, col = "#00b0eb")
legend("topleft", legend ="alpha=0.50", 
       pch = 19, col = "#00b0eb",x.intersp=0.6, y.intersp=0.8)
plot(net.fit2, col = "#e20612")
legend("topleft", legend ="alpha=0.75", 
       pch = 19, col = "#e20612",x.intersp=0.6, y.intersp=0.8)
plot(net.fit3, col = "#21908CFF")
legend("topleft", legend ="alpha=1.00", 
       pch = 19, col = "#21908CFF",x.intersp=0.6, y.intersp=0.8)
#看分别是啥
net.fit_1<-glmnet(x,y,family="cox",alpha = 0.5,lambda =net.fit1$lambda.1se)
net.fit_1[["beta"]]
net.fit_2<-glmnet(x,y,family="cox",alpha = 0.75,lambda =net.fit2$lambda.1se)
net.fit_2[["beta"]]
net.fit_3<-glmnet(x,y,family="cox",alpha = 1.00,lambda =net.fit3$lambda.1se)
net.fit_3[["beta"]]
net.fit_4<-glmnet(x,y,family="cox",alpha = 0.00,lambda =net.fit4$lambda.1se)
net.fit_4[["beta"]]
net.fit_5<-glmnet(x,y,family="cox",alpha = 0.25,lambda =net.fit5$lambda.1se)
net.fit_5[["beta"]]
#梯度提升树（Gradient Boosting Trees)筛选变量#####
colnames(train_data)
train_data_1<-subset(train_data,select = c(42,52,53,55,57,60,65,76,77,80:81,83:86,117,128,
                                           130,135,137,166))
train_data_2<-subset(train_data,select = c(14,186))
colnames(train_data_1)<-paste0("S",c(1:ncol(train_data_1)))
train_data_1<-cbind(train_data_1,train_data_2)
set.seed(111)
library(gbm)
response_variable <- Surv(train_data_1$recruitment_age,train_data_1$status)
predictors <- setdiff(names(train_data_1), response_variable)
gbm_model <- gbm(Surv(recruitment_age,status)~.,distribution = "coxph",data=train_data_1,
                 n.trees = 200,#树数量
                 shrinkage = 0.1,#学习率或步长减少
                 interaction.depth = 5,#每棵树的最大深度
                 n.minobsinnode = 10,#最小观测次数在树的终末节点
                 cv.folds = 10)
summary(gbm_model)
#在在线软件做Veen图
#棒棒糖图
figureS5e<-read.csv("E:/deskbook/bangbangtangtu.csv")
library(ggsci)
colnames(figureS5e)
figureS5e$Metabolites<-factor(figureS5e$Metabolites,levels=c("Phosphoglycerides","Total Lipids in Small VLDL","Apolipoprotein A1","Acetone",
                                                             "Sphingomyelins","Linoleic Acid","Concentration of IDL Particles","Acetoacetate",
                                                             "3-Hydroxybutyrate","Concentration of Large LDL Particles","Free Cholesterol in Very Small VLDL",
                                                             "Total Lipids in VLDL","Total Cholines","Glucose","Tyrosine","Free Cholesterol in IDL",
                                                             "Creatinine","Total Lipids in Large HDL","Omega-3 Fatty Acids","Citrate","Albumin"))
ggplot(figureS5e, aes(x=Metabolites, y=Relative.influence)) +
  geom_segment( aes(x=Metabolites, xend=Metabolites, y=0, yend=Relative.influence),
                color="#ffd401") +
  geom_point(color="#21908CFF",size=4, alpha=0.6) +
  theme_light() +
  coord_flip() +theme_classic()+ylab("Relative influence")+
  theme(axis.text.x = element_text(size = 12,color="black"))+theme(axis.text.y = element_text(size = 12,color="black"))+#加粗刻度
  theme(axis.title.x = element_text(size = 12,color="black"))+theme(axis.title.y = element_text(size = 12,color="black"))
#在测试集做与各个癌症的关联####
colnames(test_data)
result_all<-c()
for (i in test_data[,c(42,53,60,76,77,80,85,86,135,166)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=test_data)
  result_all<-rbind(result_all,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)],summary(fiti)$coef[1,5]))
}
colnames(result_all)<-c("HR","LCL","UCL","P")
write.csv(result_all,"E:/deskbook/result_all.csv",row.names = F)
#得到FDR
library(dplyr)#排序整理数据
result_all<-read.csv("E:/deskbook/result_all.csv")
#整体计算FDR
result_all<-result_all[order(result_all$P),]#需对P值先排序
result_all$BH<-p.adjust(result_all$P,method="BH")
write.csv(result_all,"E:/deskbook/result_all.csv")
#head
data_headcancer<-subset(test_data,various_cancer=="head_and_neck"|various_cancer==0)
result_head<-c()
for (i in data_headcancer[,c(42,53,60,76,77,80,85,86,135,166)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_headcancer)
  result_head<-rbind(result_head,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)],summary(fiti)$coef[1,5]))
}
colnames(result_head)<-c("HR","LCL","UCL","P")
result_head<-data.frame(result_head)
result_head<-result_head%>% mutate(cancer=c("head"),.before=HR)
#Esophagus
data_Esophagus<-subset(test_data,various_cancer=="esophagus"|various_cancer==0)
result_Esophagus<-c()
for (i in data_Esophagus[,c(42,53,60,76,77,80,85,86,135,166)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_Esophagus)
  result_Esophagus<-rbind(result_Esophagus,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)],summary(fiti)$coef[1,5]))
}
colnames(result_Esophagus)<-c("HR","LCL","UCL","P")
result_Esophagus<-data.frame(result_Esophagus)
result_Esophagus<-result_Esophagus%>% mutate(cancer=c("Esophagus"),.before=HR)
#stomach
data_stomach<-subset(test_data,various_cancer=="stomach"|various_cancer==0)
result_stomach<-c()
for (i in data_stomach[,c(42,53,60,76,77,80,85,86,135,166)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_stomach)
  result_stomach<-rbind(result_stomach,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)],summary(fiti)$coef[1,5]))
}
colnames(result_stomach)<-c("HR","LCL","UCL","P")
result_stomach<-data.frame(result_stomach)
result_stomach<-result_stomach%>% mutate(cancer=c("stomach"),.before=HR)
#colorectal
data_colorectal<-subset(test_data,various_cancer=="colorectal"|various_cancer==0)
result_colorectal<-c()
for (i in data_colorectal[,c(42,53,60,76,77,80,85,86,135,166)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_colorectal)
  result_colorectal<-rbind(result_colorectal,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)],summary(fiti)$coef[1,5]))
}
colnames(result_colorectal)<-c("HR","LCL","UCL","P")
result_colorectal<-data.frame(result_colorectal)
result_colorectal<-result_colorectal%>% mutate(cancer=c("colorectal"),.before=HR)
#liver
data_liver<-subset(test_data,various_cancer=="liver"|various_cancer==0)
result_liver<-c()
for (i in data_liver[,c(42,53,60,76,77,80,85,86,135,166)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_liver)
  result_liver<-rbind(result_liver,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)],summary(fiti)$coef[1,5]))
}
colnames(result_liver)<-c("HR","LCL","UCL","P")
result_liver<-data.frame(result_liver)
result_liver<-result_liver%>% mutate(cancer=c("liver"),.before=HR)
#gallbladder
data_gallbladder<-subset(test_data,various_cancer=="gallbladder"|various_cancer==0)
result_gallbladder<-c()
for (i in data_gallbladder[,c(42,53,60,76,77,80,85,86,135,166)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_gallbladder)
  result_gallbladder<-rbind(result_gallbladder,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)],summary(fiti)$coef[1,5]))
}
colnames(result_gallbladder)<-c("HR","LCL","UCL","P")
result_gallbladder<-data.frame(result_gallbladder)
result_gallbladder<-result_gallbladder%>% mutate(cancer=c("gallbladder"),.before=HR)
#pancreas
data_pancreas<-subset(test_data,various_cancer=="pancreas"|various_cancer==0)
result_pancreas<-c()
for (i in data_pancreas[,c(42,53,60,76,77,80,85,86,135,166)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_pancreas)
  result_pancreas<-rbind(result_pancreas,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)],summary(fiti)$coef[1,5]))
}
colnames(result_pancreas)<-c("HR","LCL","UCL","P")
result_pancreas<-data.frame(result_pancreas)
result_pancreas<-result_pancreas%>% mutate(cancer=c("pancreas"),.before=HR)
#lung
data_lung<-subset(test_data,various_cancer=="lung"|various_cancer==0)
result_lung<-c()
for (i in data_lung[,c(42,53,60,76,77,80,85,86,135,166)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_lung)
  result_lung<-rbind(result_lung,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)],summary(fiti)$coef[1,5]))
}
colnames(result_lung)<-c("HR","LCL","UCL","P")
result_lung<-data.frame(result_lung)
result_lung<-result_lung%>% mutate(cancer=c("lung"),.before=HR)
#malignant_melanoma
data_malignant_melanoma<-subset(test_data,various_cancer=="malignant_melanoma"|various_cancer==0)
result_malignant_melanoma<-c()
for (i in data_malignant_melanoma[,c(42,53,60,76,77,80,85,86,135,166)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_malignant_melanoma)
  result_malignant_melanoma<-rbind(result_malignant_melanoma,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)],summary(fiti)$coef[1,5]))
}
colnames(result_malignant_melanoma)<-c("HR","LCL","UCL","P")
result_malignant_melanoma<-data.frame(result_malignant_melanoma)
result_malignant_melanoma<-result_malignant_melanoma%>% mutate(cancer=c("malignant_melanoma"),.before=HR)
#breast
data_breast<-subset(test_data,various_cancer=="breast"|various_cancer==0)
result_breast<-c()
for (i in data_breast[,c(42,53,60,76,77,80,85,86,135,166)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_breast)
  result_breast<-rbind(result_breast,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)],summary(fiti)$coef[1,5]))
}
colnames(result_breast)<-c("HR","LCL","UCL","P")
result_breast<-data.frame(result_breast)
result_breast<-result_breast%>% mutate(cancer=c("breast"),.before=HR)
#Uterus and cervix cancer
table(test_data$various_cancer)
data_uterine<-subset(test_data,various_cancer=="uterus_cervix"|various_cancer==0)
result_uterine<-c()
for (i in data_uterine[,c(42,53,60,76,77,80,85,86,135,166)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_uterine)
  result_uterine<-rbind(result_uterine,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)],summary(fiti)$coef[1,5]))
}
colnames(result_uterine)<-c("HR","LCL","UCL","P")
result_uterine<-data.frame(result_uterine)
result_uterine<-result_uterine%>% mutate(cancer=c("uterine"),.before=HR)
#ovary
data_ovary<-subset(test_data,various_cancer=="ovary"|various_cancer==0)
result_ovary<-c()
for (i in data_ovary[,c(42,53,60,76,77,80,85,86,135,166)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_ovary)
  result_ovary<-rbind(result_ovary,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)],summary(fiti)$coef[1,5]))
}
colnames(result_ovary)<-c("HR","LCL","UCL","P")
result_ovary<-data.frame(result_ovary)
result_ovary<-result_ovary%>% mutate(cancer=c("ovary"),.before=HR)
#prostate
data_prostate<-subset(test_data,various_cancer=="prostate"|various_cancer==0)
result_prostate<-c()
for (i in data_prostate[,c(42,53,60,76,77,80,85,86,135,166)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_prostate)
  result_prostate<-rbind(result_prostate,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)],summary(fiti)$coef[1,5]))
}
colnames(result_prostate)<-c("HR","LCL","UCL","P")
result_prostate<-data.frame(result_prostate)
result_prostate<-result_prostate%>% mutate(cancer=c("prostate"),.before=HR)
#testic
data_testic<-subset(test_data,various_cancer=="testic"|various_cancer==0)
result_testic<-c()
for (i in data_testic[,c(42,53,60,76,77,80,85,86,135,166)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_testic)
  result_testic<-rbind(result_testic,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)],summary(fiti)$coef[1,5]))
}
colnames(result_testic)<-c("HR","LCL","UCL","P")
result_testic<-data.frame(result_testic)
result_testic<-result_testic%>% mutate(cancer=c("testic"),.before=HR)
#kidney
data_kidney<-subset(test_data,various_cancer=="kidney"|various_cancer==0)
result_kidney<-c()
for (i in data_kidney[,c(42,53,60,76,77,80,85,86,135,166)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_kidney)
  result_kidney<-rbind(result_kidney,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)],summary(fiti)$coef[1,5]))
}
colnames(result_kidney)<-c("HR","LCL","UCL","P")
result_kidney<-data.frame(result_kidney)
result_kidney<-result_kidney%>% mutate(cancer=c("kidney"),.before=HR)
#bladder
data_bladder<-subset(test_data,various_cancer=="bladder"|various_cancer==0)
result_bladder<-c()
for (i in data_bladder[,c(42,53,60,76,77,80,85,86,135,166)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_bladder)
  result_bladder<-rbind(result_bladder,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)],summary(fiti)$coef[1,5]))
}
colnames(result_bladder)<-c("HR","LCL","UCL","P")
result_bladder<-data.frame(result_bladder)
result_bladder<-result_bladder%>% mutate(cancer=c("bladder"),.before=HR)
#brain
data_brain<-subset(test_data,various_cancer=="brain"|various_cancer==0)
result_brain<-c()
for (i in data_brain[,c(42,53,60,76,77,80,85,86,135,166)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_brain)
  result_brain<-rbind(result_brain,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)],summary(fiti)$coef[1,5]))
}
colnames(result_brain)<-c("HR","LCL","UCL","P")
result_brain<-data.frame(result_brain)
result_brain<-result_brain%>% mutate(cancer=c("brain"),.before=HR)
#thyroid
data_thyroid<-subset(test_data,various_cancer=="thyroid"|various_cancer==0)
result_thyroid<-c()
for (i in data_thyroid[,c(42,53,60,76,77,80,85,86,135,166)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_thyroid)
  result_thyroid<-rbind(result_thyroid,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)],summary(fiti)$coef[1,5]))
}
colnames(result_thyroid)<-c("HR","LCL","UCL","P")
result_thyroid<-data.frame(result_thyroid)
result_thyroid<-result_thyroid%>% mutate(cancer=c("thyroid"),.before=HR)
#Hodgkin_lymphoma
data_Hodgkin_lymphoma<-subset(test_data,various_cancer=="Hodgkin_lymphoma"|various_cancer==0)
result_Hodgkin_lymphoma<-c()
for (i in data_Hodgkin_lymphoma[,c(42,53,60,76,77,80,85,86,135,166)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_Hodgkin_lymphoma)
  result_Hodgkin_lymphoma<-rbind(result_Hodgkin_lymphoma,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)],summary(fiti)$coef[1,5]))
}
colnames(result_Hodgkin_lymphoma)<-c("HR","LCL","UCL","P")
result_Hodgkin_lymphoma<-data.frame(result_Hodgkin_lymphoma)
result_Hodgkin_lymphoma<-result_Hodgkin_lymphoma%>% mutate(cancer=c("Hodgkin_lymphoma"),.before=HR)
#non_Hodgkin_lymphoma 
table(test_data$various_cancer)
data_non_Hodgkin_lymphoma <-subset(test_data,various_cancer=="non_Hodgkin_lymphoma"|various_cancer==0)
result_non_Hodgkin_lymphoma <-c()
for (i in data_non_Hodgkin_lymphoma [,c(42,53,60,76,77,80,85,86,135,166)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_non_Hodgkin_lymphoma )
  result_non_Hodgkin_lymphoma <-rbind(result_non_Hodgkin_lymphoma ,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)],summary(fiti)$coef[1,5]))
}
colnames(result_non_Hodgkin_lymphoma )<-c("HR","LCL","UCL","P")
result_non_Hodgkin_lymphoma <-data.frame(result_non_Hodgkin_lymphoma )
result_non_Hodgkin_lymphoma <-result_non_Hodgkin_lymphoma %>% mutate(cancer=c("non_Hodgkin_lymphoma "),.before=HR)
#multiple_myeloma 
data_multiple_myeloma <-subset(test_data,various_cancer=="multiple_myeloma"|various_cancer==0)
result_multiple_myeloma <-c()
for (i in data_multiple_myeloma [,c(42,53,60,76,77,80,85,86,135,166)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_multiple_myeloma )
  result_multiple_myeloma <-rbind(result_multiple_myeloma ,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)],summary(fiti)$coef[1,5]))
}
colnames(result_multiple_myeloma )<-c("HR","LCL","UCL","P")
result_multiple_myeloma <-data.frame(result_multiple_myeloma )
result_multiple_myeloma <-result_multiple_myeloma %>% mutate(cancer=c("multiple_myeloma"),.before=HR)
#leukemia 
data_leukemia <-subset(test_data,various_cancer=="leukemia"|various_cancer==0)
result_leukemia <-c()
for (i in data_leukemia [,c(42,53,60,76,77,80,85,86,135,166)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_leukemia )
  result_leukemia <-rbind(result_leukemia ,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)],summary(fiti)$coef[1,5]))
}
colnames(result_leukemia )<-c("HR","LCL","UCL","P")
result_leukemia <-data.frame(result_leukemia )
result_leukemia <-result_leukemia %>% mutate(cancer=c("leukemia "),.before=HR)
#合并
NMR_various_cancer<-rbind(result_head,result_Esophagus,result_stomach,result_colorectal,
                          result_liver,result_gallbladder,result_pancreas,result_lung,result_malignant_melanoma,
                          result_breast,result_uterine,result_ovary,result_prostate,result_testic,
                          result_kidney,result_bladder,result_brain,result_thyroid,result_Hodgkin_lymphoma,
                          result_non_Hodgkin_lymphoma,result_multiple_myeloma,result_leukemia)
write.csv(NMR_various_cancer,"E:/deskbook/NMR_various_cancer.csv",row.names = F)
#做代谢物环形条图####
CI_data<-read_csv("E:/deskbook/chanshi.csv")
detail<-read_csv("E:/deskbook/NMR_various_cancer2.csv")
detail$Cancer<-factor(detail$Cancer,levels=c("Head and neck cancer","Esophagus cancer","Stomach cancer","Colorectal cancer",
                                             "Liver cancer","Gallbladder cancer","Pancreas cancer","Lung cancer","Malignant melanoma",
                                             "Breast cancer","Uterus and cervix cancer","Ovary cancer","Prostate cancer","Testis cancer",
                                             "Kidney cancer","Bladder cancer","Brain cancer","Thyroid cancer",
                                             "Hodgkin lymphoma","Non_Hodgkin lymphoma","Multiple myeloma","Leukemia"))

table(detail$Cancer)
label_data <- CI_data
number_of_bar <- nrow(label_data)
number_of_bar
attach(label_data)
label_data$id<-0
for(i in 1:nrow(label_data)){
  label_data$id[i]<-i
}
label_data$Va<-label_data$Zmetabolite
label_data$metabolite<-detail$Metabolites
angle <-  90 - 360 * (label_data$id-0.5)/number_of_bar
label_data$hjust<-ifelse( angle < -90, 1, 0)
label_data$angle<-ifelse(angle < -90, angle+180, angle)
label_data$HR<-as.numeric(label_data$HR)
label_data$UCL<-as.numeric(label_data$UCL)
label_data$LCL<-as.numeric(label_data$LCL)
label_data$group<-detail$Cancer
unique(label_data$group)
head(label_data)
write.csv(label_data,"E:/deskbook/label_data.csv")
##########################################此处，重启R以应对未知的R包冲突！！！！！！！！！然后直接运行下面的代码

##########以下是进阶参数
library(tidyverse)
setwd("E:\\deskbook")######根据实际情况修改路径
label_data<-read.csv("label_data.csv",row.names = 1)
empty_bar <-5
dim(label_data)
to_add <- data.frame(matrix(NA, empty_bar*nlevels(label_data$group), ncol(label_data)))
colnames(to_add) <- colnames(label_data)
to_add$group <- rep(levels(label_data$group), each=empty_bar)
label_data <- rbind(label_data, to_add)
label_data$group<-factor(label_data$group,levels=c("Head and neck cancer","Esophagus cancer","Stomach cancer","Colorectal cancer",
                                                   "Liver cancer","Gallbladder cancer","Pancreas cancer","Lung cancer","Malignant melanoma",
                                                   "Breast cancer","Uterus and cervix cancer","Ovary cancer","Prostate cancer","Testis cancer",
                                                   "Kidney cancer","Bladder cancer","Brain cancer","Thyroid cancer",
                                                   "Hodgkin lymphoma","Non_Hodgkin lymphoma","Multiple myeloma","Leukemia"))

label_data <- label_data %>% arrange(group)
label_data$id <- seq(1, nrow(label_data))
dim(label_data)
#
new_label<-label_data
number_of_bar <- nrow(new_label)
angle <- 90-360 * (new_label$id-0.5)/number_of_bar   
new_label$hjust <- ifelse(angle < -90, 1, 0)
new_label$angle <- ifelse(angle < -90, angle+180, angle)
head(new_label)

base_data<-label_data %>% 
  group_by(group) %>% 
  summarize(start=min(id),end=max(id)-empty_bar) %>% 
  rowwise() %>% 
  mutate(title=mean(c(start, end)))
head(base_data)

grid_data <- base_data
grid_data$end <- grid_data$end[c(nrow(grid_data), 1:nrow(grid_data)-1)] + 1
grid_data <- grid_data[-1,]
grid_data

##########新建外圈注释参数
length(unique(base_data$group))==length(unique(label_data$group))
for(i in 1:length(unique(label_data$group))){
  if(unique(base_data$group)[i]==unique(label_data$group)[i]){
    print("TRUE")
  }else{
    print("FALSE")
  }
}#########以上验证label_data与base_data标签顺序相同

new_base_data<-base_data
new_base_data$length<-0
for(i in 1:length(unique(new_base_data$group))){
  sub_label_data<-subset(label_data,group==unique(label_data$group)[i])
  new_base_data$length[i]<-length(sub_label_data$group)
}
#write.csv(new_base_data,"new_base_data.csv") 24是总共的类数+1
new_base_data$start[1]<-0
for(s in 1:length(unique(new_base_data$group))){
  if(s+1<23){
    new_base_data$start[s+1]<-new_base_data$start[s]+new_base_data$length[s]
    new_base_data$end[s]<-new_base_data$start[s+1]-0.2
    new_base_data$title[s]<-new_base_data$start[s]+(new_base_data$end[s]-new_base_data$start[s])/2
  }else{
    new_base_data$start[s]<-new_base_data$start[31]+new_base_data$length[31]+0.2
    new_base_data$end[s]<-new_base_data$start[s]+new_base_data$length[s]
    new_base_data$title[s]<-new_base_data$start[s]+(new_base_data$end[s]-new_base_data$start[s])/2
  }
}

empty_bar <-1
to_add <- data.frame(matrix(NA, empty_bar, ncol(new_base_data)))
colnames(to_add) <- colnames(new_base_data)
#to_add$group <- rep(levels(new_base_data$group), each=empty_bar)
new_base_data <- rbind(new_base_data, to_add)



number_of_bar <- nrow(new_base_data)
new_base_data$id <- seq(1, nrow(new_base_data))
angle <- 90 - 360 * (new_base_data$id-0.9)/number_of_bar  
new_base_data$hjust <- ifelse(angle < -90, 1, 0)
new_base_data$angle <- ifelse(angle < -90, angle+180, angle)

write.csv(new_base_data,"new_base_data.csv")


##########如果对角度不满意，可以手动修改new_base_data.csv文件对应条目的angle列，保存后运行下面所有代码

new_base_data<-read.csv("new_base_data.csv",row.names = 1)
############带置信区间条形图
p1<- ggplot(label_data, aes(x=Va, y=HR,fill=group)) +   
  geom_bar(stat="identity",width = 0.5,fill = ifelse(label_data$HR>1,'#e31a1cff','#287A22FF'),alpha=0.8) +
  geom_errorbar(aes(x = Va,ymin = LCL, ymax = UCL),
                width = 0.1,color = 'black') +
  scale_x_discrete(limits=label_data$Va)+
  geom_segment(data=grid_data, aes(x = 19, y = 2, xend = 1, yend = 2), colour = "grey", alpha=1, size=0.3 , inherit.aes = FALSE ) +
  geom_segment(data=grid_data, aes(x = 19, y = 1.5, xend = 1, yend = 1.5), colour = "grey", alpha=1, size=0.3 , inherit.aes = FALSE ) +
  geom_segment(data=grid_data, aes(x = 19, y = 1, xend = 1, yend = 1), colour = "grey", alpha=1, size=0.3 , inherit.aes = FALSE ) +
  geom_segment(data=grid_data, aes(x = 19, y = 0.5, xend = 1, yend = 0.5), colour = "grey", alpha=1, size=0.3 , inherit.aes = FALSE ) +
  geom_segment(data=grid_data, aes(x = 19, y = 0, xend = 1, yend = 0), colour = "grey", alpha=1, size=0.3 , inherit.aes = FALSE ) +
  annotate("text", x = -4, y = c(0, 0.5, 1, 1.5,2), label = c("0", "0.5", "1.0","1.5","2") , color="blue", size=3 , angle=0, fontface="bold", hjust=0) +
  
  geom_segment(data=grid_data, aes(x = 72, y = 2, xend = 53, yend = 2), colour = "grey", alpha=1, size=0.3 , inherit.aes = FALSE ) +
  geom_segment(data=grid_data, aes(x = 72, y = 1.5, xend = 53, yend = 1.5), colour = "grey", alpha=1, size=0.3 , inherit.aes = FALSE ) +
  geom_segment(data=grid_data, aes(x = 72, y = 1, xend = 53, yend = 1), colour = "grey", alpha=1, size=0.3 , inherit.aes = FALSE ) +
  geom_segment(data=grid_data, aes(x = 72, y = 0.5, xend = 53, yend = 0.5), colour = "grey", alpha=1, size=0.3 , inherit.aes = FALSE ) +
  geom_segment(data=grid_data, aes(x = 72, y = 0, xend = 53, yend = 0), colour = "grey", alpha=1, size=0.3 , inherit.aes = FALSE ) +
  
  
  geom_segment(data=grid_data, aes(x = 132, y = 2, xend = 113, yend = 2), colour = "grey", alpha=1, size=0.3 , inherit.aes = FALSE ) +
  geom_segment(data=grid_data, aes(x = 132, y = 1.5, xend = 113, yend = 1.5), colour = "grey", alpha=1, size=0.3 , inherit.aes = FALSE ) +
  geom_segment(data=grid_data, aes(x = 132, y = 1, xend = 113, yend = 1), colour = "grey", alpha=1, size=0.3 , inherit.aes = FALSE ) +
  geom_segment(data=grid_data, aes(x = 132, y = 0.5, xend = 113, yend = 0.5), colour = "grey", alpha=1, size=0.3 , inherit.aes = FALSE ) +
  geom_segment(data=grid_data, aes(x = 132, y = 0, xend = 113, yend = 0), colour = "grey", alpha=1, size=0.3 , inherit.aes = FALSE ) +
  
  geom_segment(data=grid_data, aes(x = 200, y = 2, xend = 180, yend = 2), colour = "grey", alpha=1, size=0.3 , inherit.aes = FALSE ) +
  geom_segment(data=grid_data, aes(x = 200, y = 1.5, xend = 180, yend = 1.5), colour = "grey", alpha=1, size=0.3 , inherit.aes = FALSE ) +
  geom_segment(data=grid_data, aes(x = 200, y = 1, xend = 180, yend = 1), colour = "grey", alpha=1, size=0.3 , inherit.aes = FALSE ) +
  geom_segment(data=grid_data, aes(x = 200, y = 0.5, xend = 180, yend = 0.5), colour = "grey", alpha=1, size=0.3 , inherit.aes = FALSE ) +
  geom_segment(data=grid_data, aes(x = 200, y = 0, xend = 180, yend = 0), colour = "grey", alpha=1, size=0.3 , inherit.aes = FALSE ) +
  #ylim(-1000,0.2)+
  theme_minimal() +
  coord_polar(start = 0)+
  theme(
    axis.text = element_blank(),
    axis.title = element_blank(),
    panel.grid = element_blank())+
  geom_segment(data=base_data, aes(x = start, y = -3.5, xend = end, yend = -3.5), colour = "black", alpha=0.8, size=0.6 , inherit.aes = FALSE )+
  geom_segment(data=new_base_data, aes(x = start, y = 7.5, xend = end, yend = 7.5), colour = "black", alpha=0.8, size=0.6 , inherit.aes = FALSE )+#圈的位置
  geom_text(data=new_label, aes(x=id, y=3.4, label=metabolite, hjust=hjust), color="black", fontface="bold",alpha=0.6, size=2.6, 
            angle=new_label$angle, inherit.aes = FALSE )+#亚类的位置
  geom_text(data=new_base_data, aes(x = title, y = 10, label=group,hjust=hjust), colour = "black", alpha=0.8, size=4.3, angle=new_base_data$angle,fontface="bold", inherit.aes = FALSE)+#最外圈文字位置
  geom_text(data=new_label,aes(x=Va,y=2.5),label=ifelse(label_data$P_value<0.05,"*",""))
p1#12*12
#####合并膳食和NMR的数据####
#读取数据
library(data.table)
UKBdata2<-fread("E:/deskbook/UKBdata2.csv",header=T)
colnames(UKBdata2)
UKBdata3<-subset(UKBdata2,select=c(1,7:22,59,168,219))
#读取NMR9的数据
NMR9<-fread("E:/deskbook/NMR9.csv",header=T)
colnames(NMR9)
NMR10<-subset(NMR9,select=c(1,42,53,60,76,77,80,85,86,135,166))
colnames(NMR10)
# 找到两个数据集中都存在的eid值
common_eids <- intersect(UKBdata3$eid, NMR10$eid)
# 根据共有的eid值筛选每个数据集中的记录
matched_data1 <- UKBdata3[UKBdata3$eid %in% common_eids,]
matched_data2 <- NMR10[NMR10$eid %in% common_eids,]
# extract UKBdata3 samples without common_eids
UKBdata3_no_common_eids <- UKBdata3[!(UKBdata3$eid %in% common_eids),]
# extract NMR10 samples without common_eids
NMR10_no_common_eids <- NMR10[!(NMR10$eid %in% common_eids),]
#合并无commoneid的数据####
UKBdata_no_common<-merge(UKBdata3_no_common_eids,NMR10_no_common_eids,by="eid",all.x = T)
#最终的数据集#### 85669obs
UKBdata4<-merge(matched_data1,matched_data2,by="eid",all.x = T)
UKBdata4$energy<-UKBdata4$`100002_1`/4.184
UKBdata4$MIND_sum1_3group <- cut(UKBdata4$MIND_sum1, 
                                   breaks = quantile(UKBdata4$MIND_sum1, probs = c(0, 0.33, 0.66, 1)), include.lowest = TRUE, labels = FALSE)#三分位分组
UKBdata4$MEDAS_sum1_3group <- cut(UKBdata4$MEDAS_sum1, 
                                 breaks = quantile(UKBdata4$MEDAS_sum1, probs = c(0, 0.33, 0.66, 1)), include.lowest = TRUE, labels = FALSE)#三分位分组
UKBdata4$status<-ifelse(UKBdata4$pan_cancer==0,0,1)
colnames(UKBdata4)
#输出UKBdata4
library(tidyverse)
write_excel_csv(UKBdata4,"E:/deskbook/UKBdata4.csv")
UKBdata4<-fread("E:/deskbook/UKBdata4.csv",header=T)
#读取数据UKBdata4#####
library(data.table)
UKBdata4<-fread("E:/deskbook/UKBdata4.csv",header=T)
colnames(UKBdata4)
vars<-colnames(UKBdata4[,c(4:25,33,26,28)])
catvars<-colnames(UKBdata4[,c(4:6,9,12:13,25)])
vars2<-colnames(UKBdata4[,c(8,10,11,14:24,33,26,28)])
library(tableone)
tableS12<-CreateTableOne(vars=vars,strata="status",data=UKBdata4,
                         factorVars =catvars,addOverall = T)
tableS12_1<-print(tableS12, quote = FALSE, noSpaces = TRUE, printToggle = FALSE,showAllLevels = T,
                  nonnormal=vars2)
write.csv(tableS12_1,"D:/deskbook/tableS12.csv")
#做膳食与泛癌关联分析
table(UKBdata4$MIND_sum1_3group)
table(UKBdata4$MIND_sum1_3group,UKBdata4$status)
table(UKBdata4$MEDAS_sum1_3group)
table(UKBdata4$MEDAS_sum1_3group,UKBdata4$status)
library(survival)
#Model 3
colnames(UKBdata4)
result<-c()
for (i in UKBdata4[,c(19,18)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=UKBdata4)
  result<-rbind(result,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)],summary(fiti)$coef[1,5]))
}
write.csv(result,"E:/deskbook/table2_3.csv",row.names = F)
result<-c()
for (i in UKBdata4[,c(32,31)]){
  UKBdata4$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=UKBdata4)
  result<-rbind(result,c(exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
write.csv(result,"E:/deskbook/table2_4.csv",row.names = F)
#趋势性检验
tapply(UKBdata4$MIND_sum1,UKBdata4$MIND_sum1_3group,function(x) 
{return(quantile(x,probs=c(0.5)))})

UKBdata4$MIND_sum1_3group_p<-ifelse(UKBdata4$MIND_sum1_3group==1,4.5,ifelse(
  UKBdata4$MIND_sum1_3group==2,6.5,8))

tapply(UKBdata4$MEDAS_sum1,UKBdata4$MEDAS_sum1_3group,function(x) 
{return(quantile(x,probs=c(0.5)))})
UKBdata4$MEDAS_sum1_3group_p<-ifelse(UKBdata4$MEDAS_sum1_3group==1,4,ifelse(
  UKBdata4$MEDAS_sum1_3group==2,5,7))
#model 3
result<-c()
for (i in UKBdata4[,41:42]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=UKBdata4)
  result<-rbind(result,c(summary(fiti)$coef[1,5]))
}
#输出数据
#做森林图Figure5A
library(grid)
library("forestploter")
figure5<-read.csv("E:/deskbook/Figure5.csv",sep=",",header=T)
#整理表格
colnames(figure5)
figure5$Diet.Adherence<-ifelse(is.na(figure5$N),
                               figure5$Diet.Adherence,
                               paste0("  ",figure5$Diet.Adherence))
figure5$N<-ifelse(is.na(figure5$N),"",figure5$N)
figure5$Inicidence<-ifelse(is.na(figure5$Inicidence),"",figure5$Inicidence)
#生成一个变量se，它在绘图的时候表示正方形的大小
figure5$se<-(log(figure5$UCL)-log(figure5$HR))/1.96
figure5$se<-ifelse(figure5$se==0,NA,figure5$se)
#生成一个绘图区间，等下用来绘图
figure5$` `<-paste(rep(' ',20),collapse = ' ')
#生成HR和可信区间
figure5$`HR (95%CI)`<-ifelse(is.na(figure5$se),"",
                             paste0(figure5$HR," (",figure5$LCL,"-",figure5$UCL,")"))
#绘图
#设置forest_theme函数可以对森林图图片的细节进行调整
p<-forest(figure5[,c(1:3,9:10)],
          est=figure5$HR,
          lower=figure5$LCL,
          upper = figure5$UCL,
          ci_column=4,
          ref_line = 1,xlim=c(0.7,1.1),
          ticks_at = c(0.7,0.8,0.9,1.0,1.1))
#将文本加粗
g<-edit_plot(p,row=c(1,6),
             gp=gpar(fontface="bold"))
#做代谢物与MIND与MEDAS之间的关联####
colnames(UKBdata4)
result<-c()
for (i in UKBdata4[,21:30]){
  med.fiti<-lm(i~MIND_sum1+energy+sex+education+
                 famaliy_history+Townsend_deprivation_index2+household_income+
                 smoking_status+alochol_drinking+weekly_activity+
                 BMI+whr+SBP,data=UKBdata4)
  result<-cbind(result,c(summary(med.fiti)$coe[2,c(1:2,4)]))
}
#与MEDAS的关联
result1<-c()
for (i in UKBdata4[,21:30]){
  med.fiti<-lm(i~MEDAS_sum1+energy+sex+education+
                 famaliy_history+Townsend_deprivation_index2+household_income+
                 smoking_status+alochol_drinking+weekly_activity+
                 BMI+whr+SBP,data=UKBdata4)
  result1<-cbind(result1,c(summary(med.fiti)$coe[2,c(1:2,4)]))
}
write.csv(result,"E:/deskbook/result.csv",row.names = F)
write.csv(result1,"E:/deskbook/result1.csv",row.names = F)
#做成气泡图形式Figure5B####在线软件弄
#做代谢物与结局相关####
library(survival)
colnames(UKBdata4)
result<-c()
for (i in UKBdata4[,c(21:30)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=UKBdata4)
  result<-rbind(result,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)],summary(fiti)$coef[1,5]))
}
write.csv(result,"E:/deskbook/supplementtable13.csv")

#得到FDR
library(dplyr)#排序整理数据
supplementtable13<-read.csv("E:/deskbook/supplementtable13.csv")
#整体计算FDR
supplementtable13<-supplementtable13[order(supplementtable13$P),]#需对P值先排序
supplementtable13$BH<-p.adjust(supplementtable13$P,method="BH")
#shuchu
write.csv(supplementtable13,"E:/deskbook/supplementtable13.csv")
#做成森林图
library(grid)
library("forestploter")
figure5c<-read.csv("E:/deskbook/supplementtable13.csv",sep=",",header=T)
#生成一个绘图区间，等下用来绘图
figure5c$` `<-paste(rep(' ',20),collapse = ' ')
#生成HR和可信区间
figure5c$`HR (95%CI)`<-paste0(round(figure5c$HR,3)," (",round(figure5c$LCL,3),"-",round(figure5c$UCL,3),")")
#绘图
#设置forest_theme函数可以对森林图图片的细节进行调整
p<-forest(figure5c[,c(1,7:8,5:6)],
          est=figure5c$HR,
          lower=figure5c$LCL,
          upper = figure5c$UCL,
          ci_column=2,
          ref_line = 1,xlim=c(0.8,1.1),
          ticks_at = c(0.8,0.85,0.90,0.95,1.0,1.1))
#中介分析####
library(data.table)
library(survival)
library(mma)
UKBdata4<-fread("E:/deskbook/UKBdata4.csv",header=T)
colnames(UKBdata4)
time1<-UKBdata4$recruitment_age
event1<-UKBdata4$status
y1<-Surv(UKBdata4$recruitment_age,event1)
#MIND
fit1<-coxph(Surv(recruitment_age,status)~factor(MIND_sum1_3group)+energy+factor(sex)+factor(education)+
              factor(famaliy_history)+factor(Townsend_deprivation_index2)+factor(household_income)+
              factor(smoking_status)+factor(alochol_drinking)+weekly_activity+sleep_duration+
              BMI+whr+SBP,data=UKBdata4)
summary(fit1)#energy,sex,Townsend_deprivation_index2,household_income,smoking_status,alochol_drinkin,weekly_activity,BMI,whr,SBP
fit2<-glm(MIND_sum1_3group~energy+factor(sex)+factor(education)+
            factor(famaliy_history)+factor(Townsend_deprivation_index2)+factor(household_income)+
            factor(smoking_status)+factor(alochol_drinking)+weekly_activity+sleep_duration+
            BMI+whr+SBP,data=UKBdata4)
summary(fit2)#
#MEDAS
fit3<-coxph(Surv(recruitment_age,status)~factor(MEDAS_sum1_3group)+energy+factor(sex)+factor(education)+
              factor(famaliy_history)+factor(Townsend_deprivation_index2)+factor(household_income)+
              factor(smoking_status)+factor(alochol_drinking)+weekly_activity+sleep_duration+
              BMI+whr+SBP,data=UKBdata4)
summary(fit3)#energy,sex,Townsend_deprivation_index2,household_income,smoking_status,alochol_drinkin,weekly_activity,BMI,whr,SBP
fit4<-glm(MEDAS_sum1_3group~energy+factor(sex)+factor(education)+
            factor(famaliy_history)+factor(Townsend_deprivation_index2)+factor(household_income)+
            factor(smoking_status)+factor(alochol_drinking)+weekly_activity+sleep_duration+
            BMI+whr+SBP,data=UKBdata4)
summary(fit4)#
colnames(UKBdata4)
covs1<-subset(UKBdata4,select = c(6,8:10,12:15,17,31))
covs2<-subset(UKBdata4,select = c(6,8:10,12:15,31))
x1<-UKBdata4$MIND_sum1
x2<-UKBdata4$MIND_sum1_3group
x3<-UKBdata4$MEDAS_sum1
x4<-UKBdata4$MEDAS_sum1_3group
setwd("E:/deskbook/")
sink("mma_results_summary.txt")
for (i in  c(21:26,28:30)) {
  set.seed(55)
  metabolites <- subset(UKBdata4, select = i)
  m <- as.matrix(metabolites)
  colnames(m) <- paste0("m", c(1:ncol(m)))
  data_org<-data.org(m,y1,pred =x1,mediator = "m1",cova=covs1)
  mma_result1 <- mma(m, y1, pred =x1, mediator = "m1", n = 10, n2 = 5, type = "lp")
  cat("Summary for mma_risk1_", i, "_MIND:\n")
  print(summary(mma_result1))
  data_org<-data.org(m,y1,pred =x2,mediator = "m1",cova=covs1)
  mma_result2 <- mma(m, y1, pred =x2, mediator = "m1", n = 10, n2 = 5, type = "lp")
  cat("Summary for mma_risk2_", i, "_MIND:\n")
  print(summary(mma_result2))
}
for (i in c(21:26,28:30)) {
  set.seed(55)
  metabolites <- subset(UKBdata4, select = i)
  m <- as.matrix(metabolites)
  colnames(m) <- paste0("m", c(1:ncol(m)))
  data_org<-data.org(m,y1,pred =x3,mediator = "m1",cova=covs2)
  mma_result3 <- mma(m, y1, pred =x3, mediator = "m1", n = 10, n2 = 5, type = "lp")
  cat("Summary for mma_risk1_", i, "_MEDAS:\n")
  print(summary(mma_result1))
  data_org<-data.org(m,y1,pred =x4,mediator = "m1",cova=covs2)
  mma_result4 <- mma(m, y1, pred =x4, mediator = "m1", n = 10, n2 = 5, type = "lp")
  cat("Summary for mma_risk2_", i, "_MEDAS:\n")
  print(summary(mma_result4))
}
#多重中介
#MIND
sink("mulitiple_mma_results_summary.txt")
colnames(UKBdata4)
set.seed(55)
metabolites<-subset(UKBdata4,select = c(21:30))
m<-as.matrix(metabolites)
colnames(m)<-paste0("m",c(1:ncol(m)))
data_org<-data.org(m,y1,pred =x1,mediator =1:ncol(m),cova=covs1)
mma_risk_MIND1<-mma(m,y1,pred=x1,mediator=1:ncol(m),n=10,n2=5,type="lp")
summary(mma_risk_MIND1)
data_org<-data.org(m,y1,pred =x2,mediator =1:ncol(m),cova=covs1)
mma_risk_MIND2<-mma(m,y1,pred=x2,mediator=1:ncol(m),n=10,n2=5,type="lp")
summary(mma_risk_MIND2)
#MEDAS
metabolites<-subset(UKBdata4,select = c(21:30))
m<-as.matrix(metabolites)
colnames(m)<-paste0("m",c(1:ncol(m)))
data_org<-data.org(m,y1,pred =x3,mediator =1:ncol(m),cova=covs2)
mma_risk_MEDAS1<-mma(m,y1,pred=x3,mediator=1:ncol(m),n=10,n2=5,type="lp")
summary(mma_risk_MEDAS1)
data_org<-data.org(m,y1,pred =x4,mediator =1:ncol(m),cova=covs2)
mma_risk_MEDAS2<-mma(m,y1,pred=x4,mediator=1:ncol(m),n=10,n2=5,type="lp")
summary(mma_risk_MEDAS2)
sink()

#现在先开始敏感性分析####
#针对膳食数据的敏感性分析####
#1.利用基线膳食来做####
library(data.table)
UKBdata2<-fread("E:/deskbook/UKBdata2.csv",header=T)
colnames(UKBdata2)
UKBdata2$MIND_sum2_3group<- cut(UKBdata2$MIND_sum2, 
                                breaks = quantile(UKBdata2$MIND_sum2, probs = c(0, 0.33, 0.66, 1)), include.lowest = TRUE, labels = FALSE)#三分位分组
UKBdata2$MEDAS_sum2_3group<- cut(UKBdata2$MEDAS_sum2, 
                                 breaks = quantile(UKBdata2$MEDAS_sum2, probs = c(0, 0.33, 0.66, 1)), include.lowest = TRUE, labels = FALSE)#三分位分组
UKBdata2$various_cancer[UKBdata2$various_cancer == "non-Hodgkin_lymphoma"] <- "non_Hodgkin_lymphoma"
UKBdata2$various_cancer[UKBdata2$various_cancer == "throid"] <- "thyroid"
UKBdata2$various_cancer[UKBdata2$various_cancer == "cervix"|UKBdata2$various_cancer == "uterine"] <- "uterus_cervix"
UKBdata2$MIND_sum1_3group <- cut(UKBdata2$MIND_sum1, 
                                 breaks = quantile(UKBdata2$MIND_sum1, probs = c(0, 0.33, 0.66, 1)), include.lowest = TRUE, labels = FALSE)#三分位分组
UKBdata2$MEDAS_sum1_3group <- cut(UKBdata2$MEDAS_sum1, 
                                  breaks = quantile(UKBdata2$MEDAS_sum1, probs = c(0, 0.33, 0.66, 1)), include.lowest = TRUE, labels = FALSE)#三分位分组
UKBdata2$energy<-UKBdata2$`100002_1`/4.184
table(UKBdata2$MIND_sum2_3group)
table(UKBdata2$MEDAS_sum2_3group)
table(UKBdata2$status)
table(UKBdata2$MIND_sum2_3group,UKBdata2$status)
table(UKBdata2$MEDAS_sum2_3group,UKBdata2$status)
library(survival)
#Model 1仅进行能量调整
colnames(UKBdata2)
result<-c()
for (i in UKBdata2[,c(187,91)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy,data=UKBdata2)
  result<-rbind(result,c(exp(fiti$coefficients[1]),summary(fiti)$conf.int[1,c(3:4)],summary(fiti)$coef[1,5]))
}
write.csv(result,"E:/deskbook/table2_1.csv",row.names = F)
result<-c()
for (i in UKBdata2[,c(268,267)]){
  UKBdata2$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy,data=UKBdata2)
  result<-rbind(result,c(exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
write.csv(result,"E:/deskbook/table2_2.csv",row.names = F)
#Model 2进一步调整sex,education,income, index, family history
fit1<-coxph(Surv(recruitment_age,status)~MEDAS_sum2+energy+sex+education+
              famaliy_history+Townsend_deprivation_index2+household_income,data=UKBdata2)
summary(fit1)
fit2<-coxph(Surv(recruitment_age,status)~MIND_sum2+energy+sex+education+
              famaliy_history+Townsend_deprivation_index2+household_income,data=UKBdata2)
summary(fit2)
result<-c()
for (i in UKBdata2[,c(268,267)]){
  UKBdata2$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income,data=UKBdata2)
  result<-rbind(result,c(exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
write.csv(result,"E:/deskbook/table2_4.csv",row.names = F)
#Model 3进一步调整Smoking, alcohol, physical activity, BMI, WHR, SBP
fit1<-coxph(Surv(recruitment_age,status)~MEDAS_sum2+energy+sex+education+
              famaliy_history+Townsend_deprivation_index2+household_income+
              smoking_status+alochol_drinking+weekly_activity+
              BMI+whr+SBP,data=UKBdata2)
summary(fit1)
fit2<-coxph(Surv(recruitment_age,status)~MIND_sum2+energy+sex+education+
              famaliy_history+Townsend_deprivation_index2+household_income+
              smoking_status+alochol_drinking+weekly_activity+
              BMI+whr+SBP,data=UKBdata2)
summary(fit2)
result<-c()
for (i in UKBdata2[,c(268,267)]){
  UKBdata2$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=UKBdata2)
  result<-rbind(result,c(exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
write.csv(result,"E:/deskbook/table2_4.csv",row.names = F)
#趋势性检验
tapply(UKBdata2$MIND_sum2,UKBdata2$MIND_sum2_3group,function(x) 
{return(quantile(x,probs=c(0.5)))})

UKBdata2$MIND_sum2_3group_p<-ifelse(UKBdata2$MIND_sum2_3group==1,4,ifelse(
  UKBdata2$MIND_sum1_3group==2,6,7.5))

tapply(UKBdata2$MEDAS_sum2,UKBdata2$MEDAS_sum2_3group,function(x) 
{return(quantile(x,probs=c(0.5)))})
UKBdata2$MEDAS_sum2_3group_p<-ifelse(UKBdata2$MEDAS_sum2_3group==1,3,ifelse(
  UKBdata2$MEDAS_sum2_3group==2,5,6))
#model 1
colnames(UKBdata2)
result<-c()
for (i in UKBdata2[,c(278:279)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy,data=UKBdata2)
  result<-rbind(result,c(summary(fiti)$coef[1,5]))
}
#model 2
result<-c()
for (i in UKBdata2[,c(278:279)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income,data=UKBdata2)
  result<-rbind(result,c(summary(fiti)$coef[1,5]))
}
#model 3
result<-c()
for (i in UKBdata2[,c(278:279)]){
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=UKBdata2)
  result<-rbind(result,c(summary(fiti)$coef[1,5]))
}
#2.排除每个食物组重新构建食物评分####
#MIND#####
#MIND_sum_outgreen
colnames(UKBdata2)
UKBdata2[,MIND_sum_outgreen:= rowSums(.SD, na.rm = TRUE), .SDcols = c("Other_Vegetables_sum1_score",
                                                                      "Berries_sum1_score","Nuts_sum1_score","Butter_sum1_score","cheese_sum1_score",
                                                                      "Whole_grains_sum1_score","fish_sum1_score","bean_sum1_score","poultry_sum1_score",
                                                                      "red_meat_sum1_score","fastfried_food_sum1_score","Pastries_sweets_sum1_score","wine_sum1_score")]
UKBdata2$MIND_sum_outgreen_3group<- cut(UKBdata2$MIND_sum_outgreen, 
                                        breaks = quantile(UKBdata2$MIND_sum_outgreen, probs = c(0, 0.33, 0.66, 1)), include.lowest = TRUE, labels = FALSE)#三分位分组
table(UKBdata2$MIND_sum_outgreen_3group)
table(UKBdata2$MIND_sum_outgreen_3group,UKBdata2$status)
#排除其他蔬菜
UKBdata2[,MIND_sum_outother:= rowSums(.SD, na.rm = TRUE), .SDcols = c("Green_Leafy_Vegetables_sum1_score",
                                                                      "Berries_sum1_score","Nuts_sum1_score","Butter_sum1_score","cheese_sum1_score",
                                                                      "Whole_grains_sum1_score","fish_sum1_score","bean_sum1_score","poultry_sum1_score",
                                                                      "red_meat_sum1_score","fastfried_food_sum1_score","Pastries_sweets_sum1_score","wine_sum1_score")]
UKBdata2$MIND_sum_outother_3group<- cut(UKBdata2$MIND_sum_outother, 
                                        breaks = quantile(UKBdata2$MIND_sum_outother, probs = c(0, 0.33, 0.66, 1)), include.lowest = TRUE, labels = FALSE)#三分位分组
table(UKBdata2$MIND_sum_outother_3group)
table(UKBdata2$MIND_sum_outother_3group,UKBdata2$status)
#排除草莓
UKBdata2[,MIND_sum_outberries:= rowSums(.SD, na.rm = TRUE), .SDcols = c("Green_Leafy_Vegetables_sum1_score","Other_Vegetables_sum1_score",
                                                                        "Nuts_sum1_score","Butter_sum1_score","cheese_sum1_score",
                                                                        "Whole_grains_sum1_score","fish_sum1_score","bean_sum1_score","poultry_sum1_score",
                                                                        "red_meat_sum1_score","fastfried_food_sum1_score","Pastries_sweets_sum1_score","wine_sum1_score")]
UKBdata2$MIND_sum_outberries_3group<- cut(UKBdata2$MIND_sum_outberries, 
                                          breaks = quantile(UKBdata2$MIND_sum_outberries, probs = c(0, 0.33, 0.66, 1)), include.lowest = TRUE, labels = FALSE)#三分位分组
table(UKBdata2$MIND_sum_outberries_3group)
table(UKBdata2$MIND_sum_outberries_3group,UKBdata2$status)
#排除nut
UKBdata2[,MIND_sum_outnut:= rowSums(.SD, na.rm = TRUE), .SDcols = c("Green_Leafy_Vegetables_sum1_score","Other_Vegetables_sum1_score",
                                                                    "Berries_sum1_score","Butter_sum1_score","cheese_sum1_score",
                                                                    "Whole_grains_sum1_score","fish_sum1_score","bean_sum1_score","poultry_sum1_score",
                                                                    "red_meat_sum1_score","fastfried_food_sum1_score","Pastries_sweets_sum1_score","wine_sum1_score")]
UKBdata2$MIND_sum_outnut_3group<- cut(UKBdata2$MIND_sum_outnut, 
                                      breaks = quantile(UKBdata2$MIND_sum_outnut, probs = c(0, 0.33, 0.66, 1)), include.lowest = TRUE, labels = FALSE)#三分位分组
table(UKBdata2$MIND_sum_outnut_3group)
table(UKBdata2$MIND_sum_outnut_3group,UKBdata2$status)
#排除butter
UKBdata2[,MIND_sum_outbutter:= rowSums(.SD, na.rm = TRUE), .SDcols = c("Green_Leafy_Vegetables_sum1_score","Other_Vegetables_sum1_score",
                                                                       "Berries_sum1_score","Nuts_sum1_score","cheese_sum1_score",
                                                                       "Whole_grains_sum1_score","fish_sum1_score","bean_sum1_score","poultry_sum1_score",
                                                                       "red_meat_sum1_score","fastfried_food_sum1_score","Pastries_sweets_sum1_score","wine_sum1_score")]
UKBdata2$MIND_sum_outbutter_3group<- cut(UKBdata2$MIND_sum_outbutter, 
                                         breaks = quantile(UKBdata2$MIND_sum_outbutter, probs = c(0, 0.33, 0.66, 1)), include.lowest = TRUE, labels = FALSE)#三分位分组
table(UKBdata2$MIND_sum_outbutter_3group)
table(UKBdata2$MIND_sum_outbutter_3group,UKBdata2$status)
#排除chess
UKBdata2[,MIND_sum_outchess:= rowSums(.SD, na.rm = TRUE), .SDcols = c("Green_Leafy_Vegetables_sum1_score","Other_Vegetables_sum1_score",
                                                                      "Berries_sum1_score","Nuts_sum1_score","Butter_sum1_score",
                                                                      "Whole_grains_sum1_score","fish_sum1_score","bean_sum1_score","poultry_sum1_score",
                                                                      "red_meat_sum1_score","fastfried_food_sum1_score","Pastries_sweets_sum1_score","wine_sum1_score")]
UKBdata2$MIND_sum_outchess_3group<- cut(UKBdata2$MIND_sum_outchess, 
                                        breaks = quantile(UKBdata2$MIND_sum_outchess, probs = c(0, 0.33, 0.66, 1)), include.lowest = TRUE, labels = FALSE)#三分位分组
table(UKBdata2$MIND_sum_outchess_3group)
table(UKBdata2$MIND_sum_outchess_3group,UKBdata2$status)
#排除grain
UKBdata2[,MIND_sum_outgrain:= rowSums(.SD, na.rm = TRUE), .SDcols = c("Green_Leafy_Vegetables_sum1_score","Other_Vegetables_sum1_score",
                                                                      "Berries_sum1_score","Nuts_sum1_score","Butter_sum1_score","cheese_sum1_score",
                                                                      "fish_sum1_score","bean_sum1_score","poultry_sum1_score",
                                                                      "red_meat_sum1_score","fastfried_food_sum1_score","Pastries_sweets_sum1_score","wine_sum1_score")]
UKBdata2$MIND_sum_outgrain_3group<- cut(UKBdata2$MIND_sum_outgrain, 
                                        breaks = quantile(UKBdata2$MIND_sum_outgrain, probs = c(0, 0.33, 0.66, 1)), include.lowest = TRUE, labels = FALSE)#三分位分组
table(UKBdata2$MIND_sum_outgrain_3group)
table(UKBdata2$MIND_sum_outgrain_3group,UKBdata2$status)
#排除sea food
UKBdata2[,MIND_sum_outsea:= rowSums(.SD, na.rm = TRUE), .SDcols = c("Green_Leafy_Vegetables_sum1_score","Other_Vegetables_sum1_score",
                                                                    "Berries_sum1_score","Nuts_sum1_score","Butter_sum1_score","cheese_sum1_score",
                                                                    "Whole_grains_sum1_score","bean_sum1_score","poultry_sum1_score",
                                                                    "red_meat_sum1_score","fastfried_food_sum1_score","Pastries_sweets_sum1_score","wine_sum1_score")]
UKBdata2$MIND_sum_outsea_3group<- cut(UKBdata2$MIND_sum_outsea, 
                                      breaks = quantile(UKBdata2$MIND_sum_outsea, probs = c(0, 0.33, 0.66, 1)), include.lowest = TRUE, labels = FALSE)#三分位分组
table(UKBdata2$MIND_sum_outsea_3group)
table(UKBdata2$MIND_sum_outsea_3group,UKBdata2$status)
#排除Legumes
UKBdata2[,MIND_sum_outLegumes:= rowSums(.SD, na.rm = TRUE), .SDcols = c("Green_Leafy_Vegetables_sum1_score","Other_Vegetables_sum1_score",
                                                                        "Berries_sum1_score","Nuts_sum1_score","Butter_sum1_score","cheese_sum1_score",
                                                                        "Whole_grains_sum1_score","fish_sum1_score","poultry_sum1_score",
                                                                        "red_meat_sum1_score","fastfried_food_sum1_score","Pastries_sweets_sum1_score","wine_sum1_score")]
UKBdata2$MIND_sum_outLegumes_3group<- cut(UKBdata2$MIND_sum_outLegumes, 
                                          breaks = quantile(UKBdata2$MIND_sum_outLegumes, probs = c(0, 0.33, 0.66, 1)), include.lowest = TRUE, labels = FALSE)#三分位分组
table(UKBdata2$MIND_sum_outLegumes_3group)
table(UKBdata2$MIND_sum_outLegumes_3group,UKBdata2$status)
#排除Poultry
UKBdata2[,MIND_sum_outPoultry:= rowSums(.SD, na.rm = TRUE), .SDcols = c("Green_Leafy_Vegetables_sum1_score","Other_Vegetables_sum1_score",
                                                                        "Berries_sum1_score","Nuts_sum1_score","Butter_sum1_score","cheese_sum1_score",
                                                                        "Whole_grains_sum1_score","fish_sum1_score","bean_sum1_score",
                                                                        "red_meat_sum1_score","fastfried_food_sum1_score","Pastries_sweets_sum1_score","wine_sum1_score")]
UKBdata2$MIND_sum_outPoultry_3group<- cut(UKBdata2$MIND_sum_outPoultry, 
                                          breaks = quantile(UKBdata2$MIND_sum_outPoultry, probs = c(0, 0.33, 0.66, 1)), include.lowest = TRUE, labels = FALSE)#三分位分组
table(UKBdata2$MIND_sum_outPoultry_3group)
table(UKBdata2$MIND_sum_outPoultry_3group,UKBdata2$status)
#排除red meat
UKBdata2[,MIND_sum_outmeat:= rowSums(.SD, na.rm = TRUE), .SDcols = c("Green_Leafy_Vegetables_sum1_score","Other_Vegetables_sum1_score",
                                                                     "Berries_sum1_score","Nuts_sum1_score","Butter_sum1_score","cheese_sum1_score",
                                                                     "Whole_grains_sum1_score","fish_sum1_score","bean_sum1_score","poultry_sum1_score",
                                                                     "fastfried_food_sum1_score","Pastries_sweets_sum1_score","wine_sum1_score")]
UKBdata2$MIND_sum_outmeat_3group<- cut(UKBdata2$MIND_sum_outmeat, 
                                       breaks = quantile(UKBdata2$MIND_sum_outmeat, probs = c(0, 0.33, 0.66, 1)), include.lowest = TRUE, labels = FALSE)#三分位分组
table(UKBdata2$MIND_sum_outmeat_3group)
table(UKBdata2$MIND_sum_outmeat_3group,UKBdata2$status)
#排除fast/fied fodd
UKBdata2[,MIND_sum_outfast:= rowSums(.SD, na.rm = TRUE), .SDcols = c("Green_Leafy_Vegetables_sum1_score","Other_Vegetables_sum1_score",
                                                                     "Berries_sum1_score","Nuts_sum1_score","Butter_sum1_score","cheese_sum1_score",
                                                                     "Whole_grains_sum1_score","fish_sum1_score","bean_sum1_score","poultry_sum1_score",
                                                                     "red_meat_sum1_score","Pastries_sweets_sum1_score","wine_sum1_score")]
UKBdata2$MIND_sum_outfast_3group<- cut(UKBdata2$MIND_sum_outfast, 
                                       breaks = quantile(UKBdata2$MIND_sum_outfast, probs = c(0, 0.33, 0.66, 1)), include.lowest = TRUE, labels = FALSE)#三分位分组
table(UKBdata2$MIND_sum_outfast_3group)
table(UKBdata2$MIND_sum_outfast_3group,UKBdata2$status)
#排除Pastries
UKBdata2[,MIND_sum_outPastries:= rowSums(.SD, na.rm = TRUE), .SDcols = c("Green_Leafy_Vegetables_sum1_score","Other_Vegetables_sum1_score",
                                                                         "Berries_sum1_score","Nuts_sum1_score","Butter_sum1_score","cheese_sum1_score",
                                                                         "Whole_grains_sum1_score","fish_sum1_score","bean_sum1_score","poultry_sum1_score",
                                                                         "red_meat_sum1_score","fastfried_food_sum1_score","wine_sum1_score")]
UKBdata2$MIND_sum_outPastries_3group<- cut(UKBdata2$MIND_sum_outPastries, 
                                           breaks = quantile(UKBdata2$MIND_sum_outPastries, probs = c(0, 0.33, 0.66, 1)), include.lowest = TRUE, labels = FALSE)#三分位分组
table(UKBdata2$MIND_sum_outPastries_3group)
table(UKBdata2$MIND_sum_outPastries_3group,UKBdata2$status)
#排除wine
UKBdata2[,MIND_sum_outwine:= rowSums(.SD, na.rm = TRUE), .SDcols = c("Green_Leafy_Vegetables_sum1_score","Other_Vegetables_sum1_score",
                                                                     "Berries_sum1_score","Nuts_sum1_score","Butter_sum1_score","cheese_sum1_score",
                                                                     "Whole_grains_sum1_score","fish_sum1_score","bean_sum1_score","poultry_sum1_score",
                                                                     "red_meat_sum1_score","fastfried_food_sum1_score","Pastries_sweets_sum1_score")]
UKBdata2$MIND_sum_outwine_3group<- cut(UKBdata2$MIND_sum_outwine, 
                                       breaks = quantile(UKBdata2$MIND_sum_outwine, probs = c(0, 0.33, 0.66, 1)), include.lowest = TRUE, labels = FALSE)#三分位分组
table(UKBdata2$MIND_sum_outwine_3group)
table(UKBdata2$MIND_sum_outwine_3group,UKBdata2$status)
library(survival)
#Model 4进一步调整Total_Cholesterol,HDL,tri,CRP,monocyte_count,Albumin
colnames(UKBdata2)
var_list <- colnames(UKBdata2[,c(267,269,271,273,275,277,279,281,283,285,287,289,291,293)]) # 变量列表
result <- c() # 结果向量
for (var in var_list) {
  fit<-coxph(Surv(recruitment_age,status)~eval(parse(text = var))+energy+sex+education+
               famaliy_history+Townsend_deprivation_index2+household_income+
               smoking_status+alochol_drinking+weekly_activity+
               BMI+whr+SBP,data=UKBdata2)
  HR <- exp(fit$coefficients[1])
  CI_lower <- summary(fit)$conf.int[1, 3]
  CI_upper <- summary(fit)$conf.int[1, 4]
  p_value <- summary(fit)$coef[1, 5]
  result <- rbind(result, c(HR, CI_lower, CI_upper, p_value))
}
write.csv(result,"E:/deskbook/table2_3.csv",row.names = F)
result<-c()
for (i in UKBdata2[,c(268,270,272,274,276,278,280,282,284,286,288,290,292,294)]){
  UKBdata2$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=UKBdata2)
  result<-rbind(result,c(exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
write.csv(result,"E:/deskbook/table2_4.csv",row.names = F)
#MEDAS####
#MEDAS_sum_outvegetable
UKBdata2[,MEDAS_sum_outvegetable:= rowSums(.SD, na.rm = TRUE), .SDcols = c("fruit_sum1_score",
                                                                           "Mred_meat_sum1_score","MButter_sum1_score","MSweetened_sum1_score",
                                                                           "Mwine_sum1_score","Mbean_sum1_score","Mfish_sum1_score","MPastries_sweets_sum1_score",
                                                                           "MNuts_sum1_score","Mpoultry_sum1_score")]
UKBdata2$MEDAS_sum_outvegetable_3group<- cut(UKBdata2$MEDAS_sum_outvegetable, 
                                             breaks = quantile(UKBdata2$MEDAS_sum_outvegetable, probs = c(0, 0.33, 0.66, 1)), include.lowest = TRUE, labels = FALSE)#三分位分组
table(UKBdata2$MEDAS_sum_outvegetable_3group)
table(UKBdata2$MEDAS_sum_outvegetable_3group,UKBdata2$status)
#MEDAS_sum_outFruits
UKBdata2[,MEDAS_sum_outFruits:= rowSums(.SD, na.rm = TRUE), .SDcols = c("Vegetables_sum1_score",
                                                                        "Mred_meat_sum1_score","MButter_sum1_score","MSweetened_sum1_score",
                                                                        "Mwine_sum1_score","Mbean_sum1_score","Mfish_sum1_score","MPastries_sweets_sum1_score",
                                                                        "MNuts_sum1_score","Mpoultry_sum1_score")]
UKBdata2$MEDAS_sum_outFruits_3group<- cut(UKBdata2$MEDAS_sum_outFruits, 
                                          breaks = quantile(UKBdata2$MEDAS_sum_outFruits, probs = c(0, 0.33, 0.66, 1)), include.lowest = TRUE, labels = FALSE)#三分位分组
table(UKBdata2$MEDAS_sum_outFruits_3group)
table(UKBdata2$MEDAS_sum_outFruits_3group,UKBdata2$status)
#MEDAS_sum_outNuts 
UKBdata2[,MEDAS_sum_outNuts:= rowSums(.SD, na.rm = TRUE), .SDcols = c("Vegetables_sum1_score","fruit_sum1_score",
                                                                      "Mred_meat_sum1_score","MButter_sum1_score","MSweetened_sum1_score",
                                                                      "Mwine_sum1_score","Mbean_sum1_score","Mfish_sum1_score","MPastries_sweets_sum1_score",
                                                                      "Mpoultry_sum1_score")]
UKBdata2$MEDAS_sum_outNuts_3group<- cut(UKBdata2$MEDAS_sum_outNuts, 
                                        breaks = quantile(UKBdata2$MEDAS_sum_outNuts, probs = c(0, 0.33, 0.66, 1)), include.lowest = TRUE, labels = FALSE)#三分位分组
table(UKBdata2$MEDAS_sum_outNuts_3group)
table(UKBdata2$MEDAS_sum_outNuts_3group,UKBdata2$status)
#MEDAS_sum_outButter 
UKBdata2[,MEDAS_sum_outButter:= rowSums(.SD, na.rm = TRUE), .SDcols = c("Vegetables_sum1_score","fruit_sum1_score","MNuts_sum1_score",
                                                                        "Mred_meat_sum1_score","MSweetened_sum1_score",
                                                                        "Mwine_sum1_score","Mbean_sum1_score","Mfish_sum1_score","MPastries_sweets_sum1_score",
                                                                        "Mpoultry_sum1_score")]
UKBdata2$MEDAS_sum_outButter_3group<- cut(UKBdata2$MEDAS_sum_outButter, 
                                          breaks = quantile(UKBdata2$MEDAS_sum_outButter, probs = c(0, 0.33, 0.66, 1)), include.lowest = TRUE, labels = FALSE)#三分位分组
table(UKBdata2$MEDAS_sum_outButter_3group)
table(UKBdata2$MEDAS_sum_outButter_3group,UKBdata2$status)
#MEDAS_sum_outSeafood
UKBdata2[,MEDAS_sum_outSeafood:= rowSums(.SD, na.rm = TRUE), .SDcols = c("Vegetables_sum1_score","fruit_sum1_score","MNuts_sum1_score","MButter_sum1_score",
                                                                         "Mred_meat_sum1_score","MSweetened_sum1_score",
                                                                         "Mwine_sum1_score","Mbean_sum1_score","MPastries_sweets_sum1_score",
                                                                         "Mpoultry_sum1_score")]
UKBdata2$MEDAS_sum_outSeafood_3group<- cut(UKBdata2$MEDAS_sum_outSeafood, 
                                           breaks = quantile(UKBdata2$MEDAS_sum_outSeafood, probs = c(0, 0.33, 0.66, 1)), include.lowest = TRUE, labels = FALSE)#三分位分组
table(UKBdata2$MEDAS_sum_outSeafood_3group)
table(UKBdata2$MEDAS_sum_outSeafood_3group,UKBdata2$status)
#MEDAS_sum_outLegumes
UKBdata2[,MEDAS_sum_outLegumes:= rowSums(.SD, na.rm = TRUE), .SDcols = c("Vegetables_sum1_score","fruit_sum1_score","MNuts_sum1_score","MButter_sum1_score",
                                                                         "Mfish_sum1_score","Mred_meat_sum1_score","MSweetened_sum1_score",
                                                                         "Mwine_sum1_score","MPastries_sweets_sum1_score",
                                                                         "Mpoultry_sum1_score")]
UKBdata2$MEDAS_sum_outLegumes_3group<- cut(UKBdata2$MEDAS_sum_outLegumes, 
                                           breaks = quantile(UKBdata2$MEDAS_sum_outLegumes, probs = c(0, 0.33, 0.66, 1)), include.lowest = TRUE, labels = FALSE)#三分位分组
table(UKBdata2$MEDAS_sum_outLegumes_3group)
table(UKBdata2$MEDAS_sum_outLegumes_3group,UKBdata2$status)
#MEDAS_sum_outPoultry
UKBdata2[,MEDAS_sum_outPoultry:= rowSums(.SD, na.rm = TRUE), .SDcols = c("Vegetables_sum1_score","fruit_sum1_score","MNuts_sum1_score","MButter_sum1_score",
                                                                         "Mfish_sum1_score","Mbean_sum1_score","Mred_meat_sum1_score","MSweetened_sum1_score",
                                                                         "Mwine_sum1_score","MPastries_sweets_sum1_score")]
UKBdata2$MEDAS_sum_outPoultry_3group<- cut(UKBdata2$MEDAS_sum_outPoultry, 
                                           breaks = quantile(UKBdata2$MEDAS_sum_outPoultry, probs = c(0, 0.33, 0.66, 1)), include.lowest = TRUE, labels = FALSE)#三分位分组
table(UKBdata2$MEDAS_sum_outPoultry_3group)
table(UKBdata2$MEDAS_sum_outPoultry_3group,UKBdata2$status)
#MEDAS_sum_outred
UKBdata2[,MEDAS_sum_outred:= rowSums(.SD, na.rm = TRUE), .SDcols = c("Vegetables_sum1_score","fruit_sum1_score","MNuts_sum1_score","MButter_sum1_score",
                                                                     "Mfish_sum1_score","Mbean_sum1_score","Mpoultry_sum1_score","MSweetened_sum1_score",
                                                                     "Mwine_sum1_score","MPastries_sweets_sum1_score")]
UKBdata2$MEDAS_sum_outred_3group<- cut(UKBdata2$MEDAS_sum_outred, 
                                       breaks = quantile(UKBdata2$MEDAS_sum_outred, probs = c(0, 0.33, 0.66, 1)), include.lowest = TRUE, labels = FALSE)#三分位分组
table(UKBdata2$MEDAS_sum_outred_3group)
table(UKBdata2$MEDAS_sum_outred_3group,UKBdata2$status)
#MEDAS_sum_outPastries
UKBdata2[,MEDAS_sum_outPastries:= rowSums(.SD, na.rm = TRUE), .SDcols = c("Vegetables_sum1_score","fruit_sum1_score","MNuts_sum1_score","MButter_sum1_score",
                                                                          "Mfish_sum1_score","Mbean_sum1_score","Mpoultry_sum1_score","MSweetened_sum1_score",
                                                                          "Mwine_sum1_score","Mred_meat_sum1_score")]
UKBdata2$MEDAS_sum_outPastries_3group<- cut(UKBdata2$MEDAS_sum_outPastries, 
                                            breaks = quantile(UKBdata2$MEDAS_sum_outPastries, probs = c(0, 0.33, 0.66, 1)), include.lowest = TRUE, labels = FALSE)#三分位分组
table(UKBdata2$MEDAS_sum_outPastries_3group)
table(UKBdata2$MEDAS_sum_outPastries_3group,UKBdata2$status)
#MEDAS_sum_outWine
UKBdata2[,MEDAS_sum_outWine:= rowSums(.SD, na.rm = TRUE), .SDcols = c("Vegetables_sum1_score","fruit_sum1_score","MNuts_sum1_score","MButter_sum1_score",
                                                                      "Mfish_sum1_score","Mbean_sum1_score","Mpoultry_sum1_score","MSweetened_sum1_score",
                                                                      "Mred_meat_sum1_score","MPastries_sweets_sum1_score")]
UKBdata2$MEDAS_sum_outWine_3group<- cut(UKBdata2$MEDAS_sum_outWine, 
                                        breaks = quantile(UKBdata2$MEDAS_sum_outWine, probs = c(0, 0.33, 0.66, 1)), include.lowest = TRUE, labels = FALSE)#三分位分组
table(UKBdata2$MEDAS_sum_outWine_3group)
table(UKBdata2$MEDAS_sum_outWine_3group,UKBdata2$status)
#MEDAS_sum_outsweetened
UKBdata2[,MEDAS_sum_outsweetened:= rowSums(.SD, na.rm = TRUE), .SDcols = c("Vegetables_sum1_score","fruit_sum1_score","MNuts_sum1_score","MButter_sum1_score",
                                                                           "Mfish_sum1_score","Mbean_sum1_score","Mpoultry_sum1_score","Mwine_sum1_score",
                                                                           "Mred_meat_sum1_score","MPastries_sweets_sum1_score")]
UKBdata2$MEDAS_sum_outsweetened_3group<- cut(UKBdata2$MEDAS_sum_outsweetened, 
                                             breaks = quantile(UKBdata2$MEDAS_sum_outsweetened, probs = c(0, 0.33, 0.66, 1)), include.lowest = TRUE, labels = FALSE)#三分位分组
table(UKBdata2$MEDAS_sum_outsweetened_3group)
table(UKBdata2$MEDAS_sum_outsweetened_3group,UKBdata2$status)
#Model 4进一步调整Total_Cholesterol,HDL,tri,CRP,monocyte_count,Albumin
colnames(UKBdata2)
var_list <- colnames(UKBdata2[,c(302,304,306,308,310,312,314,316,318,320,322)]) # 变量列表
result <- c() # 结果向量
for (var in var_list) {
  fit<-coxph(Surv(recruitment_age,status)~eval(parse(text = var))+energy+sex+education+
               famaliy_history+Townsend_deprivation_index2+household_income+
               smoking_status+alochol_drinking+weekly_activity+
               BMI+whr+SBP,data=UKBdata2)
  HR <- exp(fit$coefficients[1])
  CI_lower <- summary(fit)$conf.int[1, 3]
  CI_upper <- summary(fit)$conf.int[1, 4]
  p_value <- summary(fit)$coef[1, 5]
  result <- rbind(result, c(HR, CI_lower, CI_upper, p_value))
}
write.csv(result,"E:/deskbook/table2_3.csv",row.names = F)
result<-c()
for (i in UKBdata2[,c(303,305,307,309,311,313,315,317,319,321,323)]){
  UKBdata2$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=UKBdata2)
  result<-rbind(result,c(exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
write.csv(result,"E:/deskbook/table2_4.csv",row.names = F)
#3.分为四分位和五分位数分别计算####
colnames(UKBdata2)
UKBdata2$MIND_sum1_4group<- cut(UKBdata2$MIND_sum1, 
                                breaks = quantile(UKBdata2$MIND_sum1, probs = c(0, 0.25, 0.50,0.75, 1)), include.lowest = TRUE, labels = FALSE)#四分位分组
UKBdata2$MEDAS_sum1_4group<- cut(UKBdata2$MEDAS_sum1, 
                                 breaks = quantile(UKBdata2$MEDAS_sum1, probs = c(0, 0.25, 0.50,0.75, 1)), include.lowest = TRUE, labels = FALSE)#四分位分组
UKBdata2$MEDAS_sum1_5group<- cut(UKBdata2$MEDAS_sum1, 
                                 breaks = quantile(UKBdata2$MEDAS_sum1, probs = c(0, 0.20, 0.40,0.60,0.80, 1)), include.lowest = TRUE, labels = FALSE)#五分位分组
table(UKBdata2$MIND_sum1_4group)
table(UKBdata2$MIND_sum1_4group,UKBdata2$status)
table(UKBdata2$MEDAS_sum1_4group)
table(UKBdata2$MEDAS_sum1_4group,UKBdata2$status)
table(UKBdata2$MIND_sum1_5group)
table(UKBdata2$MIND_sum1_5group,UKBdata2$status)
table(UKBdata2$MEDAS_sum1_5group)
table(UKBdata2$MEDAS_sum1_5group,UKBdata2$status)
#model 4
result<-c()
for (i in UKBdata2[,c(330,331)]){
  UKBdata2$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+Total_Cholesterol+HDL_cholesterol+Triglycerides+CRP+monocyte_count+Albumin,data=UKBdata2)
  result<-rbind(result,c(exp(fiti$coefficients[1:3]),summary(fiti)$conf.int[1:3,3:4],summary(fiti)$coef[1:3,5]))
}
write.csv(result,"D:/deskbook/table2_4.csv",row.names = F)
result<-c()
for (i in UKBdata2[,c(272,332)]){
  UKBdata2$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+Total_Cholesterol+HDL_cholesterol+Triglycerides+CRP+monocyte_count+Albumin,data=UKBdata2)
  result<-rbind(result,c(exp(fiti$coefficients[1:4]),summary(fiti)$conf.int[1:4,3:4],summary(fiti)$coef[1:4,5]))
}
write.csv(result,"D:/deskbook/table2_5.csv",row.names = F)
#4.排除肿瘤发生在前两年的个体####
table(UKBdata2$paichuqianliangnian)
library(tidyverse)
UKBdata3<-UKBdata2%>%filter((paichuqianliangnian!=1)%>% replace_na(TRUE))
#
table(UKBdata3$MIND_sum1_3group)
table(UKBdata3$MEDAS_sum1_3group)
table(UKBdata3$MIND_sum1_3group,UKBdata3$status)
table(UKBdata3$MEDAS_sum1_3group,UKBdata3$status)
library(survival)
#Model 1仅进行能量调整
colnames(UKBdata3)
result<-c()
var_list<-colnames(UKBdata3[,c(168,59)])
for (var in var_list){
  fit<-coxph(Surv(recruitment_age,status)~eval(parse(text = var))+energy,data=UKBdata3)
  HR <- exp(fit$coefficients[1])
  CI_lower <- summary(fit)$conf.int[1, 3]
  CI_upper <- summary(fit)$conf.int[1, 4]
  p_value <- summary(fit)$coef[1, 5]
  result <- rbind(result, c(HR, CI_lower, CI_upper, p_value))
}
write.csv(result,"E:/deskbook/table2_1.csv",row.names = F)
result<-c()
for (i in UKBdata3[,c(298,297)]){
  UKBdata3$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy,data=UKBdata3)
  result<-rbind(result,c(exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
write.csv(result,"E:/deskbook/table2_2.csv",row.names = F)
#Model 2进一步调整sex,education,income, index, family history
result<-c()
var_list<-colnames(UKBdata3[,c(168,59)])
for (var in var_list){
  fit<-coxph(Surv(recruitment_age,status)~eval(parse(text = var))+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income,data=UKBdata3)
  HR <- exp(fit$coefficients[1])
  CI_lower <- summary(fit)$conf.int[1, 3]
  CI_upper <- summary(fit)$conf.int[1, 4]
  p_value <- summary(fit)$coef[1, 5]
  result <- rbind(result, c(HR, CI_lower, CI_upper, p_value))
}
write.csv(result,"E:/deskbook/table2_3.csv",row.names = F)
result<-c()
for (i in UKBdata3[,c(298,297)]){
  UKBdata3$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income,data=UKBdata3)
  result<-rbind(result,c(exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
write.csv(result,"E:/deskbook/table2_4.csv",row.names = F)
#Model 3进一步调整Smoking, alcohol, physical activity, BMI, WHR, SBP
result<-c()
var_list<-colnames(UKBdata3[,c(168,59)])
for (var in var_list){
  fit<-coxph(Surv(recruitment_age,status)~eval(parse(text = var))+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=UKBdata3)
  HR <- exp(fit$coefficients[1])
  CI_lower <- summary(fit)$conf.int[1, 3]
  CI_upper <- summary(fit)$conf.int[1, 4]
  p_value <- summary(fit)$coef[1, 5]
  result <- rbind(result, c(HR, CI_lower, CI_upper, p_value))
}
write.csv(result,"E:/deskbook/table2_3.csv",row.names = F)
result<-c()
for (i in UKBdata3[,c(298,297)]){
  UKBdata3$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=UKBdata3)
  result<-rbind(result,c(exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
write.csv(result,"E:/deskbook/table2_4.csv",row.names = F)
#5.进一步调整营养素####
#重新读取数据####
UKBdata2<-fread("D:/deskbook/UKBdata2.csv",header=T)
colnames(UKBdata2)
library(survival)
#Model 5
result<-c()
var_list<-colnames(UKBdata3[,c(168,59)])
for (var in var_list){
  fit<-coxph(Surv(recruitment_age,status)~eval(parse(text = var))+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+
                `100003_1`+`100004_1`+`100005_1`,data=UKBdata2)
  HR <- exp(fit$coefficients[1])
  CI_lower <- summary(fit)$conf.int[1, 3]
  CI_upper <- summary(fit)$conf.int[1, 4]
  p_value <- summary(fit)$coef[1, 5]
  result <- rbind(result, c(HR, CI_lower, CI_upper, p_value))
}
write.csv(result,"E:/deskbook/table2_3.csv",row.names = F)
result<-c()
for (i in UKBdata2[,c(298,297)]){
  UKBdata2$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+
                `100003_1`+`100004_1`+`100005_1`,data=UKBdata2)
  result<-rbind(result,c(exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
write.csv(result,"E:/deskbook/table2_4.csv",row.names = F)
#model 6
result<-c()
var_list<-colnames(UKBdata3[,c(168,59)])
for (var in var_list){
  fit<-coxph(Surv(recruitment_age,status)~eval(parse(text = var))+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+
                `100003_1`+`100004_1`+`100005_1`+`100009_1`,data=UKBdata2)
  HR <- exp(fit$coefficients[1])
  CI_lower <- summary(fit)$conf.int[1, 3]
  CI_upper <- summary(fit)$conf.int[1, 4]
  p_value <- summary(fit)$coef[1, 5]
  result <- rbind(result, c(HR, CI_lower, CI_upper, p_value))
}
write.csv(result,"E:/deskbook/table2_3.csv",row.names = F)
result<-c()
for (i in UKBdata2[,c(298,297)]){
  UKBdata2$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+
                `100003_1`+`100004_1`+`100005_1`+`100009_1`,data=UKBdata2)
  result<-rbind(result,c(exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
write.csv(result,"E:/deskbook/table2_4.csv",row.names = F)
#6.排除每种肿瘤####
#nohead#
table(UKBdata2$various_cancer)
data_nohead<-subset(UKBdata2,various_cancer!="head_and_neck")
table(data_nohead$MEDAS_sum1_3group)
result_nohead<-c()
for (i in data_nohead[,c(298,297)]){
  data_nohead$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_nohead)
  result_nohead<-rbind(result_nohead,c(table(data_nohead$i),table(data_nohead$i,data_nohead$status)[,2],
                                       exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_nohead)<-c("x1","x2","x3","x11","x12","x13","HR_1","HR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_nohead<-data.frame(result_nohead)
result_nohead<-result_nohead%>% mutate(cancer=c("nohead"),.before=x1)
#noesophagus#
data_noesophagus<-subset(UKBdata2,various_cancer!="esophagus")
result_noesophagus<-c()
for (i in data_noesophagus[,c(298,297)]){
  data_noesophagus$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_noesophagus)
  result_noesophagus<-rbind(result_noesophagus,c(table(data_noesophagus$i),table(data_noesophagus$i,data_noesophagus$status)[,2],
                                                 exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_noesophagus)<-c("x1","x2","x3","x11","x12","x13","HR_1","HR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_noesophagus<-data.frame(result_noesophagus)
result_noesophagus<-result_noesophagus%>% mutate(cancer=c("noesophagus"),.before=x1)
#nostomach#
data_nostomach<-subset(UKBdata2,various_cancer!="stomach")
result_nostomach<-c()
for (i in data_nostomach[,c(298,297)]){
  data_nostomach$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_nostomach)
  result_nostomach<-rbind(result_nostomach,c(table(data_nostomach$i),table(data_nostomach$i,data_nostomach$status)[,2],
                                             exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_nostomach)<-c("x1","x2","x3","x11","x12","x13","HR_1","HR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_nostomach<-data.frame(result_nostomach)
result_nostomach<-result_nostomach%>% mutate(cancer=c("nostomach"),.before=x1)
#nocolorectal#
data_nocolorectal<-subset(UKBdata2,various_cancer!="colorectal")
result_nocolorectal<-c()
for (i in data_nocolorectal[,c(298,297)]){
  data_nocolorectal$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_nocolorectal)
  result_nocolorectal<-rbind(result_nocolorectal,c(table(data_nocolorectal$i),table(data_nocolorectal$i,data_nocolorectal$status)[,2],
                                                   exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_nocolorectal)<-c("x1","x2","x3","x11","x12","x13","HR_1","HR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_nocolorectal<-data.frame(result_nocolorectal)
result_nocolorectal<-result_nocolorectal%>% mutate(cancer=c("nocolorectal"),.before=x1)
#noliver#
data_noliver<-subset(UKBdata2,various_cancer!="liver")
result_noliver<-c()
for (i in data_noliver[,c(298,297)]){
  data_noliver$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_noliver)
  result_noliver<-rbind(result_noliver,c(table(data_noliver$i),table(data_noliver$i,data_noliver$status)[,2],
                                         exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_noliver)<-c("x1","x2","x3","x11","x12","x13","HR_1","HR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_noliver<-data.frame(result_noliver)
result_noliver<-result_noliver%>% mutate(cancer=c("noliver"),.before=x1)
#nogallbladder#
data_nogallbladder<-subset(UKBdata2,various_cancer!="gallbladder")
result_nogallbladder<-c()
for (i in data_nogallbladder[,c(298,297)]){
  data_nogallbladder$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_nogallbladder)
  result_nogallbladder<-rbind(result_nogallbladder,c(table(data_nogallbladder$i),table(data_nogallbladder$i,data_nogallbladder$status)[,2],
                                                     exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_nogallbladder)<-c("x1","x2","x3","x11","x12","x13","HR_1","HR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_nogallbladder<-data.frame(result_nogallbladder)
result_nogallbladder<-result_nogallbladder%>% mutate(cancer=c("nogallbladder"),.before=x1)
#nopancreas#
data_nopancreas<-subset(UKBdata2,various_cancer!="pancreas")
result_nopancreas<-c()
for (i in data_nopancreas[,c(298,297)]){
  data_nopancreas$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_nopancreas)
  result_nopancreas<-rbind(result_nopancreas,c(table(data_nopancreas$i),table(data_nopancreas$i,data_nopancreas$status)[,2],
                                               exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_nopancreas)<-c("x1","x2","x3","x11","x12","x13","HR_1","HR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_nopancreas<-data.frame(result_nopancreas)
result_nopancreas<-result_nopancreas%>% mutate(cancer=c("nopancreas"),.before=x1)
#nolung#
data_nolung<-subset(UKBdata2,various_cancer!="lung")
result_nolung<-c()
for (i in data_nolung[,c(298,297)]){
  data_nolung$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_nolung)
  result_nolung<-rbind(result_nolung,c(table(data_nolung$i),table(data_nolung$i,data_nolung$status)[,2],
                                       exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_nolung)<-c("x1","x2","x3","x11","x12","x13","HR_1","HR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_nolung<-data.frame(result_nolung)
result_nolung<-result_nolung%>% mutate(cancer=c("nolung"),.before=x1)
#nomalignant_melanoma#
data_nomalignant_melanoma<-subset(UKBdata2,various_cancer!="malignant_melanoma")
result_nomalignant_melanoma<-c()
for (i in data_nomalignant_melanoma[,c(298,297)]){
  data_nomalignant_melanoma$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_nomalignant_melanoma)
  result_nomalignant_melanoma<-rbind(result_nomalignant_melanoma,c(table(data_nomalignant_melanoma$i),table(data_nomalignant_melanoma$i,data_nomalignant_melanoma$status)[,2],
                                                                   exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_nomalignant_melanoma)<-c("x1","x2","x3","x11","x12","x13","HR_1","HR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_nomalignant_melanoma<-data.frame(result_nomalignant_melanoma)
result_nomalignant_melanoma<-result_nomalignant_melanoma%>% mutate(cancer=c("nomalignant_melanoma"),.before=x1)
#nobreast#
data_nobreast<-subset(UKBdata2,various_cancer!="breast")
result_nobreast<-c()
for (i in data_nobreast[,c(298,297)]){
  data_nobreast$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_nobreast)
  result_nobreast<-rbind(result_nobreast,c(table(data_nobreast$i),table(data_nobreast$i,data_nobreast$status)[,2],
                                           exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_nobreast)<-c("x1","x2","x3","x11","x12","x13","HR_1","HR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_nobreast<-data.frame(result_nobreast)
result_nobreast<-result_nobreast%>% mutate(cancer=c("nobreast"),.before=x1)
#nouterine#
table(UKBdata2$various_cancer)
data_nouterine<-subset(UKBdata2,various_cancer!="uterus_cervix")
table(data_nouterine$various_cancer)
result_nouterine<-c()
for (i in data_nouterine[,c(298,297)]){
  data_nouterine$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_nouterine)
  result_nouterine<-rbind(result_nouterine,c(table(data_nouterine$i),table(data_nouterine$i,data_nouterine$status)[,2],
                                             exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_nouterine)<-c("x1","x2","x3","x11","x12","x13","HR_1","HR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_nouterine<-data.frame(result_nouterine)
result_nouterine<-result_nouterine%>% mutate(cancer=c("nouterine"),.before=x1)
#noovary#
data_noovary<-subset(UKBdata2,various_cancer!="ovary")
result_noovary<-c()
for (i in data_noovary[,c(298,297)]){
  data_noovary$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_noovary)
  result_noovary<-rbind(result_noovary,c(table(data_noovary$i),table(data_noovary$i,data_noovary$status)[,2],
                                         exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_noovary)<-c("x1","x2","x3","x11","x12","x13","HR_1","HR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_noovary<-data.frame(result_noovary)
result_noovary<-result_noovary%>% mutate(cancer=c("noovary"),.before=x1)
#noprostate#
data_noprostate<-subset(UKBdata2,various_cancer!="prostate")
result_noprostate<-c()
for (i in data_noprostate[,c(298,297)]){
  data_noprostate$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_noprostate)
  result_noprostate<-rbind(result_noprostate,c(table(data_noprostate$i),table(data_noprostate$i,data_noprostate$status)[,2],
                                               exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_noprostate)<-c("x1","x2","x3","x11","x12","x13","HR_1","HR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_noprostate<-data.frame(result_noprostate)
result_noprostate<-result_noprostate%>% mutate(cancer=c("noprostate"),.before=x1)
#notestic#
data_notestic<-subset(UKBdata2,various_cancer!="testic")
result_notestic<-c()
for (i in data_notestic[,c(298,297)]){
  data_notestic$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_notestic)
  result_notestic<-rbind(result_notestic,c(table(data_notestic$i),table(data_notestic$i,data_notestic$status)[,2],
                                           exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_notestic)<-c("x1","x2","x3","x11","x12","x13","HR_1","HR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_notestic<-data.frame(result_notestic)
result_notestic<-result_notestic%>% mutate(cancer=c("notestic"),.before=x1)
#nokidney#
data_nokidney<-subset(UKBdata2,various_cancer!="kidney")
result_nokidney<-c()
for (i in data_nokidney[,c(298,297)]){
  print(table(data_nokidney$various_cancer))
  data_nokidney$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_nokidney)
  result_nokidney<-rbind(result_nokidney,c(table(data_nokidney$i),table(data_nokidney$i,data_nokidney$status)[,2],
                                           exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_nokidney)<-c("x1","x2","x3","x11","x12","x13","HR_1","HR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_nokidney<-data.frame(result_nokidney)
result_nokidney<-result_nokidney%>% mutate(cancer=c("nokidney"),.before=x1)
#nobladder#
data_nobladder<-subset(UKBdata2,various_cancer!="bladder")
result_nobladder<-c()
for (i in data_nobladder[,c(298,297)]){
  print(table(data_nobladder$various_cancer))
  data_nobladder$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_nobladder)
  result_nobladder<-rbind(result_nobladder,c(table(data_nobladder$i),table(data_nobladder$i,data_nobladder$status)[,2],
                                             exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_nobladder)<-c("x1","x2","x3","x11","x12","x13","HR_1","HR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_nobladder<-data.frame(result_nobladder)
result_nobladder<-result_nobladder%>% mutate(cancer=c("nobladder"),.before=x1)
#nobrain#
data_nobrain<-subset(UKBdata2,various_cancer!="brain")
result_nobrain<-c()
for (i in data_nobrain[,c(298,297)]){
  print(table(data_nobrain$various_cancer))
  data_nobrain$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_nobrain)
  result_nobrain<-rbind(result_nobrain,c(table(data_nobrain$i),table(data_nobrain$i,data_nobrain$status)[,2],
                                         exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_nobrain)<-c("x1","x2","x3","x11","x12","x13","HR_1","HR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_nobrain<-data.frame(result_nobrain)
result_nobrain<-result_nobrain%>% mutate(cancer=c("nobrain"),.before=x1)
#nothroid#
data_nothroid<-subset(UKBdata2,various_cancer!="thyroid")
result_nothroid<-c()
for (i in data_nothroid[,c(298,297)]){
  print(table(data_nothroid$various_cancer))
  data_nothroid$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_nothroid)
  result_nothroid<-rbind(result_nothroid,c(table(data_nothroid$i),table(data_nothroid$i,data_nothroid$status)[,2],
                                           exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_nothroid)<-c("x1","x2","x3","x11","x12","x13","HR_1","HR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_nothroid<-data.frame(result_nothroid)
result_nothroid<-result_nothroid%>% mutate(cancer=c("nothroid"),.before=x1)
#noHodgkin_lymphoma#
data_noHodgkin_lymphoma<-subset(UKBdata2,various_cancer!="Hodgkin_lymphoma")
result_noHodgkin_lymphoma<-c()
for (i in data_noHodgkin_lymphoma[,c(298,297)]){
  print(table(data_noHodgkin_lymphoma$various_cancer))
  data_noHodgkin_lymphoma$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_noHodgkin_lymphoma)
  result_noHodgkin_lymphoma<-rbind(result_noHodgkin_lymphoma,c(table(data_noHodgkin_lymphoma$i),table(data_noHodgkin_lymphoma$i,data_noHodgkin_lymphoma$status)[,2],
                                                               exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_noHodgkin_lymphoma)<-c("x1","x2","x3","x11","x12","x13","HR_1","HR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_noHodgkin_lymphoma<-data.frame(result_noHodgkin_lymphoma)
result_noHodgkin_lymphoma<-result_noHodgkin_lymphoma%>% mutate(cancer=c("noHodgkin_lymphoma"),.before=x1)
#nonon_Hodgkin_lymphoma#
data_nonon_Hodgkin_lymphoma<-subset(UKBdata2,various_cancer!="non_Hodgkin_lymphoma")
result_nonon_Hodgkin_lymphoma<-c()
for (i in data_nonon_Hodgkin_lymphoma[,c(298,297)]){
  print(table(data_nonon_Hodgkin_lymphoma$various_cancer))
  data_nonon_Hodgkin_lymphoma$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_nonon_Hodgkin_lymphoma)
  result_nonon_Hodgkin_lymphoma<-rbind(result_nonon_Hodgkin_lymphoma,c(table(data_nonon_Hodgkin_lymphoma$i),table(data_nonon_Hodgkin_lymphoma$i,data_nonon_Hodgkin_lymphoma$status)[,2],
                                                                       exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_nonon_Hodgkin_lymphoma)<-c("x1","x2","x3","x11","x12","x13","HR_1","HR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_nonon_Hodgkin_lymphoma<-data.frame(result_nonon_Hodgkin_lymphoma)
result_nonon_Hodgkin_lymphoma<-result_nonon_Hodgkin_lymphoma%>% mutate(cancer=c("nonon_Hodgkin_lymphoma"),.before=x1)
#nomultiple_myeloma#
data_nomultiple_myeloma<-subset(UKBdata2,various_cancer!="multiple_myeloma")
result_nomultiple_myeloma<-c()
for (i in data_nomultiple_myeloma[,c(298,297)]){
  print(table(data_nomultiple_myeloma$various_cancer))
  data_nomultiple_myeloma$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_nomultiple_myeloma)
  result_nomultiple_myeloma<-rbind(result_nomultiple_myeloma,c(table(data_nomultiple_myeloma$i),table(data_nomultiple_myeloma$i,data_nomultiple_myeloma$status)[,2],
                                                               exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_nomultiple_myeloma)<-c("x1","x2","x3","x11","x12","x13","HR_1","HR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_nomultiple_myeloma<-data.frame(result_nomultiple_myeloma)
result_nomultiple_myeloma<-result_nomultiple_myeloma%>% mutate(cancer=c("nomultiple_myeloma"),.before=x1)
#noleukemia#
data_noleukemia<-subset(UKBdata2,various_cancer!="leukemia")
result_noleukemia<-c()
for (i in data_noleukemia[,c(298,297)]){
  print(table(data_noleukemia$various_cancer))
  data_noleukemia$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=data_noleukemia)
  result_noleukemia<-rbind(result_noleukemia,c(table(data_noleukemia$i),table(data_noleukemia$i,data_noleukemia$status)[,2],
                                               exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_noleukemia)<-c("x1","x2","x3","x11","x12","x13","HR_1","HR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_noleukemia<-data.frame(result_noleukemia)
result_noleukemia<-result_noleukemia%>% mutate(cancer=c("noleukemia"),.before=x1)
#合并起来
result_nopancancer<-rbind(result_nohead,result_noesophagus,result_nostomach,result_nocolorectal,
                          result_noliver,result_nogallbladder,result_nopancreas,result_nolung,
                          result_nomalignant_melanoma,result_nobreast,result_nouterine,
                          result_noovary,result_noprostate,result_notestic,result_nokidney,
                          result_nobladder,result_nobrain,result_nothroid,result_noHodgkin_lymphoma,
                          result_nonon_Hodgkin_lymphoma,result_nomultiple_myeloma,result_noleukemia)
write.csv(result_nopancancer,"E:/deskbook/result_nopancancer.csv",row.names = F)
#7.排除自评幸福感差的人群####
UKBdata2<-fread("E:/deskbook/UKBdata2.csv",header=T)
happiness<-fread("E:/deskbook/happiness.csv",header=T)
happiness$rating<-happiness[["2178-0.0"]]
summary(happiness$rating)
happiness2<-subset(happiness,select=c(1,6))
UKBdata2<-merge(UKBdata2,happiness2,by="eid",all.x = T)
table(UKBdata2$rating)
UKBdata2_3<-UKBdata2%>%filter(UKBdata2$rating==1|UKBdata2$rating==2)
table(UKBdata2_3$MIND_sum1_3group)
table(UKBdata2_3$MIND_sum1_3group,UKBdata2_3$status)
table(UKBdata2_3$MEDAS_sum1_3group)
table(UKBdata2_3$MEDAS_sum1_3group,UKBdata2_3$status)
library(survival)
colnames(UKBdata2_3)
#model 1
result<-c()
var_list<-colnames(UKBdata2_3[,c(168,59)])
for (var in var_list){
  fit<-coxph(Surv(recruitment_age,status)~eval(parse(text = var))+energy,data=UKBdata2_3)
  HR <- exp(fit$coefficients[1])
  CI_lower <- summary(fit)$conf.int[1, 3]
  CI_upper <- summary(fit)$conf.int[1, 4]
  p_value <- summary(fit)$coef[1, 5]
  result <- rbind(result, c(HR, CI_lower, CI_upper, p_value))
}
write.csv(result,"E:/deskbook/table2_3.csv",row.names = F)
result<-c()
for (i in UKBdata2_3[,c(298,297)]){
  UKBdata2_3$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy,data=UKBdata2_3)
  result<-rbind(result,c(exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
write.csv(result,"E:/deskbook/table2_4.csv",row.names = F)
#Model 2进一步调整sex,education,income, index, family history
result<-c()
var_list<-colnames(UKBdata2_3[,c(168,59)])
for (var in var_list){
  fit<-coxph(Surv(recruitment_age,status)~eval(parse(text = var))+energy+sex+education+
               famaliy_history+Townsend_deprivation_index2+household_income,data=UKBdata2_3)
  HR <- exp(fit$coefficients[1])
  CI_lower <- summary(fit)$conf.int[1, 3]
  CI_upper <- summary(fit)$conf.int[1, 4]
  p_value <- summary(fit)$coef[1, 5]
  result <- rbind(result, c(HR, CI_lower, CI_upper, p_value))
}
write.csv(result,"E:/deskbook/table2_3.csv",row.names = F)
result<-c()
for (i in UKBdata2_3[,c(298,297)]){
  UKBdata2_3$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income,data=UKBdata2_3)
  result<-rbind(result,c(exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
write.csv(result,"E:/deskbook/table2_4.csv",row.names = F)
#Model 3进一步调整Smoking, alcohol, physical activity, BMI, WHR, SBP
result<-c()
var_list<-colnames(UKBdata2_3[,c(168,59)])
for (var in var_list){
  fit<-coxph(Surv(recruitment_age,status)~eval(parse(text = var))+energy+sex+education+
               famaliy_history+Townsend_deprivation_index2+household_income+
               smoking_status+alochol_drinking+weekly_activity+
               BMI+whr+SBP,data=UKBdata2_3)
  HR <- exp(fit$coefficients[1])
  CI_lower <- summary(fit)$conf.int[1, 3]
  CI_upper <- summary(fit)$conf.int[1, 4]
  p_value <- summary(fit)$coef[1, 5]
  result <- rbind(result, c(HR, CI_lower, CI_upper, p_value))
}
write.csv(result,"E:/deskbook/table2_3.csv",row.names = F)
result<-c()
for (i in UKBdata2_3[,c(298,297)]){
  UKBdata2_3$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=UKBdata2_3)
  result<-rbind(result,c(exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
write.csv(result,"E:/deskbook/table2_4.csv",row.names = F)


#8.使用填补数据进行筛选####
#导入NMR的数据####
NMR<-fread("D:/deskbook/NMR.csv",header=T)
NMR_subset1<-subset(NMR,select=c(3:338))
NMR_subset2<-subset(NMR,select=c(1:2))
colnames(NMR)
# 筛选出基线随访的列
selected_columns <- which(seq_len(ncol(NMR_subset1)) %% 2 == 1)
# 按照条件对列进行排序
sorted_columns <- c(selected_columns, setdiff(seq_len(ncol(NMR_subset1)), selected_columns))
# 根据排序后的列名生成新的数据框
new_data1 <- NMR_subset1[, ..sorted_columns]
colnames(new_data1)
NMR_subset1<-subset(new_data1 ,select=c(1:168))
NMR<-cbind(NMR_subset2,NMR_subset1)
colnames(NMR)
#删除缺失NMR的数据，剩余118021
library(tidyverse)
NMR2<-NMR%>%filter(!(is.na(`23409-0.0`)&is.na(`23410-0.0`)&
                       is.na(`23578-0.0`)&is.na(`23552-0.0`)))
#合并在excel整理的ICD数据
ICD<-fread("D:/deskbook/ICDjianlue2.csv",header=T)
colnames(ICD)
ICD<-subset(ICD,select=c(1:15,22:25))
NMR3<-merge(NMR2,ICD,by='eid',all.x = T)
#排除基线患有恶性肿瘤的,剩余110913例
NMR4<-filter(NMR3,exclude!=3) #剩余110913例
#删除基线使用降脂药,剩余91724
medication<-fread("D:/deskbook/medication.csv",header=T)
NMR5<-merge(NMR4,medication,by='eid',all.x = T)
NMR6<-filter(NMR5,medication==0)#剩余91724
#合并家族史和教育程度
education<-fread("D:/deskbook/education_family_history.csv",header=T)#3 variable
NMR7<-merge(NMR6,education,by='eid',all.x = T) #182343 obs 1378 vars
NMR7$education[NMR7$education==3]<-NA
NMR7$famaliy_history[NMR7$famaliy_history==3]<-NA
#导入cov
cov<-fread("D:/deskbook/cov.csv",header=T)
#合并sex和Townsend_deprivation_index
cov<-merge(cov,NMR_subset2,by="eid",all.x = T)
food<-fread("D:/deskbook/food.csv",header=T)
colnames(food)
cov_1<-subset(food,select=c(1,26))
cov<-merge(cov,cov_1,by="eid",all.x = T)
colnames(cov)
write.csv(cov,"D:/deskbook/cov.csv",row.names = F)
#整理变量
cov$shifang<-cov$`190-0.0`
cov$whr<-cov$`48-0.0`/cov$`49-0.0`
cov$household_income<-ifelse(cov$`738-0.0`<=2,0,1)
cov$weekly_activity<-ifelse(cov$`884-0.0`>=0&cov$`904-0.0`>=0,
                            rowMeans((select(cov,c(`884-0.0`,`904-0.0`)))),
                            ifelse(cov$`884-0.0`<0&cov$`904-0.0`<0,NA,
                                   ifelse(cov$`884-0.0`<0,cov$`904-0.0`,
                                          ifelse(cov$`904-0.0`<0,cov$`884-0.0`,0))))
cov$`1160-0.0`[cov$`1160-0.0`<=0]<-NA
cov$sleep_duration<-cov$`1160-0.0`
cov$smoking_status<-ifelse(cov$`1239-0.0`==1|cov$`1239-0.0`==2,3,ifelse(
  cov$`1249-0.0`==1,2,ifelse(cov$`1249-0.0`==2,1,
                             ifelse(cov$`1249-0.0`==3,0,
                                    ifelse(cov$`1249-0.0`==4,0,ifelse(cov$`1239-0.0`==0,0,NA))))))
cov$smoking_status<-factor(cov$smoking_status,levels=c(0,1,2,3),labels = c("Never","Former occasional smoker","Former regular smoker","Current somker"))
cov$alochol_drinking<-ifelse(cov$`1558-0.0`<=3&cov$`1558-0.0`>=1,2,
                             ifelse(cov$`1558-0.0`>=4&cov$`1558-0.0`<=5,1,
                                    ifelse(cov$`1558-0.0`==6,0,NA)))
cov$alochol_drinking<-factor(cov$alochol_drinking,levels = c(0,1,2),labels = c("Never","Occasional drinker","Regular drinker"))
cov$SBP<-cov$`4079-0.0`
cov$BMI<-cov$`21001-0.0`
cov$recruitment_age<-cov$`21022-0.0`
cov$CRP<-cov$`30710-0.0`
cov$Total_Cholesterol<-cov$`30690-0.0`
cov$HDL_cholesterol<-cov$`30760-0.0`
cov$Triglycerides<-cov$`30870-0.0`
cov$monocyte_count<-cov$`30130-0.0`
cov$Albumin<-cov$`30600-0.0`
cov$sex<-cov$`31-0.0`
cov$Townsend_deprivation_index<-cov$`189-0.0`
colnames(cov)
cov2<-subset(cov,select=c(1,110:125,128:129))
NMR8<-merge(NMR7,cov2,by="eid",all.x = T)
#删除失访的人群
NMR8<-NMR8%>%filter(is.na(shifang))# 原来有91724，剩余91465
#删除协变量缺失值 剩余85598 obs
NMR9<-NMR8%>%filter(!(is.na(famaliy_history)|is.na(education)|
                        is.na(Townsend_deprivation_index)|is.na(whr)|
                        is.na(BMI)|is.na(Total_Cholesterol)|is.na(household_income)|
                        is.na(smoking_status)))
colnames(NMR9)
NMR9<-subset(NMR9,select=-c(2,172))
missing_vals<-colSums(is.na(NMR9))
print(missing_vals)
#使用多重插补进行插补
NMR9_1<-subset(NMR9,select=c(2:169))
NMR9_2<-subset(NMR9,select=c(1,184:185,188:207))
library(mice)
names<-colnames(NMR9_1)
new_col_names <- paste("x", 1:168, sep = "")
names(NMR9_1)[1:168] <- new_col_names
tianbu<-mice(NMR9_1,m=5)
NMR9_1<-complete(tianbu,action=2)
#对代谢物进行log(x+1)转化和归一化####
n<-nrow(NMR9_1)
log_NMR9_1<-data.frame(matrix(0,n,ncol(NMR9_1)))
for (i in 1:ncol(NMR9_1)){
  log_NMR9_1[[i]]<-log(NMR9_1[[i]]+1)
}
log_NMR9_1<-scale(log_NMR9_1)
log_NMR9_2<-data.frame(log_NMR9_1)
#导入之前的NMR9的数据合并基本特征
NMR9<-fread("D:/deskbook/NMR9.csv",header=T)
colnames(NMR9)
names<-colnames(NMR9[,25:192])
colnames(log_NMR9_2)<-names
NMR9_3<-subset(NMR9,select=c(1:24))
NMR9_5<-subset(NMR9,select=c(193))
NMR9<-cbind(NMR9_3,log_NMR9_2,NMR9_5)
colnames(NMR9)
#导出
write.csv(NMR9,"D:/deskbook/NMR9_tianbu.csv",row.names = F)
#划分为训练集，测试集
library(glmnet)
library(caret)
colnames(NMR9)
set.seed(777)
training.samples <- NMR9$status %>%
  createDataPartition(p = 0.6, list = FALSE)
train_data<- NMR9[training.samples, ]
test_data<- NMR9[-training.samples, ]
table(train_data$status)#44992 controls 6367 cases
table(test_data$status)#30075 controls 4164 cases
metabolites<-subset(train_data,select=-c(1:24,193,32:33,56:57,74:82,85:86,88:112,114:115,
                                         122,129,164,183,185:190,192))
# Build the model using the training set
#生存状态和生存时间需转化为double类型
colnames(train_data)
train_data$recruitment_age<-as.double(train_data$recruitment_age)
train_data$status<-as.double(train_data$status)
y<-as.matrix(Surv(time=train_data$recruitment_age,event=train_data$status))
x<-as.matrix(metabolites)
rownames(x)<-paste0("S",c(1:nrow(x)))#这步变成numeric
#构建模型用deviance
set.seed(1000)
net.fit1<-cv.glmnet(x,y,family="cox",type.measure = "deviance",alpha=0.5,nfolds = 10)
net.fit2<-cv.glmnet(x,y,family="cox",type.measure = "deviance",alpha=0.75,nfolds = 10)
net.fit3<-cv.glmnet(x,y,family="cox",type.measure = "deviance",alpha=1,nfolds = 10)
#看分别是啥
net.fit_1<-glmnet(x,y,family="cox",alpha = 0.5,lambda =net.fit1$lambda.1se)
net.fit_1[["beta"]]
net.fit_2<-glmnet(x,y,family="cox",alpha = 0.75,lambda =net.fit2$lambda.1se)
net.fit_2[["beta"]]
net.fit_3<-glmnet(x,y,family="cox",alpha = 1.00,lambda =net.fit3$lambda.1se)
net.fit_3[["beta"]]

#9.仅针对基线时无恶性肿瘤和良性肿瘤####
colnames(UKBdata2)
table(UKBdata2$Exclusion_2)
UKBdata2_3<-UKBdata2%>%filter(UKBdata2$Exclusion_2!=1)
table(UKBdata2_3$MIND_sum1_3group)
table(UKBdata2_3$MIND_sum1_3group,UKBdata2_3$status)
table(UKBdata2_3$MEDAS_sum1_3group)
table(UKBdata2_3$MEDAS_sum1_3group,UKBdata2_3$status)
library(survival)
colnames(UKBdata2_3)
#model 1
result<-c()
var_list<-colnames(UKBdata2_3[,c(168,59)])
for (var in var_list){
  fit<-coxph(Surv(recruitment_age,status)~eval(parse(text = var))+energy,data=UKBdata2_3)
  HR <- exp(fit$coefficients[1])
  CI_lower <- summary(fit)$conf.int[1, 3]
  CI_upper <- summary(fit)$conf.int[1, 4]
  p_value <- summary(fit)$coef[1, 5]
  result <- rbind(result, c(HR, CI_lower, CI_upper, p_value))
}
write.csv(result,"E:/deskbook/table2_3.csv",row.names = F)
result<-c()
for (i in UKBdata2_3[,c(298,297)]){
  UKBdata2_3$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy,data=UKBdata2_3)
  result<-rbind(result,c(exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
write.csv(result,"E:/deskbook/table2_4.csv",row.names = F)
#Model 2进一步调整sex,education,income, index, family history
result<-c()
var_list<-colnames(UKBdata2_3[,c(168,59)])
for (var in var_list){
  fit<-coxph(Surv(recruitment_age,status)~eval(parse(text = var))+energy+sex+education+
               famaliy_history+Townsend_deprivation_index2+household_income,data=UKBdata2_3)
  HR <- exp(fit$coefficients[1])
  CI_lower <- summary(fit)$conf.int[1, 3]
  CI_upper <- summary(fit)$conf.int[1, 4]
  p_value <- summary(fit)$coef[1, 5]
  result <- rbind(result, c(HR, CI_lower, CI_upper, p_value))
}
write.csv(result,"E:/deskbook/table2_3.csv",row.names = F)
result<-c()
for (i in UKBdata2_3[,c(298,297)]){
  UKBdata2_3$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income,data=UKBdata2_3)
  result<-rbind(result,c(exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
write.csv(result,"E:/deskbook/table2_4.csv",row.names = F)
#Model 3进一步调整Smoking, alcohol, physical activity, BMI, WHR, SBP
result<-c()
var_list<-colnames(UKBdata2_3[,c(168,59)])
for (var in var_list){
  fit<-coxph(Surv(recruitment_age,status)~eval(parse(text = var))+energy+sex+education+
               famaliy_history+Townsend_deprivation_index2+household_income+
               smoking_status+alochol_drinking+weekly_activity+
               BMI+whr+SBP,data=UKBdata2_3)
  HR <- exp(fit$coefficients[1])
  CI_lower <- summary(fit)$conf.int[1, 3]
  CI_upper <- summary(fit)$conf.int[1, 4]
  p_value <- summary(fit)$coef[1, 5]
  result <- rbind(result, c(HR, CI_lower, CI_upper, p_value))
}
write.csv(result,"E:/deskbook/table2_3.csv",row.names = F)
result<-c()
for (i in UKBdata2_3[,c(298,297)]){
  UKBdata2_3$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=UKBdata2_3)
  result<-rbind(result,c(exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
write.csv(result,"E:/deskbook/table2_4.csv",row.names = F)

#10.仅针对进行过两次以上的膳食调查的人群做分析####
ICD<-fread("E:/deskbook/ICD.csv",header = T)
colnames(ICD)
table(ICD$Endpoint1)
ICD$Endpoint1[is.na(ICD$Endpoint1)] <- 0
filtered_rows <- apply(ICD, 1, function(row) {
  endpoint <- as.numeric(row["Endpoint1"])
  
  if (!is.na(endpoint)) {
    if (endpoint == 0) {
      sum(!is.na(row[80:85])) >= 2
    } else if (endpoint == 1) {
      sum(!is.na(row[80:85]) & row[80:85] < row[13]) >= 2
    } else if (endpoint == 2) {
      sum(!is.na(row[80:85]) & row[80:85] < row[14]) >= 2
    } else if (endpoint == 3) {
      sum(!is.na(row[80:85]) & row[80:85] < row[15]) >= 2
    } else if (endpoint == 4) {
      sum(!is.na(row[80:85]) & row[80:85] < row[16]) >= 2
    } else if (endpoint == 5) {
      sum(!is.na(row[80:85]) & row[80:85] < row[17]) >= 2
    } else if (endpoint == 6) {
      sum(!is.na(row[80:85]) & row[80:85] < row[18]) >= 2
    } else if (endpoint == 7) {
      sum(!is.na(row[80:85]) & row[80:85] < row[19]) >= 2
    } else {
      FALSE
    }
  } else {
    FALSE
  }
})
result_df <- ICD[filtered_rows, ]
colnames(result_df)
result_df <-subset(result_df,select = 1)
UKBdata2_3<-merge(UKBdata2,result_df)
#
table(UKBdata2_3$MIND_sum1_3group)
table(UKBdata2_3$MIND_sum1_3group,UKBdata2_3$status)
table(UKBdata2_3$MEDAS_sum1_3group)
table(UKBdata2_3$MEDAS_sum1_3group,UKBdata2_3$status)
library(survival)
colnames(UKBdata2_3)
#model 1
result<-c()
var_list<-colnames(UKBdata2_3[,c(168,59)])
for (var in var_list){
  fit<-coxph(Surv(recruitment_age,status)~eval(parse(text = var))+energy,data=UKBdata2_3)
  HR <- exp(fit$coefficients[1])
  CI_lower <- summary(fit)$conf.int[1, 3]
  CI_upper <- summary(fit)$conf.int[1, 4]
  p_value <- summary(fit)$coef[1, 5]
  result <- rbind(result, c(HR, CI_lower, CI_upper, p_value))
}
write.csv(result,"E:/deskbook/table2_3.csv",row.names = F)
result<-c()
for (i in UKBdata2_3[,c(298,297)]){
  UKBdata2_3$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy,data=UKBdata2_3)
  result<-rbind(result,c(exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
write.csv(result,"E:/deskbook/table2_4.csv",row.names = F)
#Model 2进一步调整sex,education,income, index, family history
result<-c()
var_list<-colnames(UKBdata2_3[,c(168,59)])
for (var in var_list){
  fit<-coxph(Surv(recruitment_age,status)~eval(parse(text = var))+energy+sex+education+
               famaliy_history+Townsend_deprivation_index2+household_income,data=UKBdata2_3)
  HR <- exp(fit$coefficients[1])
  CI_lower <- summary(fit)$conf.int[1, 3]
  CI_upper <- summary(fit)$conf.int[1, 4]
  p_value <- summary(fit)$coef[1, 5]
  result <- rbind(result, c(HR, CI_lower, CI_upper, p_value))
}
write.csv(result,"E:/deskbook/table2_3.csv",row.names = F)
result<-c()
for (i in UKBdata2_3[,c(298,297)]){
  UKBdata2_3$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income,data=UKBdata2_3)
  result<-rbind(result,c(exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
write.csv(result,"E:/deskbook/table2_4.csv",row.names = F)
#Model 3进一步调整Smoking, alcohol, physical activity, BMI, WHR, SBP
result<-c()
var_list<-colnames(UKBdata2_3[,c(168,59)])
for (var in var_list){
  fit<-coxph(Surv(recruitment_age,status)~eval(parse(text = var))+energy+sex+education+
               famaliy_history+Townsend_deprivation_index2+household_income+
               smoking_status+alochol_drinking+weekly_activity+
               BMI+whr+SBP,data=UKBdata2_3)
  HR <- exp(fit$coefficients[1])
  CI_lower <- summary(fit)$conf.int[1, 3]
  CI_upper <- summary(fit)$conf.int[1, 4]
  p_value <- summary(fit)$coef[1, 5]
  result <- rbind(result, c(HR, CI_lower, CI_upper, p_value))
}
write.csv(result,"E:/deskbook/table2_3.csv",row.names = F)
result<-c()
for (i in UKBdata2_3[,c(298,297)]){
  UKBdata2_3$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=UKBdata2_3)
  result<-rbind(result,c(exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
write.csv(result,"E:/deskbook/table2_4.csv",row.names = F)
#11.进一步调整吸烟和饮酒强度####
library(data.table)
UKBdata2<-fread("E:/deskbook/UKBdata2.csv",header = T)
UKBdata2$various_cancer[UKBdata2$various_cancer == "non-Hodgkin_lymphoma"] <- "non_Hodgkin_lymphoma"
UKBdata2$various_cancer[UKBdata2$various_cancer == "throid"] <- "thyroid"
UKBdata2$various_cancer[UKBdata2$various_cancer == "cervix"|UKBdata2$various_cancer == "uterine"] <- "uterus_cervix"
UKBdata2$energy<-UKBdata2$`100002_1`/4.184
smoking_intensity<-fread("E:/deskbook/smoking_intensity.csv",header = T)
UKBdata_sen11<-merge(UKBdata2,smoking_intensity,by="eid",all.x = T)
colnames(UKBdata_sen11)
missing_vals <- colSums(is.na(UKBdata_sen11[,268:321]))
print(missing_vals)
UKBdata_sen11$alcohol_frequency<-UKBdata_sen11$`1558-0.0`
summary(UKBdata_sen11$alcohol_frequency)
summary(UKBdata_sen11$`2887-0.0`)
table(UKBdata_sen11$`2887-0.0`)
UKBdata_sen11$smoking_intensity<-UKBdata_sen11$`20161-0.0`
library(tidyverse)
UKBdata_sen<-UKBdata_sen11%>%filter(!(is.na(smoking_intensity)))
table(UKBdata_sen$status)#52723obs,44021controls,8702 cases
UKBdata_sen$alcohol_frequency<-factor(UKBdata_sen$alcohol_frequency)
UKBdata_sen$MIND_sum1_3group <- cut(UKBdata_sen$MIND_sum1, 
                                 breaks = quantile(UKBdata_sen$MIND_sum1, probs = c(0, 0.33, 0.66, 1)), include.lowest = TRUE, labels = FALSE)#三分位分组
UKBdata_sen$MEDAS_sum1_3group <- cut(UKBdata_sen$MEDAS_sum1, 
                                  breaks = quantile(UKBdata_sen$MEDAS_sum1, probs = c(0, 0.33, 0.66, 1)), include.lowest = TRUE, labels = FALSE)#三分位分组                                    
#做与总癌与各个癌症的关联####
library(survival)
colnames(UKBdata_sen)
table(UKBdata_sen$various_cancer)
#总癌
UKBdata_sen_overall<-UKBdata_sen
result_overall<-c()
for (i in UKBdata_sen_overall[,c(325,324)]){
  UKBdata_sen_overall$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+smoking_intensity,data=UKBdata_sen_overall)
  result_overall<-rbind(result_overall,c(table(UKBdata_sen_overall$i),table(UKBdata_sen_overall$i,UKBdata_sen_overall$status)[,2],
                                   exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_overall)<-c("x1","x2","x3","x4","x5","x6","OR_1","OR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_overall<-data.frame(result_overall)
result_overall<-result_overall%>% mutate(diet=c("MEDAS","MIND"),.before=x1)
result_overall<-result_overall%>% mutate(cancer=c("overall"),.before=diet)
#head
UKBdata_sen_head<-subset(UKBdata_sen,various_cancer=="head_and_neck"|various_cancer==0)
result_head<-c()
for (i in UKBdata_sen_head[,c(325,324)]){
  UKBdata_sen_head$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                alochol_drinking+weekly_activity+
                BMI+whr+SBP+smoking_intensity,data=UKBdata_sen_head)
  result_head<-rbind(result_head,c(table(UKBdata_sen_head$i),table(UKBdata_sen_head$i,UKBdata_sen_head$status)[,2],
                                   exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_head)<-c("x1","x2","x3","x4","x5","x6","OR_1","OR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_head<-data.frame(result_head)
result_head<-result_head%>% mutate(diet=c("MEDAS","MIND"),.before=x1)
result_head<-result_head%>% mutate(cancer=c("head"),.before=diet)

#esophagus
UKBdata_sen_esophagus<-subset(UKBdata_sen,various_cancer=="esophagus"|various_cancer==0)
result_esophagus<-c()
for (i in UKBdata_sen_esophagus[,c(325,324)]){
  UKBdata_sen_esophagus$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+smoking_intensity+alcohol_frequency,data=UKBdata_sen_esophagus)
  result_esophagus<-rbind(result_esophagus,c(table(UKBdata_sen_esophagus$i),table(UKBdata_sen_esophagus$i,UKBdata_sen_esophagus$status)[,2],
                                             exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_esophagus)<-c("x1","x2","x3","x4","x5","x6","OR_1","OR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_esophagus<-data.frame(result_esophagus)
result_esophagus<-result_esophagus%>% mutate(diet=c("MEDAS","MIND"),.before=x1)
result_esophagus<-result_esophagus%>% mutate(cancer=c("esophagus"),.before=diet)

#stomach
UKBdata_sen_stomach<-subset(UKBdata_sen,various_cancer=="stomach"|various_cancer==0)
result_stomach<-c()
for (i in UKBdata_sen_stomach[,c(325,324)]){
  UKBdata_sen_stomach$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+smoking_intensity+alcohol_frequency,data=UKBdata_sen_stomach)
  result_stomach<-rbind(result_stomach,c(table(UKBdata_sen_stomach$i),table(UKBdata_sen_stomach$i,UKBdata_sen_stomach$status)[,2],
                                         exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_stomach)<-c("x1","x2","x3","x4","x5","x6","OR_1","OR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_stomach<-data.frame(result_stomach)
result_stomach<-result_stomach%>% mutate(diet=c("MEDAS","MIND"),.before=x1)
result_stomach<-result_stomach%>% mutate(cancer=c("stomach"),.before=diet)

#colorectal
UKBdata_sen_colorectal<-subset(UKBdata_sen,various_cancer=="colorectal"|various_cancer==0)
result_colorectal<-c()
for (i in UKBdata_sen_colorectal[,c(325,324)]){
  UKBdata_sen_colorectal$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+smoking_intensity+alcohol_frequency,data=UKBdata_sen_colorectal)
  result_colorectal<-rbind(result_colorectal,c(table(UKBdata_sen_colorectal$i),table(UKBdata_sen_colorectal$i,UKBdata_sen_colorectal$status)[,2],
                                               exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_colorectal)<-c("x1","x2","x3","x4","x5","x6","OR_1","OR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_colorectal<-data.frame(result_colorectal)
result_colorectal<-result_colorectal%>% mutate(diet=c("MEDAS","MIND"),.before=x1)
result_colorectal<-result_colorectal%>% mutate(cancer=c("colorectal"),.before=diet)

#liver
UKBdata_sen_liver<-subset(UKBdata_sen,various_cancer=="liver"|various_cancer==0)
result_liver<-c()
for (i in UKBdata_sen_liver[,c(325,324)]){
  UKBdata_sen_liver$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+smoking_intensity+alcohol_frequency,data=UKBdata_sen_liver)
  result_liver<-rbind(result_liver,c(table(UKBdata_sen_liver$i),table(UKBdata_sen_liver$i,UKBdata_sen_liver$status)[,2],
                                     exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_liver)<-c("x1","x2","x3","x4","x5","x6","OR_1","OR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_liver<-data.frame(result_liver)
result_liver<-result_liver%>% mutate(diet=c("MEDAS","MIND"),.before=x1)
result_liver<-result_liver%>% mutate(cancer=c("liver"),.before=diet)

#gallbladder
UKBdata_sen_gallbladder<-subset(UKBdata_sen,various_cancer=="gallbladder"|various_cancer==0)
result_gallbladder<-c()
for (i in UKBdata_sen_gallbladder[,c(325,324)]){
  UKBdata_sen_gallbladder$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+smoking_intensity+alcohol_frequency,data=UKBdata_sen_gallbladder)
  result_gallbladder<-rbind(result_gallbladder,c(table(UKBdata_sen_gallbladder$i),table(UKBdata_sen_gallbladder$i,UKBdata_sen_gallbladder$status)[,2],
                                                 exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_gallbladder)<-c("x1","x2","x3","x4","x5","x6","OR_1","OR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_gallbladder<-data.frame(result_gallbladder)
result_gallbladder<-result_gallbladder%>% mutate(diet=c("MEDAS","MIND"),.before=x1)
result_gallbladder<-result_gallbladder%>% mutate(cancer=c("gallbladder"),.before=diet)

#pancreas
UKBdata_sen_pancreas<-subset(UKBdata_sen,various_cancer=="pancreas"|various_cancer==0)
result_pancreas<-c()
for (i in UKBdata_sen_pancreas[,c(325,324)]){
  UKBdata_sen_pancreas$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+smoking_intensity+alcohol_frequency,data=UKBdata_sen_pancreas)
  result_pancreas<-rbind(result_pancreas,c(table(UKBdata_sen_pancreas$i),table(UKBdata_sen_pancreas$i,UKBdata_sen_pancreas$status)[,2],
                                           exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_pancreas)<-c("x1","x2","x3","x4","x5","x6","OR_1","OR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_pancreas<-data.frame(result_pancreas)
result_pancreas<-result_pancreas%>% mutate(diet=c("MEDAS","MIND"),.before=x1)
result_pancreas<-result_pancreas%>% mutate(cancer=c("pancreas"),.before=diet)

#lung
UKBdata_sen_lung<-subset(UKBdata_sen,various_cancer=="lung"|various_cancer==0)
result_lung<-c()
for (i in UKBdata_sen_lung[,c(325,324)]){
  UKBdata_sen_lung$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+smoking_intensity+alcohol_frequency,data=UKBdata_sen_lung)
  result_lung<-rbind(result_lung,c(table(UKBdata_sen_lung$i),table(UKBdata_sen_lung$i,UKBdata_sen_lung$status)[,2],
                                   exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_lung)<-c("x1","x2","x3","x4","x5","x6","OR_1","OR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_lung<-data.frame(result_lung)
result_lung<-result_lung%>% mutate(diet=c("MEDAS","MIND"),.before=x1)
result_lung<-result_lung%>% mutate(cancer=c("lung"),.before=diet)

#malignant_melanoma
UKBdata_sen_malignant_melanoma<-subset(UKBdata_sen,various_cancer=="malignant_melanoma"|various_cancer==0)
result_malignant_melanoma<-c()
for (i in UKBdata_sen_malignant_melanoma[,c(325,324)]){
  UKBdata_sen_malignant_melanoma$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+smoking_intensity+alcohol_frequency,data=UKBdata_sen_malignant_melanoma)
  result_malignant_melanoma<-rbind(result_malignant_melanoma,c(table(UKBdata_sen_malignant_melanoma$i),table(UKBdata_sen_malignant_melanoma$i,UKBdata_sen_malignant_melanoma$status)[,2],
                                                               exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_malignant_melanoma)<-c("x1","x2","x3","x4","x5","x6","OR_1","OR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_malignant_melanoma<-data.frame(result_malignant_melanoma)
result_malignant_melanoma<-result_malignant_melanoma%>% mutate(diet=c("MEDAS","MIND"),.before=x1)
result_malignant_melanoma<-result_malignant_melanoma%>% mutate(cancer=c("malignant_melanoma"),.before=diet)

#breast
UKBdata_sen_breast<-subset(UKBdata_sen,various_cancer=="breast"|various_cancer==0)
result_breast<-c()
for (i in UKBdata_sen_breast[,c(325,324)]){
  UKBdata_sen_breast$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+smoking_intensity+alcohol_frequency,data=UKBdata_sen_breast)
  result_breast<-rbind(result_breast,c(table(UKBdata_sen_breast$i),table(UKBdata_sen_breast$i,UKBdata_sen_breast$status)[,2],
                                       exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_breast)<-c("x1","x2","x3","x4","x5","x6","OR_1","OR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_breast<-data.frame(result_breast)
result_breast<-result_breast%>% mutate(diet=c("MEDAS","MIND"),.before=x1)
result_breast<-result_breast%>% mutate(cancer=c("breast"),.before=diet)

#uterine
UKBdata_sen_uterine<-subset(UKBdata_sen,various_cancer=="uterus_cervix"|various_cancer==0)
result_uterine<-c()
for (i in UKBdata_sen_uterine[,c(325,324)]){
  UKBdata_sen_uterine$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+smoking_intensity+alcohol_frequency,data=UKBdata_sen_uterine)
  result_uterine<-rbind(result_uterine,c(table(UKBdata_sen_uterine$i),table(UKBdata_sen_uterine$i,UKBdata_sen_uterine$status)[,2],
                                         exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_uterine)<-c("x1","x2","x3","x4","x5","x6","OR_1","OR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_uterine<-data.frame(result_uterine)
result_uterine<-result_uterine%>% mutate(diet=c("MEDAS","MIND"),.before=x1)
result_uterine<-result_uterine%>% mutate(cancer=c("uterine"),.before=diet)

#ovary
UKBdata_sen_ovary<-subset(UKBdata_sen,various_cancer=="ovary"|various_cancer==0)
result_ovary<-c()
for (i in UKBdata_sen_ovary[,c(325,324)]){
  UKBdata_sen_ovary$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+smoking_intensity+alcohol_frequency,data=UKBdata_sen_ovary)
  result_ovary<-rbind(result_ovary,c(table(UKBdata_sen_ovary$i),table(UKBdata_sen_ovary$i,UKBdata_sen_ovary$status)[,2],
                                     exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_ovary)<-c("x1","x2","x3","x4","x5","x6","OR_1","OR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_ovary<-data.frame(result_ovary)
result_ovary<-result_ovary%>% mutate(diet=c("MEDAS","MIND"),.before=x1)
result_ovary<-result_ovary%>% mutate(cancer=c("ovary"),.before=diet)


#prostate
UKBdata_sen_prostate<-subset(UKBdata_sen,various_cancer=="prostate"|various_cancer==0)
result_prostate<-c()
for (i in UKBdata_sen_prostate[,c(325,324)]){
  UKBdata_sen_prostate$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+smoking_intensity+alcohol_frequency,data=UKBdata_sen_prostate)
  result_prostate<-rbind(result_prostate,c(table(UKBdata_sen_prostate$i),table(UKBdata_sen_prostate$i,UKBdata_sen_prostate$status)[,2],
                                           exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_prostate)<-c("x1","x2","x3","x4","x5","x6","OR_1","OR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_prostate<-data.frame(result_prostate)
result_prostate<-result_prostate%>% mutate(diet=c("MEDAS","MIND"),.before=x1)
result_prostate<-result_prostate%>% mutate(cancer=c("prostate"),.before=diet)


#testic
UKBdata_sen_testic<-subset(UKBdata_sen,various_cancer=="testic"|various_cancer==0)
result_testic<-c()
for (i in UKBdata_sen_testic[,c(325,324)]){
  UKBdata_sen_testic$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+smoking_intensity+alcohol_frequency,data=UKBdata_sen_testic)
  result_testic<-rbind(result_testic,c(table(UKBdata_sen_testic$i),table(UKBdata_sen_testic$i,UKBdata_sen_testic$status)[,2],
                                       exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_testic)<-c("x1","x2","x3","x4","x5","x6","OR_1","OR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_testic<-data.frame(result_testic)
result_testic<-result_testic%>% mutate(diet=c("MEDAS","MIND"),.before=x1)
result_testic<-result_testic%>% mutate(cancer=c("testic"),.before=diet)


#kidney
UKBdata_sen_kidney<-subset(UKBdata_sen,various_cancer=="kidney"|various_cancer==0)
result_kidney<-c()
for (i in UKBdata_sen_kidney[,c(325,324)]){
  UKBdata_sen_kidney$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+smoking_intensity+alcohol_frequency,data=UKBdata_sen_kidney)
  result_kidney<-rbind(result_kidney,c(table(UKBdata_sen_kidney$i),table(UKBdata_sen_kidney$i,UKBdata_sen_kidney$status)[,2],
                                       exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_kidney)<-c("x1","x2","x3","x4","x5","x6","OR_1","OR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_kidney<-data.frame(result_kidney)
result_kidney<-result_kidney%>% mutate(diet=c("MEDAS","MIND"),.before=x1)
result_kidney<-result_kidney%>% mutate(cancer=c("kidney"),.before=diet)


#bladder
UKBdata_sen_bladder<-subset(UKBdata_sen,various_cancer=="bladder"|various_cancer==0)
result_bladder<-c()
for (i in UKBdata_sen_bladder[,c(325,324)]){
  UKBdata_sen_bladder$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+smoking_intensity+alcohol_frequency,data=UKBdata_sen_bladder)
  result_bladder<-rbind(result_bladder,c(table(UKBdata_sen_bladder$i),table(UKBdata_sen_bladder$i,UKBdata_sen_bladder$status)[,2],
                                         exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_bladder)<-c("x1","x2","x3","x4","x5","x6","OR_1","OR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_bladder<-data.frame(result_bladder)
result_bladder<-result_bladder%>% mutate(diet=c("MEDAS","MIND"),.before=x1)
result_bladder<-result_bladder%>% mutate(cancer=c("bladder"),.before=diet)


#brain
UKBdata_sen_brain<-subset(UKBdata_sen,various_cancer=="brain"|various_cancer==0)
result_brain<-c()
for (i in UKBdata_sen_brain[,c(325,324)]){
  UKBdata_sen_brain$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+smoking_intensity+alcohol_frequency,data=UKBdata_sen_brain)
  result_brain<-rbind(result_brain,c(table(UKBdata_sen_brain$i),table(UKBdata_sen_brain$i,UKBdata_sen_brain$status)[,2],
                                     exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_brain)<-c("x1","x2","x3","x4","x5","x6","OR_1","OR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_brain<-data.frame(result_brain)
result_brain<-result_brain%>% mutate(diet=c("MEDAS","MIND"),.before=x1)
result_brain<-result_brain%>% mutate(cancer=c("brain"),.before=diet)


#thyroid
UKBdata_sen_thyroid<-subset(UKBdata_sen,various_cancer=="thyroid"|various_cancer==0)
result_thyroid<-c()
for (i in UKBdata_sen_thyroid[,c(325,324)]){
  UKBdata_sen_thyroid$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+smoking_intensity+alcohol_frequency,data=UKBdata_sen_thyroid)
  result_thyroid<-rbind(result_thyroid,c(table(UKBdata_sen_thyroid$i),table(UKBdata_sen_thyroid$i,UKBdata_sen_thyroid$status)[,2],
                                         exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_thyroid)<-c("x1","x2","x3","x4","x5","x6","OR_1","OR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_thyroid<-data.frame(result_thyroid)
result_thyroid<-result_thyroid%>% mutate(diet=c("MEDAS","MIND"),.before=x1)
result_thyroid<-result_thyroid%>% mutate(cancer=c("thyroid"),.before=diet)


#Hodgkin_lymphoma
UKBdata_sen_Hodgkin_lymphoma<-subset(UKBdata_sen,various_cancer=="Hodgkin_lymphoma"|various_cancer==0)
result_Hodgkin_lymphoma<-c()
for (i in UKBdata_sen_Hodgkin_lymphoma[,c(325,324)]){
  UKBdata_sen_Hodgkin_lymphoma$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+smoking_intensity+alcohol_frequency,data=UKBdata_sen_Hodgkin_lymphoma)
  result_Hodgkin_lymphoma<-rbind(result_Hodgkin_lymphoma,c(table(UKBdata_sen_Hodgkin_lymphoma$i),table(UKBdata_sen_Hodgkin_lymphoma$i,UKBdata_sen_Hodgkin_lymphoma$status)[,2],
                                                           exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_Hodgkin_lymphoma)<-c("x1","x2","x3","x4","x5","x6","OR_1","OR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_Hodgkin_lymphoma<-data.frame(result_Hodgkin_lymphoma)
result_Hodgkin_lymphoma<-result_Hodgkin_lymphoma%>% mutate(diet=c("MEDAS","MIND"),.before=x1)
result_Hodgkin_lymphoma<-result_Hodgkin_lymphoma%>% mutate(cancer=c("Hodgkin_lymphoma"),.before=diet)

#non_Hodgkin_lymphoma
UKBdata_sen_non_Hodgkin_lymphoma<-subset(UKBdata_sen,various_cancer=="non_Hodgkin_lymphoma"|various_cancer==0)
result_non_Hodgkin_lymphoma<-c()
for (i in UKBdata_sen_non_Hodgkin_lymphoma[,c(325,324)]){
  UKBdata_sen_non_Hodgkin_lymphoma$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+smoking_intensity+alcohol_frequency,data=UKBdata_sen_non_Hodgkin_lymphoma)
  result_non_Hodgkin_lymphoma<-rbind(result_non_Hodgkin_lymphoma,c(table(UKBdata_sen_non_Hodgkin_lymphoma$i),table(UKBdata_sen_non_Hodgkin_lymphoma$i,UKBdata_sen_non_Hodgkin_lymphoma$status)[,2],
                                                                   exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_non_Hodgkin_lymphoma)<-c("x1","x2","x3","x4","x5","x6","OR_1","OR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_non_Hodgkin_lymphoma<-data.frame(result_non_Hodgkin_lymphoma)
result_non_Hodgkin_lymphoma<-result_non_Hodgkin_lymphoma%>% mutate(diet=c("MEDAS","MIND"),.before=x1)
result_non_Hodgkin_lymphoma<-result_non_Hodgkin_lymphoma%>% mutate(cancer=c("non_Hodgkin_lymphoma"),.before=diet)

#multiple_myeloma
UKBdata_sen_multiple_myeloma<-subset(UKBdata_sen,various_cancer=="multiple_myeloma"|various_cancer==0)
result_multiple_myeloma<-c()
for (i in UKBdata_sen_multiple_myeloma[,c(325,324)]){
  UKBdata_sen_multiple_myeloma$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+smoking_intensity+alcohol_frequency,data=UKBdata_sen_multiple_myeloma)
  result_multiple_myeloma<-rbind(result_multiple_myeloma,c(table(UKBdata_sen_multiple_myeloma$i),table(UKBdata_sen_multiple_myeloma$i,UKBdata_sen_multiple_myeloma$status)[,2],
                                                           exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_multiple_myeloma)<-c("x1","x2","x3","x4","x5","x6","OR_1","OR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_multiple_myeloma<-data.frame(result_multiple_myeloma)
result_multiple_myeloma<-result_multiple_myeloma%>% mutate(diet=c("MEDAS","MIND"),.before=x1)
result_multiple_myeloma<-result_multiple_myeloma%>% mutate(cancer=c("multiple_myeloma"),.before=diet)

#leukemia
UKBdata_sen_leukemia<-subset(UKBdata_sen,various_cancer=="leukemia"|various_cancer==0)
result_leukemia<-c()
for (i in UKBdata_sen_leukemia[,c(325,324)]){
  UKBdata_sen_leukemia$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP+smoking_intensity+alcohol_frequency,data=UKBdata_sen_leukemia)
  result_leukemia<-rbind(result_leukemia,c(table(UKBdata_sen_leukemia$i),table(UKBdata_sen_leukemia$i,UKBdata_sen_leukemia$status)[,2],
                                           exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_leukemia)<-c("x1","x2","x3","x4","x5","x6","OR_1","OR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_leukemia<-data.frame(result_leukemia)
result_leukemia<-result_leukemia%>% mutate(diet=c("MEDAS","MIND"),.before=x1)
result_leukemia<-result_leukemia%>% mutate(cancer=c("leukemia"),.before=diet)


#合并
result_sen_various_cancer<-rbind(result_overall,result_head,result_esophagus,result_stomach,result_colorectal,
                             result_liver,result_gallbladder,result_pancreas,result_lung,result_malignant_melanoma,
                             result_breast,result_uterine,result_ovary,result_prostate,result_testic,
                             result_kidney,result_bladder,result_brain,result_thyroid,result_Hodgkin_lymphoma,
                             result_non_Hodgkin_lymphoma,result_multiple_myeloma,result_leukemia)
write.csv(result_sen_various_cancer,"E:/deskbook/result_sen_various_cancer.csv",row.names = F)
#不调整
#总癌
UKBdata_sen_overall<-UKBdata_sen
result_overall<-c()
for (i in UKBdata_sen_overall[,c(325,324)]){
  UKBdata_sen_overall$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=UKBdata_sen_overall)
  result_overall<-rbind(result_overall,c(table(UKBdata_sen_overall$i),table(UKBdata_sen_overall$i,UKBdata_sen_overall$status)[,2],
                                         exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_overall)<-c("x1","x2","x3","x4","x5","x6","OR_1","OR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_overall<-data.frame(result_overall)
result_overall<-result_overall%>% mutate(diet=c("MEDAS","MIND"),.before=x1)
result_overall<-result_overall%>% mutate(cancer=c("overall"),.before=diet)
#head
UKBdata_sen_head<-subset(UKBdata_sen,various_cancer=="head_and_neck"|various_cancer==0)
result_head<-c()
for (i in UKBdata_sen_head[,c(325,324)]){
  UKBdata_sen_head$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=UKBdata_sen_head)
  result_head<-rbind(result_head,c(table(UKBdata_sen_head$i),table(UKBdata_sen_head$i,UKBdata_sen_head$status)[,2],
                                   exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_head)<-c("x1","x2","x3","x4","x5","x6","OR_1","OR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_head<-data.frame(result_head)
result_head<-result_head%>% mutate(diet=c("MEDAS","MIND"),.before=x1)
result_head<-result_head%>% mutate(cancer=c("head"),.before=diet)

#esophagus
UKBdata_sen_esophagus<-subset(UKBdata_sen,various_cancer=="esophagus"|various_cancer==0)
result_esophagus<-c()
for (i in UKBdata_sen_esophagus[,c(325,324)]){
  UKBdata_sen_esophagus$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=UKBdata_sen_esophagus)
  result_esophagus<-rbind(result_esophagus,c(table(UKBdata_sen_esophagus$i),table(UKBdata_sen_esophagus$i,UKBdata_sen_esophagus$status)[,2],
                                             exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_esophagus)<-c("x1","x2","x3","x4","x5","x6","OR_1","OR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_esophagus<-data.frame(result_esophagus)
result_esophagus<-result_esophagus%>% mutate(diet=c("MEDAS","MIND"),.before=x1)
result_esophagus<-result_esophagus%>% mutate(cancer=c("esophagus"),.before=diet)
#lung
UKBdata_sen_lung<-subset(UKBdata_sen,various_cancer=="lung"|various_cancer==0)
result_lung<-c()
for (i in UKBdata_sen_lung[,c(325,324)]){
  UKBdata_sen_lung$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=UKBdata_sen_lung)
  result_lung<-rbind(result_lung,c(table(UKBdata_sen_lung$i),table(UKBdata_sen_lung$i,UKBdata_sen_lung$status)[,2],
                                   exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
colnames(result_lung)<-c("x1","x2","x3","x4","x5","x6","OR_1","OR_2","LCL_1","LCL_2","UCL_1","UCL_2","P1","P2")
result_lung<-data.frame(result_lung)
result_lung<-result_lung%>% mutate(diet=c("MEDAS","MIND"),.before=x1)
result_lung<-result_lung%>% mutate(cancer=c("lung"),.before=diet)
#合并
result_sen_various_cancer<-rbind(result_overall,result_head,result_esophagus,result_lung)
write.csv(result_sen_various_cancer,"E:/deskbook/result_sen_various_cancer.csv",row.names = F)
#12.用不同地中海评分####
library(data.table)
library(survival)
UKBdata2<-fread("E:/deskbook/UKBdata2.csv",header=T)
colnames(UKBdata2)
UKBdata2$various_cancer[UKBdata2$various_cancer == "non-Hodgkin_lymphoma"] <- "non_Hodgkin_lymphoma"
UKBdata2$various_cancer[UKBdata2$various_cancer == "throid"] <- "thyroid"
UKBdata2$various_cancer[UKBdata2$various_cancer == "cervix"|UKBdata2$various_cancer == "uterine"] <- "uterus_cervix"
UKBdata2$MIND_sum1_3group <- cut(UKBdata2$MIND_sum1, 
                                 breaks = quantile(UKBdata2$MIND_sum1, probs = c(0, 0.33, 0.66, 1)), include.lowest = TRUE, labels = FALSE)#三分位分组
UKBdata2$MEDAS_sum1_3group <- cut(UKBdata2$MEDAS_sum1, 
                                  breaks = quantile(UKBdata2$MEDAS_sum1, probs = c(0, 0.33, 0.66, 1)), include.lowest = TRUE, labels = FALSE)#三分位分组
UKBdata2$energy<-UKBdata2$`100002_1`/4.184
ffqdata<-fread("E:/deskbook/ffqdata.csv",header=T)
colnames(ffqdata)
ffqdata2_1<-subset(ffqdata,select=c(1))
ffqdata2_2<-subset(ffqdata,select=c(199))
colnames(ffqdata2_2) <- paste0("a", gsub(" ", "_", colnames(ffqdata2_2)))
ffqdata2<-cbind(ffqdata2_1,ffqdata2_2)
UKBdata2<-merge(UKBdata2,ffqdata2,all.x = T,by="eid")
colnames(UKBdata2)
####MEDAS_continous####
#Vegetables_sum1
UKBdata2$Vegetables_sum1_score1<-ifelse(UKBdata2$Vegetables_sum1>=2,1,ifelse(UKBdata2$a104090_1>=1,1,
                                                                             ifelse(UKBdata2$Vegetables_sum1==0,0,
                                                                                    ifelse(UKBdata2$a104090_1==0,0,NA))))#大于2份蔬菜或者大于一份沙拉
UKBdata2$Vegetables_sum1_score1[is.na(UKBdata2$Vegetables_sum1_score1)]<-0
#fruit
UKBdata2$fruit_sum1_score1<-ifelse(UKBdata2$fruit_sum1>=3,1,ifelse(UKBdata2$fruit_sum1_score1==0,0,NA))
summary(UKBdata2$fruit_sum1_score1)
UKBdata2$fruit_sum1_score1[is.na(UKBdata2$fruit_sum1_score1)]<-0
#red meat
UKBdata2$Mred_meat_sum1_score1<-ifelse(UKBdata2$red_meat_sum1>=2,0,
                                       ifelse(UKBdata2$red_meat_sum1<1,1,NA))
table(UKBdata2$Mred_meat_sum1_score1)
summary(UKBdata2$Mred_meat_sum1_score1)
fit1<-lm(Mred_meat_sum1_score1~red_meat_sum1,data=UKBdata2)
summary(fit1)$coe[2,1]
UKBdata2$Mred_meat_sum1_score1<-ifelse(UKBdata2$red_meat_sum1<1,1,
                                       ifelse(UKBdata2$red_meat_sum1>=2,0,
                                              UKBdata2$red_meat_sum1*summary(fit1)$coe[2,1]))
UKBdata2$Mred_meat_sum1_score1[UKBdata2$Mred_meat_sum1_score1<=0]<-0                                      
#butter
UKBdata2$MButter_sum1_score1<-ifelse(UKBdata2$Butter_sum1>=2,0,
                                    ifelse(UKBdata2$Butter_sum1<1,1,NA))
summary(UKBdata2$MButter_sum1_score1)
UKBdata2$MButter_sum1_score1[is.na(UKBdata2$fruit_sum1_score1)]<-0
#sweetend
UKBdata2$MSweetened_sum1_score1<-ifelse(UKBdata2$Sweetened_sum1>=2,0,
                                        ifelse(UKBdata2$Sweetened_sum1<1,1,NA))
summary(UKBdata2$MSweetened_sum1_score1)
fit2<-lm(MSweetened_sum1_score1~Sweetened_sum1,data=UKBdata2)
UKBdata2$MSweetened_sum1_score1<-ifelse(UKBdata2$Sweetened_sum1>=2,0,
                                        ifelse(UKBdata2$Sweetened_sum1<1,1,
                                       UKBdata2$Sweetened_sum1*summary(fit2)$coe[2,1]))
UKBdata2$MSweetened_sum1_score1[UKBdata2$MSweetened_sum1_score1<=0]<-0
#wine
UKBdata2$Mwine_sum1_score1<-ifelse(UKBdata2$wine_sum1>=1,1,0)
#legumes
3/7
UKBdata2$Mbean_sum1_score1<-ifelse(UKBdata2$bean_sum1>=0.428571,1,
                                  ifelse(UKBdata2$bean_sum1==0,0,NA))
str(UKBdata2$Mbean_sum1_score1)
fit3<-lm(Mbean_sum1_score1~bean_sum1,data=UKBdata2)
UKBdata2$Mbean_sum1_score1<-ifelse(UKBdata2$bean_sum1>=0.428571,1,
                                   ifelse(UKBdata2$bean_sum1==0,0,
                                          UKBdata2$bean_sum1*summary(fit3)$coe[2,1]))
#seafood
UKBdata2$Mfish_sum1_score1<-ifelse(UKBdata2$fish_sum1>=0.428571,1,
                                   ifelse(UKBdata2$fish_sum1==0,0,NA))
summary(UKBdata2$Mfish_sum1_score1)
fit4<-lm(Mfish_sum1_score1~fish_sum1,data=UKBdata2)
UKBdata2$Mfish_sum1_score1<-ifelse(UKBdata2$fish_sum1>=0.428571,1,
                                   ifelse(UKBdata2$fish_sum1==0,0,
                                          UKBdata2$fish_sum1*summary(fit4)$coe[2,1]))
#sweets
2/7,4/7
UKBdata2$MPastries_sweets_sum1_score1<-ifelse(UKBdata2$Pastries_sweets_sum1>=0.5714286,0,
                                              ifelse(UKBdata2$Pastries_sweets_sum1<0.2857143,1,NA))
summary(UKBdata2$MPastries_sweets_sum1_score1)
fit5<-lm(MPastries_sweets_sum1_score1~Pastries_sweets_sum1,data=UKBdata2)
UKBdata2$MPastries_sweets_sum1_score1<-ifelse(UKBdata2$Pastries_sweets_sum1>=0.5714286,0,
                                              ifelse(UKBdata2$Pastries_sweets_sum1<0.2857143,1,
                                                     UKBdata2$Pastries_sweets_sum1*summary(fit5)$coe[2,1]))
UKBdata2$MPastries_sweets_sum1_score1[UKBdata2$MPastries_sweets_sum1_score1<=0]<-0 
#nuts
3/7
UKBdata2$MNuts_sum1_score1<-ifelse(UKBdata2$Nuts_sum1>=0.428571,1,
                                   ifelse(UKBdata2$Nuts_sum1==0,0,NA))
summary(UKBdata2$MNuts_sum1_score1)
fit6<-lm(MNuts_sum1_score1~Nuts_sum1,data=UKBdata2)
UKBdata2$MNuts_sum1_score1<-ifelse(UKBdata2$Nuts_sum1>=0.428571,1,
                                   ifelse(UKBdata2$Nuts_sum1==0,0,
                                          UKBdata2$Nuts_sum1*summary(fit6)$coe[2,1]))
#white meat
UKBdata2$Mpoultry_sum1_score1<-ifelse(UKBdata2$poultry_sum1>UKBdata2$red_meat_sum1,1,0)
#总分
UKBdata2[,MEDAS_sum1_continous:= rowSums(.SD, na.rm = TRUE), .SDcols = c("Vegetables_sum1_score1","fruit_sum1_score1",
                                                               "Mred_meat_sum1_score1","MButter_sum1_score1","MSweetened_sum1_score1",
                                                               "Mwine_sum1_score1","Mbean_sum1_score1","Mfish_sum1_score1","MPastries_sweets_sum1_score1",
                                                               "MNuts_sum1_score1","Mpoultry_sum1_score1")]
table(UKBdata2[,MEDAS_sum1_continous])
UKBdata2$MEDAS_sum1_continous_3group <- cut(UKBdata2$MEDAS_sum1_continous, 
                                  breaks = quantile(UKBdata2$MEDAS_sum1_continous, probs = c(0, 0.33, 0.66, 1)), include.lowest = TRUE, labels = FALSE)#三分位分组
#Model 1仅进行能量调整
table(UKBdata2$MEDAS_sum1_continous_3group)
table(UKBdata2$MEDAS_sum1_continous_3group,UKBdata2$status)
table(UKBdata2$MEDAS_sum1_continous_3group,UKBdata2$MEDAS_sum1_continous)
colnames(UKBdata2)
result<-c()
var_list<-colnames(UKBdata2[,c(282)])
for (var in var_list){
  fit<-coxph(Surv(recruitment_age,status)~eval(parse(text = var))+energy,data=UKBdata2)
  HR <- exp(fit$coefficients[1])
  CI_lower <- summary(fit)$conf.int[1, 3]
  CI_upper <- summary(fit)$conf.int[1, 4]
  p_value <- summary(fit)$coef[1, 5]
  result <- rbind(result, c(HR, CI_lower, CI_upper, p_value))
}
write.csv(result,"E:/deskbook/table2_1.csv",row.names = F)
result<-c()
for (i in UKBdata2[,c(287)]){
  UKBdata2$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy,data=UKBdata2)
  result<-rbind(result,c(exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
write.csv(result,"E:/deskbook/table2_2.csv",row.names = F)
#Model 2进一步调整sex,education,income, index, family history
result<-c()
var_list<-colnames(UKBdata2[,c(282)])
for (var in var_list){
  fit<-coxph(Surv(recruitment_age,status)~eval(parse(text = var))+energy+sex+education+
               famaliy_history+Townsend_deprivation_index2+household_income,data=UKBdata2)
  HR <- exp(fit$coefficients[1])
  CI_lower <- summary(fit)$conf.int[1, 3]
  CI_upper <- summary(fit)$conf.int[1, 4]
  p_value <- summary(fit)$coef[1, 5]
  result <- rbind(result, c(HR, CI_lower, CI_upper, p_value))
}
write.csv(result,"E:/deskbook/table2_3.csv",row.names = F)
result<-c()
for (i in UKBdata2[,c(287)]){
  UKBdata2$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income,data=UKBdata2)
  result<-rbind(result,c(exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
write.csv(result,"E:/deskbook/table2_4.csv",row.names = F)
#Model 3进一步调整Smoking, alcohol, physical activity, BMI, WHR, SBP
result<-c()
var_list<-colnames(UKBdata2[,c(282)])
for (var in var_list){
  fit<-coxph(Surv(recruitment_age,status)~eval(parse(text = var))+energy+sex+education+
               famaliy_history+Townsend_deprivation_index2+household_income+
               smoking_status+alochol_drinking+weekly_activity+
               BMI+whr+SBP,data=UKBdata2)
  HR <- exp(fit$coefficients[1])
  CI_lower <- summary(fit)$conf.int[1, 3]
  CI_upper <- summary(fit)$conf.int[1, 4]
  p_value <- summary(fit)$coef[1, 5]
  result <- rbind(result, c(HR, CI_lower, CI_upper, p_value))
}
write.csv(result,"E:/deskbook/table2_3.csv",row.names = F)
result<-c()
for (i in UKBdata2[,c(287)]){
  UKBdata2$i<-factor(i)
  fiti<-coxph(Surv(recruitment_age,status)~i+energy+sex+education+
                famaliy_history+Townsend_deprivation_index2+household_income+
                smoking_status+alochol_drinking+weekly_activity+
                BMI+whr+SBP,data=UKBdata2)
  result<-rbind(result,c(exp(fiti$coefficients[1:2]),summary(fiti)$conf.int[1:2,3:4],summary(fiti)$coef[1:2,5]))
}
write.csv(result,"E:/deskbook/table2_4.csv",row.names = F)
#计算中位随访时间####
library(data.table)
ICD<-fread("E:/deskbook/ICD.csv",header = T)
colnames(ICD)
table(ICD$Endpoint1)
ICD$Endpoint1[is.na(ICD$Endpoint1)] <- 0
#转换成时间编码
ICD$`53-0.0` <- as.POSIXct(ICD$`53-0.0`, format="%Y/%m/%d")
ICD$`40005-0.0` <- as.POSIXct(ICD$`40005-0.0`, format="%Y/%m/%d")
ICD$`40005-1.0` <- as.POSIXct(ICD$`40005-1.0`, format="%Y/%m/%d")
ICD$`40005-2.0` <- as.POSIXct(ICD$`40005-2.0`, format="%Y/%m/%d")
ICD$`40005-3.0` <- as.POSIXct(ICD$`40005-3.0`, format="%Y/%m/%d")
ICD$`40005-4.0` <- as.POSIXct(ICD$`40005-4.0`, format="%Y/%m/%d")
ICD$`40005-5.0` <- as.POSIXct(ICD$`40005-5.0`, format="%Y/%m/%d")
ICD$`40005-6.0` <- as.POSIXct(ICD$`40005-6.0`, format="%Y/%m/%d")
#计算
ICD$follow_up_time<-0
ICD$follow_up_time2 <- as.POSIXct("2022/08/31", format="%Y/%m/%d")
ICD$follow_up_time2<- as.Date(ICD$follow_up_time2)
ICD$follow_up_time <- ifelse(ICD$Endpoint1==0,(difftime(ICD$follow_up_time2, ICD$`53-0.0`, units = "weeks"))/52,
                             ifelse(ICD$Endpoint1==1,(difftime(ICD$`40005-0.0`, ICD$`53-0.0`, units = "weeks"))/52,
                                    ifelse(ICD$Endpoint1==2,(difftime(ICD$`40005-1.0`, ICD$`53-0.0`, units = "weeks"))/52,
                                           ifelse(ICD$Endpoint1==3,(difftime(ICD$`40005-2.0`, ICD$`53-0.0`, units = "weeks"))/52,
                                                  ifelse(ICD$Endpoint1==4,(difftime(ICD$`40005-3.0`, ICD$`53-0.0`, units = "weeks"))/52,
                                                         ifelse(ICD$Endpoint1==5,(difftime(ICD$`40005-4.0`, ICD$`53-0.0`, units = "weeks"))/52,
                                                                ifelse(ICD$Endpoint1==6,(difftime(ICD$`40005-5.0`, ICD$`53-0.0`, units = "weeks"))/52,
                                                                       ifelse(ICD$Endpoint1==7,(difftime(ICD$`40005-6.0`, ICD$`53-0.0`, units = "weeks"))/52,NA))))))))
ICD_follow_up<-subset(ICD,select = c(1,85))
UKBdata2<-fread("E:/deskbook/UKBdata2.csv",header = T)
UKBdata_follow<-merge(UKBdata2,ICD_follow_up,all.x = T,by="eid")
summary(UKBdata_follow$follow_up_time)
colnames(UKBdata_follow)
#计算中位随访年龄
library(survival)
fit<-survfit(Surv(follow_up_time,status==0)~1,data=UKBdata_follow)
fit
